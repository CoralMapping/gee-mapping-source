/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var wcmc = ee.FeatureCollection("projects/coral_atlas/global_datasets/wcmc_reefs_2018v4_dissolved"),
    low_rrs = ee.Image("projects/coral_atlas/workflow/mapping/eastern_png_and_solomons/eastern_png_and_solomons_low_tide_normalized_sr_may2018_may2020_v2_shift_mosaic/20200530T220905Z/eastern_png_and_solomons_low_tide_normalized_sr_may2018_may2020_v2_shift_mosaic"),
    Artifact_layer = /* color: #98ff00 */ee.Geometry.MultiPolygon(
        [[[[133.87823474549796, -0.4089792032861279],
           [133.63653552674796, -1.2987640172814356],
           [134.26275622987296, -2.901638046434227],
           [135.18560779237296, -3.680374916452446],
           [135.93267810487296, -3.384307934312925],
           [136.67974841737296, -2.7370426506771937],
           [141.32696521424796, -3.1759097861941235],
           [143.4279701191011, -4.259070182025207],
           [145.6691810566011, -5.8786331785618025],
           [146.5480873066011, -6.490284053493718],
           [146.8776771503511, -7.798378392835013],
           [147.6906654316011, -8.559593192736711],
           [148.4816810566011, -7.515281003123185],
           [149.31140410379453, -6.323085296945845],
           [148.7783119159761, -5.829452527797415],
           [148.11862548736215, -5.198240891526597],
           [147.2951576191011, -5.003695852147759],
           [146.5920326191011, -3.9084008385224744],
           [142.7687904316011, -2.043326425476854],
           [136.8361732441011, -0.13213848083636925],
           [135.2101966816011, 0.1974508549526587],
           [134.3532630878511, 0.17547831519620935]]],
         [[[151.68811485734636, -4.985234424733032],
           [151.46289513078386, -4.547302031346837],
           [150.85864708390886, -4.667761071909342],
           [150.7075727286196, -4.971498668283573],
           [150.91907188859636, -5.20956328424697],
           [151.22119591203386, -5.2150337336424],
           [151.31457970109636, -5.154856179259612]]],
         [[[148.29333946672136, -5.269735597524267],
           [148.47461388078386, -5.559573881564838],
           [149.94678184953386, -5.625178101912731],
           [149.95227501359636, -5.4556856112092955],
           [149.67761681047136, -5.182210323933331],
           [148.50757286515886, -5.258795608490538]]]]),
    image = ee.Image("projects/coral_atlas/workflow/mapping/eastern_png_and_solomons/eastern_png_and_solomons_high_tide_normalized_sr_may2018_may2020_v2_shift_mosaic/20200531T191050Z/eastern_png_and_solomons_high_tide_normalized_sr_may2018_may2020_v2_shift_mosaic_depth"),
    noReef_mask = 
    /* color: #ff0000 */
    /* shown: false */
    ee.Geometry.MultiPolygon(
        [[[[136.23460438801584, -2.629275602393311],
           [136.54427215599102, -2.6962787263763],
           [137.36482013102457, -2.6642552504268946],
           [139.9995688809453, -2.5488413084834396],
           [140.07921983543994, -2.3677343285527304],
           [140.06823358805778, -2.329314547708212],
           [140.09020640950374, -2.1854847510356965],
           [140.1231655546508, -2.0345255557659154],
           [139.63448174799328, -1.9669377329328368],
           [139.49441008227905, -2.0918267724754664],
           [139.5314881643882, -2.116529138763426],
           [139.52736506429588, -2.1590732891643567],
           [139.4779267245694, -2.149467044103999],
           [139.44702752783493, -2.1364300548067074],
           [139.43123492792634, -2.1137861921821144],
           [139.45595566720115, -2.08359346232172],
           [139.48754244073766, -2.090454349328754],
           [139.54384696346003, -1.9923256158176599],
           [139.5246187017566, -1.9339977952593315],
           [139.36257072084962, -1.8543904470764119],
           [139.27742670959822, -2.0177183714923896],
           [139.24996091781156, -2.052028911291586],
           [139.2183752982711, -2.032815066888063],
           [139.22661505062067, -1.9998765582770235],
           [139.3158789203569, -1.8379195014091445],
           [139.15383091818813, -1.743208750439816],
           [139.1140055109585, -1.8022318777858688],
           [139.0453410146064, -1.9271349034216445],
           [139.03160811474413, -1.957329886529148],
           [139.00276905663648, -1.9573298729370465],
           [138.9835430281675, -1.9339974195429486],
           [138.99727592261027, -1.91340970740139],
           [139.03023484752666, -1.913409722828662],
           [139.11812540735292, -1.748699334409607],
           [138.91773994280973, -1.5812461623387108],
           [138.86504146035546, -1.676821768127756],
           [138.80204113775144, -1.7325886201906302],
           [138.71861290024526, -1.67047400566644],
           [138.68943055312397, -1.6172809060505622],
           [138.67535436102222, -1.4878959602114388],
           [138.80169701766204, -1.262741578012466],
           [138.6314091475644, -1.1419187033444245],
           [138.12603852128439, -0.9332130799140748],
           [137.35699635552635, -1.0485527089145301],
           [136.9944485474737, -1.5098621463199164],
           [136.86947954194483, -1.612818145966949],
           [136.98895568769177, -1.7157737768162993],
           [137.07409974041192, -1.824211687443526],
           [137.08783288063466, -1.8736240112529094],
           [137.05487379382166, -1.892840019458443],
           [137.00268881657726, -1.884604837618182],
           [136.8969455186693, -1.8338247953769289],
           [136.7307777778106, -1.9436237149937916],
           [136.40668192102845, -2.058910156772861],
           [136.10455880821428, -2.2016340367542937]]],
         [[[140.71373901908086, -2.519074775282059],
           [140.81673584525274, -2.393534125840512],
           [140.64782105033086, -2.3029730415497327],
           [140.511865239784, -2.2899372546960612],
           [140.41024170462774, -2.307775669833533],
           [140.35531006400274, -2.3516846576705537],
           [140.3745361382215, -2.41411536419168],
           [140.43221436087774, -2.4834032269293895]]],
         [[[141.01554161343432, -2.387859721554285],
           [140.81778770718432, -2.8103972628843534],
           [143.70169883999682, -3.8358778782129113],
           [144.47623497280932, -3.9893279430452173],
           [144.861104733211, -4.114675941761769],
           [144.99808555874682, -3.872872867174884],
           [144.57648521694995, -3.6796593376325206],
           [144.47552778474923, -3.593346729811558],
           [144.08072716030932, -3.5288961647240895],
           [143.73053795132495, -3.3493190968681943],
           [143.60693752278266, -3.490864395121523],
           [143.51767784390307, -3.431572330714073],
           [143.49059614019686, -3.412637628239037],
           [143.46711920932088, -3.403297989914695],
           [143.44535929714593, -3.397899047607604],
           [143.42566025255888, -3.3918146080873],
           [143.3956183987176, -3.3777633645023197],
           [143.4136420139484, -3.3458902334157075],
           [143.30962425503589, -3.2876246268176796],
           [143.21555382046557, -3.2293541220233344],
           [142.62228591753225, -3.0515008073622583],
           [142.5452147010249, -3.052256989853185],
           [142.52375977021381, -3.0948364536741915],
           [142.49474882336892, -3.1183889132894542],
           [142.50530539369186, -3.1493624488793324],
           [142.4980092648015, -3.1721086640064704],
           [142.4666499559995, -3.161155754741027],
           [142.45039778869068, -3.131005394371224],
           [142.46948817473128, -3.111787510014121],
           [142.4940711264162, -3.102168014898324],
           [142.5382918119067, -3.049447468494804],
           [142.49530847595784, -3.0296389838063837],
           [142.44401743960728, -3.020190317366411],
           [142.4159365767008, -3.0770604152104624],
           [142.4218444790445, -3.1137014765581057],
           [142.41134446803005, -3.125618030331904],
           [142.39741101603315, -3.1320494428617125],
           [142.3884272183513, -3.1284569050030293],
           [142.38871320960297, -3.1159511828595705],
           [142.43803684947088, -3.0189993360011136],
           [141.11991173062182, -2.3933481048259027]]],
         [[[145.21952800346358, -4.2738047138002],
           [145.20785502983077, -4.305301928527081],
           [145.24562053276046, -4.3981678926099725],
           [145.27995280815108, -4.395429393667492],
           [145.32115153861983, -4.405014095909013],
           [145.33767395566056, -4.411689210082155],
           [145.34956149650557, -4.40698236769878],
           [145.36852999193823, -4.434879814516641],
           [145.35411052299483, -4.441297919007947],
           [145.35814454404175, -4.44912781605429],
           [145.36475352836592, -4.447202429309091],
           [145.37131974775963, -4.43920148412537],
           [145.3854388307375, -4.440699112586922],
           [145.4168527562712, -4.458412311356147],
           [145.42505499768322, -4.479889606114662],
           [145.4325038877046, -4.487975519783595],
           [145.4455840002671, -4.486713220665236],
           [145.45426985631863, -4.490360341485443],
           [145.45591770358362, -4.498542421633423],
           [145.46867141018305, -4.527761992604998],
           [145.50022366735283, -4.557579367043024],
           [145.5944364507292, -4.678125161332891],
           [145.70567302299483, -4.5515075843828035],
           [145.47529899424939, -4.342791359648398],
           [145.3880950147572, -4.271581916429295],
           [145.30913078135876, -4.266103991729912]]],
         [[[145.6133541386202, -5.370215193785555],
           [145.6298336308077, -5.586204004849849],
           [145.85779993940145, -5.6067051817884765],
           [145.98551600385457, -5.471384228231634],
           [145.96628992963582, -5.331930621906449],
           [145.9319576542452, -5.225268206335136],
           [145.82166488984257, -5.211602215155205],
           [145.80887776375215, -5.205110192988256],
           [145.66416590619832, -5.237576342001267]]],
         [[[147.6394295424008, -6.575348731674722],
           [147.53780600724454, -6.5535201300551575],
           [146.9417977064633, -6.509860063645987],
           [146.76876303849454, -6.613546476096603],
           [146.7275643080258, -6.913567550664378],
           [146.8319344252133, -7.235196480466454],
           [147.2878670424008, -7.6845455744788485],
           [147.68200156388517, -7.921285558025248],
           [147.8914299826872, -7.6450335761539545],
           [147.7932381361508, -7.491245934917704],
           [147.6943611830258, -7.360515750107844],
           [147.8207039564633, -6.889027412822765],
           [147.70809409318204, -6.594447971880935]]],
         [[[149.81287598377014, -9.759604790651878],
           [149.60550904041077, -9.752837640550407],
           [149.61649536853577, -9.926033168752364],
           [149.61512207752014, -10.366723373189567],
           [149.61939415201212, -10.42549656293051],
           [149.69775615974652, -10.442722973453531],
           [149.73487565213944, -10.372312060934986],
           [149.79533110499034, -10.378887446325564],
           [149.84786256143937, -10.489024044005982],
           [149.85939776293532, -10.517380249720935],
           [149.89840077160318, -10.513328348413188],
           [150.0774910875286, -10.587905093132598],
           [150.30382752185608, -10.354565274760462],
           [150.39171814685608, -10.293092127730384],
           [150.4418432689264, -10.249175398193326],
           [150.51188111072327, -10.141046796732594],
           [150.40476441150452, -10.07615208629753],
           [150.14246582752014, -9.954439356985928],
           [149.9859106517389, -9.913858333176595],
           [149.86368775134827, -9.793438477225978]]],
         [[[149.1330497016487, -10.07562241966596],
           [147.40769482517518, -9.303519832356724],
           [147.12067700290956, -9.021520241975242],
           [146.98884106540956, -9.022876542165095],
           [146.78422070408143, -9.16254802067035],
           [146.89683056736268, -9.23439647027281],
           [147.02317334080018, -9.285901445006068],
           [147.24701977634706, -9.437322722045637],
           [147.3046979990033, -9.464754391339842],
           [147.46772932938347, -9.71120175974356],
           [147.502404927528, -9.74910076048838],
           [147.557336568153, -9.888139535562015],
           [147.7166383259655, -10.012386656871596],
           [147.72899794510613, -10.102592211320342],
           [147.80727553299675, -10.088395914131285],
           [147.85499739578972, -10.09583214790848],
           [147.87662672928582, -10.096508160641845],
           [147.89859938553582, -10.090085982345293],
           [147.9411714070202, -10.091100019015665],
           [148.03043532303582, -10.12929307165367],
           [148.05309462479363, -10.123547504405641],
           [148.06923079422722, -10.130982924787082],
           [148.04897475174675, -10.168833298345833],
           [148.0894868367077, -10.161736694410031],
           [148.13755202225457, -10.151598415511087],
           [148.15780806473504, -10.139770017491028],
           [148.17119765213738, -10.09718417195499],
           [148.17428755692254, -10.087673632874168],
           [148.1938569538952, -10.084293462258763],
           [148.27865767411004, -10.08125127838205],
           [148.33324599198113, -10.129922768567774],
           [148.31298994950066, -10.183317710019587],
           [148.36208510330925, -10.222175499868428],
           [148.40946364334832, -10.227919292180234],
           [148.54335951737175, -10.218796750000491],
           [148.57340025833855, -10.19666505077138],
           [148.58610320023308, -10.183148752757864],
           [148.61837553910027, -10.181628133375215],
           [148.64566969803582, -10.19075174091424],
           [148.66575407913933, -10.210180775290585],
           [148.68618178299675, -10.212208084459595],
           [148.70351958206902, -10.234000841388886],
           [148.74780821732293, -10.231973671264896],
           [148.79467177323113, -10.250048814305924],
           [148.8861396370809, -10.251844181847616],
           [148.93969798669028, -10.28292408243113],
           [148.98638988122153, -10.29238257597236],
           [149.03720164879965, -10.28292408243113],
           [149.16903758629965, -10.28697775722295],
           [149.29400706872153, -10.330213712283271],
           [149.35168529137778, -10.17345525916007]]]]),
    imageVisParam = {"opacity":1,"bands":["b3","b2","b1"],"min":26.14,"max":1280.86,"gamma":0.43900000000000006};
/***** End of imports. If edited, may not auto-convert in the playground. *****/
//Viewing script for looking at reefs and classifications for each region. In this case png and salomon 
//From this region Hawaii onwards the map_viewer script is going to be used from the very beginning
//in the workflow.

//RB: I set initially this viewer for CR to draw artifact layers and set the mask 1) noReef_mask, 2) mid_mask and 3) refined_mask

// imports
/*
var pkg_vis = require('users/mitchest/global_reefs:Modules/pkg_vis')
var map_palettes = require('users/mitchest/global_reefs:Modules/colour_pals')
*/
// choose where to centre (link this dynamically to map app?)

Map.setCenter(147.86087035000003, -7.199000717379121, 5)

/*
//4. add turbidity for reference
Map.addLayer(turbidity.focal_mode(5), {min:5, max:20, palette: ['#ffffe5','#fff7bc','#fee391','#fec44f','#fe9929','#ec7014','#cc4c02','#993404','#662506']}, "Accumulative turbidity (smooth)", false)
Map.addLayer(turbidity, {min:5, max:20, palette: ['#ffffe5','#fff7bc','#fee391','#fec44f','#fe9929','#ec7014','#cc4c02','#993404','#662506']}, "Accumulative turbidity", false)
*/


// add some background data
//Map.addLayer(any_rrs, {bands: ['b3','b2','b1'], min: 66, max: 1260}, "Any tide mosaic", false)
//Map.addLayer(high_rrs, {bands: ['b3','b2','b1'], min: 66, max: 1260}, "High tide mosaic", false)

var imageVisParam = {"opacity":1,"bands":["b3","b2","b1"],"min":26.14,"max":1280.86,"gamma":1};
Map.addLayer(low_rrs, imageVisParam, 'Dove sr lowtide', true)
//Map.addLayer(Artifact_layer, {color: 'ffff00'}, 'Artifact Layer', false)

//Map.addLayer(any_depth, {min: -1, max: 1200, palette:['#d0d1e6','#a6bddb','#74a9cf','#3690c0','#0570b0','#045a8d','#023858']}, "Any tide depth", false)
//Map.addLayer(high_depth, {min: -1, max: 1200, palette:['#d0d1e6','#a6bddb','#74a9cf','#3690c0','#0570b0','#045a8d','#023858']}, "High tide depth", false)
//Map.addLayer(low_depth, {min: -1, max: 1200, palette:['#d0d1e6','#a6bddb','#74a9cf','#3690c0','#0570b0','#045a8d','#023858']}, "Low tide depth", false)
//Map.addLayer(pixels.select('depth'), {min: -1, max: 2500, palette:['#d0d1e6','#a6bddb','#74a9cf','#3690c0','#0570b0','#045a8d','#023858']}, "Depth covariate (S2/LS8/Dove)", false)

/*
// Hawaii classification


Map.addLayer(ee.ImageCollection([hawaii_geo_west, hawaii_geo_east]).mosaic(), map_palettes.geo, "Geo RAW", false)
Map.addLayer(geo_clean_p2, map_palettes.geo, "Geo Clean Pass 2", false)
Map.addLayer(geo_clean_man, map_palettes.geo, "Geo Clean Manual (FINAL)", true)
Map.addLayer(ee.ImageCollection([hawaii_benthic_west, hawaii_benthic_east]).mosaic(), map_palettes.benthic, "Benthic RAW", false)
Map.addLayer(benthic_clean, map_palettes.benthic, "Benthic Clean (FINAL)", true)

// wave data
//var kd1 = ee.Image('users/danleeharris/reefwave/fiji_v1_kd1')
//var kd2 = ee.Image('users/danleeharris/reefwave/fiji_v1_kd2')

//Map.addLayer(kd1, {}, "waves - kd1", false)
//Map.addLayer(kd2, {}, "waves - kd2", false)

// add training data / sample point distributions
// ----> possibly - points are only intermediate in the mapping script, so will have to pull those out if we want that
//Map.addLayer(ee.Image().byte().paint(fiji_training_geo_oldmaps, 'class_num'), map_palettes.geo, "Training data - geo (old maps) ", false)
//Map.addLayer(ee.Image().byte().paint(fiji_training_geo, 'class_num'), map_palettes.geo, "Training data - geo (new maps)", false)
//Map.addLayer(ee.Image().byte().paint(fiji_training_benthic, 'class_num'), map_palettes.benthic, "Training - benthic (manual curation)", false)
//Map.addLayer(geo_train, {}, "geomorphic training locations", false)

*/

// WCMC

Map.addLayer(Artifact_layer, {color: 'ffff00'}, 'Artifact Layer', false)
//Map.addLayer(any_depth, {min: -1, max: 1200, palette:['#d0d1e6','#a6bddb','#74a9cf','#3690c0','#0570b0','#045a8d','#023858']}, "Any tide depth", false)
//Map.addLayer(high_depth, {min: -1, max: 1200, palette:['#d0d1e6','#a6bddb','#74a9cf','#3690c0','#0570b0','#045a8d','#023858']}, "High tide depth", false)
//Map.addLayer(low_depth, {min: -1, max: 1200, palette:['#d0d1e6','#a6bddb','#74a9cf','#3690c0','#0570b0','#045a8d','#023858']}, "Low tide depth", false)
//Map.addLayer(pixels.select('depth'), {min: -1, max: 2500, palette:['#d0d1e6','#a6bddb','#74a9cf','#3690c0','#0570b0','#045a8d','#023858']}, "Depth covariate (S2/LS8/Dove)", false)

// wave data
//var kd1 = ee.Image('users/danleeharris/reefwave/fiji_v1_kd1')
//var kd2 = ee.Image('users/danleeharris/reefwave/fiji_v1_kd2')

//Map.addLayer(kd1, {}, "waves - kd1", false)
//Map.addLayer(kd2, {}, "waves - kd2", false)

var region_wcmcBound = 
    ee.Geometry.Polygon(
        [[[133.27621531509237, -3.6964607454528933],
          [134.77035594009237, -4.6606761835234165],
          [138.02230906509237, -2.8189834208112403],
          [143.29574656509237, -4.485454607626794],
          [146.81137156509237, -8.32775342522801],
          [145.58090281509237, -9.369872642992746],
          [146.72348094009237, -10.408873647930577],
          [149.36019969009237, -11.960805457501285],
          [153.31527781509237, -12.5620026138334],
          [155.77621531509237, -12.132715510948076],
          [157.79769969009237, -10.235937480088639],
          [157.88559031509237, -11.616658821605727],
          [161.04965281509237, -14.101349060999887],
          [161.40121531509237, -13.24736423000143],
          [161.40121531509237, -12.390372354418293],
          [162.36801219009237, -11.874809336893126],
          [163.77426219009237, -9.369872642992746],
          [163.33480906509237, -7.544319839235769],
          [161.04965281509237, -4.6606761835234165],
          [149.88754344009237, -0.2712922865886533],
          [148.56918406509237, -1.2379938346478028],
          [147.07504344009237, -1.2379938346478028],
          [146.10824656509237, -0.09551200607302315],
          [142.76840281509237, -0.7107281976529471],
          [142.15316844009237, -2.467795559859385],
          [135.12191844009237, 0.6954864947804655],
          [133.45199656509237, -0.44707001364412374]]]);


var wcmc=wcmc.filterBounds(region_wcmcBound)

Map.addLayer(wcmc, {color:'#ffff00'}, "WCMC layer", false)

// #############
// example confidence layers




/*
// depth and nir combos
var depth_nir_flag = fiji_dove_ocean.select('b4').multiply(fiji_high_depth_ocean).gt(250000)
//Map.addLayer(depth_nir_flag, {}, "NIR flag", false)
var conf_flag = fiji_high_depth_ocean.eq(-1)
                        .or(fiji_high_depth_ocean.gt(1000))
                        .add(depth_nir_flag.eq(1))
                        .selfMask()
Map.addLayer(conf_flag, {min:1,max:2,palette:["#f7f7f7","#bababa"]}, "Confidence flag", false)

//straight depth missing/-1
var depth_flag = fiji_high_depth_ocean.gt(0).selfMask()
//Map.addLayer(depth_flag, {min:0,max:1,palette:["#ffff00"]}, "Valid depth retrievals", false)

//Map.addLayer(fiji_geo_clean.gt(0).updateMask(fiji_high_depth_ocean.lte(0)), {min:0,max:1,palette:["#ff0000"]}, "Unmapped area via original algorithm", false)
*/


////////// UI SET UP //////////

/*
//Generate title
var title = ui.Label({
  value: 'Coral Atlas map classes',
  style: {fontWeight: 'bold', fontSize: '18px'}
})

// generate the legend
var geo_legend = pkg_vis.discrete_legend(map_palettes.geo_atlas_names, map_palettes.geo_atlas_cols, 'Geomorphic Zone', false)
var benthic_legend = pkg_vis.discrete_legend(map_palettes.benthic_atlas_names, map_palettes.benthic_atlas_cols, 'Benthic Habitat', false)
//var mask_legend = pkg_vis.discrete_legend(["Low confidence depth","Water conditions"], ["#f7f7f7","#bababa"], 'Confidence Mask reason', false)
pkg_vis.add_lgds([title, geo_legend, benthic_legend])//, mask_legend])
// generate the legend

var conf_str = {"opacity":1,"bands":["constant"],"min":0,"max":9,"palette":["4d004b","810f7c","88419d","8c6bb1","8c96c6","9ebcda","bfd3e6","e0ecf4","f7fcfd"]};
Map.addLayer(benthic_conf_clean,conf_str,'confidence_benthic',true);
Map.addLayer(geo_conf_clean,conf_str,'confidence_geo',true);


//Confidence layer panel

var legend=ui.Panel({
  style: {
    position: 'bottom-right',
    padding: "8px 15px"
  }
});

//var vis = {min: 'low', max: 'high', palette: 'ece2f0,a6bddb,1c9099'};
var vis = {min: 'low', max: 'high', palette: '4d004b,810f7c,88419d,8c6bb1,8c96c6,9ebcda,bfd3e6,e0ecf4,f7fcfd'};

function makeColorBarParams(palette) {
  return {
    bbox: [0, 0, 1, 0.1],
    dimensions: '100x10',
    format: 'png',
    min: 0,
    max: 1,
    palette: palette,
  };
}

var colorBar=ui.Thumbnail({
  image: ee.Image.pixelLonLat().select(0),
  params: makeColorBarParams(vis.palette),
  style:{stretch:'horizontal', margin: '0px 8px',maxHeight: '24px'}
})
// Create a panel with three numbers for the legend.
var legendLabels = ui.Panel({
  widgets: [
    ui.Label(vis.min, {margin: '4px 8px'}),
    ui.Label(
        (' '),
        {margin: '4px 8px', textAlign: 'center', stretch: 'horizontal'}),
    ui.Label(vis.max, {margin: '4px 8px'})
  ],
  layout: ui.Panel.Layout.flow('horizontal')
});

var legendTitle = ui.Label({
  value: 'Confidence Layer',
  style: {fontWeight: 'bold',position: 'bottom-right'}
});

legend.add(legendTitle);
legend.add(colorBar)
legend.add(legendLabels);

Map.add(legend)

*/