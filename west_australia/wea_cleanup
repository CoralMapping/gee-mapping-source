/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var imageVisParam = {"opacity":1,"bands":["depth"],"min":1500,"max":2500,"gamma":1},
    imageVisParam2 = {"opacity":1,"bands":["b3","b2","b1"],"min":44.94,"max":2202.06,"gamma":1},
    waves = ee.Image("projects/coral_atlas/coral_sea/in_out/cosea_waves"),
    wavespng = ee.Image("projects/coral_atlas/png_solomons/in_out/pns_waves"),
    wcmc = ee.FeatureCollection("projects/coral_atlas/global_datasets/wcmc_reefs_2018v4_dissolved"),
    midMask = 
    /* color: #15d623 */
    /* shown: false */
    ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.1836661868681,
                -28.06032233118577
              ],
              [
                113.98592109753788,
                -28.149958979225445
              ],
              [
                113.93099201841366,
                -28.29757442089106
              ],
              [
                113.89803477459687,
                -28.59942534714115
              ],
              [
                113.88910645970527,
                -28.739193431038426
              ],
              [
                113.97727390196623,
                -28.817412918752858
              ],
              [
                114.04359722536742,
                -28.912432857086305
              ],
              [
                114.00447247489087,
                -28.955689713174205
              ],
              [
                113.98866817328616,
                -29.00855374403404
              ],
              [
                113.93924354728621,
                -29.00858646548108
              ],
              [
                113.88708352892287,
                -28.985779691464067
              ],
              [
                113.74972660573967,
                -29.0661835563608
              ],
              [
                114.36493259739895,
                -30.021905267375896
              ],
              [
                114.88401168509729,
                -30.031416884215687
              ],
              [
                114.99974312829477,
                -30.026070516607547
              ],
              [
                115.00760720732957,
                -29.928526985624377
              ],
              [
                115.00120255843638,
                -29.867675270621586
              ],
              [
                114.97825897857251,
                -29.75975361075793
              ],
              [
                114.93240702685796,
                -29.76077813970033
              ],
              [
                114.89909283248286,
                -29.82535815480512
              ],
              [
                114.84828401828509,
                -29.80793695001803
              ],
              [
                114.84144409526559,
                -29.772500592397247
              ],
              [
                114.86654842118445,
                -29.752539798010364
              ],
              [
                114.89488672415692,
                -29.767893620567243
              ],
              [
                114.96853273611804,
                -29.762985915759927
              ],
              [
                115.00284250400888,
                -29.695903064880497
              ],
              [
                115.00025273751571,
                -29.66532559945509
              ],
              [
                114.99936306124128,
                -29.645476019369674
              ],
              [
                115.0172722702817,
                -29.49854766913029
              ],
              [
                114.86752847021478,
                -29.06256786138556
              ],
              [
                114.29627107023296,
                -28.091824773631906
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.50234545982664,
                -28.396491874993792
              ],
              [
                113.50234545982664,
                -28.595632967130076
              ],
              [
                113.61083545006102,
                -28.713732555400057
              ],
              [
                113.69460620201414,
                -28.699278530764694
              ],
              [
                113.70833911217039,
                -28.67879857836598
              ],
              [
                113.73992480552977,
                -28.657109557537577
              ],
              [
                113.73168505943602,
                -28.57754476767505
              ],
              [
                113.67812670982664,
                -28.53412039829782
              ],
              [
                113.63555468834227,
                -28.43876530955035
              ],
              [
                113.61770190513914,
                -28.417026793914967
              ],
              [
                113.59435595787352,
                -28.420650189889194
              ],
              [
                113.58336962974852,
                -28.36145253546554
              ],
              [
                113.55590380943602,
                -28.337280731161993
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.5806230477173,
                -28.70228995056192
              ],
              [
                113.56002368248292,
                -28.75286884112655
              ],
              [
                113.57238330162352,
                -28.884620025231996
              ],
              [
                113.74129809654539,
                -28.907463979857145
              ],
              [
                113.75640429771727,
                -28.828089708010445
              ],
              [
                113.7124589852173,
                -28.781760072103076
              ],
              [
                113.68429875402951,
                -28.724869930834945
              ],
              [
                113.66302050865477,
                -28.716141365354744
              ],
              [
                113.62731618784753,
                -28.70108881986832
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.05027808421829,
                -25.977109950762614
              ],
              [
                112.9768033624551,
                -25.87088581332177
              ],
              [
                112.89989529084477,
                -25.712607878930417
              ],
              [
                112.90744773154938,
                -25.658150870024723
              ],
              [
                112.90675928898702,
                -25.613572809221694
              ],
              [
                112.89508759284297,
                -25.58137462385972
              ],
              [
                112.94384280373139,
                -25.464877023284547
              ],
              [
                113.00839310167525,
                -25.453718966977476
              ],
              [
                113.02624427032114,
                -25.261356244014493
              ],
              [
                113.08667194308616,
                -24.97286582127021
              ],
              [
                113.11139229789039,
                -24.693680024688025
              ],
              [
                113.11413899961032,
                -24.651248692742108
              ],
              [
                112.68839878844574,
                -24.67870582460446
              ],
              [
                112.63621050438971,
                -25.62596031411836
              ],
              [
                113.06195167022929,
                -26.25087273594089
              ],
              [
                113.15534014637095,
                -26.18187593424453
              ],
              [
                113.14294506685577,
                -26.127616941563428
              ],
              [
                113.17246950763216,
                -26.115290179822736
              ],
              [
                113.14053392268852,
                -26.050541687809414
              ],
              [
                113.12826415236354,
                -26.028178431329287
              ],
              [
                113.11050757229783,
                -26.000877533607962
              ],
              [
                113.09464256065954,
                -25.984676251549843
              ],
              [
                113.08741303232267,
                -25.977075895753696
              ],
              [
                113.07640784796945,
                -25.971944151312474
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.1663236734847,
                -24.742086798546435
              ],
              [
                113.165639588348,
                -24.75003314779473
              ],
              [
                113.14778424477379,
                -24.80879537857701
              ],
              [
                113.13130475258629,
                -24.864877617980873
              ],
              [
                113.13679791664879,
                -24.937123878316612
              ],
              [
                113.1210050699691,
                -24.978833040738607
              ],
              [
                113.11757184243004,
                -24.996259547107453
              ],
              [
                113.10795880532066,
                -25.0839768797355
              ],
              [
                113.07911969399254,
                -25.243076048594684
              ],
              [
                113.07225323891441,
                -25.27660949366275
              ],
              [
                113.07431166158666,
                -25.317570503752627
              ],
              [
                113.03139642039015,
                -25.361012710144717
              ],
              [
                113.04426952243102,
                -25.4422736735502
              ],
              [
                113.04135419106282,
                -25.436386768222327
              ],
              [
                113.03242779946126,
                -25.432976258216264
              ],
              [
                113.00222337823048,
                -25.46459743495317
              ],
              [
                112.96650983071129,
                -25.491251692027685
              ],
              [
                113.07796605718215,
                -25.903525204798587
              ],
              [
                113.2180417407759,
                -26.14539847570156
              ],
              [
                113.21211902754008,
                -26.15071307221869
              ],
              [
                113.21649634197533,
                -26.156952437283408
              ],
              [
                113.21422156507609,
                -26.16018823368154
              ],
              [
                113.20459716653747,
                -26.15240723007114
              ],
              [
                113.19909875677274,
                -26.15236867249034
              ],
              [
                113.19875286695583,
                -26.148188880099443
              ],
              [
                113.19394388429282,
                -26.147707246431303
              ],
              [
                113.1893823509455,
                -26.143171323572545
              ],
              [
                113.18138799510123,
                -26.140176120570107
              ],
              [
                113.1759686415129,
                -26.13718068980998
              ],
              [
                113.1750124621622,
                -26.140965825319615
              ],
              [
                113.17530686200223,
                -26.150866293805183
              ],
              [
                113.18206260010061,
                -26.152696038408163
              ],
              [
                113.18710222789889,
                -26.169471896972432
              ],
              [
                113.20937197456468,
                -26.18114099218013
              ],
              [
                113.21465075253174,
                -26.18052519098388
              ],
              [
                113.2176337379222,
                -26.18129575048076
              ],
              [
                113.22216161382278,
                -26.195931265470545
              ],
              [
                113.57372411382278,
                -26.616591966350505
              ],
              [
                113.68770726811965,
                -26.712316784494284
              ],
              [
                114.0420163501509,
                -26.635006820843106
              ],
              [
                114.2727292407759,
                -26.394152613214064
              ],
              [
                114.30431493413528,
                -25.85286631221671
              ],
              [
                113.97884496343215,
                -25.419531642296313
              ],
              [
                113.76049169194778,
                -24.988092075520207
              ],
              [
                113.64376195561965,
                -24.609109417692817
              ],
              [
                113.47210057866653,
                -24.479192404774693
              ],
              [
                113.42954830082147,
                -24.526518002705377
              ],
              [
                113.3773434985884,
                -24.583823627067652
              ],
              [
                113.1853831619744,
                -24.72506541782513
              ],
              [
                113.17276416502726,
                -24.73451188804948
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.43075222637924,
                -24.49991439427579
              ],
              [
                113.43058056500229,
                -24.49116659257073
              ],
              [
                113.42628903057846,
                -24.48835466993762
              ],
              [
                113.42182583477768,
                -24.48616757554278
              ],
              [
                113.4202808823851,
                -24.486323797831982
              ],
              [
                113.41839260723862,
                -24.48616757554278
              ],
              [
                113.41701931622299,
                -24.48507401408658
              ],
              [
                113.41890759136948,
                -24.48366799253293
              ],
              [
                113.41701931622299,
                -24.482105727934115
              ],
              [
                113.4144443955687,
                -24.47898114054617
              ],
              [
                113.41598934796127,
                -24.474606587868674
              ],
              [
                113.41204113629135,
                -24.470700608786753
              ],
              [
                113.41272778179916,
                -24.452106487238
              ],
              [
                113.40809292462143,
                -24.436791620577086
              ],
              [
                113.40774960186752,
                -24.429446075447533
              ],
              [
                113.40757794049057,
                -24.424913504394784
              ],
              [
                113.40809292462143,
                -24.420068162156465
              ],
              [
                113.4063763108519,
                -24.41694203616576
              ],
              [
                113.40448803570541,
                -24.414597390855928
              ],
              [
                113.40551800396713,
                -24.41100218345742
              ],
              [
                113.40448803570541,
                -24.408657427817317
              ],
              [
                113.40500301983627,
                -24.4059999854499
              ],
              [
                113.40362972882065,
                -24.40318616198398
              ],
              [
                113.40483135845932,
                -24.400684932936308
              ],
              [
                113.4063763108519,
                -24.398808978643995
              ],
              [
                113.40740627911362,
                -24.395525991592883
              ],
              [
                113.40710480061233,
                -24.392708032859524
              ],
              [
                113.40607483235061,
                -24.389737571477816
              ],
              [
                113.4050448640889,
                -24.386454348712206
              ],
              [
                113.40452987995803,
                -24.38317104065453
              ],
              [
                113.40521652546585,
                -24.381451178587724
              ],
              [
                113.40521652546585,
                -24.380200355115175
              ],
              [
                113.4050448640889,
                -24.37863680837134
              ],
              [
                113.40641815510452,
                -24.377698671043724
              ],
              [
                113.40744810808478,
                -24.376799626274117
              ],
              [
                113.40658980597551,
                -24.373867881121424
              ],
              [
                113.40727646198928,
                -24.37363332885784
              ],
              [
                113.40847809162796,
                -24.3720697009091
              ],
              [
                113.40899307575881,
                -24.36956785598075
              ],
              [
                113.41019470539749,
                -24.36628410941345
              ],
              [
                113.41070968952835,
                -24.361749271641845
              ],
              [
                113.41191131916702,
                -24.358308941464074
              ],
              [
                113.41036636677444,
                -24.349394923676446
              ],
              [
                113.40950805988967,
                -24.34376469429997
              ],
              [
                113.40916473713577,
                -24.33954185798837
              ],
              [
                113.40916473713577,
                -24.33344195698695
              ],
              [
                113.40967972126663,
                -24.33093934853551
              ],
              [
                113.40779144612014,
                -24.326246824468758
              ],
              [
                113.40985138264358,
                -24.32264910501926
              ],
              [
                113.408306430251,
                -24.315922659976387
              ],
              [
                113.40864975300491,
                -24.30763143443458
              ],
              [
                113.41051730864795,
                -24.304642830447026
              ],
              [
                113.40931567900928,
                -24.301513851530533
              ],
              [
                113.410345647271,
                -24.298541250089276
              ],
              [
                113.40365085356984,
                -24.29353460606044
              ],
              [
                113.40038928740773,
                -24.286963086080203
              ],
              [
                113.40038928740773,
                -24.284146616249544
              ],
              [
                113.39918765776906,
                -24.27866996831764
              ],
              [
                113.39695605986867,
                -24.27147172905988
              ],
              [
                113.39575443023,
                -24.263490595791783
              ],
              [
                113.39558276885305,
                -24.260986607564323
              ],
              [
                113.39386615508351,
                -24.255665468823025
              ],
              [
                113.3931795095757,
                -24.25284830521843
              ],
              [
                113.39403781646047,
                -24.250500621209184
              ],
              [
                113.39918765776905,
                -24.246587718228845
              ],
              [
                113.39815768950733,
                -24.24189207577825
              ],
              [
                113.3938661550835,
                -24.235004820055643
              ],
              [
                113.39317950957569,
                -24.23062182690695
              ],
              [
                113.39180621856006,
                -24.228273732786473
              ],
              [
                113.39180621856006,
                -24.227334483012672
              ],
              [
                113.39163455718311,
                -24.22592559536084
              ],
              [
                113.39403781646045,
                -24.22780410876566
              ],
              [
                113.39541110747608,
                -24.228117191638667
              ],
              [
                113.39747104399952,
                -24.228117191638667
              ],
              [
                113.399359319146,
                -24.227177940710067
              ],
              [
                113.4022775625542,
                -24.228430273741814
              ],
              [
                113.40468082183155,
                -24.228586814504677
              ],
              [
                113.40605411284717,
                -24.228586814504677
              ],
              [
                113.40811404937061,
                -24.229212975631455
              ],
              [
                113.40965900176319,
                -24.22889989545301
              ],
              [
                113.41120395415577,
                -24.229056435638462
              ],
              [
                113.41377887481006,
                -24.22686485552752
              ],
              [
                113.41635379546436,
                -24.223890507898677
              ],
              [
                113.41686877959522,
                -24.22107264079883
              ],
              [
                113.41944370024952,
                -24.21856781770379
              ],
              [
                113.421331975396,
                -24.216845723252895
              ],
              [
                113.42373523467334,
                -24.214967048209946
              ],
              [
                113.42562350981983,
                -24.213714582790168
              ],
              [
                113.42785510772022,
                -24.211992422734298
              ],
              [
                113.4294000601128,
                -24.21089649057934
              ],
              [
                113.43111667388233,
                -24.209800548998526
              ],
              [
                113.432318303521,
                -24.208391467402095
              ],
              [
                113.43386325591358,
                -24.2069823702254
              ],
              [
                113.43575153106006,
                -24.204477270110274
              ],
              [
                113.4378114675835,
                -24.20353784487341
              ],
              [
                113.43901309722217,
                -24.199780074692733
              ],
              [
                113.44124469512256,
                -24.19899719196308
              ],
              [
                113.44416293853077,
                -24.19743141208193
              ],
              [
                113.44793948882374,
                -24.19508270620731
              ],
              [
                113.44999942534717,
                -24.18928904675979
              ],
              [
                113.4517160391167,
                -24.184747886464663
              ],
              [
                113.45291766875538,
                -24.17848395184973
              ],
              [
                113.45446262114795,
                -24.169713926847493
              ],
              [
                113.45745456273664,
                -24.1567143887473
              ],
              [
                113.45110309178938,
                -24.1220947112061
              ],
              [
                113.46251492082399,
                -24.010496156202013
              ],
              [
                113.4577084022693,
                -24.00877126018026
              ],
              [
                113.45753674089235,
                -24.00406688074608
              ],
              [
                113.45959667741579,
                -23.99748046056028
              ],
              [
                113.46131329118532,
                -23.994500778784605
              ],
              [
                113.46062664567751,
                -23.98948221146373
              ],
              [
                113.46062664567751,
                -23.984777126933423
              ],
              [
                113.46114162980837,
                -23.977876025330403
              ],
              [
                113.4654331642322,
                -23.971915685503628
              ],
              [
                113.46646313249391,
                -23.968778553797403
              ],
              [
                113.4654331642322,
                -23.965013894947642
              ],
              [
                113.46440319597048,
                -23.959994178777603
              ],
              [
                113.46371655046266,
                -23.956072389529112
              ],
              [
                113.46440319597048,
                -23.953719258727585
              ],
              [
                113.46491818010134,
                -23.948699102855294
              ],
              [
                113.46371655046266,
                -23.945561406220307
              ],
              [
                113.46457485734743,
                -23.9414822865125
              ],
              [
                113.46337322770876,
                -23.93630475657455
              ],
              [
                113.46217159807009,
                -23.924536870719614
              ],
              [
                113.4657764869861,
                -23.91622025134583
              ],
              [
                113.4683514076404,
                -23.910570921518445
              ],
              [
                113.46886639177126,
                -23.90350891193601
              ],
              [
                113.46783642350954,
                -23.896603462857744
              ],
              [
                113.47058300554079,
                -23.891267181443773
              ],
              [
                113.47607616960329,
                -23.882477532144915
              ],
              [
                113.48405929642053,
                -23.875883307130206
              ],
              [
                113.48371597366662,
                -23.86944732169806
              ],
              [
                113.48680587845178,
                -23.867092612945168
              ],
              [
                113.49264236526818,
                -23.86410992039102
              ],
              [
                113.50204384764822,
                -23.857640458799615
              ],
              [
                113.5087386413494,
                -23.849633544585046
              ],
              [
                113.51251519164236,
                -23.8422541856166
              ],
              [
                113.51320183715018,
                -23.829692608687495
              ],
              [
                113.51440346678885,
                -23.818386149341343
              ],
              [
                113.51612008055838,
                -23.809748607053557
              ],
              [
                113.51612008055838,
                -23.80268109959309
              ],
              [
                113.51577675780447,
                -23.79545613892475
              ],
              [
                113.5171500488201,
                -23.78901616143415
              ],
              [
                113.51920998534354,
                -23.783518367197548
              ],
              [
                113.51835167845877,
                -23.777391979744905
              ],
              [
                113.52229989012869,
                -23.77267917760803
              ],
              [
                113.52659142455252,
                -23.764509916079252
              ],
              [
                113.53431618651541,
                -23.754297617920194
              ],
              [
                113.5475341125408,
                -23.74581294557535
              ],
              [
                113.55646050414236,
                -23.737799136345174
              ],
              [
                113.56452858885916,
                -23.72051277174128
              ],
              [
                113.57585823973807,
                -23.70133794136689
              ],
              [
                113.58100808104666,
                -23.69127788714512
              ],
              [
                113.5856429382244,
                -23.671941544333787
              ],
              [
                113.59010545931471,
                -23.65559050184579
              ],
              [
                113.59680025301589,
                -23.643168162632527
              ],
              [
                113.60538332186354,
                -23.624925628986446
              ],
              [
                113.61224977694167,
                -23.609354560383785
              ],
              [
                113.61705629549635,
                -23.59975934448608
              ],
              [
                113.62392275057448,
                -23.59362433031709
              ],
              [
                113.63147585116042,
                -23.580094823662318
              ],
              [
                113.63902895174635,
                -23.577577552262074
              ],
              [
                113.65705339632643,
                -23.562315561222366
              ],
              [
                113.67353288851393,
                -23.55964059665347
              ],
              [
                113.70180909799603,
                -23.549412288810842
              ],
              [
                113.71125047372846,
                -23.536350369540692
              ],
              [
                113.71159379648236,
                -23.519509595842766
              ],
              [
                113.72944657968549,
                -23.518565189585157
              ],
              [
                113.73511140512494,
                -23.525490678139235
              ],
              [
                113.74815766977338,
                -23.5190373935608
              ],
              [
                113.7524492041972,
                -23.50392602641646
              ],
              [
                113.7524492041972,
                -23.49022985259466
              ],
              [
                113.75588243173627,
                -23.48424716919088
              ],
              [
                113.76549546884564,
                -23.47596792288033
              ],
              [
                113.77133195566205,
                -23.46966967288093
              ],
              [
                113.77184693979291,
                -23.457859643928995
              ],
              [
                113.771503617039,
                -23.435653929821296
              ],
              [
                113.76644089809076,
                -23.407535904013045
              ],
              [
                113.31193014340488,
                -23.285717679191002
              ],
              [
                113.00705953793613,
                -23.993882502655083
              ],
              [
                112.74613424496738,
                -24.330449090254863
              ],
              [
                112.72759481625646,
                -24.67471755404509
              ],
              [
                112.92439288182393,
                -24.659707665182943
              ],
              [
                113.11790896592257,
                -24.649281447037787
              ],
              [
                113.11411886837813,
                -24.712040463135658
              ],
              [
                113.12612402796117,
                -24.774799441343088
              ],
              [
                113.15875538633132,
                -24.743588562478095
              ],
              [
                113.16496214978363,
                -24.739641105745218
              ],
              [
                113.17872091488927,
                -24.727586066765475
              ],
              [
                113.41575515928933,
                -24.537449328242904
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.74321405510435,
                -23.399347232168477
              ],
              [
                113.76261368467775,
                -23.381688468249415
              ],
              [
                113.76553207933395,
                -23.36151125205248
              ],
              [
                113.76587380407089,
                -23.3085518043688
              ],
              [
                113.75832027327945,
                -23.275774028987552
              ],
              [
                113.74321392896621,
                -23.232874908714823
              ],
              [
                113.72948088935605,
                -23.189961996389627
              ],
              [
                113.73634741050286,
                -23.17355047779855
              ],
              [
                113.7267342830859,
                -23.14324700286598
              ],
              [
                113.71162794117264,
                -23.08261950495515
              ],
              [
                113.73085419862797,
                -23.059877139704145
              ],
              [
                113.75145375900576,
                -23.059877140313446
              ],
              [
                113.7542003692506,
                -22.984041512930343
              ],
              [
                113.74596054741107,
                -22.922077481638908
              ],
              [
                113.73772072511677,
                -22.8853915339116
              ],
              [
                113.71643228769385,
                -22.860399672227793
              ],
              [
                113.71300117945633,
                -22.835406856103802
              ],
              [
                113.69514396454083,
                -22.777484453408828
              ],
              [
                113.67729523220615,
                -22.75817916488152
              ],
              [
                113.64157457117507,
                -22.70497081855396
              ],
              [
                113.6189176429372,
                -22.66791294031784
              ],
              [
                113.59627044600037,
                -22.646057973391677
              ],
              [
                113.63197635171171,
                -22.553504935853567
              ],
              [
                113.64158948111275,
                -22.510376821809693
              ],
              [
                113.67180216401213,
                -22.481194290558257
              ],
              [
                113.76656012088547,
                -22.29961728384203
              ],
              [
                113.82526884732967,
                -22.224949770458185
              ],
              [
                113.83008075715794,
                -22.206075150411394
              ],
              [
                113.83454561670825,
                -22.193239661071246
              ],
              [
                113.84347196349974,
                -22.17646942506959
              ],
              [
                113.85376489374364,
                -22.14865253006028
              ],
              [
                113.85745667062085,
                -22.137680245559345
              ],
              [
                113.86526766947605,
                -22.131795973111913
              ],
              [
                113.86921455644566,
                -22.099037128785255
              ],
              [
                113.8758262874859,
                -22.08149653691092
              ],
              [
                113.8810634570177,
                -22.069045972671958
              ],
              [
                113.8832970373194,
                -22.05496261604618
              ],
              [
                113.89256615067671,
                -22.01661486524026
              ],
              [
                113.90166129238082,
                -21.99242393799538
              ],
              [
                113.90595041798937,
                -21.973012040928126
              ],
              [
                113.91247529592528,
                -21.94005213085136
              ],
              [
                113.92174340359861,
                -21.912187166770195
              ],
              [
                113.9351446953951,
                -21.887975349537555
              ],
              [
                113.95900691670302,
                -21.877781225582083
              ],
              [
                113.97598888014075,
                -21.854522859899546
              ],
              [
                114.00244273821237,
                -21.84449494781375
              ],
              [
                114.01326099438802,
                -21.841070153658794
              ],
              [
                114.03519262060117,
                -21.82611038955267
              ],
              [
                114.05677668616512,
                -21.814018055513635
              ],
              [
                114.11537915217555,
                -21.78599626315297
              ],
              [
                114.14885309331471,
                -21.776913266362552
              ],
              [
                114.16456000158472,
                -21.780020883292735
              ],
              [
                114.18026773042075,
                -21.784402284006198
              ],
              [
                113.84071850482437,
                -21.5709616357678
              ],
              [
                113.5384318942951,
                -21.91719398726005
              ],
              [
                113.2062521757077,
                -22.649860127980418
              ],
              [
                113.33534256892102,
                -23.290911819562535
              ],
              [
                113.54741991964927,
                -23.34778905441505
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.1925737524099,
                -21.82553782978924
              ],
              [
                114.18158796466257,
                -21.83828643788932
              ],
              [
                114.17660893821474,
                -21.853264813247172
              ],
              [
                114.16476137039349,
                -21.871429727619688
              ],
              [
                114.16145687317366,
                -21.87835912549783
              ],
              [
                114.16038390212455,
                -21.885607133370648
              ],
              [
                114.15634944497722,
                -21.90026205024033
              ],
              [
                114.15484705572048,
                -21.909819076843217
              ],
              [
                114.15437454242078,
                -21.91842048909187
              ],
              [
                114.15139175430045,
                -21.925388504838903
              ],
              [
                114.15167056625141,
                -21.93251574482213
              ],
              [
                114.1513700240194,
                -21.939284535695236
              ],
              [
                114.15308620087292,
                -21.946927867129038
              ],
              [
                114.15205640824522,
                -21.956800305649423
              ],
              [
                114.1518851068544,
                -21.962851452991202
              ],
              [
                114.14673623137732,
                -21.977494825471858
              ],
              [
                114.13883889533004,
                -22.00646613157945
              ],
              [
                114.13368843567656,
                -22.017448940058987
              ],
              [
                114.12991105331737,
                -22.02620363483869
              ],
              [
                114.12664828012763,
                -22.038460830262718
              ],
              [
                114.12553232156984,
                -22.047450963886433
              ],
              [
                114.12441639485525,
                -22.05500911926791
              ],
              [
                114.1178934284995,
                -22.072511447684818
              ],
              [
                114.11493205007176,
                -22.081061989749152
              ],
              [
                114.11712063833991,
                -22.088339923358784
              ],
              [
                114.10986732291192,
                -22.092436960862038
              ],
              [
                114.10261340918389,
                -22.111485640707887
              ],
              [
                114.09772147895565,
                -22.128897932223417
              ],
              [
                114.09437401657058,
                -22.146151233230388
              ],
              [
                114.09317120195215,
                -22.15791891447605
              ],
              [
                114.09694731327133,
                -22.172707661315883
              ],
              [
                114.09480125134094,
                -22.186458230697333
              ],
              [
                114.09201157835616,
                -22.19301578977546
              ],
              [
                114.08907174613945,
                -22.1974072989862
              ],
              [
                114.10072405387494,
                -22.210063477485438
              ],
              [
                114.10733172995612,
                -22.216263586924377
              ],
              [
                114.11730965649619,
                -22.222183872109703
              ],
              [
                114.1221381645441,
                -22.227150325103157
              ],
              [
                114.12370609860051,
                -22.232275244244867
              ],
              [
                114.1226820908065,
                -22.23661532560797
              ],
              [
                114.12251629726707,
                -22.241432045102147
              ],
              [
                114.12217602412447,
                -22.244158207421055
              ],
              [
                114.12492581267709,
                -22.24910882490632
              ],
              [
                114.12785097147001,
                -22.252812315898034
              ],
              [
                114.13085472095693,
                -22.25575191191022
              ],
              [
                114.13437353455696,
                -22.25885035954992
              ],
              [
                114.13772097744321,
                -22.263259352574796
              ],
              [
                114.13995280502023,
                -22.264888023373935
              ],
              [
                114.13737839166075,
                -22.266119598789192
              ],
              [
                114.13351629182678,
                -22.2729907630962
              ],
              [
                114.12943899147096,
                -22.279503829349764
              ],
              [
                114.12997520005628,
                -22.285540132639657
              ],
              [
                114.13033981410186,
                -22.290464430302087
              ],
              [
                114.13862253334811,
                -22.29658068367092
              ],
              [
                114.14759235090504,
                -22.297613900557934
              ],
              [
                114.15729218037914,
                -22.296424338918808
              ],
              [
                114.16733543898162,
                -22.299046059351642
              ],
              [
                114.18708013332967,
                -22.306985239195235
              ],
              [
                114.18583712509577,
                -22.314133606314055
              ],
              [
                114.18442243289336,
                -22.320487903162306
              ],
              [
                114.19141930179079,
                -22.332797046866506
              ],
              [
                114.19996186617574,
                -22.337642879543186
              ],
              [
                114.20974848279198,
                -22.358920939986962
              ],
              [
                114.20331126843223,
                -22.364160749033303
              ],
              [
                114.19873013162737,
                -22.370729140659403
              ],
              [
                114.18917047065642,
                -22.361422487904328
              ],
              [
                114.18046896400267,
                -22.371086373591204
              ],
              [
                114.17843562045793,
                -22.374886406215204
              ],
              [
                114.169020861981,
                -22.376940142152193
              ],
              [
                114.1587409589869,
                -22.383170716232442
              ],
              [
                114.15514588531478,
                -22.394857176850294
              ],
              [
                114.16040404929741,
                -22.403340706572546
              ],
              [
                114.14059962413965,
                -22.419758801706692
              ],
              [
                114.14178551695782,
                -22.42747356810771
              ],
              [
                114.15533171030381,
                -22.42884072840235
              ],
              [
                114.171436802246,
                -22.416974846750122
              ],
              [
                114.16794004269599,
                -22.408476768710695
              ],
              [
                114.17730086405003,
                -22.394162700244433
              ],
              [
                114.19738440091635,
                -22.400353695164156
              ],
              [
                114.19901632815419,
                -22.420905877437026
              ],
              [
                114.19343971977611,
                -22.4360618313977
              ],
              [
                114.18399718753814,
                -22.448596974078786
              ],
              [
                114.17584243735729,
                -22.470411769700586
              ],
              [
                114.20030575039421,
                -22.466209904564472
              ],
              [
                114.21833370399258,
                -22.449074834785907
              ],
              [
                114.23567152012785,
                -22.438918584725805
              ],
              [
                114.25043871351549,
                -22.427811396972043
              ],
              [
                114.26005204526435,
                -22.398609104672126
              ],
              [
                114.29112485994524,
                -22.392103907323534
              ],
              [
                114.31601825081249,
                -22.38591019191716
              ],
              [
                114.34692021364219,
                -22.38305141652614
              ],
              [
                114.33455924220596,
                -22.31699766113549
              ],
              [
                114.3537873909042,
                -22.27379176288682
              ],
              [
                114.39499056942964,
                -22.254726084800065
              ],
              [
                114.39636399788627,
                -22.230572516035107
              ],
              [
                114.36477489155305,
                -22.217858450881227
              ],
              [
                114.40048428294158,
                -22.161902834561946
              ],
              [
                114.45954214276412,
                -22.15427076773603
              ],
              [
                114.49113119944285,
                -22.119921470735733
              ],
              [
                114.50486555079397,
                -22.088109116864516
              ],
              [
                114.50486552047812,
                -22.058835434544754
              ],
              [
                114.48151704932604,
                -22.030828872389918
              ],
              [
                114.51035920599628,
                -21.99644956771517
              ],
              [
                114.54194827054005,
                -21.997722991782478
              ],
              [
                114.62710148561086,
                -22.049924707207577
              ],
              [
                114.74384325116615,
                -21.852475323353328
              ],
              [
                114.89216426571028,
                -21.605485977556217
              ],
              [
                114.93833203652113,
                -21.58150534801189
              ],
              [
                114.96763178063526,
                -21.581970667392213
              ],
              [
                114.96271516478082,
                -21.573264756845035
              ],
              [
                114.94544075166539,
                -21.558172594085125
              ],
              [
                114.91734090362925,
                -21.538536579383486
              ],
              [
                114.89130803942987,
                -21.528477967976315
              ],
              [
                114.85566714185109,
                -21.511389097287143
              ],
              [
                114.83959870570914,
                -21.507870747450205
              ],
              [
                114.79722887181576,
                -21.529082832419764
              ],
              [
                114.7709722896982,
                -21.56635007481814
              ],
              [
                114.76436463583252,
                -21.56358898305776
              ],
              [
                114.75672712816004,
                -21.564020507814142
              ],
              [
                114.75063130585218,
                -21.579933945512405
              ],
              [
                114.7489562926024,
                -21.589327230301198
              ],
              [
                114.74813948927206,
                -21.597124321904737
              ],
              [
                114.73637654390376,
                -21.61463343203359
              ],
              [
                114.73118074736726,
                -21.621951230373703
              ],
              [
                114.72358119923763,
                -21.62575794793274
              ],
              [
                114.68268345666601,
                -21.646793120834964
              ],
              [
                114.66281160969633,
                -21.654079096185125
              ],
              [
                114.65186405308074,
                -21.666469108726385
              ],
              [
                114.5911653214431,
                -21.67341462049349
              ],
              [
                114.528410489646,
                -21.657364157463704
              ],
              [
                114.43544800082026,
                -21.649754834559957
              ],
              [
                114.42678886556375,
                -21.65228908926032
              ],
              [
                114.4222486839529,
                -21.6509942506527
              ],
              [
                114.39875192691869,
                -21.630543206207978
              ],
              [
                114.39253323178801,
                -21.638357456427478
              ],
              [
                114.38597046587793,
                -21.64744797446069
              ],
              [
                114.37872017690654,
                -21.6520697407156
              ],
              [
                114.37423638995078,
                -21.65980541095175
              ],
              [
                114.37431262522898,
                -21.664232076518502
              ],
              [
                114.37164220173133,
                -21.66833966029713
              ],
              [
                114.36048440024955,
                -21.677182347199068
              ],
              [
                114.35799455284226,
                -21.677934999018028
              ],
              [
                114.35434622674074,
                -21.688998817725427
              ],
              [
                114.34846629298514,
                -21.70022309775869
              ],
              [
                114.3274828326361,
                -21.706637248613205
              ],
              [
                114.31353522839949,
                -21.72580935733133
              ],
              [
                114.30451894519094,
                -21.7400677184295
              ],
              [
                114.30464391355117,
                -21.746075065242827
              ],
              [
                114.31020372942861,
                -21.745252779362563
              ],
              [
                114.31782485350615,
                -21.748261054435524
              ],
              [
                114.30365473942777,
                -21.72957041905799
              ],
              [
                114.29393036376969,
                -21.720271462403797
              ],
              [
                114.30034352778182,
                -21.694067568297463
              ],
              [
                114.28792937321882,
                -21.686546984710496
              ],
              [
                114.27482927827828,
                -21.676792025479028
              ],
              [
                114.26236111030936,
                -21.67929501651091
              ],
              [
                114.24789360590776,
                -21.685578408329032
              ],
              [
                114.23720104564528,
                -21.687075805032038
              ],
              [
                114.2092826309363,
                -21.689500824822733
              ],
              [
                114.2030478917407,
                -21.696613989623827
              ],
              [
                114.20299262353652,
                -21.705003091716126
              ],
              [
                114.1894918367464,
                -21.7087013422752
              ],
              [
                114.18285663048347,
                -21.717502508693517
              ],
              [
                114.16444845448517,
                -21.74612973008761
              ],
              [
                114.15936732518854,
                -21.76713362996498
              ],
              [
                114.13643140257517,
                -21.763902851194914
              ],
              [
                114.17954623723303,
                -21.78863429196826
              ],
              [
                114.18720354529768,
                -21.805460007094496
              ],
              [
                114.19326472042914,
                -21.80845359532576
              ],
              [
                114.19675148391396,
                -21.81686564870387
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                121.84847730603099,
                -17.191751327012778
              ],
              [
                121.79903882946849,
                -17.23372844153154
              ],
              [
                121.76607984509349,
                -17.3360076598078
              ],
              [
                121.70290845837474,
                -17.626797291757093
              ],
              [
                122.14785474743724,
                -17.6137086786087
              ],
              [
                122.20003980603099,
                -17.40940378243942
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                121.54018600433767,
                -18.965798549781145
              ],
              [
                121.54018600433767,
                -18.948914090453652
              ],
              [
                121.54293258636892,
                -18.933326919264182
              ],
              [
                121.57726486175955,
                -18.909943435193334
              ],
              [
                121.58275802582205,
                -18.88785603125203
              ],
              [
                121.59237106293142,
                -18.85926800744726
              ],
              [
                121.60610397308767,
                -18.852770049452175
              ],
              [
                121.61159713715017,
                -18.833274665912384
              ],
              [
                121.60061080902517,
                -18.798177274674742
              ],
              [
                121.61022384613456,
                -18.76047192384261
              ],
              [
                121.58825334518849,
                -18.735110652209332
              ],
              [
                121.59099777191581,
                -18.68893863292319
              ],
              [
                121.62121017425955,
                -18.672026344448863
              ],
              [
                121.66996441465896,
                -18.66747710831918
              ],
              [
                121.70498092621267,
                -18.652510069026956
              ],
              [
                121.7173405453533,
                -18.61347078747068
              ],
              [
                121.68300826996267,
                -18.586137957692337
              ],
              [
                121.69674118011893,
                -18.554895068484182
              ],
              [
                121.72764258891769,
                -18.53862220975018
              ],
              [
                121.7502995297283,
                -18.511926758590576
              ],
              [
                121.75167282074392,
                -18.496299241790172
              ],
              [
                121.75716598480642,
                -18.465039931182417
              ],
              [
                121.78737838715017,
                -18.440288937083523
              ],
              [
                121.39461715668142,
                -18.123425553549183
              ],
              [
                120.9702702328533,
                -18.296925553857758
              ],
              [
                121.3383122250408,
                -18.789078545688703
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                119.49231484135464,
                -18.920978465029695
              ],
              [
                118.96222450932339,
                -18.86640788940203
              ],
              [
                118.88669350346402,
                -19.166325021721473
              ],
              [
                118.07750780035428,
                -19.805339025416608
              ],
              [
                118.15569379946791,
                -20.108387220071005
              ],
              [
                118.20585710748735,
                -20.314009414947247
              ],
              [
                118.17089158941678,
                -20.419160516519753
              ],
              [
                118.52525349759101,
                -20.42914537294653
              ],
              [
                118.85341722418241,
                -20.280101784384556
              ],
              [
                118.93169481207303,
                -20.08288840859181
              ],
              [
                118.94817430426053,
                -19.907994421165963
              ],
              [
                118.93169481207303,
                -19.888009335056193
              ],
              [
                118.88500291754178,
                -19.91770845059893
              ],
              [
                118.85479051519803,
                -19.90867017941499
              ],
              [
                118.86715013433866,
                -19.8608878864853
              ],
              [
                118.92482835699491,
                -19.85572137024253
              ],
              [
                118.95504075933866,
                -19.90479647653086
              ],
              [
                119.12670213629178,
                -19.62693511616502
              ],
              [
                119.12189346314591,
                -19.612707419090285
              ],
              [
                119.07314378668241,
                -19.601062987609314
              ],
              [
                119.05803758551053,
                -19.580362288680536
              ],
              [
                119.10198289801053,
                -19.55448267378596
              ],
              [
                119.13906175543241,
                -19.59847554582708
              ],
              [
                119.34917528082303,
                -19.257866248732448
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.82051552377561,
                -19.242162171178773
              ],
              [
                116.36183632455686,
                -19.224009175249684
              ],
              [
                115.91963661752561,
                -19.405448610894474
              ],
              [
                115.12038124643186,
                -19.705673800260875
              ],
              [
                114.73036659799436,
                -20.682624083453486
              ],
              [
                114.9495613918772,
                -20.993222036901834
              ],
              [
                115.23245934109595,
                -21.036808287768878
              ],
              [
                115.22215965847876,
                -20.990657743238323
              ],
              [
                115.26165343168319,
                -20.966915531145464
              ],
              [
                115.26628332554819,
                -20.945428813374516
              ],
              [
                115.26541832547093,
                -20.829018653100267
              ],
              [
                115.36292198758032,
                -20.686478386619054
              ],
              [
                115.42506697905604,
                -20.62634050249691
              ],
              [
                115.42051730332436,
                -20.540570390057233
              ],
              [
                115.43244384742579,
                -20.490805593090514
              ],
              [
                115.45216407205545,
                -20.44273239197315
              ],
              [
                115.46470179209203,
                -20.419088278177465
              ],
              [
                115.48750979055903,
                -20.396748824278845
              ],
              [
                115.49132469754126,
                -20.361733379230692
              ],
              [
                115.51467350373314,
                -20.35369351917118
              ],
              [
                115.53046349148657,
                -20.3424199662745
              ],
              [
                115.55243614773657,
                -20.34757044584171
              ],
              [
                115.58125915667108,
                -20.3813493405337
              ],
              [
                115.59224460447547,
                -20.40145459438584
              ],
              [
                115.61078606129848,
                -20.423089866120016
              ],
              [
                115.62246580984484,
                -20.439573066661367
              ],
              [
                115.63071046572202,
                -20.455018671656518
              ],
              [
                115.6224745081613,
                -20.477539471481034
              ],
              [
                115.62419179489645,
                -20.501822057119774
              ],
              [
                115.60599532368882,
                -20.515171332386878
              ],
              [
                115.59363434919969,
                -20.537845978943295
              ],
              [
                115.59363487820532,
                -20.559877691277787
              ],
              [
                115.58539513211157,
                -20.59266258569605
              ],
              [
                115.62313532800863,
                -20.676183158468042
              ],
              [
                115.59500816922095,
                -20.764827963047743
              ],
              [
                115.51810387234593,
                -20.908577120082537
              ],
              [
                115.52357228129449,
                -21.002183649432432
              ],
              [
                115.54556969265845,
                -21.158525757540037
              ],
              [
                115.51304003224583,
                -21.21792220625048
              ],
              [
                115.59772316098284,
                -21.259135193650962
              ],
              [
                115.616716642959,
                -21.209965407337215
              ],
              [
                115.63707337553126,
                -21.183837220949993
              ],
              [
                115.62695370736537,
                -21.15919555447664
              ],
              [
                115.69098529786709,
                -21.13901791976018
              ],
              [
                115.73054691596569,
                -21.135965749257704
              ],
              [
                115.74757917136706,
                -21.135398055220897
              ],
              [
                115.75369132229402,
                -21.122944723909963
              ],
              [
                115.75224999051001,
                -21.11113186921976
              ],
              [
                115.807536783699,
                -21.073324937170792
              ],
              [
                115.8284676418772,
                -21.037449166981272
              ],
              [
                115.83603867765999,
                -20.99544454866136
              ],
              [
                115.86385072371604,
                -20.957776825192283
              ],
              [
                115.86882266627381,
                -20.919062941466912
              ],
              [
                115.90811852078345,
                -20.872652705296833
              ],
              [
                115.93559487732247,
                -20.923329298805815
              ],
              [
                115.9314813958448,
                -20.96916869965932
              ],
              [
                115.960329096065,
                -20.96514448670176
              ],
              [
                116.01454857449438,
                -20.82388440339366
              ],
              [
                116.09114617660168,
                -20.78348622071519
              ],
              [
                116.21937262713628,
                -20.78958545639562
              ],
              [
                116.24090559817897,
                -20.785234907987984
              ],
              [
                116.28302696804907,
                -20.758407392550158
              ],
              [
                116.34277350953377,
                -20.72887620349263
              ],
              [
                116.37778404812718,
                -20.690332591883262
              ],
              [
                116.38327721218968,
                -20.572092494611084
              ],
              [
                116.52884605984593,
                -20.44346671029902
              ],
              [
                116.83097008328343,
                -20.31988460028333
              ],
              [
                117.00949791531468,
                -20.42030261223304
              ],
              [
                117.12760094265843,
                -20.40228368050092
              ],
              [
                117.11191004409643,
                -20.469867532713092
              ],
              [
                117.04772210177958,
                -20.477934184609516
              ],
              [
                116.92497195590748,
                -20.44205960505898
              ],
              [
                116.90339940403172,
                -20.484555800411233
              ],
              [
                116.8213410270968,
                -20.622219351799078
              ],
              [
                116.82583883572524,
                -20.64765195386162
              ],
              [
                116.81935004216636,
                -20.664088858209944
              ],
              [
                116.83180823982165,
                -20.683453932770867
              ],
              [
                116.84838878576969,
                -20.689969749822716
              ],
              [
                116.87331320249332,
                -20.69529019780443
              ],
              [
                117.0238958988239,
                -20.610625087240862
              ],
              [
                117.17154625515845,
                -20.574663907642837
              ],
              [
                117.22647789578343,
                -20.618371297812317
              ],
              [
                117.26491334319614,
                -20.687875083878307
              ],
              [
                117.3075194548966,
                -20.779098406463195
              ],
              [
                117.73047569851782,
                -20.773816303438917
              ],
              [
                118.06555870633032,
                -20.57980660374619
              ],
              [
                118.19327477078343,
                -20.31730892080727
              ],
              [
                118.06967857937718,
                -19.8116537284404
              ],
              [
                117.92410973172093,
                -19.734114348856114
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.14152949542373,
                -21.75233793508555
              ],
              [
                114.15544787337734,
                -21.7638291616316
              ],
              [
                114.16069026679507,
                -21.759688865451068
              ],
              [
                114.15838419639644,
                -21.75235602969726
              ],
              [
                114.15572906709255,
                -21.73482063346886
              ],
              [
                114.18117925727633,
                -21.709145522593715
              ],
              [
                114.1976714520637,
                -21.700176154666043
              ],
              [
                114.20351342638125,
                -21.69154390279206
              ],
              [
                114.21278790379783,
                -21.686739393276177
              ],
              [
                114.23682932582096,
                -21.68414658922437
              ],
              [
                114.25572146180521,
                -21.672299095799435
              ],
              [
                114.2721148286275,
                -21.672459362805785
              ],
              [
                114.28129918178306,
                -21.675809497655393
              ],
              [
                114.28936975902744,
                -21.683305621149437
              ],
              [
                114.29366209932236,
                -21.68824934036535
              ],
              [
                114.30018413755343,
                -21.691117664659554
              ],
              [
                114.32703203284771,
                -21.659125042926433
              ],
              [
                114.34165463379311,
                -21.65429484635318
              ],
              [
                114.34563366850638,
                -21.64946413320044
              ],
              [
                114.35379283278161,
                -21.636102700077277
              ],
              [
                114.37259268530181,
                -21.625293222544762
              ],
              [
                114.40589514693592,
                -21.611966864111036
              ],
              [
                114.42030943213484,
                -21.641008848298604
              ],
              [
                114.43678533067568,
                -21.648985469595008
              ],
              [
                114.47676053519668,
                -21.645925442974765
              ],
              [
                114.53598028582924,
                -21.647321093651687
              ],
              [
                114.5437952785579,
                -21.6520007086751
              ],
              [
                114.557486627196,
                -21.660401887649005
              ],
              [
                114.56946333327892,
                -21.659230806023583
              ],
              [
                114.57766065527728,
                -21.646254366086286
              ],
              [
                114.58606220015693,
                -21.654657603275496
              ],
              [
                114.596180162202,
                -21.65763523975616
              ],
              [
                114.60097646660381,
                -21.663960278238186
              ],
              [
                114.61161014108032,
                -21.668052457200293
              ],
              [
                114.63474313256326,
                -21.66288811881612
              ],
              [
                114.64150184268254,
                -21.653605002982765
              ],
              [
                114.64253154143175,
                -21.647892636834268
              ],
              [
                114.64232406507183,
                -21.64782906974291
              ],
              [
                114.64140174397399,
                -21.647167303677385
              ],
              [
                114.64215340945935,
                -21.64746358853043
              ],
              [
                114.64140352133454,
                -21.646210299926953
              ],
              [
                114.64088909219242,
                -21.646042264987397
              ],
              [
                114.64050328802867,
                -21.645854220361723
              ],
              [
                114.64003185057996,
                -21.64568550786309
              ],
              [
                114.64020403314827,
                -21.64577723147025
              ],
              [
                114.64003530763303,
                -21.645605018023684
              ],
              [
                114.65059789143668,
                -21.62975136374461
              ],
              [
                114.66184655483681,
                -21.638151068451524
              ],
              [
                114.65998253737351,
                -21.641572366400794
              ],
              [
                114.66331130601417,
                -21.64958097273887
              ],
              [
                114.66880759794289,
                -21.651586262001693
              ],
              [
                114.67194200018665,
                -21.650474782240295
              ],
              [
                114.67507635069282,
                -21.649203692656258
              ],
              [
                114.67736715785894,
                -21.64728052532721
              ],
              [
                114.67837045444448,
                -21.644798900436516
              ],
              [
                114.68010327980747,
                -21.639145968397713
              ],
              [
                114.67840287674734,
                -21.63692363122656
              ],
              [
                114.67657858544035,
                -21.627794942333832
              ],
              [
                114.67855409388777,
                -21.626376710319068
              ],
              [
                114.68078707970965,
                -21.624080721398133
              ],
              [
                114.68302131046077,
                -21.619009885566637
              ],
              [
                114.67984832679075,
                -21.61685145780581
              ],
              [
                114.67736203190661,
                -21.616608022684307
              ],
              [
                114.67354827276617,
                -21.613966751547988
              ],
              [
                114.67093614634976,
                -21.61172449271749
              ],
              [
                114.66957348484173,
                -21.608205288371376
              ],
              [
                114.66546423611469,
                -21.605404252276585
              ],
              [
                114.66239565335657,
                -21.599323375499527
              ],
              [
                114.65694539200426,
                -21.59769538446166
              ],
              [
                114.6481061478981,
                -21.580872643284966
              ],
              [
                114.6606361977798,
                -21.568807514659497
              ],
              [
                114.70252813750213,
                -21.6131045290392
              ],
              [
                114.70544762476042,
                -21.63590323750568
              ],
              [
                114.73137064872685,
                -21.62135967842849
              ],
              [
                114.73763784020979,
                -21.611693746499395
              ],
              [
                114.74527732244044,
                -21.60043168183269
              ],
              [
                114.75197155202193,
                -21.571519499867193
              ],
              [
                114.73755163014069,
                -21.52801406874667
              ],
              [
                114.76568661925364,
                -21.501484533899422
              ],
              [
                114.7941855353669,
                -21.520186202324492
              ],
              [
                114.8067275721231,
                -21.509408905189208
              ],
              [
                114.85221983549549,
                -21.505022963053808
              ],
              [
                114.87196645039226,
                -21.51755778236843
              ],
              [
                114.89797531576427,
                -21.52350372423173
              ],
              [
                114.91436942758286,
                -21.521786616704972
              ],
              [
                114.90990815723448,
                -21.484253795028756
              ],
              [
                114.9455867105281,
                -21.406263752930776
              ],
              [
                114.9867852053923,
                -21.39731364146588
              ],
              [
                115.0581959241897,
                -21.45995292287791
              ],
              [
                115.02180655468663,
                -21.481676168842576
              ],
              [
                114.92945129156442,
                -21.49253793347139
              ],
              [
                114.92215288382144,
                -21.50324341008123
              ],
              [
                114.91691313702187,
                -21.512671556988455
              ],
              [
                114.93296095388183,
                -21.545430050660727
              ],
              [
                114.96944749243602,
                -21.5735746556707
              ],
              [
                114.96024082411788,
                -21.581901144306087
              ],
              [
                114.93647847267991,
                -21.582068187252634
              ],
              [
                114.90296202928234,
                -21.60003142227133
              ],
              [
                114.88482875325836,
                -21.62114978078459
              ],
              [
                114.83380862253182,
                -21.706500266718937
              ],
              [
                114.80587168938155,
                -21.752677728562684
              ],
              [
                114.79189692149201,
                -21.77640163026499
              ],
              [
                114.7779185250464,
                -21.78992184667873
              ],
              [
                114.90372430880156,
                -21.75664426764929
              ],
              [
                115.03702171422592,
                -21.68436792210581
              ],
              [
                115.06368903551088,
                -21.722998450031316
              ],
              [
                115.29028072668498,
                -21.767643068460686
              ],
              [
                115.87242061853186,
                -21.532295881310603
              ],
              [
                116.23235319151318,
                -20.99655878013333
              ],
              [
                116.91242168272701,
                -20.790415878787268
              ],
              [
                116.72397332088303,
                -20.627570463617666
              ],
              [
                116.54574402402022,
                -20.65917246270891
              ],
              [
                116.51527610097185,
                -20.672279672322176
              ],
              [
                116.49922259175189,
                -20.676388752760722
              ],
              [
                116.48633741429524,
                -20.689744714494527
              ],
              [
                116.46330866408611,
                -20.69589525626122
              ],
              [
                116.43166221800948,
                -20.699838161873462
              ],
              [
                116.38624088761416,
                -20.711456145147974
              ],
              [
                116.19860701316347,
                -20.804549549836317
              ],
              [
                116.14308140248184,
                -20.802681229349485
              ],
              [
                116.09441511308319,
                -20.825187721551742
              ],
              [
                116.09045726166619,
                -20.849659628446435
              ],
              [
                116.04265485415588,
                -20.953763344870087
              ],
              [
                115.98252473128221,
                -20.97330759986236
              ],
              [
                115.89218438781893,
                -20.96717428321999
              ],
              [
                115.8816865494529,
                -20.96699075646599
              ],
              [
                115.86638012057745,
                -20.991170123433523
              ],
              [
                115.87009915265241,
                -21.000420123543694
              ],
              [
                115.85164829233139,
                -21.039655181063445
              ],
              [
                115.84412927744019,
                -21.056061166189895
              ],
              [
                115.83695198145753,
                -21.059332893145164
              ],
              [
                115.83045965276392,
                -21.085025954154087
              ],
              [
                115.81485232464283,
                -21.08954356679244
              ],
              [
                115.7978702962315,
                -21.100787098761696
              ],
              [
                115.77338966987438,
                -21.123585511344174
              ],
              [
                115.71799374557668,
                -21.161105847383784
              ],
              [
                115.70100178631141,
                -21.157473498110285
              ],
              [
                115.6361963368479,
                -21.238875992956075
              ],
              [
                115.53007766494468,
                -21.354793786809278
              ],
              [
                115.3620146610186,
                -21.53342405823503
              ],
              [
                115.3252739471697,
                -21.514895013312028
              ],
              [
                115.32461285796228,
                -21.410099381292547
              ],
              [
                115.3692628951499,
                -21.3640591656722
              ],
              [
                115.38229076624077,
                -21.31673802875009
              ],
              [
                115.4468352352968,
                -21.17722472415615
              ],
              [
                115.42227247892075,
                -21.156714751092025
              ],
              [
                115.39771953783942,
                -21.09779293288555
              ],
              [
                115.34452554617938,
                -21.058086599523772
              ],
              [
                115.28753426516427,
                -21.05296027878337
              ],
              [
                114.91949434632954,
                -20.993994295218826
              ],
              [
                113.9719289914688,
                -21.534062667340947
              ],
              [
                113.85657323832115,
                -21.631114668637178
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.68993557859267,
                -21.60890043003181
              ],
              [
                114.68736065793837,
                -21.611932739221032
              ],
              [
                114.68624485898818,
                -21.61360846176127
              ],
              [
                114.69130886960829,
                -21.623821969704544
              ],
              [
                114.69680203367079,
                -21.624939028357677
              ],
              [
                114.69774617124403,
                -21.62461986962347
              ],
              [
                114.70040692258681,
                -21.6252581863871
              ],
              [
                114.70143689084853,
                -21.61496498483389
              ],
              [
                114.69577206540907,
                -21.609937806119063
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    rs_dl_sl_srs_tobrs = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.46692648498026,
                -20.661025627540276
              ],
              [
                115.45594015685526,
                -20.682868492179278
              ],
              [
                115.45937338439433,
                -20.76057787569464
              ],
              [
                115.44289389220683,
                -20.793961382854086
              ],
              [
                115.38384237853495,
                -20.887652493355393
              ],
              [
                115.41886129943339,
                -20.913311102912495
              ],
              [
                115.45388022033183,
                -20.96717988780264
              ],
              [
                115.50469311836392,
                -21.010776821637403
              ],
              [
                115.51979818908183,
                -20.956920661413104
              ],
              [
                115.54864968288291,
                -20.84209904469981
              ],
              [
                115.58571710579565,
                -20.791389744015184
              ],
              [
                115.69283285705058,
                -20.752872941729294
              ],
              [
                115.66742697326151,
                -20.63917962235235
              ],
              [
                115.54520407287089,
                -20.57040849577496
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.09416581773911,
                -21.010889423167885
              ],
              [
                115.11957170152817,
                -21.036526900100643
              ],
              [
                115.21707536363755,
                -21.060237639006726
              ],
              [
                115.29535295152817,
                -21.089710586606312
              ],
              [
                115.31938554430161,
                -21.055752113183765
              ],
              [
                115.32007218980942,
                -21.00063319823624
              ],
              [
                115.30839921617661,
                -20.968577953863047
              ],
              [
                115.25964738512192,
                -20.970501462468363
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.62958314655384,
                -20.44237396780276
              ],
              [
                116.62065675495228,
                -20.462318175116025
              ],
              [
                116.6000573897179,
                -20.473897494120862
              ],
              [
                116.58220460651478,
                -20.484189488690838
              ],
              [
                116.54924562213978,
                -20.49062163462558
              ],
              [
                116.54684189738569,
                -20.50541415639895
              ],
              [
                116.56091859577258,
                -20.51506132772538
              ],
              [
                116.5743078579669,
                -20.515383403419047
              ],
              [
                116.58907106159289,
                -20.522135247988576
              ],
              [
                116.59937153862813,
                -20.510238216458372
              ],
              [
                116.60692415769049,
                -20.510399115588935
              ],
              [
                116.61859681842883,
                -20.509273331692295
              ],
              [
                116.63336036750981,
                -20.50252108144345
              ],
              [
                116.63730886776449,
                -20.493677233129173
              ],
              [
                116.65224244831164,
                -20.48290302713031
              ],
              [
                116.67421510456164,
                -20.475184031198914
              ],
              [
                116.68211237952401,
                -20.46424823851547
              ],
              [
                116.68451478717883,
                -20.45202471399379
              ],
              [
                116.67970826862414,
                -20.441087155856543
              ],
              [
                116.65842167890457,
                -20.4407666880144
              ],
              [
                116.63713624713978,
                -20.432722615669856
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    brsdl_mask = 
    /* color: #98ff00 */
    /* shown: false */
    ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.5019454058787,
                -20.32701480615454
              ],
              [
                115.45937338439433,
                -20.298037275779848
              ],
              [
                115.44220724669901,
                -20.307697055295293
              ],
              [
                115.37834921447245,
                -20.394607923502054
              ],
              [
                115.41611471740214,
                -20.60235108462373
              ],
              [
                115.46074667540995,
                -20.613277122654882
              ],
              [
                115.47791281310526,
                -20.59335258277839
              ],
              [
                115.50400534240214,
                -20.540833817636727
              ],
              [
                115.52872458068339,
                -20.486169889647353
              ],
              [
                115.52735128966776,
                -20.44950198190406
              ],
              [
                115.52048483458964,
                -20.42312140750385
              ],
              [
                115.52803793517558,
                -20.343308746697392
              ],
              [
                115.50400534240214,
                -20.326568598995298
              ],
              [
                115.45456686583964,
                -20.318197845565862
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.6650123753563,
                -21.559847379404783
              ],
              [
                114.62930680895005,
                -21.589220179111845
              ],
              [
                114.6540260472313,
                -21.607734752362756
              ],
              [
                114.67393876695786,
                -21.570703238100474
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.00696183824692,
                -21.436224968940177
              ],
              [
                115.01176835680161,
                -21.44645095877664
              ],
              [
                115.03065110826645,
                -21.46434471576399
              ],
              [
                115.04095079088364,
                -21.48606989547697
              ],
              [
                115.0608635106102,
                -21.472332290887636
              ],
              [
                115.05434037828599,
                -21.448048704935804
              ],
              [
                115.02721788072739,
                -21.431111705267398
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.81017091510853,
                -20.31557135297529
              ],
              [
                116.83557679889759,
                -20.364502476898927
              ],
              [
                116.98114564655384,
                -20.432722615669856
              ],
              [
                116.96466615436634,
                -20.379951190695998
              ],
              [
                116.83351686237415,
                -20.312351657195105
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.63164308307728,
                -20.392180325149987
              ],
              [
                116.50461366413197,
                -20.4430173697363
              ],
              [
                116.54855897663197,
                -20.464248122270714
              ],
              [
                116.59250428913197,
                -20.45202471399379
              ],
              [
                116.61516359088978,
                -20.438513499649417
              ],
              [
                116.65979554889759,
                -20.43915691774036
              ],
              [
                116.67284181354603,
                -20.405052050078243
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.77309205768665,
                -20.493837606410693
              ],
              [
                116.72846009967884,
                -20.48676237943999
              ],
              [
                116.69687440631947,
                -20.481616554779894
              ],
              [
                116.66322877643665,
                -20.52149217783552
              ],
              [
                116.65704896686634,
                -20.547212875924075
              ],
              [
                116.67284181354603,
                -20.54528397360852
              ],
              [
                116.68176820514759,
                -20.561357415729198
              ],
              [
                116.67833497760853,
                -20.58964256552887
              ],
              [
                116.71472718952259,
                -20.62949000973244
              ],
              [
                116.72502687213978,
                -20.64555457773579
              ],
              [
                116.74493959186634,
                -20.638486376810523
              ],
              [
                116.76073243854603,
                -20.621778414663744
              ],
              [
                116.81223085163197,
                -20.55557117133891
              ],
              [
                116.83283021686634,
                -20.51506132772538
              ],
              [
                116.80536439655384,
                -20.502198817287123
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.80399110553822,
                -20.362893146934088
              ],
              [
                116.76073243854603,
                -20.387353151110922
              ],
              [
                116.77171876667103,
                -20.460066539443975
              ],
              [
                116.81085756061634,
                -20.453633112764734
              ],
              [
                116.83008363483509,
                -20.415670413437418
              ],
              [
                116.84518983600697,
                -20.38220399887003
              ],
              [
                116.82871034381947,
                -20.357099420148995
              ],
              [
                116.81291749713978,
                -20.357099420148995
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.87059571979603,
                -20.395720156697852
              ],
              [
                116.82665040729603,
                -20.451059666648792
              ],
              [
                116.86990907428822,
                -20.50573611532644
              ],
              [
                116.85205629108509,
                -20.536603612031794
              ],
              [
                116.82939698932728,
                -20.573250674144003
              ],
              [
                116.85892274616322,
                -20.58739280235569
              ],
              [
                116.92758729694447,
                -20.485154327780034
              ],
              [
                116.9296472334679,
                -20.45234639509508
              ],
              [
                116.91248109577259,
                -20.412452804899107
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.9845788740929,
                -20.398938114817884
              ],
              [
                116.9790857100304,
                -20.42532283549126
              ],
              [
                117.02646425006947,
                -20.465213086751056
              ],
              [
                117.06354310749134,
                -20.464569777771366
              ],
              [
                117.0669763350304,
                -20.418244451845354
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.61319554125669,
                -20.51742546892642
              ],
              [
                116.58366978442075,
                -20.527714540519035
              ],
              [
                116.58847630297544,
                -20.570149645195293
              ],
              [
                116.57131016528012,
                -20.606145942503836
              ],
              [
                116.60358250414731,
                -20.601004134508585
              ],
              [
                116.64066136156919,
                -20.565006623751533
              ],
              [
                116.64752781664731,
                -20.554077128125105
              ],
              [
                116.6358548430145,
                -20.53092973353283
              ],
              [
                116.62692845141294,
                -20.51935472253233
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.58366978442075,
                -20.62028501981535
              ],
              [
                116.60083592211606,
                -20.646631614885607
              ],
              [
                116.63516819750669,
                -20.646631614885607
              ],
              [
                116.62692845141294,
                -20.608716781444144
              ],
              [
                116.59534275805356,
                -20.608716781444144
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                117.16291290485805,
                -20.56444428959666
              ],
              [
                116.99949127399867,
                -20.61040406519118
              ],
              [
                116.99743133747523,
                -20.655064968324314
              ],
              [
                117.08291870319789,
                -20.666950912454002
              ],
              [
                117.19690185749477,
                -20.642535534423526
              ],
              [
                117.24599701130336,
                -20.605262400873077
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                122.18642035844687,
                -17.93186431931425
              ],
              [
                122.16547767045859,
                -17.93611065697468
              ],
              [
                122.15346137407187,
                -17.98869146645149
              ],
              [
                122.19534675004843,
                -18.033748266408587
              ],
              [
                122.24169532182577,
                -18.003385166877777
              ],
              [
                122.21937934282187,
                -17.96387266105591
              ],
              [
                122.19672004106405,
                -17.941010150773906
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    sl_brs = 
    /* color: #0b4a8b */
    /* shown: false */
    ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.5239225201185,
                -20.33490874255456
              ],
              [
                115.52735574765757,
                -20.37482240780347
              ],
              [
                115.53834207578257,
                -20.468128547802888
              ],
              [
                115.47585733457163,
                -20.59287704256024
              ],
              [
                115.46761758847788,
                -20.633366242491483
              ],
              [
                115.58366067929819,
                -20.619228379817173
              ],
              [
                115.61249979062632,
                -20.61280164460088
              ],
              [
                115.61387308164194,
                -20.554305901903025
              ],
              [
                115.65438516660288,
                -20.475204634250762
              ],
              [
                115.595333652931,
                -20.34263477302163
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.50138933435278,
                -20.998093500028777
              ],
              [
                115.4588173128684,
                -21.03911486668289
              ],
              [
                115.46911699548559,
                -21.08012493951473
              ],
              [
                115.51786882654028,
                -21.127528734082798
              ],
              [
                115.53434831872778,
                -21.136495316097843
              ],
              [
                115.52198869958715,
                -21.055776571879854
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.97584554777006,
                -20.947568193803495
              ],
              [
                115.96005270109038,
                -20.971773940923114
              ],
              [
                115.97018072233061,
                -20.97754426910801
              ],
              [
                115.99764654264311,
                -20.97546056518503
              ],
              [
                116.00159475431303,
                -20.963118030990657
              ],
              [
                116.0024530611978,
                -20.95558377562869
              ],
              [
                115.99284002408842,
                -20.947247561600197
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.082275601481,
                -20.795832638283468
              ],
              [
                116.03764364347319,
                -20.822148716844083
              ],
              [
                116.01704427823881,
                -20.86065176575854
              ],
              [
                116.04142019376616,
                -20.89561682537926
              ],
              [
                116.08639547452788,
                -20.901069357683667
              ],
              [
                116.11283132657866,
                -20.833379790172657
              ],
              [
                116.10493490323881,
                -20.798079312100025
              ],
              [
                116.09017202482084,
                -20.786203657288546
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                121.79549276390435,
                -18.427597803915386
              ],
              [
                121.71103536644341,
                -18.495333889584582
              ],
              [
                121.6609102443731,
                -18.588427269812435
              ],
              [
                121.56409322777154,
                -18.716591483579933
              ],
              [
                121.52632772484185,
                -18.9687320695318
              ],
              [
                121.58125936546685,
                -18.991458049059574
              ],
              [
                121.67464315452935,
                -18.799163695647202
              ],
              [
                121.67532980003716,
                -18.7504054636906
              ],
              [
                121.79549276390435,
                -18.689275254659574
              ],
              [
                121.81334554710747,
                -18.623568200671908
              ],
              [
                121.83531820335747,
                -18.491426765510987
              ],
              [
                121.84081136741997,
                -18.44518570255377
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    rs_brs = 
    /* color: #ffc82d */
    /* shown: false */
    ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.52597799865214,
                -20.34052908662443
              ],
              [
                115.5403975543162,
                -20.40875983182294
              ],
              [
                115.5458907183787,
                -20.471170923905355
              ],
              [
                115.53250871059457,
                -20.520047412529852
              ],
              [
                115.51757300799339,
                -20.529052239223525
              ],
              [
                115.5169702231452,
                -20.54191344646473
              ],
              [
                115.50842860465173,
                -20.55863121266121
              ],
              [
                115.49370565978495,
                -20.570847305476207
              ],
              [
                115.49302228030737,
                -20.581130568366937
              ],
              [
                115.48032036006657,
                -20.590772366053262
              ],
              [
                115.47602798244475,
                -20.607162514231483
              ],
              [
                115.46074667540995,
                -20.631264544428408
              ],
              [
                115.5995501109918,
                -20.613435406332727
              ],
              [
                115.60641656606992,
                -20.55365403951791
              ],
              [
                115.64555536001524,
                -20.483557929609386
              ],
              [
                115.59131036489805,
                -20.348420102984598
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.86921693468247,
                -20.95447981906103
              ],
              [
                115.85685731554184,
                -20.969548061451295
              ],
              [
                115.85376741075669,
                -20.986538087427206
              ],
              [
                115.85136415147934,
                -21.00480822285585
              ],
              [
                115.86235047960434,
                -21.02339659113421
              ],
              [
                115.87985994005356,
                -20.994551579981216
              ],
              [
                115.89736940050278,
                -20.96121262562223
              ],
              [
                115.8925628819481,
                -20.944860998390965
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.72296144151841,
                -21.14896747666507
              ],
              [
                115.72399140978013,
                -21.155051121877577
              ],
              [
                115.7497406163231,
                -21.146085662759276
              ],
              [
                115.75283052110825,
                -21.137439884673892
              ],
              [
                115.73532106065903,
                -21.1310352793911
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.63166488637677,
                -23.594341351353837
              ],
              [
                113.62634338369122,
                -23.597959451569405
              ],
              [
                113.62634338369122,
                -23.601105544542744
              ],
              [
                113.62617172231427,
                -23.603307764716774
              ],
              [
                113.62222351064435,
                -23.609756911027315
              ],
              [
                113.62102188100567,
                -23.61416102374911
              ],
              [
                113.63029159536114,
                -23.622182420205238
              ],
              [
                113.64368118276349,
                -23.61919411421303
              ],
              [
                113.65192092885724,
                -23.605352650332776
              ],
              [
                113.6495176695799,
                -23.595285213205447
              ],
              [
                113.64419616689435,
                -23.59213898062324
              ],
              [
                113.63938964833966,
                -23.587419490277345
              ],
              [
                113.62840332021466,
                -23.588520719875
              ],
              [
                113.6288324374821,
                -23.5928468657661
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    srs_brs = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.MultiPolygon(
        [[[[115.84827424669419, -21.02980583604055],
           [115.81497193956528, -21.07017773808888],
           [115.7555771031395, -21.112140081902904],
           [115.72399140978013, -21.14800687825968],
           [115.72055818224106, -21.15857311802078],
           [115.73944093370591, -21.154410749940865],
           [115.826988235952, -21.088757947911635],
           [115.85754396104966, -21.057682843208667],
           [115.86406709337388, -21.02628078544677],
           [115.85857392931138, -21.01666658741176],
           [115.85531245649635, -21.023717063799158],
           [115.85067750597153, -21.02371705992466]]],
         [[[115.86990358019028, -20.967624540579273],
           [115.86166383409652, -20.975959618940223],
           [115.85376741075669, -20.98717918265542],
           [115.85239411974106, -20.999679989516938],
           [115.86303712511216, -21.01955091191698],
           [115.87265016222153, -20.995833698881682],
           [115.88981629991684, -20.96858630410876],
           [115.89942933702622, -20.96089202265777],
           [115.88123323106919, -20.95736534469322],
           [115.87265016222153, -20.959609603927692]]],
         [[[116.09772512540678, -20.79743740870953],
           [116.08399221525053, -20.807386604276175],
           [116.07300588712553, -20.817335143362317],
           [116.07300588712553, -20.837230251066757],
           [116.1203844271646, -20.82022330590475],
           [116.12141439542631, -20.801930675079298]]]]),
    rs_mask = 
    /* color: #98ff00 */
    /* shown: false */
    ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.84140779161606,
                -20.979480849517895
              ],
              [
                115.82527162218247,
                -21.013136218471896
              ],
              [
                115.80638887071763,
                -21.06889125291018
              ],
              [
                115.7662201085106,
                -21.100284318735472
              ],
              [
                115.7995224156395,
                -21.11021339716142
              ],
              [
                115.82595826769028,
                -21.082346236019625
              ],
              [
                115.84209443712388,
                -21.046783995306185
              ],
              [
                115.86269380235825,
                -21.031403097141624
              ],
              [
                115.86784364366684,
                -21.008008271355337
              ],
              [
                115.85891725206528,
                -20.982045335069007
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.89410783434067,
                -20.897076699158283
              ],
              [
                115.87453843736802,
                -20.92273369684537
              ],
              [
                115.9068107762352,
                -20.965699326835793
              ],
              [
                115.92054368639145,
                -20.95832550599559
              ],
              [
                115.92775346422349,
                -20.913754246993182
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.49654008531724,
                -20.341500174314977
              ],
              [
                115.43748857164536,
                -20.443834320892417
              ],
              [
                115.40590287828599,
                -20.54224252287649
              ],
              [
                115.41002275133286,
                -20.61616781856854
              ],
              [
                115.46014787340317,
                -20.634161595814724
              ],
              [
                115.53705217027817,
                -20.563459531619632
              ],
              [
                115.55421830797349,
                -20.43611336099191
              ],
              [
                115.55009843492661,
                -20.369825855363466
              ],
              [
                115.52263261461411,
                -20.333130229107724
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.46426774645005,
                -20.96537205119333
              ],
              [
                115.42581559801255,
                -20.998069031865306
              ],
              [
                115.4395485081688,
                -21.071771227314706
              ],
              [
                115.53155900621567,
                -21.164007698868875
              ],
              [
                115.5603981175438,
                -21.160165658160956
              ],
              [
                115.54666520738755,
                -20.99422269972318
              ],
              [
                115.47594072008286,
                -20.967936778828328
              ],
              [
                115.44160844469224,
                -20.958318823383838
              ],
              [
                115.42238237047349,
                -20.999351120556845
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.05434037828599,
                -21.464017442056203
              ],
              [
                115.01932145738755,
                -21.458266103921297
              ],
              [
                115.00078202867661,
                -21.466573519482246
              ],
              [
                114.97880937242661,
                -21.476158410432845
              ],
              [
                114.98292924547349,
                -21.495326299712705
              ],
              [
                115.05365373277817,
                -21.47871427482756
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.50172071208692,
                -21.261497219775173
              ],
              [
                115.48112134685255,
                -21.273654989983033
              ],
              [
                115.44747571696973,
                -21.33442876617758
              ],
              [
                115.4289362882588,
                -21.3504176846193
              ],
              [
                115.40765027751661,
                -21.363847028437508
              ],
              [
                115.40353040446973,
                -21.386226531940434
              ],
              [
                115.36233167400098,
                -21.40796334362788
              ],
              [
                115.2971003507588,
                -21.435449387505994
              ],
              [
                115.31014661540723,
                -21.53256783526038
              ],
              [
                115.38293103923536,
                -21.54150969442756
              ],
              [
                115.58205823650098,
                -21.313960407499227
              ],
              [
                115.58961133708692,
                -21.283892333268895
              ],
              [
                115.54703931560255,
                -21.24421866159793
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.05412313566069,
                -20.92063269511918
              ],
              [
                116.03197881803374,
                -20.92881005495482
              ],
              [
                116.03146383390288,
                -20.963919525183464
              ],
              [
                116.04828664884428,
                -20.95991201126498
              ],
              [
                116.05755636319975,
                -20.92864971885525
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.05515310392241,
                -20.82856657558329
              ],
              [
                116.03043386564116,
                -20.83241715956262
              ],
              [
                116.00193807706694,
                -20.87893726168691
              ],
              [
                116.04073354825834,
                -20.893692354912197
              ],
              [
                116.06819936857084,
                -20.911973827806083
              ],
              [
                116.0987550936685,
                -20.842684902076165
              ],
              [
                116.07609579191069,
                -20.82952923080852
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.10287496671538,
                -20.793585931009147
              ],
              [
                116.06854269132475,
                -20.816372410213535
              ],
              [
                116.07025930509428,
                -20.830812761536777
              ],
              [
                116.10115835294584,
                -20.835946775044096
              ],
              [
                116.11901113614897,
                -20.804498195761656
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.55405214069447,
                -20.483868993211136
              ],
              [
                116.50049379108509,
                -20.49030115258867
              ],
              [
                116.44418885944447,
                -20.542391692973183
              ],
              [
                116.4517419600304,
                -20.589965075681874
              ],
              [
                116.47440126178822,
                -20.642021636073654
              ],
              [
                116.5176599287804,
                -20.66129732563538
              ],
              [
                116.53207948444447,
                -20.668364465942627
              ],
              [
                116.69756105182728,
                -20.641379071000216
              ],
              [
                116.73944642780384,
                -20.537247737184856
              ],
              [
                116.71129396198353,
                -20.468430710226155
              ],
              [
                116.68176820514759,
                -20.44076657039985
              ],
              [
                116.61173036335072,
                -20.476150045883973
              ],
              [
                116.58632447956165,
                -20.487728321213055
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.78888490436634,
                -20.367721086491112
              ],
              [
                116.78545167682728,
                -20.327805585989395
              ],
              [
                116.69206788776478,
                -20.356133777881805
              ],
              [
                116.65224244831165,
                -20.383813127416932
              ],
              [
                116.70580079792103,
                -20.4230706578309
              ],
              [
                116.70717408893665,
                -20.45910154262098
              ],
              [
                116.7264001631554,
                -20.493194417450695
              ],
              [
                116.77446534870228,
                -20.499626185602523
              ],
              [
                116.78957154987415,
                -20.484189488690838
              ],
              [
                116.78819825885853,
                -20.47068110423826
              ],
              [
                116.78064515827259,
                -20.44945124093716
              ],
              [
                116.77858522174915,
                -20.421783684367245
              ],
              [
                116.77171876667103,
                -20.396685551190277
              ],
              [
                116.76210572956165,
                -20.37351441459868
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                122.17213989133427,
                -17.929995486413752
              ],
              [
                122.13300109738896,
                -17.97016871831459
              ],
              [
                122.20921874875614,
                -18.03481862961908
              ],
              [
                122.2456109606702,
                -17.99498663872928
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.67959947975885,
                -22.72982079201389
              ],
              [
                113.7043187180401,
                -22.73615383171668
              ],
              [
                113.71942491921197,
                -22.73995351474671
              ],
              [
                113.72903795632135,
                -22.748185798990484
              ],
              [
                113.74620409401666,
                -22.824785559498523
              ],
              [
                113.76268358620416,
                -22.854527576040386
              ],
              [
                113.76955004128229,
                -22.88046742660153
              ],
              [
                113.7757298508526,
                -22.888691222817705
              ],
              [
                113.79838915261041,
                -22.905769822574072
              ],
              [
                113.81486864479791,
                -22.873508440695765
              ],
              [
                113.7867161789776,
                -22.807063821659074
              ],
              [
                113.76337023171197,
                -22.75578439043495
              ],
              [
                113.72560472878229,
                -22.713986909881275
              ],
              [
                113.70225878151666,
                -22.70828626381681
              ],
              [
                113.68577928932916,
                -22.736787119555157
              ],
              [
                113.70569200905572,
                -22.735520540944943
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.80456896218072,
                -22.89849696732578
              ],
              [
                113.79564257057916,
                -22.913676953619227
              ],
              [
                113.78534288796197,
                -23.059065494842066
              ],
              [
                113.79564257057916,
                -23.029368390962826
              ],
              [
                113.83340807350885,
                -22.99207978446779
              ],
              [
                113.82310839089166,
                -22.90229212320889
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.3707815561479,
                -22.15788577451741
              ],
              [
                114.28220428564009,
                -22.37012746592799
              ],
              [
                114.3652883920854,
                -22.499601341823258
              ],
              [
                114.42502655126509,
                -22.399333099757236
              ],
              [
                114.45935882665572,
                -22.21574398665295
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.73636501247063,
                -22.4190031058394
              ],
              [
                113.72984188014641,
                -22.427254591974442
              ],
              [
                113.72881191188469,
                -22.436140259337044
              ],
              [
                113.71954219752922,
                -22.45422718108674
              ],
              [
                113.71473567897453,
                -22.458351938146624
              ],
              [
                113.72400539333,
                -22.482463445638327
              ],
              [
                113.74254482204094,
                -22.4729462466735
              ],
              [
                113.75490444118157,
                -22.422811544987763
              ],
              [
                113.75524776393547,
                -22.40884675755068
              ],
              [
                113.74803798610344,
                -22.401229009104764
              ],
              [
                113.74391811305657,
                -22.400594177887193
              ],
              [
                113.73876827174797,
                -22.416146707938328
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.78649013454094,
                -22.355196235285753
              ],
              [
                113.77035396510735,
                -22.361546488523523
              ],
              [
                113.74632137233391,
                -22.396785129699857
              ],
              [
                113.756964377705,
                -22.405355341345306
              ],
              [
                113.79129665309563,
                -22.361863993585867
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.62885575947553,
                -23.59020860363327
              ],
              [
                113.62851243672162,
                -23.602635965540163
              ],
              [
                113.6219893043974,
                -23.618836959800767
              ],
              [
                113.64791017231732,
                -23.62638625357526
              ],
              [
                113.64379029927045,
                -23.594141440439465
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    sl_mask = 
    /* color: #0b4a8b */
    /* shown: false */
    ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.8386612095848,
                -20.992627828306052
              ],
              [
                115.80947877550278,
                -21.054798704459902
              ],
              [
                115.76210023546372,
                -21.09804662939216
              ],
              [
                115.74184419298325,
                -21.12014626319785
              ],
              [
                115.76381684923325,
                -21.13679888445405
              ],
              [
                115.85651399278794,
                -21.076264061958387
              ],
              [
                115.86818696642074,
                -20.99743577936058
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.65755845689927,
                -21.14576379164568
              ],
              [
                115.62253953600083,
                -21.188985203893335
              ],
              [
                115.61258317613755,
                -21.205630081867923
              ],
              [
                115.63386918687974,
                -21.213311700616384
              ],
              [
                115.66408158922349,
                -21.200188693476917
              ],
              [
                115.6815910496727,
                -21.164334537791195
              ],
              [
                115.67335130357895,
                -21.14672440459806
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.46286458307344,
                -21.44409685601062
              ],
              [
                115.34888142877656,
                -21.421086999977543
              ],
              [
                115.30768269830781,
                -21.44154038449411
              ],
              [
                115.31317586237031,
                -21.52588026518954
              ],
              [
                115.36055440240938,
                -21.546957594514534
              ],
              [
                115.47522420221406,
                -21.484355369834358
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.02871725187163,
                -20.89337160743528
              ],
              [
                116.01137945279936,
                -20.907002770633337
              ],
              [
                115.99970647916655,
                -20.965682797286558
              ],
              [
                116.00622961149077,
                -20.976422278298095
              ],
              [
                116.06407949552397,
                -20.95125541477001
              ],
              [
                116.05034658536772,
                -20.89754127116878
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.69412782428822,
                -20.53531759063379
              ],
              [
                116.65086915729603,
                -20.56939350264547
              ],
              [
                116.61791017292103,
                -20.5996054034931
              ],
              [
                116.44418885944447,
                -20.6169584693865
              ],
              [
                116.49500062702259,
                -20.672218013639725
              ],
              [
                116.51491334674915,
                -20.682496642558668
              ],
              [
                116.68520143268665,
                -20.657441265642912
              ],
              [
                116.73326661823353,
                -20.643948197278892
              ],
              [
                116.7483728194054,
                -20.59446337486295
              ],
              [
                116.7318933272179,
                -20.554606775967887
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                117.12726957684782,
                -20.555473005824798
              ],
              [
                116.94599516278532,
                -20.63260494316459
              ],
              [
                116.86703092938689,
                -20.681434966313116
              ],
              [
                116.82857878094939,
                -20.65830691112156
              ],
              [
                116.86977751141814,
                -20.560616348299526
              ],
              [
                116.84986479169157,
                -20.53232582257793
              ],
              [
                116.77708036786345,
                -20.63260494316459
              ],
              [
                116.80111296063689,
                -20.701347968119173
              ],
              [
                116.88557035809782,
                -20.7315336598528
              ],
              [
                116.9830740202072,
                -20.693640019446093
              ],
              [
                117.06684477216032,
                -20.66087686894332
              ],
              [
                117.14443571454314,
                -20.654451892896954
              ],
              [
                117.1753347623947,
                -20.596614894672232
              ],
              [
                117.15748197919157,
                -20.55740177954474
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                122.19823242063114,
                -17.94861348448223
              ],
              [
                122.17557311887333,
                -17.9767000882657
              ],
              [
                122.2123086535413,
                -18.023718816109678
              ],
              [
                122.2394311510999,
                -17.994660109802933
              ],
              [
                122.21986175412724,
                -17.96853583809024
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.36940826513228,
                -22.10167175352232
              ],
              [
                114.30829681493697,
                -22.261264703254366
              ],
              [
                114.30623687841353,
                -22.362902466692212
              ],
              [
                114.2114797983354,
                -22.398458186093446
              ],
              [
                114.22315277196822,
                -22.326702499152063
              ],
              [
                114.15998138524947,
                -22.279056650890944
              ],
              [
                114.12427581884322,
                -22.373062170690783
              ],
              [
                114.10848297216353,
                -22.44987090625712
              ],
              [
                114.12976898290572,
                -22.50443639482866
              ],
              [
                114.36803497411665,
                -22.488816468975333
              ],
              [
                114.41953338720259,
                -22.41583791874988
              ],
              [
                114.49506439306197,
                -22.2023942068119
              ],
              [
                114.48888458349165,
                -22.161065415609755
              ],
              [
                114.46347869970259,
                -22.122904981522662
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.4696585092729,
                -21.987352070239833
              ],
              [
                114.44013275243697,
                -22.100639954671927
              ],
              [
                114.50467743017134,
                -22.15788577451741
              ],
              [
                114.62621368505415,
                -22.085370476605192
              ],
              [
                114.61522735692915,
                -22.007088502429504
              ],
              [
                114.47927154638228,
                -21.979074684734503
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    srs_rs = 
    /* color: #ffc82d */
    /* shown: false */
    ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.0891931319054,
                -20.786523493272778
              ],
              [
                116.04627778766712,
                -20.817654913333183
              ],
              [
                116.06241395710072,
                -20.83658737485452
              ],
              [
                116.10052278278431,
                -20.797115316122756
              ],
              [
                116.10258271930775,
                -20.786844468524123
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.63829713520795,
                -23.602950567014815
              ],
              [
                113.61786943135053,
                -23.604523563065943
              ],
              [
                113.62525087055951,
                -23.617264135510027
              ],
              [
                113.63417726216107,
                -23.62276893792724
              ],
              [
                113.64241700825482,
                -23.611287231040066
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    srs_tomask = 
    /* color: #00ffff */
    /* shown: false */
    ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.61173036335072,
                -20.510881130310516
              ],
              [
                116.58975770710072,
                -20.521813713249756
              ],
              [
                116.57327821491322,
                -20.516669065577126
              ],
              [
                116.4901941084679,
                -20.540461611344593
              ],
              [
                116.4627282881554,
                -20.56039305688386
              ],
              [
                116.47234132526478,
                -20.58739280235569
              ],
              [
                116.5011804365929,
                -20.57196496113945
              ],
              [
                116.5341394209679,
                -20.575179223346208
              ],
              [
                116.55199220417103,
                -20.56617911862461
              ],
              [
                116.57327821491322,
                -20.577750584377664
              ],
              [
                116.63232972858509,
                -20.553320906004913
              ],
              [
                116.65086915729603,
                -20.541104601767483
              ],
              [
                116.65086915729603,
                -20.519241411024733
              ],
              [
                116.64056947467884,
                -20.503806690156342
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                117.15713865643767,
                -20.56961678090167
              ],
              [
                116.97992187702602,
                -20.614581539682497
              ],
              [
                116.87383514606898,
                -20.670163170158755
              ],
              [
                116.81478363239711,
                -20.645427033888083
              ],
              [
                116.80173736774867,
                -20.6913623665923
              ],
              [
                116.8583856221432,
                -20.71576989303846
              ],
              [
                116.95829254352992,
                -20.709026101018758
              ],
              [
                117.04789978229945,
                -20.650888605087005
              ],
              [
                117.11690765583461,
                -20.628398523589365
              ],
              [
                117.17080932819789,
                -20.62197217541472
              ],
              [
                117.21372467243617,
                -20.63289680587933
              ],
              [
                117.22505432331508,
                -20.603334232025016
              ],
              [
                117.16531616413539,
                -20.568301586124072
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                118.90737310133062,
                -19.851767542916473
              ],
              [
                118.89913335523687,
                -19.87437037238264
              ],
              [
                118.91698613844,
                -19.884056312896956
              ],
              [
                118.91561284742437,
                -19.901812332290636
              ],
              [
                118.94960180006109,
                -19.88954474967175
              ],
              [
                118.93449559888921,
                -19.8579029151192
              ],
              [
                118.92179265699468,
                -19.852413382741066
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.8612453391624,
                -22.124251143821795
              ],
              [
                113.79498404765849,
                -22.28223003256527
              ],
              [
                113.81318015361552,
                -22.28159465924663
              ],
              [
                113.83549613261943,
                -22.220585387930868
              ],
              [
                113.85746878886943,
                -22.18244110734156
              ],
              [
                113.87394828105693,
                -22.13188398496765
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.46835528301688,
                -21.98193057210849
              ],
              [
                114.35849200176688,
                -22.2154167489958
              ],
              [
                114.46080218243094,
                -22.27261582992324
              ],
              [
                114.54457293438406,
                -22.0653173701729
              ],
              [
                114.55006609844656,
                -21.98193057210849
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.71587951608444,
                -22.71144108498387
              ],
              [
                113.70729644723679,
                -22.721891847197654
              ],
              [
                113.73270233102585,
                -22.74469073925961
              ],
              [
                113.76222808786179,
                -22.808950464573698
              ],
              [
                113.79347045846725,
                -22.88425086853362
              ],
              [
                113.80514343210007,
                -22.850086104856487
              ],
              [
                113.7522717279985,
                -22.73012521890326
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.77802093454147,
                -22.8731798954524
              ],
              [
                113.76119811960007,
                -22.882353051546186
              ],
              [
                113.78385742135788,
                -22.90386009009927
              ],
              [
                113.80754669137741,
                -22.893106996954337
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                121.74617547536792,
                -18.403000299346484
              ],
              [
                121.52644891286792,
                -18.767468456771397
              ],
              [
                121.49348992849292,
                -19.00654889147111
              ],
              [
                121.59236688161792,
                -19.019532595133516
              ],
              [
                121.69948358083667,
                -18.764867884729004
              ],
              [
                121.87251824880542,
                -18.603554286043043
              ],
              [
                121.89449090505542,
                -18.40039415922561
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    orf_irf_rs_brs_totrf = 
    /* color: #bf04c2 */
    /* shown: false */
    ee.Geometry.MultiPolygon(
        [[[[116.89655668622282, -20.556759976043075],
           [116.81965238934782, -20.558688733515854],
           [116.78738005048064, -20.633248663103902],
           [116.78120024091032, -20.67693923782584],
           [116.85192472821501, -20.740525096545912],
           [116.97002775555876, -20.731534776934442],
           [117.08538420087126, -20.67115738303711],
           [117.22683317548064, -20.646742680837747],
           [117.23301298505095, -20.594687734524015],
           [117.18426115399626, -20.55547412420039],
           [117.03113920575407, -20.5972587667344],
           [116.89792997723845, -20.666660232666974],
           [116.88007719403532, -20.683363262669136],
           [116.83338529950407, -20.663447900880843],
           [116.83407194501189, -20.632606060974616],
           [116.8677175748947, -20.57476076528827]]],
         [[[121.8257051662481, -18.41978038251641],
           [121.75772726097466, -18.4341120502921],
           [121.71721517601372, -18.52333233642316],
           [121.66777669945122, -18.576712014508768],
           [121.67944967308404, -18.63137631067519],
           [121.61215841331841, -18.661304074656144],
           [121.55585348167779, -18.689275254659574],
           [121.53662740745904, -18.84660814760155],
           [121.5180879787481, -18.96743334850609],
           [121.60117208519341, -19.002495262959567],
           [121.68906271019341, -18.80501373519604],
           [121.71103536644341, -18.737400887681876],
           [121.79617940941216, -18.695129103395733],
           [121.83531820335747, -18.589078093713727],
           [121.85042440452935, -18.46016656647253]]],
         [[[122.18655944699833, -17.94273432827959],
           [122.16733337277958, -17.984537413326773],
           [122.19788909787724, -18.011312314163764],
           [122.21471191281864, -18.022086431568578],
           [122.23531127805302, -17.98845594536802],
           [122.19514251584599, -17.93489514947075]]]]),
    Dl_SRS_Pr_to_rs = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.MultiPolygon(
        [[[[113.61757805964874, -23.59838217095967],
           [113.59697869441436, -23.631412275242813],
           [113.58616402766631, -23.665534632521034],
           [113.59217217585967, -23.668836323772787],
           [113.60058358333038, -23.65012563762791],
           [113.60573342463897, -23.63801729686903],
           [113.60916665217803, -23.625907836045304],
           [113.6210112871878, -23.615212835755084],
           [113.6198150253937, -23.61288043678834],
           [113.6220519688726, -23.60960430258262],
           [113.62068940080418, -23.607456182851244],
           [113.62139746817148, -23.605362093712973],
           [113.61972377693836, -23.602117767325755],
           [113.62118283837707, -23.599404395494307]]],
         [[[113.64315560481475, -23.58280794971745],
           [113.64349892756866, -23.589730054057874],
           [113.6455588640921, -23.592404405667864],
           [113.66581490657256, -23.5908312642639],
           [113.69122079036163, -23.577458800852433],
           [113.70546868464874, -23.56801859471496],
           [113.72143319270538, -23.54630354584327],
           [113.7308745684378, -23.539221775978003],
           [113.73362107427752, -23.527654017508443],
           [113.72606804988311, -23.530880535768564],
           [113.69602730891631, -23.557004163290806],
           [113.65671685359405, -23.565973127274717]]],
         [[[113.73282939455055, -23.52665271767227],
           [113.73368770143531, -23.536882795874813],
           [113.7462189819529, -23.534522079198627],
           [113.76733333131813, -23.518468082491843],
           [113.77299815675758, -23.488243484105386],
           [113.7795212890818, -23.481473483322166],
           [113.78449946901344, -23.44998054146407],
           [113.78449946901344, -23.3896506016047],
           [113.78226787111305, -23.37625772129654],
           [113.75377208253883, -23.374209279094014],
           [113.76218349000953, -23.42556834527673],
           [113.76716166994117, -23.469821970678222],
           [113.75136882326149, -23.493911124407568],
           [113.74879390260719, -23.511857044135326],
           [113.73626262208961, -23.522245669659032]]],
         [[[113.62657100221656, -23.585110824708465],
           [113.62433940431617, -23.603673500602795],
           [113.63429576417946, -23.608864287333272],
           [113.64305049440406, -23.600842075769],
           [113.6425355102732, -23.590774292396553],
           [113.63189250490211, -23.582436324448594]]],
         [[[113.76770737126049, -23.292009971663305],
           [113.7687373395222, -23.29800134382476],
           [113.77457382633861, -23.30304650060924],
           [113.77354385807689, -23.308879724612357],
           [113.76993896916088, -23.32354048207538],
           [113.77234222843822, -23.33709630244806],
           [113.76925232365306, -23.374919178713718],
           [113.77354385807689, -23.37428888581227],
           [113.77800705387767, -23.347971483582974],
           [113.77989532902416, -23.324328649037525],
           [113.78676178410228, -23.315816198482217],
           [113.78882172062572, -23.304307759908998],
           [113.77989532902416, -23.29674002473478],
           [113.77629044010814, -23.283180089488436],
           [113.7661624188679, -23.284126176306536]]],
         [[[113.74912526798846, -23.242216635780554],
           [113.77247121525409, -23.27470509214037],
           [113.78105428410174, -23.26114291297138],
           [113.7731578607619, -23.240323860337952],
           [113.76594808292987, -23.2087736510334],
           [113.74397542667987, -23.216346381101783]]],
         [[[114.37421478368697, -22.12926577195546],
           [114.30349029638228, -22.37139740357029],
           [114.13251556493697, -22.41456838689364],
           [114.18538726903853, -22.474223832692417],
           [114.41678680517134, -22.46660967286203],
           [114.43463958837447, -22.199851247636577]]],
         [[[119.09311674939306, -19.5574306915193],
           [119.06736754285009, -19.5737673833168],
           [119.07474898205908, -19.59770330631691],
           [119.08951186047705, -19.609346522523925],
           [119.1065063367954, -19.60708262981691],
           [119.11251448498876, -19.60853799307247],
           [119.11062620984228, -19.59430720954429],
           [119.09637831555517, -19.59430720954429],
           [119.08298872815283, -19.579428226822994],
           [119.08607863293798, -19.574090865446465],
           [119.10496138440283, -19.577002175389634],
           [119.11148451672705, -19.585412330802576],
           [119.12350081311376, -19.569723801907173],
           [119.10410307751806, -19.551930838731383]]],
         [[[114.36465715156862, -21.653100403360877],
           [114.3471476911194, -21.643527201251114],
           [114.33410142647097, -21.65437678233816],
           [114.29547693333595, -21.695693428622267],
           [114.30552066802704, -21.70502584302594],
           [114.35435746895143, -21.673840162661143],
           [114.36500047432253, -21.663311119059752]]],
         [[[113.58765702900678, -23.672458963192767],
           [113.57985182341616, -23.69572501479915],
           [113.5874049240021, -23.697768456447477],
           [113.59152479704896, -23.67528883945317],
           [113.59058065947573, -23.67261618014816]]],
         [[[113.5162421816766, -23.820488587372846],
           [113.51323810757992, -23.82229451703755],
           [113.51117817105649, -23.844356236829082],
           [113.4957286471307, -23.86311752126569],
           [113.48225322903988, -23.87465553918951],
           [113.47029943019459, -23.887222155248192],
           [113.47433347255298, -23.889105632725784],
           [113.48737973720142, -23.878903135073315],
           [113.49390286952564, -23.875685257424518],
           [113.49647779017994, -23.870505091226786],
           [113.50085515529224, -23.86140005445693],
           [113.50815076381275, -23.855120345817877],
           [113.51398725062916, -23.845935723874554],
           [113.51733464747974, -23.83266789879879],
           [113.51707715541431, -23.827328982655615],
           [113.51793546229908, -23.821361698728115]]],
         [[[113.4664662085354, -23.897634261034355],
           [113.4664662085354, -23.908619941790175],
           [113.46114470584985, -23.922743016452774],
           [113.46011473758813, -23.935295564282963],
           [113.46028639896508, -23.949886366910153],
           [113.46320464237328, -23.970749915832496],
           [113.46835448368188, -23.96996563297066],
           [113.46783949955102, -23.942512726629452],
           [113.46457793338891, -23.92886253596473],
           [113.46783949955102, -23.916780128794223],
           [113.47007109745141, -23.91317087886945],
           [113.47058608158227, -23.904225781514555],
           [113.4693844519436, -23.897948150581993],
           [113.47333266361352, -23.892298022153128],
           [113.46869780643578, -23.890728498227674]]],
         [[[113.39255570857256, -24.255081642710177],
           [113.39633225886553, -24.282780553560837],
           [113.40285539118975, -24.296393058756504],
           [113.407404417679, -24.294359099012688],
           [113.3960747668001, -24.25015154281418],
           [113.39118241755693, -24.250464570711745]]]]),
    refinement_mask = /* color: #98ff00 */ee.Geometry.MultiPolygon(
        [[[[114.87152518891935, -21.594281334871788],
           [114.79118766450529, -21.740412890612557],
           [114.75754203462247, -21.80864185542271],
           [114.8083538022006, -21.802266691980464],
           [114.89487113618497, -21.62620041720765],
           [114.90517081880216, -21.59938886134067]]],
         [[[114.74781677228094, -21.576870353101516],
           [114.73957702618719, -21.608314484036992],
           [114.74610015851141, -21.609272066106886],
           [114.75433990460516, -21.592992308944595],
           [114.75296661358954, -21.576870353101516]]],
         [[[114.67022582989813, -21.655547637273788],
           [114.67726394635321, -21.654749908208217],
           [114.72275421124579, -21.632571275323766],
           [114.71983596783758, -21.625390412578763],
           [114.66215774518133, -21.65139939797945]]],
         [[[115.13957428276586, -21.00440996040484],
           [115.0534002715354, -21.031971267983522],
           [115.3284017974143, -21.072342582850165],
           [115.3448812896018, -21.01049952485164],
           [115.32702850639868, -21.013063477626318],
           [115.28376983940649, -21.022677907978927],
           [115.20446228325414, -21.004089450128436]]],
         [[[116.68839911077794, -20.387664463642615],
           [116.7031619891959, -20.418233950155994],
           [116.73543432806309, -20.423381898176885],
           [116.75603369329747, -20.421451437849726],
           [116.75706366155919, -20.400214776329594],
           [116.73543432806309, -20.350329291167018],
           [116.68942907903966, -20.369963568288217]]],
         [[[116.93662146185216, -20.384124447096475],
           [116.9503543720084, -20.39442245132016],
           [116.95928076360997, -20.395066053740265],
           [116.96443060491856, -20.39957119541492],
           [116.97129705999669, -20.405363326855287],
           [116.97816351507481, -20.408259310898625],
           [116.98777655218419, -20.412442302814622],
           [117.01009253118809, -20.432068669910397],
           [117.01524237249669, -20.442685169086094],
           [117.02416876409825, -20.46069936850156],
           [117.05712774847325, -20.447188916943357],
           [117.0488880023795, -20.43271211496869],
           [117.06639746282872, -20.422738414092073],
           [117.07601049993809, -20.41565991157244],
           [117.0766971454459, -20.403754423301564],
           [117.02004889105137, -20.415016395200944],
           [116.97644690130528, -20.396996844872696],
           [116.94314459417637, -20.382193494723662]]],
         [[[118.16979829750335, -20.143351710759102],
           [118.12585298500335, -20.16977996480206],
           [118.17117158851897, -20.29541395236073],
           [118.20962373695647, -20.2857534068878]]],
         [[[119.08755178452964, -19.56700308832156],
           [119.09373159409995, -19.56441509929784],
           [119.1019713401937, -19.560533037868844],
           [119.10883779527182, -19.568297067253006],
           [119.1129576683187, -19.575090286206375],
           [119.11948080064292, -19.579295468708384],
           [119.12325735093589, -19.584470927246706],
           [119.13596029283042, -19.589646219466392],
           [119.1290938377523, -19.57056150538727],
           [119.10300130845542, -19.544356776117496],
           [119.07553548814292, -19.552121584179762],
           [119.03914327622886, -19.574119843888308],
           [119.07141561509604, -19.60258372212956],
           [119.07313222886557, -19.592880692628622],
           [119.07107229234214, -19.585117847870468],
           [119.07210226060386, -19.575090286206375],
           [119.07347555161948, -19.568620560362813]]],
         [[[116.35858103321459, -20.7185680315712],
           [116.37162729786303, -20.73719183908499],
           [116.40664621876147, -20.72627471251652],
           [116.4416651396599, -20.70893412900841],
           [116.49041697071459, -20.70443809821179],
           [116.53092905567553, -20.672962150180215],
           [116.57624765919115, -20.663325350856038],
           [116.61452773586029, -20.655574843723063],
           [116.62688735500092, -20.640153907098796],
           [116.60903457179779, -20.634370652712047],
           [116.58431533351654, -20.63051502766064],
           [116.5547895766806, -20.635013247389153],
           [116.53625014796967, -20.63822618006443],
           [116.51427749171967, -20.640796477348033],
           [116.48955825343842, -20.648507108583832],
           [116.47376540675873, -20.657502350816664],
           [116.46209243312592, -20.67741849225583],
           [116.42501357570404, -20.691550943348226],
           [116.41677382961029, -20.685769645162985],
           [116.3899946548056, -20.688339138220158],
           [116.38175490871186, -20.68063052852161]]],
         [[[113.18730409744938, -24.711441576747387],
           [113.15949495438298, -24.74106692333719],
           [113.16876466873845, -24.745120369340135],
           [113.20618684891423, -24.71986212956668]]],
         [[[112.99294301853769, -26.14995258613967],
           [112.98762151585214, -26.157194626646646],
           [113.00255605564706, -26.181690962270448],
           [113.01474401341073, -26.192473880572994],
           [113.0185205637037, -26.181382864226926],
           [113.0046159921705, -26.15796503003367]]],
         [[[114.93363929296919, -21.539871626396792],
           [114.92024970556685, -21.5612662231523],
           [114.91921973730513, -21.5979809326544],
           [114.99063087011763, -21.594788718679666],
           [114.96900153662153, -21.5612662231523],
           [114.94565558935591, -21.543384388588166]]],
         [[[114.90239692236372, -21.487808920583994],
           [114.89759040380903, -21.52230654051721],
           [114.91921973730513, -21.54082966088016],
           [115.00470710302778, -21.501545064583315],
           [115.04041266943403, -21.481419574606132],
           [115.03629279638716, -21.463847427504557],
           [115.02358985449263, -21.47151553420435],
           [115.01535010839888, -21.477905314789215],
           [115.00642371679731, -21.4823779943806],
           [114.97552466894575, -21.478224796459227],
           [114.96316504980513, -21.479183237263552],
           [114.94222236181685, -21.486531073824448],
           [114.91990638281294, -21.476627381099938],
           [114.90617347265669, -21.47630789592535]]],
         [[[114.55323768164106, -21.664682078779585],
           [114.55976081396528, -21.66978711709558],
           [114.60782599951216, -21.67776337764734],
           [114.63563514257856, -21.662767642824722],
           [114.55632758642622, -21.652237790954338]]]]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
///////////////////////////////
// Global coral atlas project - WEA
// Contact: mitchell.lyons@gmail.com
// Region coordinator: Rodney Borrego (rodbio2008@gmail.com)
// Description:
// - Developing a process to combine OBIA and supervised classification
// - This script loads the raw classification data (from *_classification script)
// - Then applied some cleanup and object-based relational rules
///////////////////////////////

// Table of contents
// 1. Setting constants
// 2. Data loads & vis
// 3. OBIA clean up rules
// 4. Export

// Load and libraries needed
var map_palettes = require('users/mitchest/global_reefs:Modules/colour_pals');
var pkg_vis = require('users/mitchest/global_reefs:Modules/pkg_vis');
var param_module = require('users/mitchest/global_reefs:Modules/reef_params');

// ###########################################
// SENSOR GENERICS
var sensor_params = param_module.dove;         //<------------ THIS IS WHERE YOU CHOOSE THE SENSOR
// REGION AND SENSOR SPECIFIC LOAD PATHS
var region_params = param_module.west_australia;  //<------------ THIS IS WHERE YOU CHOOSE THE REGION
//  ^^ all the data paths are in this module ^^
// ###########################################

// 1. Setting constants

// These will get written to the asset metadata 

//Map.centerObject(geometry, 7)

var vars = {
  
  // analysis type
  geomorphic: true, // map geomorphic zonation (when set to true) or benthic habitat (when set to false)

  // analysis parameters
  image_data_scale: sensor_params.pixel,
  small_object_geo: ee.Number(400).int(), // smallest object szie in pixels (geomorphic)
  small_object_benthic: ee.Number(130).int(), // smallest object szie in pixels (benthic)
  smooth_radius: ee.Number(3), // radius in pixels for initial smooth 
  dist_to_land_ORF: 1000, //distance to land in meters to convert terrestrial reef flat to ORF
  dist_to_land_RC: 500, //distance to land in meters to convert reef crest to TRF - not used for Indo
  wave_height: 0.4, //cut off height for waves in metres, Hs95 threshold
  geo_depth_cutoff: 1200, //depth in centimetres
  shallowlag_depth_cutoff: 500, //depth in centimetres
  benthic_depth_cutoff: 750, //depth in centimetres
  
  //############
  // Clean-up stage selection
  cleanup_stage: 3, // set to 1, 2 or 3
  geo_refinement: false, // set to true to apply the refinement_mask (the other stage 3 masks will still run)
  
  /*
  - GEOMORPHIC 1: The first pass does a small object filter, just to generally clean noise and reduce the amount of cleaning needed
  -            2: The second pass runs the OBIA cleanup rules
  -            3: The third pass is the MANUAL cleanup stage, which includes AT LEAST the no_reef masking
                        - see below where it starts/ends (only that section is run)
                        - please put region specific stuff in here ONLY

  - BENTHIC 1: This is the main benthic stge - it does noise removal, no data reclaim and OBIA rules - review those if needed
            2: The second mas is the MANUAL stage - it's optional, but shuold include ALL region specific stuff
                        - see below where it starts/ends (only that section is run)
                        - please put region specific stuff in here ONLY
  */
  
  // DON'T TOUCH --->
  obia_2nd_pass: null,
  obia_clean: null, // run object-based relationship rules + small object clean up
  fast_clean: null, // run a faster (but less precise) version of the OBIA clean; only applies to geomorphic (`obia_clean: true` also)
  manual_clean: false, // apply manual touch ups
  // --------------<
  //############
  
  reproject_display: false,
  
  // export options
  do_export: false, // export the results?
  geomorph_output_name: region_params.sname + '_geo_clean', // DO NOT CHANGE - change in the pop up dialouge if you must
  benthic_output_name: region_params.sname + '_benthic_clean', // DO NOT CHANGE - change in the pop up dialouge if you must
  asset_output: region_params.asset // asset path

};


// Clean up stage auto-parameterisation (DON'T TOUCH) --->

if (vars.geomorphic) {
  var temp_outname = vars.geomorph_output_name;
  if (vars.cleanup_stage == 1) {
    vars.obia_2nd_pass = false;
    vars.obia_clean = false;
    vars.fast_clean = true;
    vars.manual_clean = false;
    vars.geomorph_output_name = temp_outname + '1';
  } else if (vars.cleanup_stage == 2) {
    vars.obia_2nd_pass = true;
    vars.obia_clean = true;
    vars.fast_clean = true;
    vars.manual_clean = false;
    vars.geomorph_output_name = temp_outname + '2';
  } else if (vars.cleanup_stage == 3) {
    vars.manual_clean = true;
    vars.obia_2nd_pass = false;
    vars.obia_clean = false;
    vars.fast_clean = false;
    vars.do_export = false;
    vars.geomorph_output_name = temp_outname + '3';
  }
}

if (!vars.geomorphic) {
  var temp_outname = vars.benthic_output_name;
  if (vars.cleanup_stage == 1) {
    vars.obia_2nd_pass = true,
    vars.obia_clean = true, 
    vars.fast_clean = false, 
    vars.manual_clean = false;
    vars.benthic_output_name = temp_outname + '1';
  } else if (vars.cleanup_stage == 2) {
    vars.manual_clean = true;
    vars.obia_2nd_pass = false,
    vars.obia_clean = false, 
    vars.fast_clean = false,
    vars.do_export = false;
    vars.benthic_output_name = temp_outname + '2';
  }
}

//Region extent is created in map viewer and exported to GEE asset
var region_extent = ee.FeatureCollection(region_params.extent_mask).geometry();
Map.addLayer(region_extent, {}, "Manual reef outline", false);
// -----------------------------------------<

//################################################################################################
//START OF CLEAN 3 - Manual Cleanup
//Review everything in this section
//This is the section to add/remove manual cleanups
//You MUST review it for each region

//###############################################################################################

if (vars.manual_clean && vars.geomorphic) {
  
  print("Doing GEOMORPHIC manual clean ups - make sure this is what you want to do");
  print("Export the manual map, check 'manual' layer in the viewer for effects");
  
  var depth = ee.Image(region_params.pixels).select('depth');
  
  // define the manually edited map - uses the output from the second pass of cleaning
  //var man_geo = ee.Image(region_params.geo_map_clean2);
  var man_geo = ee.Image(region_params.geo_map_clean2); // use this when testing for a small area
  
  // import the mid mask from asset ****only use ee.FC if mid_mask created in map viewer****
  //var mid_mask = ee.FeatureCollection(region_params.mid_mask).geometry();
  //Map.addLayer(mid_mask, {color: 'red'}, "mid mask import", true, 0.4);
  //var midmask = ee.Image().byte().paint(ee.Feature(mid_mask.dissolve(),{zone: 1}), "zone").clip(mid_mask.dissolve());
  
  // the "MID MASK" CLEAN
 // man_geo = man_geo.where({
  //  test: midmask.eq(1),
  //  value: ee.Image(0)
  //});
  
  /*
  // the "REEF MASK" CLEAN
  
  // Define a kernel for reef mask Morphological Operations
  var kernel_rm = ee.Kernel.circle({radius: vars.smooth_radius.multiply(5)});

  // Create reef mask to clean areas inside the reef - Perform an dilation of deepwater
  var reef_mask = man_geo.eq(2)
            .focal_max({kernel: kernel_rm, iterations: 2});
  var global_reef_mask = ee.Image(region_params.global_reef_mask);
  

  // Reef crest, slope, sheltered slope (within reef mask) -> Inner reef flat
  man_geo = man_geo.where({
    test: reef_mask.eq(0)
                    .and(man_geo.eq(15).or(man_geo.eq(21)).or(man_geo.eq(22))),
    value: ee.Image(13)
  });
  
  // the "DEEP WATER" CLEAN
  
  // Define a kernel for deep water Morphological Operations
  var kernel_dw = ee.Kernel.circle({radius: vars.smooth_radius.multiply(5)});

  // Create mask to clean deepwater areas - Perform an dilation of deepwater followed by a erosion
  var deepwater = man_geo.eq(2)
            .focal_max({kernel: kernel_dw, iterations: 2})
            .focal_min({kernel: kernel_dw, iterations: 2});
    
  
    // Deep lagoon (outside reef mask and global mask) -> deepwater 
  man_geo = man_geo.where({
    test: deepwater.eq(1)
                    .and(man_geo.eq(12)),
                    //.and(global_reef_mask.eq(2)),
    value: ee.Image(2)
  });
  
 
  // Reef classes in deepwater -> deepwater
  man_geo = man_geo.where({
    test: deepwater.eq(1)
                    .and(man_geo.eq(15).or(man_geo.eq(21)).or(man_geo.eq(22)).or(man_geo.eq(24))),
    value: ee.Image(2)
  });
  
  */
  
/*
  // WAVE clean (un-comment this sectio nbased on whether you have waves or not)
  
  var waves = ee.Image(region_params.waves)
  Map.addLayer(waves.lt(vars.wave_height), {}, vars.wave_height + "m Hs95 threshold", false)
  
  man_geo = man_geo.where({
    test: waves.lte(vars.wave_height)
               .and(man_geo.eq(22)),
    value: ee.Image(21)
  })
 
*/ 
  
  
/*
  ##############
  
  The rest of the manual geometry paintings and rules should go here
      - make the geom, paint the layer, use it in a rule
      - consult previous regions *_cleanup script for ideas/hints/existing rules etc.
  e.g. 
  var notreefcrest = ee.Image().byte().paint(ee.Feature(not_reef_crest, {zone: 1}), "zone").clip(not_reef_crest);
  var notdeepwater = ee.Image().byte().paint(ee.Feature(not_deep_water, {zone: 1}), "zone").clip(not_deep_water);
  
*/
var mid_Mask = ee.Image().byte().paint(ee.Feature(midMask, {zone: 1}), "zone").clip(midMask);

man_geo = man_geo.where({
  test: mid_Mask.eq(1),
  value: ee.Image (0),
})



/*
var Brs_Sl = ee.Image().byte().paint(ee.Feature(brs_sl, {zone: 1}), "zone").clip(brs_sl);

var Dl_SRS_Pr_toRs = ee.Image().byte().paint(ee.Feature(Dl_SRS_Pr_to_rs, {zone: 1}), "zone").clip(Dl_SRS_Pr_to_rs);
var Rs_Sl = ee.Image().byte().paint(ee.Feature(rs_sl, {zone:1}), "zone").clip(rs_sl)
*/
var Sl_Brs = ee.Image().byte().paint(ee.Feature(sl_brs, {zone: 1}), "zone").clip(sl_brs);
var Rs_Brs = ee.Image().byte().paint(ee.Feature(rs_brs, {zone: 1}), "zone").clip(rs_brs);
var Rs_Dl_Sl_SRS_toBrs= ee.Image().byte().paint(ee.Feature(rs_dl_sl_srs_tobrs, {zone:1}), "zone").clip(rs_dl_sl_srs_tobrs);
var SRS_toBrs = ee.Image().byte().paint(ee.Feature(srs_brs, {zone: 1}), "zone").clip(srs_brs);
var Rs_mask = ee.Image().byte().paint(ee.Feature(rs_mask, {zone: 1}), "zone").clip(rs_mask);
var Sl_mask = ee.Image().byte().paint(ee.Feature(sl_mask, {zone: 1}), "zone").clip(sl_mask);
var Srs_rs = ee.Image().byte().paint(ee.Feature(srs_rs, {zone:1}), "zone").clip(srs_rs)
var Srs_tomask = ee.Image().byte().paint(ee.Feature(srs_tomask, {zone:1}), "zone").clip(srs_tomask)
var Dl_SRS_Pr_toRs = ee.Image().byte().paint(ee.Feature(Dl_SRS_Pr_to_rs, {zone: 1}), "zone").clip(Dl_SRS_Pr_to_rs);

var Orf_irf_rs_brs_totrf= ee.Image().byte().paint(ee.Feature(orf_irf_rs_brs_totrf, {zone:1}), "zone").clip(orf_irf_rs_brs_totrf);
/*

var Brs_rs = ee.Image().byte().paint(ee.Feature(brs_rs, {zone: 1}), "zone").clip(brs_rs)
var BrsDl_srs = ee.Image().byte().paint(ee.Feature(brsdl_srs, {zone: 1}), "zone").clip(brsdl_srs)
var Sl_srs = ee.Image().byte().paint(ee.Feature(sl_srs, {zone:1}),"zone").clip(sl_srs) 
var Sl_rs = ee.Image().byte().paint(ee.Feature(sl_rs, {zone:1}),"zone").clip(sl_rs)  
*/

var Brs_mask = ee.Image().byte().paint(ee.Feature(brsdl_mask, {zone:1}),"zone").clip(brsdl_mask)  
 
 //var Srs_Brs = ee.Image().byte().paint(ee.Feature(srs_brs, {zone: 1}), "zone").clip(srs_brs)
 //var All_Brs = ee.Image().byte().paint(ee.Feature(all_brs, {zone:1}), "zone").clip(all_brs)
 // var Srs_Orf = ee.Image().byte().paint(ee.Feature(srs_orf, {zone: 1}), "zone").clip(srs_orf)  
  
  // Back reef slope -> shallow lagoon (inside the reef)

/*
  man_geo = man_geo.where({
   test: Brs_Sl.eq(1)
                   .and(man_geo.eq(24)).or(man_geo.eq(12)),
    value: ee.Image(11)
  });
  



  

  // deep laggon, sheltered r s and patch reefs into reef slope
  
  man_geo = man_geo.where({
    test: Dl_SRS_Pr_toRs.eq(1)
                            .and(man_geo.eq(12)).or(man_geo.eq(25)).or(man_geo.eq(21)),
    value: ee.Image(22)
  });
  
  //reef slope to shallow lagoon
  
  man_geo = man_geo.where({
   test: Rs_Sl.eq(1)
                   .and(man_geo.eq(22)),
  value: ee.Image(11)
  })
  
  */
   // Shallow lagoon and deep lagoon > back reef slope (inside the reef)
  man_geo = man_geo.where({
    test:  Sl_Brs.eq(1)
                     .and(man_geo.eq(11).or(man_geo.eq(12))),
    value: ee.Image(24)
  });
  
  // reef slope > back reef slope (outside the reef)
  man_geo = man_geo.where({
    test: Rs_Brs.eq(1)
                     .and(man_geo.eq(22)),
    value: ee.Image(24)
  });
  
   // deep laggon, sheltered r s and patch reefs into reef slope
  
  
  man_geo = man_geo.where({
    test: Dl_SRS_Pr_toRs.eq(1)
                            .and(man_geo.eq(12)).or(man_geo.eq(25)).or(man_geo.eq(21)),
    value: ee.Image(22)
  });
  
  

  man_geo = man_geo.where({
    test: Rs_Dl_Sl_SRS_toBrs.eq(1)
                      .and(man_geo.eq(22)).or(man_geo.eq(12)).or(man_geo.eq(11)).or(man_geo.eq(21)),
    value: ee.Image(24)
  })
  
   //sheltered reef slope > back reef slope (inside the reef)
  man_geo = man_geo.where({
    test:  SRS_toBrs.eq(1)
                     .and(man_geo.eq(21)),
    value: ee.Image(24)
  });
  
  //mask out rs
  man_geo = man_geo.where({
  test: Rs_mask.eq(1)
        .and(man_geo.eq(22)),
  value: ee.Image (0),
})

//mask out shallow lagoon
  man_geo = man_geo.where({
  test: Sl_mask.eq(1)
        .and(man_geo.eq(11)),
  value: ee.Image (0),
})


//srs to rs
  man_geo = man_geo.where({
  test: Srs_rs.eq(1)
        .and(man_geo.eq(21)),
  value: ee.Image (22),
})


//srs to mask
  man_geo = man_geo.where({
  test: Srs_tomask.eq(1)
        .and(man_geo.eq(21)),
  value: ee.Image (0),
})

  man_geo = man_geo.where({
    test: Orf_irf_rs_brs_totrf.eq(1)
                      .and(man_geo.eq(14)).or(man_geo.eq(13)).or(man_geo.eq(22)).or(man_geo.eq(24)),
    value: ee.Image(16)
  })
  
  
  /*
  
  man_geo = man_geo.where({
    test: Brs_rs.eq(1)
          .and(man_geo.eq(24)),
    value: ee.Image(22)
  })
  
  
  man_geo = man_geo.where({
    test: BrsDl_srs.eq(1)
          .and(man_geo.eq(24)).or(man_geo.eq(12)),
    value: ee.Image(21)
  })
  
  
   man_geo = man_geo.where({
    test: Sl_srs.eq(1)
          .and(man_geo.eq(11)),
    value: ee.Image(21)
  })
  
  man_geo = man_geo.where({
    test: Sl_rs.eq(1)
          .and(man_geo.eq(11)),
    value: ee.Image(22)
  })
  
 */ 
  man_geo = man_geo.where({
    test: Brs_mask.eq(1)
         .and(man_geo.eq(24)).or(man_geo.eq(12)),
    value: ee.Image(0)
  }) 
  
  
  var refine = ee.Image().byte().paint(ee.Feature(refinement_mask, {zone: 1}), "zone").clip(refinement_mask);
    // apply
    man_geo = man_geo.where({
      test: refine.eq(1),
      value: ee.Image(0)
    });

/*
 //Back reef slope > reef slope (outside the reef)
  man_geo = man_geo.where({
    test:  Brs_Rs.eq(1)
                     .and(man_geo.eq(24)),
    value: ee.Image(22)
  });
  
  //reef crest > Back reef slope (outside the reef)
 // man_geo = man_geo.where({
   // test:  Rc_Brs.eq(1)
   //                  .and(man_geo.eq(15)),
  //  value: ee.Image(24)
  //});
   
  //sheltered reef slope > Back reef slope (outside the reef)
  man_geo = man_geo.where({
    test:  Srs_Brs.eq(1)
                     .and(man_geo.eq(21)),
    value: ee.Image(24)
  });
    
  //sheltered reef slope > outer reef falt (inside the reef)
 // man_geo = man_geo.where({
   // test:  Srs_Orf.eq(1)
     //                .and(man_geo.eq(21)),
   // value: ee.Image(14)
  //}); 
  
  man_geo = man_geo.where({
    test: All_Brs.eq(1)
            .and(man_geo.eq(11)).or(man_geo.eq(12))
            .or(man_geo.eq(13)).or(man_geo.eq(15))
            .or(man_geo.eq(16)).or(man_geo.eq(21)).or(man_geo.eq(22))
            .or(man_geo.eq(23)),
    
    value: ee.Image(24)
  });
*/
  
  if (vars.geo_refinement) {
    // make the mask image layer
    var refine = ee.Image().byte().paint(ee.Feature(refinement_mask, {zone: 1}), "zone").clip(refinement_mask);
    // apply
    man_geo = man_geo.where({
      test: refine.eq(1),
      value: ee.Image(0)
    });
  }
  
  // Add data + the manual layer to the map
  var lowtide_image = ee.ImageCollection(region_params.image);
  Map.addLayer(lowtide_image, imageVisParam2, sensor_params.sname + ' low tide', false);
  var notreef_mask = ee.FeatureCollection(region_params.notreef_mask).geometry();
  Map.addLayer(notreef_mask, {}, "noReefmask", false);
  var geo_clean1 = ee.Image(region_params.geo_map_clean1);
  Map.addLayer(geo_clean1, map_palettes.geo, 'Geo clean stage 1', false);
  var geo_clean2 = ee.Image(region_params.geo_map_clean2);
  Map.addLayer(geo_clean2.updateMask(geo_clean2.gt(2)), map_palettes.geo, 'Geo clean stage 2', false);
  Map.addLayer(man_geo.updateMask(man_geo.gt(2)), map_palettes.geo, 'Geo clean stage 3', false);
  var unepClipped= wcmc.filterBounds(region_extent)
  Map.addLayer(unepClipped, {color:'#FFFF33'}, 'UNEP_layer', false)
  
 // Map.addLayer(waves, {}, 'waves', false);
 // Map.addLayer(wavespng, {}, 'wavespng', false);
  
  //Map.addLayer(man_geo.updateMask(man_geo.gt(2)), map_palettes.geo, 'Geo clean stage 3 - no DW', false);
 // Map.addLayer(global_reef_mask.updateMask(global_reef_mask.eq(1)), {palette: ['F8FF23'], opacity: 0.4}, 'global_reef_mask - land', false);
  //Map.addLayer(global_reef_mask.updateMask(global_reef_mask.eq(3)), {palette: ['0000ff'], opacity: 0.4}, 'global_reef_mask - reef', false);
  //Map.addLayer(global_reef_mask.updateMask(global_reef_mask.eq(2)), {palette: ['FF0000'], opacity: 0.4}, 'global_reef_mask - water', false);

  // display distance to land mask for assessing cut-off distances
  var distToLand = ee.Image(region_params.distToLand);
    
  //Map.addLayer(distToLand.lte(vars.dist_to_land_RC), {}, 'RC to TRF ' + vars.dist_to_land_RC + 'm', false);
 // Map.addLayer(distToLand.unmask(100000, false).lte(vars.dist_to_land_ORF), {}, 'TRF to ORF ' + vars.dist_to_land_ORF + 'm', false);
  
  // display distance to water mask
  var distToWater = ee.Image(region_params.distToWater);
    
  //Map.addLayer(distToWater.unmask(100000, false).lte(vars.dist_to_land_ORF), {}, 'distToWater ' + vars.dist_to_land_ORF + 'm', false);
  
  
  // Export
  var output_name = (vars.geomorphic) ? vars.geomorph_output_name : vars.benthic_output_name;
  Export.image.toAsset({
    image: man_geo,
    description: output_name,
    assetId: vars.asset_output + 'in_out/' + output_name,
    region: region_extent,
    scale: vars.image_data_scale,
    crs: 'EPSG:4326',
    maxPixels: 1e13,
    pyramidingPolicy: {'.default': 'mode'}
  });
  
} 

if (vars.manual_clean && !vars.geomorphic) {
  
  print("Doing BENTHIC manual clean ups - make sure this is what you want to do");
  print("Export the manual map, check 'manual' layer in the viewer for effects");
  
  var depth = ee.Image(region_params.pixels).select('depth');
  
  // define the final geomorphic map (the manually edited geo map - stage 3)
  var geo_map = ee.Image(region_params.geo_map_clean3);
  
  // define the clean benthic map to apply 2nd stage rules to
  var man_benthic = ee.Image(region_params.benthic_map_clean1);
  
  
  /*
  **Generic benthic rules**
    - should be generally applicable, but still review
  */
  
  // BMA on inner RF, outer RF,reef crest, reef slope -> rubble 
  man_benthic = man_benthic.where({
    test: man_benthic.eq(18)
                     .and(geo_map.eq(13).or(geo_map.eq(14)).or(geo_map.eq(15)).or(geo_map.eq(22))),
    value: ee.Image(12)
  });
  
  // Rubble on Outer reef flat and Reef crest -> rock 
  man_benthic = man_benthic.where({
    test: man_benthic.eq(12)
                     .and(geo_map.eq(14).or(geo_map.eq(15))),
    value: ee.Image(13)
  });
    
  // Seagrass on Back reef slope -> Sand 
  man_benthic = man_benthic.where({
    test: man_benthic.eq(14)
                     .and(geo_map.eq(24)),
    value: ee.Image(11)
  });  
  
    
  /*
  
  **Manual polygon guided rules**
   - same as per geomorphic clean section
   - add a geometry, paint the layer, create a rule
  
  */
  
  
  
     
  // Add the manual layer to the map

  var dove_image = ee.Image(region_params.image);
  Map.addLayer(dove_image, {bands: ['b3','b2','b1'], min:0, max:4000, gamma:1.5}, sensor_params.sname + ' low tide', true);
  
  var benthic_clean1 = ee.Image(region_params.benthic_map_clean1);
  var geo_clean1 = ee.Image(region_params.geo_map_clean1);
  var geo_clean2 = ee.Image(region_params.geo_map_clean2);
  Map.addLayer(geo_clean1, map_palettes.geo, 'Geo clean stage 1', false);
   Map.addLayer(geo_clean2.updateMask(geo_clean2.gt(2)), map_palettes.geo, 'Geo clean stage 2', false);
  // Map.addLayer(geo_clean2, map_palettes.geo, 'Geo clean stage 2', false);
  //Map.addLayer(geo_map.updateMask(geo_map.gt(2)), map_palettes.geo, 'Geo clean stage 3 - MANUAL', true);
  Map.addLayer(geo_map.updateMask(geo_map.gt(2)), map_palettes.geo, 'Geo clean stage 3 - MANUAL', true);
  Map.addLayer(benthic_clean1, map_palettes.benthic, 'Benthic clean stage 1', false);
  Map.addLayer(man_benthic, map_palettes.benthic, 'Benthic clean stage 2 - MANUAL', true);
  
  // Export
  var output_name = (vars.geomorphic) ? vars.geomorph_output_name : vars.benthic_output_name;
  Export.image.toAsset({
    image: man_benthic,
    description: output_name,
    assetId: vars.asset_output + 'in_out/' + output_name,
    region: region_extent,
    scale: vars.image_data_scale,
    crs: 'EPSG:4326',
    maxPixels: 1e13,
    pyramidingPolicy: {'.default': 'mode'}
  });
  
}

// #################################################################################################
// END OF MANUAL SECTION
// #################################################################################################


// 2. Data loads & vis

if (!vars.manual_clean) {

  // load input data
  
  // define raw geo/benthic outputs
  // Run check to see if the region has been split into multiple areas
  
  // geo
  if (ee.List(region_params.geo_map).length().getInfo() > 1) {
    var geo_map_raw = ee.Image(region_params.geo_map[0]).unmask(0, false)
                 .add(ee.Image(region_params.geo_map[1]).unmask(0,false))
                 .selfMask();
  } else {
    var geo_map_raw = ee.Image(region_params.geo_map);
  }
  
  // benthic
  if (ee.List(region_params.benthic_map).length().getInfo() > 1) {
      var benthic_map = ee.Image(region_params.benthic_map[0]).unmask(0, false)
               .add(ee.Image(region_params.benthic_map[1]).unmask(0,false))
               .selfMask();
  } else {
      var benthic_map = ee.Image(region_params.benthic_map);
  }
  
  // set the geo map for further processing
  if (vars.geomorphic && vars.obia_2nd_pass) {
    // if it's 2nd pass, you want to make sure you're loading the latest geo clean map
    var geo_map = ee.Image(region_params.geo_map_clean1);
  } else if (vars.geomorphic) {
    var geo_map = geo_map_raw;
  }
  
  var depth = ee.Image(region_params.pixels).select('depth');
  var low_tide_image = ee.Image(region_params.image);
  
  var display_pal = (vars.geomorphic) ? map_palettes.geo : map_palettes.benthic;
  Map.addLayer(depth, {min:0, max:2500}, 'Depth data', false);
  Map.addLayer(low_tide_image, {bands: ['b3','b2','b1'], min:0, max:3000}, sensor_params.sname + ' low tide', false);
  
  // load for display purposes
  if (vars.geomorphic) {
    Map.addLayer(geo_map_raw, display_pal, 'Geomorphic map RAW', false);
    if (vars.cleanup_stage == 2) Map.addLayer(ee.Image(region_params.geo_map_clean1), display_pal, 'Geo clean stage 1', false);
  }
  if (!vars.geomorphic) {
    // Use the manually cleaned geomorphic map as input for the benthic clean
    var geo_map = ee.Image(region_params.geo_map_clean3);
    Map.addLayer(geo_map.updateMask(geo_map.gt(2)), map_palettes.geo, 'Geo clean stage 3', false);
    Map.addLayer(benthic_map, display_pal, 'Benthic map RAW', false);
  }
  
  // 3. Object-based re-classificaiton and cleaning
  
  /* OUTPUT EXTENT
    - to the mapping extent just so it doesn't balloon out
    - to the 'reef boundary' extent for noise/deep removal
  */  
  var class_extent_mask = geo_map.gt(0);
  
  /*
  
  ########
  Initial small object clean
   - this was originally at the end, but we needed to massively reduce the number of objects to 
     iterate through in the OBIA cleaning, so this happens first now
   - future collabs with google might fix this, but need to change the parallel serialisation of vector procesing
   
   - includes a possible special case for:
        - geomorphic to clean up turbid areas over size threshold; fix shallow vs. deep lagoon
        - benthic to allow breaking waves (temporal class) to grow into surrounding class
  ########
  
  */
  
  // ##############################################################################################
  // START OF CLEAN 1
  // ##############################################################################################
  
  if (vars.geomorphic && !vars.obia_2nd_pass) {
    
    // shallow lagoon > 5m == deep lagoon//this rule is making mini deep laggoons witin BRS 
    //so I will generate another clean up1 with shallow lagoons instead (comenting this up)
    
    // = geo_map.where({
     // test: geo_map.eq(11)
                    //.and(depth.gt(vars.shallowlag_depth_cutoff)),
      //value: ee.Image(12)
    //});
    
    // deep water in depth data == deep (s2 + ls8 data should be good enough for this)
    geo_map = geo_map.where({
      test: depth.gt(vars.geo_depth_cutoff),
      value: ee.Image(2)
    });
    
    // make a smooth map with masked area as a value - *** Change to ee.kernal*** see reef mask in clean 3
    var smooth_map = geo_map
                        .focal_mode({
                          radius: vars.smooth_radius, // relates to smoothness required
                          kernelType: 'circle', units: 'pixels', iterations: 2
                        });
    
    // replace small objects with smooth underneath
    var clean_map = geo_map.where({
      test: geo_map.connectedPixelCount(vars.small_object_geo, false).lt(vars.small_object_geo), 
      value: smooth_map
    }).updateMask(class_extent_mask);
    
    // display distance to land mask for assessing cut-off distances
    var distToLand = ee.Image(region_params.distToLand);
    
    Map.addLayer(distToLand.lte(vars.dist_to_land_RC), {}, 'RC to TRF ' + vars.dist_to_land_RC + 'm', false);
    Map.addLayer(distToLand.unmask(100000, false).lte(vars.dist_to_land_ORF), {}, 'TRF to ORF ' + vars.dist_to_land_ORF + 'm', false);

    // // reef crest close to land -> TRF - Not need when using .focal masks (reef mask) as this will take care of RC inside the reef
    // clean_map = clean_map.where({
    //   test: distToLand.lte(vars.dist_to_land_RC)
    //                 .and(clean_map.eq(15)),
    //   value: ee.Image(16)
    // });
    
    // TRF outside of specified distance from land -> ORF
    clean_map = clean_map.where({
      test: distToLand.unmask(100000, false).gt(vars.dist_to_land_ORF)
                       .and(clean_map.eq(16)),
      value: ee.Image(14)
    });
  }
  
  if (!vars.geomorphic && vars.cleanup_stage == 1) {
    
    // make a smooth map with masked area as a value, and without temporal class (basically breaking waves)
    var smooth_map = benthic_map
                        .focal_mode({
                          radius: vars.smooth_radius, // relates to smoothness required
                          kernelType: 'circle', units: 'pixels', iterations: 1
                        });
    
    //replace small objects with smooth underneath
    var clean_map = benthic_map.where({
      test: benthic_map.connectedPixelCount(vars.small_object_benthic, false).lt(vars.small_object_benthic),
      value: smooth_map
    }).updateMask(class_extent_mask);
    
  }
  
  // ##############################################################################################
  // START OF CLEAN 2
  // ##############################################################################################
  
  if (vars.geomorphic && vars.obia_2nd_pass) {
    var clean_map = geo_map;
  }
  
  if (vars.obia_clean) {
    
    if (vars.geomorphic && !vars.fast_clean) { 
      
      // FUNCTION that maps over feature colleciton and assigns neighbour percentages
      var set_neighbour_properties = function(f) {
        // make the 1px buffer
        var diff = f.buffer(vars.image_data_scale).difference(f, ee.ErrorMargin(0.5));
        // reduce the classes in the buffer zone
        var diff_classes = ee.Dictionary(
          clean_map.unmask(ee.Image(0)).reduceRegion({
            reducer: ee.Reducer.frequencyHistogram(),
            geometry: diff.geometry(),
            scale: vars.image_data_scale,
            maxPixels: 1e11
          }).get('classification')
        );
        // calculate the percentages
        var diff_sum = diff_classes.toArray().reduce(ee.Reducer.sum(), [0]).get([0]);
        var diff_percs = diff_classes.map(function(k,v){return(ee.Number(v).divide(diff_sum).multiply(100).toUint8())});
        
        /* NOW, we can try to do the class logic right here (see /users/mitchest/global_reefs/obia_dev),
           or we can return the neighbour % and do image logic via (painted) rasters */
        
        return(f.set(diff_percs));
      };
      
      // FUNCTION to reduce the map to vectors and map the neighbour properties function
      var reduce_neighbours = function() {
        // reduce map to vectors
        var map_fc = clean_map
              .updateMask(segment_id).updateMask(clean_map.eq(classn)) // only vectorise class/es of interest
              .reduceToVectors({
                scale: vars.image_data_scale, 
                eightConnected: false,
                bestEffort: true, 
                maxPixels: 1e13,
                tileScale: 1,
                geometry: region_extent
              });
        // map the function, calculate neighbour properties
        return(map_fc.map(set_neighbour_properties));
      };
      
      // first make a make size threshold, so we're not vecortising huge objects when we don't have to
      var segment_id = clean_map.connectedComponents(ee.Kernel.plus(1),vars.small_object_geo.sqrt()).select('labels');
      //Map.addLayer(segment_id.reproject(ee.Projection('EPSG:4326').atScale(ee.Number(vars.image_data_scale))))
      Map.addLayer(clean_map.updateMask(segment_id).reproject(ee.Projection('EPSG:4326').atScale(ee.Number(vars.image_data_scale))), display_pal, 'Map objects to be iterated through (OBIA)', false);
      
      // This is where we select the single or group of classes to vectorise for cleaning up
      //var classn = ee.Number(15) // one class
      var classn = clean_map.where({
        test: clean_map.neq(16) //TRF
                .and(clean_map.neq(15)) //RR
                .and(clean_map.neq(14)) //ORF
                .and(clean_map.neq(13)) //IRF
                //.and(clean_map.neq(12)) // deep L
                .and(clean_map.neq(11)), // shallow L 
        value: ee.Image(99) // 99 ensures it's ignored in logic
      });
      
      // Minimum size of object to reclass based on neighbourhood
      var max_size = ee.Number(1000).divide(vars.image_data_scale).pow(2); // the first number is the square dimension of the desired min size;
      // calculate neighbours
      var map_fc_neighbours = reduce_neighbours();
      
      // #########
      // REEF RIM
      // #########
      
      var focus_class = ee.Number(15); //RR
      
      // start the object-based neighbourhood rules
      // paint out to rasters (only paint the layers needed)
      var objsize = ee.Image(30000).paint(map_fc_neighbours, 'count').rename('count');
      //var nb24 = ee.Image().byte().paint(map_fc_neighbours, '24').unmask(0).rename('nb24') //OCL
      var nb22 = ee.Image().byte().paint(map_fc_neighbours, '22').unmask(0).rename('nb22'); //SL ex
      var nb21 = ee.Image().byte().paint(map_fc_neighbours, '21').unmask(0).rename('nb21'); //Sl sh
      var nb16 = ee.Image().byte().paint(map_fc_neighbours, '16').unmask(0).rename('nb16'); //TRF
      var nb15 = ee.Image().byte().paint(map_fc_neighbours, '15').unmask(0).rename('nb15'); //RR
      var nb14 = ee.Image().byte().paint(map_fc_neighbours, '14').unmask(0).rename('nb14'); //ORF
      var nb13 = ee.Image().byte().paint(map_fc_neighbours, '13').unmask(0).rename('nb13'); //IRF
      //var nb3 = ee.Image().byte().paint(map_fc_neighbours, '3').unmask(0).rename('nb3') //Turbid
      
      // RR surrounded by ORF --> ORF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb14.gt(75)),
        value: ee.Image(14)
      });
      
      // RR surrounded by IRF --> IRF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb13.gt(75)),
        value: ee.Image(13)
      });
      
      // RR surrounded by IRF + ORF --> IRF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb13.add(nb14).gt(75)),
        value: ee.Image(13)
      });
      
      // RR with decent border to TRF --> TRF (often dark, probably seagrass)
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb16.gt(40)),
        value: ee.Image(16)
      });
      
      // RR surrounded by OCL --> OCL
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb24.gt(75)),
        value: ee.Image(24)
      })
      
      // small RR objects touching OCL + stuff --> ORF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(objsize.lte(max_size))
                .and(nb13.lte(75).and(nb14.lte(75))) // to ensure we're no re-writing previous rules
                .and(nb24.gt(1)),
        value: ee.Image(14)
      })
      
      // ####
      // ORF
      // ####
      
      focus_class = ee.Number(14); // ORF
      
      // ORF surrounded by IRF --> IRF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb13.gt(75)),
        value: ee.Image(13)
      });
      
      // ORF surrounded by TRF --> TRF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb16.gt(75)),
        value: ee.Image(16)
      });
      
      // ORF surrounded by RR --> RR
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb15.gt(85)),
        value: ee.Image(15)
      });
      
      // ORF touching slope and RR --> RR
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb21.gt(0).or(nb22.gt(0)))
                .and(nb15.gt(0)),
        value: ee.Image(15)
      });
      
      // ####
      // IRF
      // ####
      
      focus_class = ee.Number(13); // IRF
      
      // IRF surrounded by ORF --> ORF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb14.gt(75)),
        value: ee.Image(14)
      });
      
      // IRF surrounded by TRF --> TRF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb16.gt(75)),
        value: ee.Image(16)
      });
      
      // IRF surrounded by RR --> RR
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb15.gt(85)),
        value: ee.Image(15)
      });
      
      // ####
      // TRF
      // ####
      
      focus_class = ee.Number(16); // TRF
      
      // TRF surrounded by ORF --> ORF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb14.gt(75)),
        value: ee.Image(14)
      });
      
      // TRF surrounded by IRF --> IRF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb13.gt(75)),
        value: ee.Image(13)
      });
      
      // TRF surrounded by IRF + ORF --> IRF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb13.add(nb14).gt(75)),
        value: ee.Image(13)
      });
      
      // ####
      // LAGOONS
      // ####
      
      var nb11 = ee.Image().byte().paint(map_fc_neighbours, '11').unmask(0).rename('nb11'); // shallow lag
      
      // SL sourrounded by DL --> DL
      clean_map = clean_map.where({
        test: clean_map.eq(11)
                .and(nb12.gt(75)),
        value: ee.Image(12)
      })
      
      // DL sourrounded by SL --> SL
      clean_map = clean_map.where({
        test: clean_map.eq(12)
                .and(nb11.gt(75)),
        value: ee.Image(11)
      })
      
      // DL/SL surrounded by IRF --> IRF
      clean_map = clean_map.where({
        test: clean_map.eq(11).or(clean_map.eq(12))
                .and(objsize.lte(max_size))
                .and(nb13.gt(80)),
        value: ee.Image(13)
      })
      
      // SL surrounded by IRF --> IRF
      clean_map = clean_map.where({
        test: clean_map.eq(11)
                .and(objsize.lte(max_size))
                .and(nb13.gt(80)),
        value: ee.Image(13)
      });
      
    
    } else if (vars.geomorphic && vars.fast_clean) {
      print("Executing the fast version OBIA");
      
      /* fast version of the geo clean up
        - blanket version assigns the underlying most common in neighbourhood
        - mode OBIA version iterates through objects+buffers but take the mode instead of doing the class percs, to see if that speeds things up
      */
      
      
      // ## Blanket version
      
      // the "LAND MASK" CLEAN  ****to be moved to datagen for next region****
      var global_reef_mask = ee.Image(region_params.global_reef_mask);
  
      clean_map = clean_map.where({
        test: global_reef_mask.eq(1),
        value: ee.Image(0)
      });
      
      // make a very smooth map to capture the broader neighbourhood  - *** Change to ee.kernal*** see reef mask in clean 3
      var smooth_map = clean_map
                          .focal_mode({
                            radius: vars.smooth_radius.multiply(3), // relates to smoothness required
                            kernelType: 'circle', units: 'pixels', iterations: 2
                          });
      
      // first make a make size threshold, so we're not vectorising huge objects when we don't have t
      // - the unmask(99) captures small no data values/ data gaps
      var segment_id = clean_map.unmask(0).connectedComponents(ee.Kernel.plus(1),vars.small_object_geo.sqrt().multiply(2)).select('labels').pow(2).log().int();
      Map.addLayer(clean_map.unmask(0).updateMask(segment_id.gt(0)).reproject(ee.Projection('EPSG:4326').atScale(ee.Number(vars.image_data_scale))), display_pal, 'Map objects to be iterated through (OBIA)', false);
      
      // replace small objects with smooth underneath
      var clean_map = clean_map.unmask(0).where({
        test: segment_id.gt(0), 
        value: smooth_map
      }).selfMask();
      
      
      // ## mode OBIA version
      
      /* A possible faster plan
            - vectorise one/few class/es at a time, thus only spending resources on what is actually needed to clean up
            - BUT, just assign the mode of the neighbours, so save resouces even further??
      
      // FUNCTION that maps over feature colleciton and assigns neighbour percentages
      var set_neighbour_mode = function(f) {
        // make the 1px buffer
        var diff = f.buffer(vars.image_data_scale).difference(f, ee.ErrorMargin(0.5))
        // reduce the classes in the buffer zone
        var diff_mode = ee.Number(ee.Dictionary(
          clean_map.unmask(ee.Image(0)).reduceRegion({
            reducer: ee.Reducer.mode(),
            geometry: diff.geometry(),
            scale: vars.image_data_scale,
            maxPixels: 1e11
          })).get('classification'))
        
        return(f.set('mode',diff_mode))
      }
      
      // FUNCTION to reduce the map to vectors and map the neighbour properties function
      var reduce_neighbours_mode = function() {
        // reduce map to vectors
        var map_fc = clean_map.unmask(0)
              .updateMask(classn.gt(0)) // only vectorise class/es of interest
              .reduceToVectors({
                scale: vars.image_data_scale, 
                eightConnected: false,
                bestEffort: true, 
                maxPixels: 1e13,
                tileScale: 1,
                geometry: region_extent
              })
        // map the function, calculate neighbour properties
        return(map_fc.map(set_neighbour_mode))
      }
      
      // first make a make size threshold, so we're not vecortising huge objects when we don't have to
      var segment_id = clean_map.unmask(0).connectedComponents(ee.Kernel.plus(1),vars.small_object_geo.sqrt()).select('labels')
      Map.addLayer(clean_map.unmask(0).updateMask(segment_id.gt(0)).reproject(ee.Projection('EPSG:4326').atScale(ee.Number(vars.image_data_scale))), display_pal, 'Map objects to be iterated through (OBIA)', false)
      
      // This is where we select the single or group of classes to vectorise for cleaning up
      var classn = segment_id.where({
        test: clean_map.neq(16) //TRF
                .and(clean_map.neq(15)) //RR
                .and(clean_map.neq(14)) //ORF
                .and(clean_map.neq(13)) //IRF
                //.and(clean_map.neq(12)) // deep L
                .and(clean_map.neq(11)) // shallow L 
                .and(clean_map.unmask(0).neq(0)), // no data values (want to reclaim the small gaps 
        value: ee.Image(0) // 99 ensures it's ignored in logic
      })
      
      // calculate neighbours
      var map_fc_neighbours = reduce_neighbours_mode()
      
      //print(map_fc_neighbours.limit(10))
      
      var mode_map = ee.Image().byte().paint(map_fc_neighbours, 'mode').unmask(0).rename('mode') // paint out the mode values to an image
      //Map.addLayer(mode_map, display_pal, "mode map", false)
      
      // replace small objects with mode underneath
      var clean_map = clean_map.unmask(0).where({
        test: segment_id.gt(0), 
        value: mode_map
      }).selfMask()
      
      */
      
    } else {
      
      if (vars.cleanup_stage == 1) {
        // BENTHIC CLEAN-UP RULES
        
        // reclaim shallow no data to surrounding class
        var smooth_map = clean_map
                            .focal_mode({
                              radius: vars.smooth_radius.multiply(3), // relates to smoothness required
                              kernelType: 'circle', units: 'pixels', iterations: 2
                            });
        
        var clean_map = clean_map.unmask(0).where({
          test: geo_map.gt(2).and(clean_map.eq(0)), 
          value: smooth_map
        }).selfMask();
        
        // cut benthic off to < 10 - 15 m
        clean_map = clean_map.where({
          test: depth.gt(vars.benthic_depth_cutoff),
          value: ee.Image(0)
        });
        
        // Deep (or land or missing) in geo == masked from benthic
        clean_map = clean_map.where({
          test: geo_map.unmask(0).lte(2),
          value: ee.Image(0)
        });
        
      }
    }
  }
  
  // Final clip to the classified extent and move on
  if (vars.geomorphic) {
    clean_map = clean_map.updateMask(clean_map.gt(1)); // this ignores 0/land; make it .gt(2) if you want to mask deep too
  } else {
    clean_map = clean_map.updateMask(clean_map.gt(1)); // this ignores 0/land; make it .gt(2) if you want to mask deep too
  }

  
  
  // 4. Export data
  
  var output_name = (vars.geomorphic) ? vars.geomorph_output_name : vars.benthic_output_name;
  
  if (vars.do_export) {
    print("For export, the image data scale must be set to:", vars.image_data_scale);
    
    Map.addLayer(region_extent, {}, "Export footprint", false);
    
    Export.image.toAsset({
      image: clean_map.set(vars),
      description: output_name,
      assetId: vars.asset_output + 'in_out/' + output_name,
      region: region_extent,
      scale: vars.image_data_scale,
      crs: 'EPSG:4326',
      maxPixels: 1e13,
      pyramidingPolicy: {'.default': 'mode'}
    });
    
  } else {
    if (vars.reproject_display) {
      Map.addLayer(clean_map.reproject(ee.Projection('EPSG:4326').atScale(vars.image_data_scale)), display_pal, output_name, true);
    } else {
      Map.addLayer(clean_map, display_pal, output_name, false);
    }
  }

}

//Generate title
var title = ui.Label({
  value: 'Classes',
  style: {fontWeight: 'bold', fontSize: '12px'}
});

// generate the legend
var geo_legend = pkg_vis.discrete_legend(map_palettes.geo_atlas_names, map_palettes.geo_atlas_cols, 'Geomorphic Zone', false);
var benthic_legend = pkg_vis.discrete_legend(map_palettes.benthic_atlas_names, map_palettes.benthic_atlas_cols, 'Benthic Habitat', false);
//var mask_legend = pkg_vis.discrete_legend(["Low confidence depth","Water conditions"], ["#f7f7f7","#bababa"], 'Confidence Mask reason', false)
var legend = (vars.geomorphic) ? geo_legend : benthic_legend;
pkg_vis.add_lgds([title, legend]);//, mask_legend])
// generate the legend
