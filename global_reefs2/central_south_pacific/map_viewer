/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var centre_map = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.Point([-149.72358895932618, -17.71541788992402]),
    wcmc = ee.FeatureCollection("projects/coral_atlas/global_datasets/wcmc_reefs_2018v4_dissolved"),
    GCRMN_ext = ee.Image("projects/coral_atlas/global_datasets/GCRMN_reefextent_final"),
    notReef_mask = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.MultiPolygon(
        [[[[-139.26373045864145, -10.021814966815812],
           [-139.236092976952, -10.068467222637077],
           [-139.20038741054574, -10.077932075737149],
           [-139.14064925136606, -10.066777041076],
           [-139.1342977804188, -10.048860572620393],
           [-139.15056253608154, -10.024221866872047],
           [-139.14747263129638, -9.994807427780598],
           [-139.13605123387222, -9.950767921522957],
           [-139.129528101548, -9.910355542263046],
           [-139.10961538182144, -9.889048264900497],
           [-139.08146291600113, -9.883974899901267],
           [-139.06704336033707, -9.868585214070807],
           [-139.08386617527847, -9.861989414221192],
           [-139.11150365696793, -9.848966550087079],
           [-139.1492691598976, -9.830361567160699],
           [-139.24848943577652, -9.833236951145192]]],
         [[[-139.93625040047476, -8.88387685737755],
           [-140.0210511206896, -8.94865908911266],
           [-140.11649484627554, -9.002578961032512],
           [-140.19511575692007, -9.030383555020352],
           [-140.17292231710343, -9.105600650663945],
           [-140.028040114955, -9.110007575630291],
           [-139.87114161641983, -9.087972407779784],
           [-139.8690816798964, -8.978454530193652],
           [-139.86770838888077, -8.89705757095068]]]]),
    region_extent = 
    /* color: #98ff00 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-166.50747019036498, -11.039948809791559],
          [-165.98012644036498, -11.643166048967426],
          [-163.73891550286498, -12.845619784215419],
          [-163.65102487786498, -18.470825299947656],
          [-160.57485300286498, -18.887130358436256],
          [-160.44301706536498, -21.44444894477791],
          [-159.08071237786498, -22.097418263110924],
          [-157.58657175286498, -22.422779544476754],
          [-155.47719675286498, -22.1788294143579],
          [-153.58754831536498, -23.030775108176403],
          [-152.04946237786498, -22.949865569850946],
          [-150.86293894036498, -23.31357536127791],
          [-148.27016550286498, -24.198442596688196],
          [-145.06215769036498, -27.792017483833867],
          [-144.22719675286498, -28.180080625160823],
          [-143.26039987786498, -28.218809980651507],
          [-142.95278269036498, -27.636402229497982],
          [-147.17153269036498, -23.273211945216822],
          [-149.14907175286498, -22.787901397336597],
          [-150.95082956536498, -22.05669505675158],
          [-153.45571237786498, -21.852903405974896],
          [-155.96059519036498, -20.04723156719584],
          [-159.60805612786498, -18.387442120539358],
          [-162.50844675286498, -18.262291730779012],
          [-162.81606394036498, -12.845619784215419],
          [-165.23305612786498, -10.867370155525734],
          [-160.75063425286498, -10.867370155525734],
          [-159.47622019036498, -9.873151714697253],
          [-151.52211862786498, -9.959729240816934],
          [-152.40102487786498, -11.126200221324133],
          [-155.74086862786498, -15.190448754105075],
          [-155.25747019036498, -16.711515337883927],
          [-154.64223581536498, -17.215912285516577],
          [-152.13735300286498, -17.42567472695726],
          [-145.80922800286498, -20.25350891407062],
          [-137.98696237786498, -23.636040313886074],
          [-134.55922800286498, -24.278585158414387],
          [-130.16469675286498, -25.593550173971824],
          [-124.495751440365, -24.99757940354312],
          [-124.451806127865, -24.278585158414387],
          [-130.51625925286498, -23.515208361542772],
          [-134.20766550286498, -22.706847029145624],
          [-134.99868112786498, -21.36261985471198],
          [-135.74575144036498, -19.385332097550872],
          [-135.74575144036498, -18.304018583892734],
          [-137.89907175286498, -17.005911620198418],
          [-138.64614206536498, -14.468267031541506],
          [-140.84340769036498, -13.701037976316936],
          [-138.07485300286498, -10.608315424003008],
          [-137.98696237786498, -9.743242781829194],
          [-138.77797800286498, -8.702204536581284],
          [-139.56899362786498, -7.919502166226214],
          [-140.18422800286498, -7.266105738303773],
          [-141.23891550286498, -7.309696026640603],
          [-141.64351347523072, -9.006950998758901],
          [-140.48827979430274, -9.945399701221843],
          [-139.16048138534342, -10.867108198915416],
          [-140.68945795926226, -12.737115959091954],
          [-141.99810663660014, -13.551177612282954],
          [-143.0450782543226, -14.495048464012955],
          [-146.31076461903518, -13.768324855048435],
          [-149.10512644036498, -14.51081458889993],
          [-150.86293894036498, -15.614117729746887],
          [-152.88442331536498, -15.571789797844175],
          [-154.81801706536498, -15.232854360446138],
          [-151.74184519036498, -11.987279439655715],
          [-149.80825144036498, -10.392268543950067],
          [-149.76430612786498, -9.569952277933716],
          [-150.77504831536498, -9.613283252523134],
          [-157.63051706536498, -9.483273775950472],
          [-155.52114206536498, -6.39344502291052],
          [-154.55434519036498, -4.118048223427747],
          [-154.73012644036498, -3.5480394602744822],
          [-155.43325144036498, -3.855014556726677],
          [-158.33364206536498, -8.615315653334529],
          [-161.54164987786498, -9.656608677405726],
          [-166.24379831536498, -10.521914802859191]]]),
    mid_mask = 
    /* color: #0b4a8b */
    /* shown: false */
    ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -150.63430644538448,
                -17.636430715384634
              ],
              [
                -150.6401429322009,
                -17.642810728903136
              ],
              [
                -150.64211703803585,
                -17.650417372802476
              ],
              [
                -150.64426280524776,
                -17.659005132956832
              ],
              [
                -150.64100123908565,
                -17.66301261414531
              ],
              [
                -150.6353364136462,
                -17.664730078761828
              ],
              [
                -150.63190318610714,
                -17.670127717959282
              ],
              [
                -150.62855578925655,
                -17.674462068534407
              ],
              [
                -150.62598086860226,
                -17.678223873022137
              ],
              [
                -150.61207629706905,
                -17.668819214238876
              ],
              [
                -150.6119046356921,
                -17.65630616676766
              ],
              [
                -150.62743999030636,
                -17.637494066658153
              ],
              [
                -150.63121654059933,
                -17.635776342251663
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -157.35501761688718,
                -20.127982162953103
              ],
              [
                -157.3179387594653,
                -20.143937909267102
              ],
              [
                -157.31811042084226,
                -20.17810028701245
              ],
              [
                -157.32978339447507,
                -20.188573102364522
              ],
              [
                -157.34351630463132,
                -20.193084252097556
              ],
              [
                -157.36892218842038,
                -20.20275056162013
              ],
              [
                -157.4502760782738,
                -20.26198140397455
              ],
              [
                -157.15845173745348,
                -20.281948928814042
              ],
              [
                -157.15639180093004,
                -19.992491851125852
              ],
              [
                -157.45508259682848,
                -19.973132667112438
              ],
              [
                -157.48117512612535,
                -20.21430660746711
              ],
              [
                -157.47568196206285,
                -20.241367070632446
              ],
              [
                -157.4117753630682,
                -20.225678941182693
              ],
              [
                -157.3546121245428,
                -20.18637133017102
              ],
              [
                -157.36310102393458,
                -20.172372805312282
              ],
              [
                -157.36584760596583,
                -20.153252341670836
              ],
              [
                -157.35892172645293,
                -20.133594769498
              ],
              [
                -157.35746260474883,
                -20.130371304362658
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -157.7315784861018,
                -19.87913315966506
              ],
              [
                -157.7267719675471,
                -19.863957785383167
              ],
              [
                -157.72333874000805,
                -19.840707587387698
              ],
              [
                -157.71372570289867,
                -19.834571550541913
              ],
              [
                -157.6879764963557,
                -19.840384643990586
              ],
              [
                -157.67836345924633,
                -19.844905791779055
              ],
              [
                -157.6773334909846,
                -19.865572255949015
              ],
              [
                -157.67939342750805,
                -19.88849596358534
              ],
              [
                -157.70342602028148,
                -19.900763627467754
              ],
              [
                -157.71921886696117,
                -19.903668987564973
              ],
              [
                -157.72711529030101,
                -19.886236027098285
              ],
              [
                -157.8256489206721,
                -19.931428626366078
              ],
              [
                -157.79474987282055,
                -19.986933269931374
              ],
              [
                -157.55854381813305,
                -19.987901200845425
              ],
              [
                -157.55820049537914,
                -19.71535632588004
              ],
              [
                -157.83457531227367,
                -19.714386731249796
              ],
              [
                -157.83938183082836,
                -19.91980890548697
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -158.09299145934077,
                -19.969103319104132
              ],
              [
                -158.0178037762353,
                -19.906813572983673
              ],
              [
                -158.06827222105952,
                -19.866134488211305
              ],
              [
                -158.16886578795405,
                -19.850957869906416
              ],
              [
                -158.20937787291498,
                -19.88550678388694
              ],
              [
                -158.26327954527827,
                -19.95458199972106
              ],
              [
                -158.26739941832514,
                -20.04394755240988
              ],
              [
                -158.23100720641108,
                -20.141320669835537
              ],
              [
                -158.06655560728998,
                -20.156469315944253
              ],
              [
                -157.98106824156733,
                -20.092964105162203
              ],
              [
                -157.97214184996577,
                -19.99652882895971
              ],
              [
                -158.01093732115717,
                -19.91391519860408
              ],
              [
                -158.09402142760248,
                -19.978460794222972
              ],
              [
                -158.07925854918452,
                -19.99652882895971
              ],
              [
                -158.07719861266108,
                -20.005239462200986
              ],
              [
                -158.08303509947748,
                -20.01394961333663
              ],
              [
                -158.09745465514155,
                -20.02072384191168
              ],
              [
                -158.10844098326655,
                -20.02491726574032
              ],
              [
                -158.11496411559077,
                -20.031045914738886
              ],
              [
                -158.1225172161767,
                -20.031691021784454
              ],
              [
                -158.13625012633295,
                -20.01782063682353
              ],
              [
                -158.14620648619623,
                -19.998464566890053
              ],
              [
                -158.1444898724267,
                -19.97910611685888
              ],
              [
                -158.1393400311181,
                -19.9674899051909
              ],
              [
                -158.13075696227045,
                -19.96006798859515
              ],
              [
                -158.11221753355952,
                -19.964585718549813
              ],
              [
                -158.09882794615717,
                -19.974266132685493
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -159.8435513507887,
                -18.90689716092257
              ],
              [
                -159.83960313911876,
                -18.903811539672663
              ],
              [
                -159.83857317085705,
                -18.90186269693045
              ],
              [
                -159.83668489571056,
                -18.900563455825576
              ],
              [
                -159.8339383136793,
                -18.897315308932377
              ],
              [
                -159.82964677925548,
                -18.893255036671366
              ],
              [
                -159.8284451496168,
                -18.891955728748613
              ],
              [
                -159.82638521309337,
                -18.888382579969935
              ],
              [
                -159.82381029243908,
                -18.885621458237686
              ],
              [
                -159.82243700142345,
                -18.883672403725626
              ],
              [
                -159.82106371040783,
                -18.880423929141344
              ],
              [
                -159.81986208076916,
                -18.876200818014667
              ],
              [
                -159.81986208076916,
                -18.874251653904256
              ],
              [
                -159.81951875801525,
                -18.871977600456944
              ],
              [
                -159.8196904193922,
                -18.869865951772766
              ],
              [
                -159.81625719185314,
                -18.839812685129232
              ],
              [
                -159.79084189084713,
                -18.822930868883514
              ],
              [
                -159.77161581662838,
                -18.81058186224627
              ],
              [
                -159.76543600705807,
                -18.71175721076996
              ],
              [
                -160.02842123655026,
                -18.712407562013535
              ],
              [
                -160.02155478147213,
                -18.969749338994728
              ],
              [
                -159.89589865354245,
                -19.078805057405187
              ],
              [
                -159.64733297971432,
                -19.098920603482604
              ],
              [
                -159.56081564572995,
                -19.082049665609482
              ],
              [
                -159.56218893674557,
                -18.859322661812275
              ],
              [
                -159.57592184690182,
                -18.700700857134237
              ],
              [
                -159.74689657834713,
                -18.708505417048144
              ],
              [
                -159.76406271604245,
                -18.81513160178547
              ],
              [
                -159.74964316037838,
                -18.843727144962166
              ],
              [
                -159.74414999631588,
                -18.869069123638763
              ],
              [
                -159.74530403016632,
                -18.87824991526436
              ],
              [
                -159.73637763856476,
                -18.890593943727442
              ],
              [
                -159.72350303529328,
                -18.90228744709297
              ],
              [
                -159.72556297181671,
                -18.915928834880795
              ],
              [
                -159.72556297181671,
                -18.924860093074198
              ],
              [
                -159.72504798768585,
                -18.93362850038748
              ],
              [
                -159.72607795594757,
                -18.941909351321815
              ],
              [
                -159.72693626283234,
                -18.948079130101497
              ],
              [
                -159.72865287660187,
                -18.94970271819022
              ],
              [
                -159.73122779725617,
                -18.960255655679575
              ],
              [
                -159.74015418885773,
                -18.955872208854917
              ],
              [
                -159.74513236878937,
                -18.951975714976342
              ],
              [
                -159.75543205140656,
                -18.94158461980601
              ],
              [
                -159.76504508851593,
                -18.937038312268253
              ],
              [
                -159.7853011309964,
                -18.93103050175426
              ],
              [
                -159.80418388246125,
                -18.929244354255708
              ],
              [
                -159.8120803058011,
                -18.927620567231482
              ],
              [
                -159.81911842225617,
                -18.926646287442136
              ],
              [
                -159.8285597979886,
                -18.92388579718987
              ],
              [
                -159.83971778749054,
                -18.922099573316302
              ],
              [
                -159.84435264466828,
                -18.920313330352826
              ],
              [
                -159.84589759706085,
                -18.9165783970214
              ],
              [
                -159.84641258119171,
                -18.90862108692541
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -165.8268703433166,
                -10.933133004780453
              ],
              [
                -165.84626807891232,
                -10.95032415601888
              ],
              [
                -165.83373679839474,
                -10.96431229764648
              ],
              [
                -165.80987586699825,
                -10.960267601759222
              ],
              [
                -165.8119358035217,
                -10.940043293265397
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -140.04624208602777,
                -9.241322995070167
              ],
              [
                -140.08950075301996,
                -9.23488446960153
              ],
              [
                -140.14923891219965,
                -9.238273181885745
              ],
              [
                -140.21344026718012,
                -9.280968159806786
              ],
              [
                -140.2460559288012,
                -9.336870385367883
              ],
              [
                -140.2336963096606,
                -9.45271184115125
              ],
              [
                -140.19161954166702,
                -9.534331087847384
              ],
              [
                -140.1675869488936,
                -9.595947120740032
              ],
              [
                -140.10613217594437,
                -9.61253414185309
              ],
              [
                -140.0364376569014,
                -9.618965625190048
              ],
              [
                -140.00725522281937,
                -9.60204040658177
              ],
              [
                -139.9488903546553,
                -9.50555055165476
              ],
              [
                -139.8943020367842,
                -9.411065697483517
              ],
              [
                -139.90837826969437,
                -9.299614901351852
              ],
              [
                -139.99352231266312,
                -9.258616445283096
              ],
              [
                -140.02648129703812,
                -9.244384456977738
              ],
              [
                -140.03781094791702,
                -9.24878965774234
              ],
              [
                -140.04502072574905,
                -9.268104117395525
              ],
              [
                -140.04879727604202,
                -9.290128081724752
              ],
              [
                -140.05429044010452,
                -9.30300298889794
              ],
              [
                -140.05978360416702,
                -9.312828257149862
              ],
              [
                -140.06218686344437,
                -9.32095930470605
              ],
              [
                -140.0642467999678,
                -9.32875138090014
              ],
              [
                -140.06527676822952,
                -9.336882057421255
              ],
              [
                -140.0577236676436,
                -9.343657476285607
              ],
              [
                -140.04914059879593,
                -9.348061427860145
              ],
              [
                -140.0419308209639,
                -9.351110284770865
              ],
              [
                -140.0364376569014,
                -9.355514142030328
              ],
              [
                -140.02568740552465,
                -9.363538445120762
              ],
              [
                -140.01837029697708,
                -9.358774654266423
              ],
              [
                -140.01000185004307,
                -9.358393533229812
              ],
              [
                -140.00877870203195,
                -9.361399951949037
              ],
              [
                -140.0095725671833,
                -9.363686532528792
              ],
              [
                -140.0196576547579,
                -9.367137560050063
              ],
              [
                -140.02270474674515,
                -9.37008034938345
              ],
              [
                -140.02339139225296,
                -9.376516385946942
              ],
              [
                -140.02686752005133,
                -9.377617288172102
              ],
              [
                -140.0302578473311,
                -9.37956499318351
              ],
              [
                -140.02995744578948,
                -9.383629763259997
              ],
              [
                -140.02682461979202,
                -9.383926148618087
              ],
              [
                -140.02373471500687,
                -9.386000853793021
              ],
              [
                -140.02373471500687,
                -9.391081711975524
              ],
              [
                -140.02648129703812,
                -9.393114034386107
              ],
              [
                -140.02809060829506,
                -9.393770263062772
              ],
              [
                -140.0279833185475,
                -9.398999178403889
              ],
              [
                -140.02819791080765,
                -9.40564642564498
              ],
              [
                -140.02854123356155,
                -9.410049590483707
              ],
              [
                -140.0298716041858,
                -9.412081785272752
              ],
              [
                -140.02957120182327,
                -9.416823580723264
              ],
              [
                -140.031888619638,
                -9.418093681137314
              ],
              [
                -140.03231778385452,
                -9.42224267728638
              ],
              [
                -140.03437772037796,
                -9.426984317009683
              ],
              [
                -140.03437772037796,
                -9.431725891581777
              ],
              [
                -140.03800405121257,
                -9.4317576453112
              ],
              [
                -140.03939880926558,
                -9.43517618833219
              ],
              [
                -140.03652348758988,
                -9.435832381173633
              ],
              [
                -140.03742470981888,
                -9.440785504568357
              ],
              [
                -140.03579392673782,
                -9.447939890433105
              ],
              [
                -140.03909840824417,
                -9.450860869149249
              ],
              [
                -140.04330411197952,
                -9.454755468876883
              ],
              [
                -140.0467373395186,
                -9.458819352025188
              ],
              [
                -140.05025639774613,
                -9.46292551851467
              ],
              [
                -140.0502134742796,
                -9.468005235055735
              ],
              [
                -140.05051388981155,
                -9.471349356007487
              ],
              [
                -140.0584961758266,
                -9.466100475542001
              ],
              [
                -140.07016911135528,
                -9.463729909687297
              ],
              [
                -140.07068410160355,
                -9.469021180368728
              ],
              [
                -140.07694974186234,
                -9.468301559251568
              ],
              [
                -140.07561936619095,
                -9.460851275592356
              ],
              [
                -140.08085508188242,
                -9.455940770243005
              ],
              [
                -140.08759274723343,
                -9.454247480107805
              ],
              [
                -140.0910259747725,
                -9.449252217270272
              ],
              [
                -140.09892239811234,
                -9.440531499972089
              ],
              [
                -140.10098233463577,
                -9.435790046478887
              ],
              [
                -140.1032997665128,
                -9.43282661158301
              ],
              [
                -140.10600342991165,
                -9.43299594513243
              ],
              [
                -140.1099517098688,
                -9.42586239211056
              ],
              [
                -140.11359944584183,
                -9.42321641218675
              ],
              [
                -140.11819138767532,
                -9.41775499399607
              ],
              [
                -140.12295499088577,
                -9.412081801496571
              ],
              [
                -140.12638821842484,
                -9.40835607218092
              ],
              [
                -140.13188138248734,
                -9.400227068896625
              ],
              [
                -140.1291348004561,
                -9.39103937179851
              ],
              [
                -140.1296927105003,
                -9.387313404580613
              ],
              [
                -140.13359799625687,
                -9.383629761150946
              ],
              [
                -140.13677373776608,
                -9.381004591217245
              ],
              [
                -140.1349712872725,
                -9.37753259133575
              ],
              [
                -140.13286843540482,
                -9.37753259133575
              ],
              [
                -140.12819066288284,
                -9.376982147119612
              ],
              [
                -140.12484325329865,
                -9.37626234640891
              ],
              [
                -140.12123837711624,
                -9.373129013157937
              ],
              [
                -140.11437192203812,
                -9.367370403556128
              ],
              [
                -140.1133419537764,
                -9.362289198144367
              ],
              [
                -140.1126123770333,
                -9.35716556335744
              ],
              [
                -140.10990872623734,
                -9.355852897971552
              ],
              [
                -140.1059175898079,
                -9.354942500740412
              ],
              [
                -140.10407223942093,
                -9.353608633712895
              ],
              [
                -140.1020123028975,
                -9.349416478673731
              ],
              [
                -140.0975491070967,
                -9.344673777747305
              ],
              [
                -140.0966049595513,
                -9.342535305854202
              ],
              [
                -140.0939442181807,
                -9.340820285674294
              ],
              [
                -140.0862194562178,
                -9.341878941590556
              ],
              [
                -140.08347287418655,
                -9.338575924491225
              ],
              [
                -140.08209958317093,
                -9.334171852984165
              ],
              [
                -140.0767351632226,
                -9.335272897808425
              ],
              [
                -140.0742031598311,
                -9.3338330759478
              ],
              [
                -140.0697399640303,
                -9.334171852984165
              ],
              [
                -140.06493344547562,
                -9.31926535207785
              ],
              [
                -140.05429044010452,
                -9.275219703251947
              ],
              [
                -140.0477673077803,
                -9.256244487227116
              ],
              [
                -140.04502072574905,
                -9.24878965774234
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -139.51938611087604,
                -8.862254217681237
              ],
              [
                -139.5059965234737,
                -8.85682659328276
              ],
              [
                -139.51492291507526,
                -8.836811536243538
              ],
              [
                -139.5609281640987,
                -8.788974543605777
              ],
              [
                -139.63405591068073,
                -8.758776380929955
              ],
              [
                -139.68074780521198,
                -8.782527951132899
              ],
              [
                -139.73842602786823,
                -8.853434287345074
              ],
              [
                -139.75696545657917,
                -8.966042051329229
              ],
              [
                -139.68555432376667,
                -9.064375706352754
              ],
              [
                -139.55989819583698,
                -9.06844410718164
              ],
              [
                -139.53552228030964,
                -8.955528941975953
              ],
              [
                -139.54204541263385,
                -8.945015528619662
              ],
              [
                -139.54925519046589,
                -8.945354675727561
              ],
              [
                -139.55989819583698,
                -8.947050406526952
              ],
              [
                -139.56916791019245,
                -8.950102702053695
              ],
              [
                -139.57912427005573,
                -8.955868079282691
              ],
              [
                -139.5887373071651,
                -8.955868079282691
              ],
              [
                -139.59629040775104,
                -8.961294233158823
              ],
              [
                -139.5993803125362,
                -8.958242031571379
              ],
              [
                -139.59697705325885,
                -8.95179841072589
              ],
              [
                -139.59869366702839,
                -8.945693822519463
              ],
              [
                -139.60967999515339,
                -8.937893366379905
              ],
              [
                -139.61826306400104,
                -8.924326957955639
              ],
              [
                -139.61791974124714,
                -8.914830171873582
              ],
              [
                -139.61379986820026,
                -8.909064145553588
              ],
              [
                -139.600066958044,
                -8.887355936981555
              ],
              [
                -139.59800702152057,
                -8.880232650641346
              ],
              [
                -139.58599072513385,
                -8.865985662955007
              ],
              [
                -139.56573468265339,
                -8.859540415499888
              ],
              [
                -139.54822522220417,
                -8.860558093666153
              ],
              [
                -139.53277569827839,
                -8.863611111256642
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -144.31538867513225,
                -27.564396808818255
              ],
              [
                -144.28277301351116,
                -27.543090057244626
              ],
              [
                -144.21582507649944,
                -27.49102333103099
              ],
              [
                -144.23299121419475,
                -27.45751709397576
              ],
              [
                -144.30302905599163,
                -27.45264261084714
              ],
              [
                -144.4063692049174,
                -27.471225422436852
              ],
              [
                -144.51398030165913,
                -27.517112132820255
              ],
              [
                -144.5345796668935,
                -27.563688260029664
              ],
              [
                -144.51329365615132,
                -27.636709044832525
              ],
              [
                -144.42814961318257,
                -27.744325794273553
              ],
              [
                -144.33785572890523,
                -27.75678302292326
              ],
              [
                -144.20258656386616,
                -27.752529495313105
              ],
              [
                -144.15623799208882,
                -27.705425768477998
              ],
              [
                -144.14250508193257,
                -27.610548857350693
              ],
              [
                -144.20292988662007,
                -27.497623453675704
              ],
              [
                -144.3086732948232,
                -27.571296861245635
              ],
              [
                -144.28876057509663,
                -27.59198958736128
              ],
              [
                -144.2928804481435,
                -27.61967521403297
              ],
              [
                -144.31279316787007,
                -27.657085323128438
              ],
              [
                -144.3303026283193,
                -27.65617303364268
              ],
              [
                -144.34472218398335,
                -27.645833220839307
              ],
              [
                -144.36188832167866,
                -27.638838087294772
              ],
              [
                -144.38248768691304,
                -27.62697575179525
              ],
              [
                -144.3962205970693,
                -27.604464197121168
              ],
              [
                -144.39862385634663,
                -27.58194801666609
              ],
              [
                -144.39004078749898,
                -27.5649056716706
              ],
              [
                -144.37184468154194,
                -27.55668788107529
              ],
              [
                -144.3467821205068,
                -27.555470378300814
              ],
              [
                -144.3251527870107,
                -27.563992614205755
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -144.3339281038432,
                -27.602434292869717
              ],
              [
                -144.3445711092143,
                -27.592697953373992
              ],
              [
                -144.35864734212444,
                -27.59574065237058
              ],
              [
                -144.3569307283549,
                -27.609735979867203
              ],
              [
                -144.3397645906596,
                -27.620687597903625
              ],
              [
                -144.3184785799174,
                -27.620383401078886
              ],
              [
                -144.32637500325725,
                -27.60456400184054
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -149.5374493493315,
                -23.34776622812608
              ],
              [
                -149.509983529019,
                -23.33326576626071
              ],
              [
                -149.50929688351118,
                -23.32254701600343
              ],
              [
                -149.52302979366743,
                -23.306782577430834
              ],
              [
                -149.51135682003462,
                -23.26957109460665
              ],
              [
                -149.5161633385893,
                -23.237396859098556
              ],
              [
                -149.54156922237837,
                -23.216574100784385
              ],
              [
                -149.66241883175337,
                -23.231718247112248
              ],
              [
                -149.7194104089018,
                -23.284709224011067
              ],
              [
                -149.7132305993315,
                -23.411423409766936
              ],
              [
                -149.50861023800337,
                -23.534868770741802
              ],
              [
                -149.38158081905806,
                -23.510314871292074
              ],
              [
                -149.37746094601118,
                -23.436625717106057
              ],
              [
                -149.4165997399565,
                -23.42906552921278
              ],
              [
                -149.4385723962065,
                -23.427805455864018
              ],
              [
                -149.47565125362837,
                -23.43032559055288
              ],
              [
                -149.50655030147993,
                -23.444185472580493
              ],
              [
                -149.53882264034712,
                -23.442925543368375
              ],
              [
                -149.55255555050337,
                -23.408272783719582
              ],
              [
                -149.56903504269087,
                -23.37865323378359
              ],
              [
                -149.56766175167525,
                -23.353439890780795
              ],
              [
                -149.54706238644087,
                -23.349657475960747
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -149.58777336114017,
                -17.53651530537185
              ],
              [
                -149.5880308532056,
                -17.53774292697052
              ],
              [
                -149.58751586907474,
                -17.539461583243842
              ],
              [
                -149.58674339287845,
                -17.5403618252654
              ],
              [
                -149.58562759392825,
                -17.540116305157444
              ],
              [
                -149.58373931878177,
                -17.541998617486833
              ],
              [
                -149.5843401336011,
                -17.542898846908454
              ],
              [
                -149.58734420769778,
                -17.54347171784874
              ],
              [
                -149.59103492730227,
                -17.543880910268886
              ],
              [
                -149.59249404900638,
                -17.545026644130225
              ],
              [
                -149.59154991143313,
                -17.548218293119007
              ],
              [
                -149.56648735039798,
                -17.544535616219463
              ],
              [
                -149.54983619683352,
                -17.527512493042195
              ],
              [
                -149.55163864129153,
                -17.523829395575056
              ],
              [
                -149.55378440850345,
                -17.52211059117199
              ],
              [
                -149.5565309905347,
                -17.522765375721388
              ],
              [
                -149.56142333977786,
                -17.522028742937202
              ],
              [
                -149.5641699218091,
                -17.521210258558977
              ],
              [
                -149.56803230279056,
                -17.522356135654878
              ],
              [
                -149.57309631341067,
                -17.526039263027307
              ],
              [
                -149.57764533989993,
                -17.530540761611874
              ],
              [
                -149.582881011897,
                -17.533978194395957
              ],
              [
                -149.58485511773196,
                -17.53496030608153
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -140.24300151004036,
                -8.790157932803945
              ],
              [
                -140.20935584930183,
                -8.78201486883443
              ],
              [
                -140.19639539837712,
                -8.781081797070883
              ],
              [
                -140.1928333553287,
                -8.784093239938516
              ],
              [
                -140.18195424895413,
                -8.781612158281538
              ],
              [
                -140.17262028102402,
                -8.777264665625331
              ],
              [
                -140.16403720434963,
                -8.785068539101813
              ],
              [
                -140.15442415845138,
                -8.789140060072452
              ],
              [
                -140.15339427156923,
                -8.799233895176283
              ],
              [
                -140.1473431651381,
                -8.797367880330828
              ],
              [
                -140.13923211244807,
                -8.79974276731272
              ],
              [
                -140.12695831298453,
                -8.799318666706213
              ],
              [
                -140.120091851594,
                -8.80813989939176
              ],
              [
                -140.11219542102714,
                -8.803050752328053
              ],
              [
                -140.1032690212314,
                -8.805764972766113
              ],
              [
                -140.08850612925463,
                -8.809496993319126
              ],
              [
                -140.08206859349332,
                -8.799064561028576
              ],
              [
                -140.05417382245895,
                -8.799657948388209
              ],
              [
                -140.04971056173733,
                -8.795247316455661
              ],
              [
                -140.04250083816348,
                -8.796434756061265
              ],
              [
                -140.03237245024022,
                -8.788122249157954
              ],
              [
                -139.95898719374966,
                -8.796349990197408
              ],
              [
                -139.85547569370007,
                -8.704052983135542
              ],
              [
                -140.060696995093,
                -8.641179654297897
              ],
              [
                -140.19665291547784,
                -8.643555632747573
              ],
              [
                -140.32316578007192,
                -8.665462871654894
              ],
              [
                -140.4332023752055,
                -8.742993572233178
              ],
              [
                -140.39303360244426,
                -8.92890159822488
              ],
              [
                -140.33157881072472,
                -9.031653307900728
              ],
              [
                -140.18875648959357,
                -9.109630148530078
              ],
              [
                -140.02396138995735,
                -8.99740606810594
              ],
              [
                -139.9951222523691,
                -8.94789428705257
              ],
              [
                -139.9038844589409,
                -8.938525300527926
              ],
              [
                -139.8252197816679,
                -8.85019516382731
              ],
              [
                -139.9758292634416,
                -8.81255454024993
              ],
              [
                -140.0311353243733,
                -8.818329479999434
              ],
              [
                -140.03295439448846,
                -8.840554850073529
              ],
              [
                -140.00172723782134,
                -8.847597820252698
              ],
              [
                -140.00790037254546,
                -8.865553491584057
              ],
              [
                -140.00788869138603,
                -8.891963886842378
              ],
              [
                -140.00666566060295,
                -8.923412245172377
              ],
              [
                -140.01640828318662,
                -8.930173535189205
              ],
              [
                -140.02190145241917,
                -8.925425244774527
              ],
              [
                -140.02172979090957,
                -8.923305452280216
              ],
              [
                -140.01881154494617,
                -8.911264797368352
              ],
              [
                -140.02430471419186,
                -8.904481155145309
              ],
              [
                -140.03426108324658,
                -8.908212174099479
              ],
              [
                -140.0394109292745,
                -8.91363904266541
              ],
              [
                -140.04953889612597,
                -8.914910969128114
              ],
              [
                -140.05494629822766,
                -8.922796700605753
              ],
              [
                -140.06627577911286,
                -8.924492809748822
              ],
              [
                -140.07249853824266,
                -8.928817074723723
              ],
              [
                -140.08026637480728,
                -8.93093664815504
              ],
              [
                -140.08799101609864,
                -8.937295913879941
              ],
              [
                -140.09743252842017,
                -8.941789628683425
              ],
              [
                -140.1033548567376,
                -8.936702377216788
              ],
              [
                -140.10876218985396,
                -8.941111326923785
              ],
              [
                -140.11811774361578,
                -8.939245990473085
              ],
              [
                -140.12416873491298,
                -8.946029025116282
              ],
              [
                -140.13176483578175,
                -8.947555143105214
              ],
              [
                -140.1372580049617,
                -8.951964004200134
              ],
              [
                -140.15133425099833,
                -8.95264228577608
              ],
              [
                -140.16472385090592,
                -8.960442432974986
              ],
              [
                -140.17845677391676,
                -8.969938038340194
              ],
              [
                -140.19184637381943,
                -8.967903286594888
              ],
              [
                -140.19527960450836,
                -8.95772935715231
              ],
              [
                -140.20248938901358,
                -8.949250865048782
              ],
              [
                -140.2134757272979,
                -8.938398106864115
              ],
              [
                -140.22102883487648,
                -8.933649923440623
              ],
              [
                -140.22223044550128,
                -8.933310792845313
              ],
              [
                -140.22763780404827,
                -8.934667396456527
              ],
              [
                -140.22909690742716,
                -8.929834333291684
              ],
              [
                -140.22823861934322,
                -8.925510036580633
              ],
              [
                -140.2254920346627,
                -8.914656571722963
              ],
              [
                -140.2254920496771,
                -8.910077642724636
              ],
              [
                -140.22789529608835,
                -8.90549870984928
              ],
              [
                -140.22892530089928,
                -8.899562915366008
              ],
              [
                -140.22948319958874,
                -8.896171003330673
              ],
              [
                -140.2327876497522,
                -8.893287870596016
              ],
              [
                -140.23403224543057,
                -8.880313265860783
              ],
              [
                -140.23690752643478,
                -8.875310060832394
              ],
              [
                -140.23768007034585,
                -8.869161694648412
              ],
              [
                -140.24145655698896,
                -8.861995737656478
              ],
              [
                -140.24420314152584,
                -8.859281931033596
              ],
              [
                -140.24557643373237,
                -8.852327710188856
              ],
              [
                -140.25398784881628,
                -8.84036953527022
              ],
              [
                -140.25295787942716,
                -8.825103216192117
              ],
              [
                -140.24849467921507,
                -8.797622251121622
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    });
/***** End of imports. If edited, may not auto-convert in the playground. *****/
// Viewing script for looking at reefs and classifications for each region. 
// From this region Timor Sea onwards the map_viewer script is going to be used from the very beginning 
// in the workflow 

//Viewer for Central South Pacific + Marquesas (note it's being run out of CSP script/asset folders)

// #### ---> note this is a special joined region - don't use this as a template map viewer

// Load and libraries needed
var map_palettes = require('users/mitchest/global_reefs_modules:colour_pals');
var param_module = require('users/mitchest/global_reefs_modules:reef_params');
var pkg_vis = require('users/mitchest/global_reefs_modules:pkg_vis');

// ###########################################
// SENSOR GENERICS
var sensor_params = param_module.dove ;      //<------------ THIS IS WHERE YOU CHOOSE THE SENSOR
// REGION AND SENSOR SPECIFIC LOAD PATHS
var region_params = param_module.central_south_pacific;       //<------------ THIS IS WHERE YOU CHOOSE THE REGION
//  ^^ all the data paths are in this module ^^
// ###########################################



// Choose which layers will be shown in the map viewer
var vars = {
  raw: true, // set to true if you want to view the raw classifications for benthic and geo
  geo_cleanup_stage: 3, // set to 0, 1, 2 or 3 - this controls the display of the geo clean stages (0 = cleanup not ready)
  benthic_cleanup_stage: 2, // set to 0, 1 or 2 - this controls the display of the benthic clean stages (0 = cleanup not ready)
};

// choose where to centre the map (link this dynamically to map app?)
Map.centerObject(centre_map, 6);


// Add low-tide base map to viewer
var low_tide_image = ee.Image(region_params.pixels);
Map.addLayer(low_tide_image, {bands: ['b3','b2','b1'], min: 0, max: 2000}, sensor_params.sname + " from stack", false);
// var low_tide_image = ee.Image(region_params.pixels);
// Map.addLayer(low_tide_image, {bands: ['b3','b2','b1'], min: 0, max: 3000}, sensor_params.sname + " from stack", false); // image data

//print (region_params.image[0])
Map.addLayer(GCRMN_ext, {}, "GCRMN_ext", false);// CR added GCRMN_ext

// Add rugosity map to viewer
  var rugosity_map = ee.Image(region_params.rugosity)
  Map.addLayer(rugosity_map, {min:0, max:50}, 'rugosity', false);


//Load other imagery for viewing purpose only
//Map.addLayer(geo_clean2_0, map_palettes.geo, 'Geomorphic - stage 2 clean', false);




// Load the raw classifications
if (vars.raw) {
// geo raw (test if more than one map exists for the region)
  if (ee.List(region_params.geo_map).length().getInfo() > 1) {
    var geo_map_raw = ee.Image(region_params.geo_map[0]).unmask(0, false)
                 .add(ee.Image(region_params.geo_map[1]).unmask(0, false))
                 .selfMask();
  } else {
    var geo_map_raw = ee.Image(region_params.geo_map);
  }

  // benthic raw (test if more than one map exists for the region)
  if (ee.List(region_params.benthic_map).length().getInfo() > 1) {
    var benthic_map_raw = ee.Image(region_params.benthic_map[0]).unmask(0, false)
                     .add(ee.Image(region_params.benthic_map[1]).unmask(0, false))
                     .selfMask();
  } else {
      var benthic_map_raw = ee.Image(region_params.benthic_map);
  }

  // Add the raw region classification to the viewer
  Map.addLayer(geo_map_raw, map_palettes.geo, 'Geomorphic RAW', false);
  Map.addLayer(benthic_map_raw.updateMask(geo_map_raw.gt(2)), map_palettes.benthic, 'Benthic RAW', false);
}

// Add geo clean stage 1 to the viewer
if (vars.geo_cleanup_stage == 1||vars.geo_cleanup_stage == 2) {
  Map.addLayer(ee.Image(region_params.geo_map_clean1), map_palettes.geo, 'Geomorphic - stage 1 clean', false);
  }

// Add geo clean stage 2 to the viewer
if (vars.geo_cleanup_stage == 2||vars.geo_cleanup_stage == 3) {
  Map.addLayer(ee.Image(region_params.geo_map_clean2), map_palettes.geo, 'Geomorphic - stage 2 clean', false);
}

// Add geo clean stage 3 to the viewer
if (vars.geo_cleanup_stage == 3) {
  var geo_map_clean3 = ee.Image(region_params.geo_map_clean3)
  Map.addLayer(geo_map_clean3.updateMask(geo_map_clean3.gt(2)), map_palettes.geo, 'Geomorphic - stage 3 clean', true);
}

// Add benthic clean stage 1 to the viewer
if (vars.benthic_cleanup_stage == 1||vars.benthic_cleanup_stage == 2) {
  Map.addLayer(ee.Image(region_params.benthic_map_clean1), map_palettes.benthic, 'Benthic - stage 1 clean', false);
  }

// Add geo clean stage 2 to the viewer
if (vars.benthic_cleanup_stage == 2) {
  Map.addLayer(ee.Image(region_params.benthic_map_clean2), map_palettes.benthic, 'Benthic - stage 2 clean', false);
}

// Geo Training Data - Needs more work + add flag to show
var geo_train = ee.FeatureCollection(region_params.geo_train_library);

var geo_buff = function(feature) {
 return feature.buffer(20);   // substitute in your value of Z here
};

var geo_train_buff = geo_train.map(geo_buff);

// Create an empty image into which to paint the features, cast to byte.
var empty = ee.Image().byte();

// Paint the interior of the polygons with different colors.
var geo_fill = empty.paint({
  featureCollection: geo_train_buff,
  color: 'class_num',
});

//Map.addLayer(geo_fill, map_palettes.geo, 'Geo Training Data', false);

var wcmc=wcmc.filterBounds(region_extent);
Map.addLayer(wcmc, {color:'#ffff00'}, "WCMC layer", false);

////////// UI SET UP //////////

//Generate title
var title = ui.Label({
  value: 'Coral Atlas map classes',
  style: {fontWeight: 'bold', fontSize: '14px'}
});

// generate the legend
var geo_legend = pkg_vis.discrete_legend(map_palettes.geo_atlas_names, map_palettes.geo_atlas_cols, 'Geomorphic Zone', false);
var benthic_legend = pkg_vis.discrete_legend(map_palettes.benthic_atlas_names, map_palettes.benthic_atlas_cols, 'Benthic Habitat', false);
//var mask_legend = pkg_vis.discrete_legend(["Low confidence depth","Water conditions"], ["#f7f7f7","#bababa"], 'Confidence Mask reason', false)
pkg_vis.add_lgds([title, geo_legend, benthic_legend]);//, mask_legend])
// generate the legend



////////// MASK EXPORTS //////////

/*
Export.table.toAsset({
  collection: ee.FeatureCollection(region_extent),
  description: "region_extent_export",
  assetId: region_params.asset + 'in_out/' + region_params.sname + '_extent'
})

Export.table.toAsset({
  collection: ee.FeatureCollection(notReef_mask),
  description: "not_reef_mask_export",
  assetId: region_params.asset + 'in_out/' +  region_params.sname + '_notreef'
})
 */
Export.table.toAsset({
  collection: ee.FeatureCollection(mid_mask),
  description: "mid_mask_export",
  assetId: region_params.asset + 'in_out/' +  region_params.sname + '_midmask'
})

/*
Export.table.toAsset({
  collection: ee.FeatureCollection(Banks_0_3m_mask),
  description: "Banks_0_3m_mask_export",
  assetId: region_params.asset + 'in_out/' +  region_params.sname + '_Banks_0_3m_mask' // mask created to still map areas in low turbidty regions but up to 5 m
})

Export.table.toAsset({
  collection: ee.FeatureCollection(DW_0_5m_mask),
  description: "DW_0_5m_mask_export",
  assetId: region_params.asset + 'in_out/' +  region_params.sname + '_DW_0_5m_mask' // mask created to still map areas in low turbidty regions but up to 8  m
})

Export.table.toAsset({
  collection: ee.FeatureCollection(GCRMN_ext_mask),
  description: "GCRMN_ext_mask_export",
  assetId: region_params.asset + 'in_out/' +  region_params.sname + '_GCRMN_ext_mask' // GCRMN_ext_mask created to still map areas in low turbidty regions but up to 8  m
})

Export.table.toAsset({
  collection: ee.FeatureCollection(Coastline_Mask),
  description: "Coastline_Mask_export",
  assetId: region_params.asset + 'in_out/' +  region_params.sname + '_Coast_mask' //Mask to change BRS and DL in RS
})
*/
/*
Export.table.toAsset({
  collection: ee.FeatureCollection(lagoons_mask),
  description: "lagoons_mask_export",
  assetId: region_params.asset + 'in_out/' +  region_params.sname + '_lagoons_mask' // lagoons_mask to change RC in ORF and RS SRS in BRS
})  

Export.table.toAsset({
  collection: ee.FeatureCollection(SG_to_AC),
  description: "SG_to_AC_mask_export",
  assetId: region_params.asset + 'in_out/' +  region_params.sname + 'SG_to_AC_mask' // SG_to_AC_mask to change SG_to_AC
})  */
