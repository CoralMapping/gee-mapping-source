/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var centre_map = /* color: #d63000 */ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Point",
          "coordinates": [
            122.97355459536129,
            -2.5240694931651593
          ]
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                110.08659170473634,
                -3.0785795799322937
              ],
              [
                109.57023428286134,
                -3.6488820378438636
              ],
              [
                110.50407217348634,
                -4.098291311962617
              ],
              [
                113.55827139223634,
                -4.821188677684344
              ],
              [
                115.40397451723634,
                -4.67885697658847
              ],
              [
                115.62370107973634,
                -4.251691705120294
              ],
              [
                115.52482412661134,
                -2.9908122161693727
              ],
              [
                110.66886709536134,
                -2.2225707818302105
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                104.95493648377449,
                -4.96540121373207
              ],
              [
                105.17466304627449,
                -5.140499260637487
              ],
              [
                105.42734859314949,
                -5.33742695831676
              ],
              [
                105.95469234314949,
                -5.818534980702509
              ],
              [
                106.08652828064949,
                -5.621765873136318
              ],
              [
                106.28428218689949,
                -3.5850093988385074
              ],
              [
                106.16343257752449,
                -3.398588632646403
              ],
              [
                106.19639156189949,
                -3.047582789591549
              ],
              [
                105.57017085877449,
                -2.367194769265193
              ],
              [
                105.37241695252449,
                -2.356217773003393
              ],
              [
                105.02085445252449,
                -2.1476388612428403
              ],
              [
                104.73520992127449,
                -1.5217423029855544
              ],
              [
                104.41660640564949,
                -0.9396037327912877
              ],
              [
                103.81235835877449,
                -0.6979293714325663
              ],
              [
                104.06504390564949,
                -0.22553394015720038
              ],
              [
                103.97715328064949,
                0.13701417495441612
              ],
              [
                103.71348140564949,
                0.41166896662648694
              ],
              [
                103.52671382752449,
                0.6972998260577854
              ],
              [
                103.40586421814949,
                0.8950345421444785
              ],
              [
                103.16416499939949,
                1.1696479010122949
              ],
              [
                103.32895992127449,
                1.2575188026883841
              ],
              [
                103.49375484314949,
                1.1806319184328642
              ],
              [
                103.72446773377449,
                1.8505596634000787
              ],
              [
                102.61484859314949,
                2.4214494087681766
              ],
              [
                102.36216304627449,
                1.971342041154704
              ],
              [
                102.12046382752449,
                2.17994520151379
              ],
              [
                102.28525874939949,
                2.7068076493620863
              ],
              [
                101.32944820252449,
                3.1456866822371956
              ],
              [
                100.51645992127449,
                4.077659535201548
              ],
              [
                99.50571773377449,
                5.1289299549118255
              ],
              [
                97.34141109314949,
                5.861625881699749
              ],
              [
                95.93516109314949,
                5.8834832240400115
              ],
              [
                95.56162593689949,
                5.402428795216521
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                107.09727046814949,
                -6.4520889557659356
              ],
              [
                108.62437007752449,
                -7.0957539899036295
              ],
              [
                110.38218257752449,
                -7.281053500420239
              ],
              [
                110.29429195252449,
                -6.746753983716745
              ],
              [
                110.01963374939949,
                -6.746753983716745
              ],
              [
                109.03086421814949,
                -6.528500368494751
              ],
              [
                108.66831539002449,
                -6.430255000670395
              ],
              [
                108.40464351502449,
                -6.146329387928234
              ],
              [
                108.12998531189949,
                -6.1354061005188765
              ],
              [
                107.75645015564949,
                -6.091710716197999
              ],
              [
                107.39390132752449,
                -5.884109499295055
              ],
              [
                106.93247554627449,
                -5.7966751039359625
              ],
              [
                106.97642085877449,
                -6.364747521303552
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                106.41082654127581,
                -7.352405101584314
              ],
              [
                106.41769299635394,
                -7.386453782970421
              ],
              [
                106.38336072096331,
                -7.513091757159603
              ],
              [
                106.37512097486956,
                -7.59205163272267
              ],
              [
                106.54403576979144,
                -7.6709970072441385
              ],
              [
                107.15240368971331,
                -7.749927733537947
              ],
              [
                107.56301770338519,
                -7.80299353257658
              ],
              [
                107.60284314283831,
                -7.555296244329727
              ],
              [
                107.64816174635394,
                -7.585245315959929
              ],
              [
                107.58361706861956,
                -7.80163295499438
              ],
              [
                107.82394299635394,
                -7.891421544007951
              ],
              [
                107.82256970533831,
                -7.68596775784533
              ],
              [
                107.91320691236956,
                -7.722711905554831
              ],
              [
                107.92144665846331,
                -7.745845471345351
              ],
              [
                107.84728894361956,
                -7.89686265215592
              ],
              [
                108.04916272291644,
                -7.962150345870377
              ],
              [
                108.07525525221331,
                -7.754009956147446
              ],
              [
                108.10821423658831,
                -7.759452858017902
              ],
              [
                108.08349499830706,
                -7.9703105777802685
              ],
              [
                108.17825207838519,
                -8.065501217591063
              ],
              [
                108.29223523268206,
                -8.11444769558342
              ],
              [
                108.40072522291644,
                -8.043745323109887
              ],
              [
                108.44879040846331,
                -7.998870106981655
              ],
              [
                108.42681775221331,
                -7.811156905066058
              ],
              [
                108.44879040846331,
                -7.80163295499438
              ],
              [
                108.49410901197894,
                -8.001589957930435
              ],
              [
                108.68087659010394,
                -8.109009491760371
              ],
              [
                108.75503430494769,
                -8.074956768284787
              ],
              [
                108.61633191236956,
                -7.666851637182781
              ],
              [
                108.67538342604144,
                -7.676378632370257
              ],
              [
                108.69872937330706,
                -7.714484475411986
              ],
              [
                108.68224988111956,
                -7.7553083546549235
              ],
              [
                108.78936658033831,
                -8.046402584201935
              ],
              [
                108.84979138502581,
                -7.721288729491419
              ],
              [
                108.89648327955706,
                -7.734896908886131
              ],
              [
                108.85116467604144,
                -8.054561128105773
              ],
              [
                108.84567151197894,
                -8.089912916604666
              ],
              [
                109.40460095533831,
                -8.144294225356964
              ],
              [
                109.37164197096331,
                -7.710401870416293
              ],
              [
                109.45129284986956,
                -7.736257702694116
              ],
              [
                109.44442639479144,
                -8.144294225356964
              ],
              [
                110.38706583832985,
                -8.296198165022874
              ],
              [
                110.42963785981422,
                -8.06783386974367
              ],
              [
                110.50928873872047,
                -8.104544073417083
              ],
              [
                110.47495646332985,
                -8.307069374785641
              ],
              [
                112.0762137875486,
                -8.548875192637388
              ],
              [
                112.1036796078611,
                -8.302992706396797
              ],
              [
                112.87409586762672,
                -8.3722902954963
              ],
              [
                112.92353434418922,
                -8.3722902954963
              ],
              [
                113.00867838715797,
                -8.596403376962522
              ],
              [
                113.18438358505688,
                -8.657766887602616
              ],
              [
                113.25991459091625,
                -8.440481893417571
              ],
              [
                113.34231205185375,
                -8.425539020471517
              ],
              [
                113.42058963974438,
                -8.444557122083683
              ],
              [
                113.49474735458813,
                -8.401085801815205
              ],
              [
                113.76665897568188,
                -8.512471249086301
              ],
              [
                113.93557377060375,
                -8.53827546377416
              ],
              [
                114.06603641708813,
                -8.585804972682944
              ],
              [
                114.0866357823225,
                -8.62246652858832
              ],
              [
                114.04543705185375,
                -8.855930102454733
              ],
              [
                114.29812259872875,
                -8.914272998935372
              ],
              [
                114.32146854599438,
                -8.721570662900193
              ],
              [
                114.38601322372875,
                -8.699851448360542
              ],
              [
                114.39562626083813,
                -8.513829409061472
              ],
              [
                114.37640018661938,
                -8.493456503814741
              ],
              [
                114.377773477635,
                -8.437765050410102
              ],
              [
                114.4381982823225,
                -8.439123474303004
              ],
              [
                114.41485233505688,
                -8.130640138507548
              ],
              [
                114.22121830185375,
                -8.126561657004908
              ],
              [
                110.83099720886374,
                -7.942306569164826
              ],
              [
                109.53461049011374,
                -7.528626074381319
              ],
              [
                108.29315541198874,
                -7.387012024484574
              ],
              [
                107.06268666198874,
                -7.158155346146428
              ],
              [
                106.65619252136374,
                -7.212655584194384
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    notReef_mask = /* color: #d63000 */ee.Geometry.MultiPoint(),
    artifact_layer = 
    /* color: #98ff00 */
    /* shown: false */
    ee.Geometry.MultiPoint(),
    wcmc = ee.FeatureCollection("projects/coral_atlas/global_datasets/wcmc_reefs_2018v4_dissolved"),
    region_wcmcBound = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[125.61292878907614, 5.37738287551761],
          [118.58167878907614, 0.6391876452835566],
          [113.13246003907614, -1.865352297869458],
          [110.18812410157614, 2.264587617955663],
          [104.56312410157614, 2.1767630075246363],
          [97.97132722657614, 6.644763383602538],
          [93.88441316407614, 7.037454508127354],
          [94.58753816407614, 1.6936417075197112],
          [96.74085847657614, 0.24369235678350853],
          [100.60804597657614, -5.1983790124187905],
          [102.54163972657614, -7.643688572040937],
          [94.93910066407614, -12.44535783729859],
          [103.85999910157614, -13.772129866763253],
          [113.00062410157614, -11.154889077713621],
          [124.16273347657614, -12.273650598071253],
          [135.67640535157614, -8.339980293243885],
          [140.59828035157614, -5.329658903890787],
          [134.66566316407614, 2.220675965269313],
          [127.41468660157614, 5.289872798079709]]]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
// Viewing script for looking at reefs and classifications for each region. 
// From this region Timor Sea onwards the map_viewer script is going to be used from the very beginning
// in the workflow 

//Viewer for Indonesia

// Load and libraries needed
var map_palettes = require('users/mitchest/global_reefs:Modules/colour_pals');
var param_module = require('users/mitchest/global_reefs:Modules/reef_params');
var pkg_vis = require('users/mitchest/global_reefs:Modules/pkg_vis');

// ###########################################
// SENSOR GENERICS
var sensor_params = param_module.dove ;      //<------------ THIS IS WHERE YOU CHOOSE THE SENSOR
// REGION AND SENSOR SPECIFIC LOAD PATHS
var region_params = param_module.indonesia;       //<------------ THIS IS WHERE YOU CHOOSE THE REGION
//  ^^ all the data paths are in this module ^^
// ###########################################


/*
// Choose which layers will be shown in the map viewer
var vars = {
  raw: true, // set to true if you want to view the raw classifications for benthic and geo
  geo_cleanup_stage: 3, // set to 0, 1, 2 or 3 - this controls the display of the geo clean stages (0 = cleanup not ready)
  benthic_cleanup_stage: 0, // set to 0, 1 or 2 - this controls the display of the benthic clean stages (0 = cleanup not ready)
};

*/
// choose where to centre the map (link this dynamically to map app?)
Map.centerObject(centre_map, 6);

// Add low-tide base map to viewer
// var low_tide_image = ee.Image(region_params.pixels);
// Map.addLayer(low_tide_image, {bands: ['b3','b2','b1'], min: 0, max: 3000}, sensor_params.sname + " from stack", false); // image data

//print (region_params.image[0])
var low_tide_image_dove = ee.ImageCollection([region_params.image[0], region_params.image[1]]).mosaic();
Map.addLayer(low_tide_image_dove, {bands: ['b3','b2','b1'], min: 0, max: 3000}, sensor_params.sname + ' low tide', false); // image data


var wcmc=wcmc.filterBounds(region_wcmcBound)

Map.addLayer(wcmc, {color:'#ffff00'}, "WCMC layer", false)




/*

// Load the raw classifications
if (vars.raw) {
// geo raw (test if more than one map exists for the region)
  if (ee.List(region_params.geo_map).length().getInfo() > 1) {
    var geo_map_raw = ee.Image(region_params.geo_map[0]).unmask(0, false)
                 .add(ee.Image(region_params.geo_map[1]).unmask(0, false))
                 .selfMask();
  } else {
    var geo_map_raw = ee.Image(region_params.geo_map);
  }

  // benthic raw (test if more than one map exists for the region)
  if (ee.List(region_params.benthic_map).length().getInfo() > 1) {
    var benthic_map_raw = ee.Image(region_params.benthic_map[0]).unmask(0, false)
                     .add(ee.Image(region_params.benthic_map[1]).unmask(0, false))
                     .selfMask();
  } else {
      var benthic_map_raw = ee.Image(region_params.benthic_map);
  }

  // Add the raw region classification to the viewer
  Map.addLayer(geo_map_raw, map_palettes.geo, 'Geomorphic RAW', false);
  Map.addLayer(benthic_map_raw.updateMask(geo_map_raw.gt(2)), map_palettes.benthic, 'Benthic RAW', false);
  Map.addLayer(benthic_subreg2_no_b4p.updateMask(geo_map_raw.gt(2)), map_palettes.benthic, 'Benthic RAW (no band4 outer reefs)', false); // test without band b4p
}

// Add geo clean stage 1 to the viewer
if (vars.geo_cleanup_stage == 1||vars.geo_cleanup_stage == 2) {
  Map.addLayer(ee.Image(region_params.geo_map_clean1), map_palettes.geo, 'Geomorphic - stage 1 clean', false);
  //Map.addLayer(ee.Image(region_params.geo_map_clean1), map_palettes.geo, 'timor_geo_clean1_10m_5m', false);
  //Map.addLayer(ee.Image(timor_geo_clean1_10m_4m), map_palettes.geo, 'timor_geo_clean1_10m_4m', false);
  //Map.addLayer(ee.Image(timor_geo_clean1_15m), map_palettes.geo, 'timor_geo_clean1_15m_5m', false);
  //Map.addLayer(ee.Image(timor_geo_clean1_15m_4m), map_palettes.geo, 'timor_geo_clean1_15m_4m', false);
  }

// Add geo clean stage 2 to the viewer
if (vars.geo_cleanup_stage == 2||vars.geo_cleanup_stage == 3) {
  Map.addLayer(ee.Image(region_params.geo_map_clean2), map_palettes.geo, 'Geomorphic - stage 2 clean', false);
  //Map.addLayer(ee.Image(region_params.geo_map_clean1), map_palettes.geo, 'timor_geo_clean2_10m_5m', false);
  //Map.addLayer(ee.Image(timor_geo_clean2_10m_4m), map_palettes.geo, 'timor_geo_clean2_10m_4m', false);
  //Map.addLayer(ee.Image(timor_geo_clean2_15m), map_palettes.geo, 'timor_geo_clean2_15m_5m', false);
  //Map.addLayer(ee.Image(timor_geo_clean2_15m_4m), map_palettes.geo, 'timor_geo_clean2_15m_4m', false);
}

// Add geo clean stage 3 to the viewer
if (vars.geo_cleanup_stage == 3) {
  var geo_map_clean3 = ee.Image(region_params.geo_map_clean3)
  Map.addLayer(geo_map_clean3.updateMask(geo_map_clean3.gt(2)), map_palettes.geo, 'Geomorphic - stage 3 clean', true);
}

// Add benthic clean stage 1 to the viewer
if (vars.benthic_cleanup_stage == 1||vars.benthic_cleanup_stage == 2) {
  Map.addLayer(ee.Image(region_params.benthic_map_clean1), map_palettes.benthic, 'Benthic - stage 1 clean', false);
  }

// Add geo clean stage 2 to the viewer
if (vars.benthic_cleanup_stage == 2) {
  Map.addLayer(ee.Image(region_params.benthic_map_clean2), map_palettes.benthic, 'Benthic - stage 2 clean', false);
}

// Geo Training Data - Needs more work + add flag to show
var geo_train = ee.FeatureCollection(region_params.geo_train_library);

var geo_buff = function(feature) {
  return feature.buffer(20);   // substitute in your value of Z here
};

var geo_train_buff = geo_train.map(geo_buff)

// Create an empty image into which to paint the features, cast to byte.
var empty = ee.Image().byte();

// Paint the interior of the polygons with different colors.
var geo_fill = empty.paint({
  featureCollection: geo_train_buff,
  color: 'class_num',
});

Map.addLayer(geo_fill, map_palettes.geo, 'Geo Training Data', false);


////////// UI SET UP //////////

//Generate title
var title = ui.Label({
  value: 'Coral Atlas map classes',
  style: {fontWeight: 'bold', fontSize: '14px'}
});

// generate the legend
var geo_legend = pkg_vis.discrete_legend(map_palettes.geo_atlas_names, map_palettes.geo_atlas_cols, 'Geomorphic Zone', false);
var benthic_legend = pkg_vis.discrete_legend(map_palettes.benthic_atlas_names, map_palettes.benthic_atlas_cols, 'Benthic Habitat', false);
//var mask_legend = pkg_vis.discrete_legend(["Low confidence depth","Water conditions"], ["#f7f7f7","#bababa"], 'Confidence Mask reason', false)
pkg_vis.add_lgds([title, geo_legend, benthic_legend]);//, mask_legend])
// generate the legend

*/