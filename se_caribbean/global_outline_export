/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var reef_mask = ee.Image("projects/coral_atlas/reefMask/global_reef_mask_combined"),
    imageVisParam = {"opacity":1,"bands":["b3","b2","b1"],"min":17.26,"max":845.74,"gamma":1},
    region_extent = 
    /* color: #d63000 */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[-77.43628196678644, 21.15751521857745],
          [-77.43628196678644, 7.527230111136917],
          [-58.89136009178644, 7.527230111136917],
          [-58.89136009178644, 21.15751521857745]]], null, false),
    refined_mask = /* color: #26de41 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-77.20021003885455, 7.7587513745741905],
                  [-76.87062019510455, 7.432053761196195],
                  [-76.32130378885455, 7.432053761196195],
                  [-76.16749519510455, 7.9328870654002],
                  [-75.83790535135455, 8.585226525700948],
                  [-75.20069832010455, 8.802428332674591],
                  [-75.02491707010455, 9.27981948323113],
                  [-74.93702644510455, 10.254245026265725],
                  [-74.18995613260455, 10.232622590478856],
                  [-73.64063972635455, 10.686379811050672],
                  [-72.69581550760455, 11.031646577765171],
                  [-72.34425300760455, 10.556802785429563],
                  [-71.75099128885455, 10.340719978842051],
                  [-70.80616707010455, 10.556802785429563],
                  [-69.59767097635455, 11.031646577765171],
                  [-69.07032722635455, 10.815901561122251],
                  [-68.82862800760455, 10.189373302582048],
                  [-66.67530769510455, 10.037954736658373],
                  [-65.84034675760455, 9.626607222466955],
                  [-65.07130378885455, 9.474930621325338],
                  [-63.77491707010454, 9.821519823434043],
                  [-63.09376472635454, 9.344868707265228],
                  [-62.25880378885454, 9.041203024044176],
                  [-60.67677253885454, 8.997801094798232],
                  [-60.03956550760454, 10.146118146125685],
                  [-59.86378425760454, 11.48419247544146],
                  [-60.56690925760454, 12.043479921932697],
                  [-60.34718269510454, 12.644488135716559],
                  [-59.51222175760454, 12.451457791994489],
                  [-58.67726082010454, 12.623047480949168],
                  [-58.61134285135454, 13.286858093195423],
                  [-59.07276863260454, 13.756855640747373],
                  [-60.25929207010454, 14.055456393759476],
                  [-60.08351082010454, 15.224692737202892],
                  [-60.23731941385454, 15.880899723278983],
                  [-60.12745613260454, 16.68236708052783],
                  [-60.83058113260454, 17.16584944896842],
                  [-60.87452644510454, 17.940974823164854],
                  [-61.40187019510454, 18.337706464105043],
                  [-62.50050300760454, 19.128427698309387],
                  [-63.64308113260454, 19.335891538919807],
                  [-65.53272957010455, 19.294419755720643],
                  [-68.01563972635455, 19.25293746096122],
                  [-68.54298347635455, 20.369214590226118],
                  [-69.31202644510455, 21.10896788541374],
                  [-70.16896003885455, 21.211423595471498],
                  [-70.71827644510455, 20.41040646254153],
                  [-71.61915535135455, 20.41040646254153],
                  [-73.28907722635455, 20.616200208974835],
                  [-73.83839363260455, 20.204337302277743],
                  [-73.75050300760455, 19.23219237770955],
                  [-74.08009285135455, 19.066137566341755],
                  [-75.09083503885455, 18.983047646373862],
                  [-75.53028816385455, 18.712719797490877],
                  [-75.50831550760455, 18.149893153986135],
                  [-75.31056160135455, 17.899161444253334],
                  [-74.7929665623841, 17.787659277340225],
                  [-74.1777321873841, 17.59925998828697],
                  [-72.3320290623841, 17.724881484227698],
                  [-72.3100564061341, 17.137903997233437],
                  [-71.6948220311341, 16.927815458203217],
                  [-71.4531228123841, 16.843714177911753],
                  [-70.5302712498841, 17.683017399919922],
                  [-69.1020485936341, 17.766735794090987],
                  [-68.1352517186341, 17.45259111630931],
                  [-66.3334939061341, 17.284824946557396],
                  [-65.2348610936341, 17.179893313460493],
                  [-64.4438454686341, 17.032889227706466],
                  [-63.828611093634095, 16.75957550719494],
                  [-63.389157968634095, 16.422650223993518],
                  [-63.784665781134095, 16.10625128434183],
                  [-64.1801735936341, 15.704755013613845],
                  [-64.1582009373841, 15.132848581940964],
                  [-63.564939218634095, 15.026768528841718],
                  [-62.576169687384095, 15.154058232846513],
                  [-61.851072031134095, 13.472168542375663],
                  [-62.400388437384095, 12.573061828325276],
                  [-62.883786874884095, 12.14379288677894],
                  [-65.79077415428644, 12.266201418450507],
                  [-67.50464134178644, 12.738135957004745],
                  [-69.15259056053644, 12.909532643852069],
                  [-70.22925071678644, 13.2519722536736],
                  [-71.85522727928644, 13.166407024341712],
                  [-73.08569602928644, 12.63095403709118],
                  [-74.46997337303644, 11.922442760955986],
                  [-75.70044212303644, 11.427528833337906],
                  [-76.97485618553644, 9.43957499290479],
                  [-77.48022727928644, 9.33118237960734],
                  [-77.37036399803644, 8.114970512594807]]]),
            {
              "system:index": "0"
            })]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
///////////////////////////////
// Coral atlas mapping project - reef outline export script for GBR-torres straigh
// Contact: mitchell.lyons@gmail.com
// Description:
// - Primarily for use in generating exports for wave modelling
///////////////////////////////

var param_module = require('users/mitchest/global_reefs:Modules/reef_params')

// #############################
// load analysis params module
var region_params = param_module.se_caribbean        //<------------ THIS IS WHERE YOU CHOOSE THE REGION
// choose an appropriate scale
var export_scale = ee.Number(100)
// #############################

//var region_extent = ee.FeatureCollection(region_params.extent_mask).geometry().bounds()

// display it

var Dove_sr = ee.Image(region_params.image)
Map.addLayer(Dove_sr, imageVisParam, "Dove se caribbean")
Map.addLayer(reef_mask, {min:1, max:3}, "Global reef mask", true)
//Map.addLayer

// exports
//Map.addLayer(region_extent, {}, "export_geom", true)


// drive export
Export.image.toDrive({
  image: reef_mask, 
  description: 'reef_mask_export_' + region_params.sname,
  folder: 'wcmc_rf/',
  fileNamePrefix: 'reef_mask_' + region_params.sname,
  region: region_extent,
  scale: export_scale,
  crs: 'EPSG:4326',
  maxPixels: 1e13,
  skipEmptyTiles: true
})

Export.table.toDrive({
  collection: refined_mask,
  fileFormat: 'SHP'
})
