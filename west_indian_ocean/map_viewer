/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var depth_pal = {"opacity":1,"bands":["depth"],"max":5,"palette":["e4e1ff","7f89ff","3a52ff","0007ff","000258"]},
    wcmc = ee.FeatureCollection("projects/coral_atlas/global_datasets/wcmc_reefs_2018v4_dissolved"),
    BondariesWCMCForWIO = 
    /* color: #00ffff */
    /* shown: false */
    /* locked: true */
    ee.Geometry.Polygon(
        [[[54.701770985703206, -2.9751249685105154],
          [52.548450673203206, -4.772691629173448],
          [52.196888173203206, -5.910289150084192],
          [51.757435048203206, -8.091037974566733],
          [48.285755360703206, -8.65623438835204],
          [44.814075673203206, -9.350691639103687],
          [46.440052235703206, -10.864858654100164],
          [45.736927235703206, -11.72673086956205],
          [43.583606923203206, -10.605801768506067],
          [41.781849110703206, -10.605801768506067],
          [41.737903798203206, -12.543027437564627],
          [44.638294423203206, -13.954584744088688],
          [46.352161610703206, -13.783928424683062],
          [48.857044423203206, -10.99430318398806],
          [49.955677235703206, -10.908013101551091],
          [52.680286610703206, -10.95116128603305],
          [53.339466298203206, -8.438948520327026],
          [54.613880360703206, -6.827435160865552],
          [55.624622548203206, -6.914694536706059],
          [56.108020985703206, -11.511507059571993],
          [58.788685048203206, -15.865441173681486],
          [56.942981923203206, -19.631456469862268],
          [54.438099110703206, -20.539442163648662],
          [54.130481923203206, -21.482966628121225],
          [54.965442860703206, -22.420415520660942],
          [55.844349110703206, -22.095048738332846],
          [57.074817860703206, -21.196440284100703],
          [58.481067860703206, -20.827232047085705],
          [59.184192860703206, -17.883867297837703],
          [63.754505360703206, -20.909357190677294],
          [64.9849741107032, -20.00354040738218],
          [63.666614735703206, -19.009403584868657],
          [61.776966298203206, -19.175515382142862],
          [60.370716298203206, -18.009288625640345],
          [60.458606923203206, -15.187980739313776],
          [58.964466298203206, -15.187980739313776],
          [56.811145985703206, -11.55456509703201],
          [57.514270985703206, -10.216806458907836],
          [56.327747548203206, -9.17720313716965],
          [56.327747548203206, -7.786369242288465],
          [57.250599110703206, -7.089164748909251],
          [56.108020985703206, -5.866575713917645],
          [57.602161610703206, -5.647957630653708],
          [57.206653798203206, -4.422260866394937],
          [56.547474110703206, -3.4138941523262103]]]),
    no_reef = 
    /* color: #01ff14 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[55.2248077855843, -20.980851493012523],
          [55.33741764886555, -21.08595829180467],
          [55.4884796605843, -21.2191575703884],
          [55.5763702855843, -21.37014202611179],
          [55.5763702855843, -21.549074333518252],
          [55.95265202386555, -21.487750868105195],
          [56.05702214105305, -21.23195887279921],
          [55.8839874730843, -20.93981411727935],
          [55.6917267308968, -20.672797751973356],
          [55.42530827386555, -20.62910598668815],
          [55.1479034887093, -20.793527159750223],
          [55.1204376683968, -20.867971649301655]]]),
    low_rrs = ee.Image("projects/coral_atlas/workflow/mapping/west_indian_ocean/west_indian_ocean_islands_low_tide_normalized_sr_jan2018_jan2020_v2_shift_mosaic/20200131T210330Z/west_indian_ocean_islands_low_tide_normalized_sr_jan2018_jan2020_v2_shift_mosaic"),
    wio_geo = ee.Image("projects/coral_atlas/west_indian_ocean/in_out/wio_geo"),
    wio_benthic = ee.Image("projects/coral_atlas/west_indian_ocean/in_out/wio_benthic"),
    RCtoIRF = /* color: #fffe44 */ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                55.659204329888894,
                -4.334751664179756
              ],
              [
                55.669160689752175,
                -4.329274193622515
              ],
              [
                55.66529830877073,
                -4.323283164810927
              ],
              [
                55.65182289067991,
                -4.329445365177744
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                55.641437377374245,
                -4.348102832274304
              ],
              [
                55.65422614995725,
                -4.352638752251315
              ],
              [
                55.647445525567605,
                -4.339202079783282
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                47.27158998556605,
                -11.579461643890012
              ],
              [
                47.28480791159144,
                -11.599472871643533
              ],
              [
                47.31931184835902,
                -11.596782369818476
              ],
              [
                47.31364702291957,
                -11.590224163011682
              ],
              [
                47.31965517111293,
                -11.587197246399292
              ],
              [
                47.32703661032191,
                -11.58047064766063
              ],
              [
                47.3208568007516,
                -11.570716792066495
              ],
              [
                47.2853228957223,
                -11.555749007824549
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                46.13475192333875,
                -9.376827643454927
              ],
              [
                46.2308822944325,
                -9.497396375688599
              ],
              [
                46.24324191357312,
                -9.357857947235685
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    SSBRStoSL = 
    /* color: #61f1f4 */
    /* shown: false */
    ee.Geometry.MultiPolygon(
        [[[[47.59276366952485, -9.687179116346291],
           [47.585897214446724, -9.690224948811181],
           [47.55602813485688, -9.724404059517544],
           [47.583150632415474, -9.759594740247222],
           [47.602376706634224, -9.75485774946257],
           [47.61027312997407, -9.741999863736947],
           [47.62675262216157, -9.741323119180288],
           [47.635335691009224, -9.753504311155895],
           [47.64460540536469, -9.738277751694888],
           [47.65112853768891, -9.715605810020225],
           [47.640828855071724, -9.702746413933353],
           [47.59894347909516, -9.685486975255515]]],
         [[[46.25038479518611, -9.40622340341489],
           [46.25931118678767, -9.425867826694434],
           [46.330036784724705, -9.429933909852755],
           [46.334842192647045, -9.405545989593882],
           [46.270640837666576, -9.387932764844745]]]]),
    RCtoORF = /* color: #ffc756 */ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                55.33929678436959,
                -5.819532133315801
              ],
              [
                55.333116974799275,
                -5.8584678623598325
              ],
              [
                55.36813589569771,
                -5.845148049131459
              ],
              [
                55.363329377143025,
                -5.816116589567722
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                43.506915678114375,
                -11.926392658304064
              ],
              [
                43.50296746644445,
                -11.913627711464002
              ],
              [
                43.51309548768469,
                -11.909596550929056
              ],
              [
                43.51876031312414,
                -11.903717667927056
              ],
              [
                43.52133523377844,
                -11.900190277085507
              ],
              [
                43.522880186171015,
                -11.895151067927433
              ],
              [
                43.52133523377844,
                -11.88809601826973
              ],
              [
                43.51704369935461,
                -11.883560532624061
              ],
              [
                43.512923826307734,
                -11.883056585110332
              ],
              [
                43.511378873915156,
                -11.881376753328569
              ],
              [
                43.51532708558508,
                -11.87364939369107
              ],
              [
                43.49232446107336,
                -11.313008866314455
              ],
              [
                43.14350854310461,
                -11.338593277865346
              ],
              [
                43.17646752747961,
                -11.832321102203176
              ],
              [
                43.523910154432734,
                -12.027147416453223
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                43.718756638793565,
                -12.274879754714837
              ],
              [
                43.71832748421397,
                -12.269595971553105
              ],
              [
                43.71103185572926,
                -12.266408876448143
              ],
              [
                43.709315237298256,
                -12.26204752601617
              ],
              [
                43.70090380682758,
                -12.258860339613284
              ],
              [
                43.690432434174625,
                -12.258021599842035
              ],
              [
                43.68322263662195,
                -12.25684735975713
              ],
              [
                43.67678531739249,
                -12.255169864897628
              ],
              [
                43.67275126404055,
                -12.25248585102713
              ],
              [
                43.6659706211712,
                -12.24861085673042
              ],
              [
                43.62674588940111,
                -12.242739394259143
              ],
              [
                43.62073772450368,
                -12.251965917921538
              ],
              [
                43.59699679070081,
                -12.333640628673626
              ],
              [
                43.63622152122414,
                -12.41634119358034
              ],
              [
                43.67707704212393,
                -12.4257292488325
              ],
              [
                43.715185973631854,
                -12.42363373080356
              ],
              [
                43.73887530940788,
                -12.425142505939043
              ],
              [
                43.751664117489675,
                -12.394043208962541
              ],
              [
                43.83431929997707,
                -12.425226325763028
              ],
              [
                43.92384173926684,
                -12.410463780361823
              ],
              [
                43.898092459853586,
                -12.367206327954133
              ],
              [
                43.88092627529285,
                -12.38598563886182
              ],
              [
                43.872477288280706,
                -12.386781646407787
              ],
              [
                43.87256311890763,
                -12.376134646365466
              ],
              [
                43.872477287777095,
                -12.368840781586716
              ],
              [
                43.869129881502616,
                -12.362468963054202
              ],
              [
                43.854109469371224,
                -12.355593932309587
              ],
              [
                43.795229454284915,
                -12.329601329923106
              ],
              [
                43.73734219526262,
                -12.292662771154447
              ],
              [
                43.76111736127429,
                -12.302055266699165
              ],
              [
                43.77004377736395,
                -12.292830497210288
              ],
              [
                43.766438895508784,
                -12.29345946332129
              ],
              [
                43.768756313488424,
                -12.289643683453892
              ],
              [
                43.75708330780394,
                -12.28394086775953
              ],
              [
                43.75124680497305,
                -12.27966367486131
              ],
              [
                43.74669776600604,
                -12.280502345612716
              ],
              [
                43.73365146561086,
                -12.270605860477158
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                44.20584584919939,
                -12.185539758565815
              ],
              [
                44.214772240800954,
                -12.195103827515704
              ],
              [
                44.22181035725603,
                -12.200640762387955
              ],
              [
                44.23193837849627,
                -12.206513142648076
              ],
              [
                44.24258138386736,
                -12.210204286460636
              ],
              [
                44.25185109822283,
                -12.215573131055422
              ],
              [
                44.26215078084002,
                -12.219767465116897
              ],
              [
                44.27348043171892,
                -12.225639421085694
              ],
              [
                44.280690209550954,
                -12.228659233386793
              ],
              [
                44.291676537675954,
                -12.233524413978877
              ],
              [
                44.310902611894704,
                -12.245099828335048
              ],
              [
                44.315880791826345,
                -12.247448401212063
              ],
              [
                44.32326223103533,
                -12.248287172175354
              ],
              [
                44.33150197712908,
                -12.246777382522277
              ],
              [
                44.34729482380877,
                -12.243925534061237
              ],
              [
                44.349354760332204,
                -12.246777382522277
              ],
              [
                44.354332940263845,
                -12.249964706104828
              ],
              [
                44.369095818681814,
                -12.249964706104828
              ],
              [
                44.377335564775564,
                -12.254829494190743
              ],
              [
                44.39244176594744,
                -12.277642475310643
              ],
              [
                44.39810659138689,
                -12.28334541188367
              ],
              [
                44.40458869607414,
                -12.275860388430385
              ],
              [
                44.44235419900383,
                -12.300013318766805
              ],
              [
                44.4931127855162,
                -12.345062595559995
              ],
              [
                44.48246978014511,
                -12.34724258476482
              ],
              [
                44.48246978014511,
                -12.364681844525578
              ],
              [
                44.53516982286972,
                -12.38312594922794
              ],
              [
                44.54615615099472,
                -12.328963651938503
              ],
              [
                44.56240267151398,
                -12.20500231531322
              ],
              [
                44.53974336975617,
                -12.178827126149779
              ],
              [
                44.50986612291689,
                -12.091877617636053
              ],
              [
                44.485490207389546,
                -12.062669651488353
              ],
              [
                44.450400298859655,
                -12.042530368595646
              ],
              [
                44.39066213967997,
                -12.071740529508805
              ],
              [
                44.373496001984655,
                -12.134850451637787
              ],
              [
                44.337790435578405,
                -12.160450307103437
              ],
              [
                44.22410006952882,
                -12.15188656860394
              ],
              [
                44.184961275583504,
                -12.164220682316332
              ],
              [
                44.197149233347176,
                -12.167576804704852
              ],
              [
                44.204444841867684,
                -12.175547425480426
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                45.03757112960229,
                -12.626090775472209
              ],
              [
                45.016285118860104,
                -12.62357811094676
              ],
              [
                44.99208086470971,
                -12.644516227491131
              ],
              [
                45.01010530928979,
                -12.669472219779344
              ],
              [
                45.05387896041284,
                -12.651216062400536
              ],
              [
                45.04752748946557,
                -12.63212106961759
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                46.45964661355934,
                -12.32157784418613
              ],
              [
                46.45054856058083,
                -12.328118343611097
              ],
              [
                46.44127884622536,
                -12.337677241544574
              ],
              [
                46.428919227084734,
                -12.352434153335853
              ],
              [
                46.43578568216286,
                -12.362830568753916
              ],
              [
                46.44591370340309,
                -12.365848805478324
              ],
              [
                46.455355079135515,
                -12.365848805478324
              ],
              [
                46.472864539584734,
                -12.349751140343505
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                46.456385047397234,
                -12.314198623406687
              ],
              [
                46.48968735452614,
                -12.31822367864954
              ],
              [
                46.50994339700661,
                -12.285853779466972
              ],
              [
                46.463079841098406,
                -12.277802615711543
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                47.70351453091799,
                -10.118734474066663
              ],
              [
                47.773380711337914,
                -10.116030601574497
              ],
              [
                47.77698560025393,
                -10.04876446170537
              ],
              [
                47.70557446744143,
                -10.043017457841731
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                46.47070188457929,
                -9.768643115754143
              ],
              [
                46.541769694637885,
                -9.763906253670994
              ],
              [
                46.55241270000898,
                -9.693352885253203
              ],
              [
                46.48666639263593,
                -9.691999197968842
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                46.244958527342654,
                -9.362600468405482
              ],
              [
                46.24358523632703,
                -9.382586096129732
              ],
              [
                46.50279391552625,
                -9.449648075277832
              ],
              [
                46.527856476561404,
                -9.443890739902903
              ],
              [
                46.531289704100466,
                -9.368697900517295
              ],
              [
                46.390869441313534,
                -9.357886654018097
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                46.23363469612714,
                -9.4723263312725
              ],
              [
                46.22917150032636,
                -9.501448274289746
              ],
              [
                46.261958823324406,
                -9.50805116129674
              ],
              [
                46.26487706673261,
                -9.477405917969836
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                50.71165643323697,
                -9.32507794343911
              ],
              [
                50.71208558667935,
                -9.33303931666807
              ],
              [
                50.71766458143033,
                -9.349723732317948
              ],
              [
                50.744443756235015,
                -9.342779047271694
              ],
              [
                50.73955140699185,
                -9.317370483535326
              ],
              [
                50.71217141736783,
                -9.321012491291235
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    MoreDeep = 
    /* color: #1b27ff */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[54.97193475746061, -4.238376289551878],
          [55.42237421058561, -4.271244437181423],
          [55.45533319496061, -4.068535503752379],
          [55.23147412172192, -3.952120122279829],
          [55.01313348792936, -3.9753817066470383]]]),
    geoclean1 = ee.Image("projects/coral_atlas/west_indian_ocean/in_out/wio_geo-clean_p1"),
    geoclean2 = ee.Image("projects/coral_atlas/west_indian_ocean/in_out/wio_geo-clean_p2"),
    geoclean3 = ee.Image("projects/coral_atlas/west_indian_ocean/in_out/wio_geo-clean_manual"),
    RCtoTRF = /* color: #1bb154 */ee.Geometry.Polygon(
        [[[45.073189372763345, -12.641816757163951],
          [45.03061644512276, -12.704790238145707],
          [45.04022966177205, -12.822656060410678],
          [45.02237646888026, -12.953850806424729],
          [45.099282412872824, -13.0261123446533],
          [45.20777474691597, -12.993998705479559],
          [45.209148063155624, -12.947158874228037],
          [45.22837454758383, -12.923066387289424],
          [45.24348105953236, -12.836046427772416],
          [45.28262067629399, -12.785996297994584],
          [45.26614083016702, -12.763730013415087],
          [45.1967881608094, -12.706129941477421],
          [45.10752236879109, -12.633776473358088]]]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
// little viewing script for looking at reefs and classifications for each region. 
//The map_viewer WIO script is going to be used from the very beginning
//in the workflow to annotate masks 
// little viewing script for looking at reefs and classifications for each region. 
//The map_viewer WIO script is going to be used from the very beginning
//in the workflow to annotate masks 


// Current Region: West Indian Ocean  <--------- Indicate region here

// imports
var pkg_vis = require('users/mitchest/global_reefs:Modules/pkg_vis')
var map_palettes = require('users/mitchest/global_reefs:Modules/colour_pals')

// choogse where to centre (link this dynamically to map app?)
var centre_map = ee.Geometry.Point([50.26077595263271,-9.927142570159555]) // <---- change for region
Map.centerObject(centre_map, 5)

//splitting North Cari regions


//4. add turbidity for reference
//Map.addLayer(turbidity.focal_mode(5), {min:5, max:20, palette: ['#ffffe5','#fff7bc','#fee391','#fec44f','#fe9929','#ec7014','#cc4c02','#993404','#662506']}, "Accumulative turbidity (smooth)", false)
//Map.addLayer(turbidity, {min:5, max:20, palette: ['#ffffe5','#fff7bc','#fee391','#fec44f','#fe9929','#ec7014','#cc4c02','#993404','#662506']}, "Accumulative turbidity", false)



// add some background data
//Map.addLayer(any_rrs, {bands: ['b3','b2','b1'], min: 66, max: 1260}, "Any tide mosaic", false)
//Map.addLayer(high_rrs, {bands: ['b3','b2','b1'], min: 66, max: 1260}, "High tide mosaic", false)

var imageVisParam = {"opacity":1,"bands":["b3","b2","b1"],"max":1536,"gamma":1};
Map.addLayer(low_rrs, imageVisParam, 'Dove sr lowtide', false)
//Map.addLayer(Artifact_layer, {color: 'ffff00'}, 'Artifact Layer', false)

// West Indian Ocean classification

//Map.addLayer(benthic.updateMask(geo.gt(2)), map_palettes.benthic, "Nth. Cari & Baha Benthic - RAW", false)
//Map.addLayer(ee.ImageCollection([benthic_baha,benthic_cari]).mosaic(), map_palettes.benthic, "Nth. Cari & Baha Benthic - RAW", false)
Map.addLayer(wio_benthic, map_palettes.benthic, "wio_benthic - RAW", false)
//Map.addLayer(benthic_clean, map_palettes.benthic, "WIO benthic - clean #1", false)
Map.addLayer(wio_geo, map_palettes.geo, "wio_geo - RAW", false)
Map.addLayer(geoclean1, map_palettes.geo, "wio_geo - firstPass", false)
Map.addLayer(geoclean2, map_palettes.geo, "wio_geo - 2ndPass", false)
Map.addLayer(geoclean3, map_palettes.geo, "wio_geo - manual", false)
//Map.addLayer(geoclean4, map_palettes.geo, "wio_geo - manual CR edits", false)
//Map.addLayer(waves.lte(0.4), {}, "waves 0.4 threshold", false)
//Map.addLayer(ee.ImageCollection([hawaii_geo_west, hawaii_geo_east]).mosaic(), map_palettes.geo, "Hawaii east/west Geo - RAW", false)
//Map.addLayer(geo_clean, map_palettes.geo, "Nth. Cari & Baha Geo - FINAL", false)




var wcmc=wcmc.filterBounds(BondariesWCMCForWIO)

Map.addLayer(wcmc, {color:'#ffff00'}, "WCMC layer", false)

// #############
// example confidence layers

/*
// depth and nir combos
var depth_nir_flag = fiji_dove_ocean.select('b4').multiply(fiji_high_depth_ocean).gt(250000)
//Map.addLayer(depth_nir_flag, {}, "NIR flag", false)
var conf_flag = fiji_high_depth_ocean.eq(-1)
                        .or(fiji_high_depth_ocean.gt(1000))
                        .add(depth_nir_flag.eq(1))
                        .selfMask()
Map.addLayer(conf_flag, {min:1,max:2,palette:["#f7f7f7","#bababa"]}, "Confidence flag", false)

//straight depth missing/-1
var depth_flag = fiji_high_depth_ocean.gt(0).selfMask()
//Map.addLayer(depth_flag, {min:0,max:1,palette:["#ffff00"]}, "Valid depth retrievals", false)

//Map.addLayer(fiji_geo_clean.gt(0).updateMask(fiji_high_depth_ocean.lte(0)), {min:0,max:1,palette:["#ff0000"]}, "Unmapped area via original algorithm", false)
*/

////////// UI SET UP //////////


//Generate title
var title = ui.Label({
  value: 'Coral Atlas map classes',
  style: {fontWeight: 'bold', fontSize: '18px'}
})

// generate the legend
var geo_legend = pkg_vis.discrete_legend(map_palettes.geo_atlas_names, map_palettes.geo_atlas_cols, 'Geomorphic Zone', false)
var benthic_legend = pkg_vis.discrete_legend(map_palettes.benthic_atlas_names, map_palettes.benthic_atlas_cols, 'Benthic Habitat', false)
//var mask_legend = pkg_vis.discrete_legend(["Low confidence depth","Water conditions"], ["#f7f7f7","#bababa"], 'Confidence Mask reason', false)
pkg_vis.add_lgds([title, geo_legend, benthic_legend])//, mask_legend])


//show confidence layers
var conf_str = {"opacity":1,"bands":["constant"],"min":0,"max":9,"palette":["4d004b","810f7c","88419d","8c6bb1","8c96c6","9ebcda","bfd3e6","e0ecf4","f7fcfd"]};
Map.addLayer(benthic_conf_clean,conf_str,'confidence_benthic',false);
Map.addLayer(geo_conf_clean,conf_str,'confidence_geo',false);

//Confidence legend

var legend=ui.Panel({
  style: {
    position: 'bottom-right',
    padding: "8px 15px"
  }
});

//var vis = {min: 'low', max: 'high', palette: 'ece2f0,a6bddb,1c9099'};
var vis = {min: 'low', max: 'high', palette: '4d004b,810f7c,88419d,8c6bb1,8c96c6,9ebcda,bfd3e6,e0ecf4,f7fcfd'};

function makeColorBarParams(palette) {
  return {
    bbox: [0, 0, 1, 0.1],
    dimensions: '100x10',
    format: 'png',
    min: 0,
    max: 1,
    palette: palette,
  };
}

var colorBar=ui.Thumbnail({
  image: ee.Image.pixelLonLat().select(0),
  params: makeColorBarParams(vis.palette),
  style:{stretch:'horizontal', margin: '0px 8px',maxHeight: '24px'}
})
// Create a panel with three numbers for the legend.
var legendLabels = ui.Panel({
  widgets: [
    ui.Label(vis.min, {margin: '4px 8px'}),
    ui.Label(
        (' '),
        {margin: '4px 8px', textAlign: 'center', stretch: 'horizontal'}),
    ui.Label(vis.max, {margin: '4px 8px'})
  ],
  layout: ui.Panel.Layout.flow('horizontal')
});

var legendTitle = ui.Label({
  value: 'Confidence Layer Legend',
  style: {fontWeight: 'bold',position: 'bottom-right'}
});

legend.add(legendTitle);
legend.add(colorBar)
legend.add(legendLabels);

Map.add(legend)