/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var depth_pal = {"opacity":1,"bands":["depth"],"max":5,"palette":["e4e1ff","7f89ff","3a52ff","0007ff","000258"]},
    wcmc = ee.FeatureCollection("projects/coral_atlas/global_datasets/wcmc_reefs_2018v4_dissolved"),
    BondariesWCMCForWIO = 
    /* color: #00ffff */
    /* shown: false */
    /* locked: true */
    ee.Geometry.Polygon(
        [[[54.701770985703206, -2.9751249685105154],
          [52.548450673203206, -4.772691629173448],
          [52.196888173203206, -5.910289150084192],
          [51.757435048203206, -8.091037974566733],
          [48.285755360703206, -8.65623438835204],
          [44.814075673203206, -9.350691639103687],
          [46.440052235703206, -10.864858654100164],
          [45.736927235703206, -11.72673086956205],
          [43.583606923203206, -10.605801768506067],
          [41.781849110703206, -10.605801768506067],
          [41.737903798203206, -12.543027437564627],
          [44.638294423203206, -13.954584744088688],
          [46.352161610703206, -13.783928424683062],
          [48.857044423203206, -10.99430318398806],
          [49.955677235703206, -10.908013101551091],
          [52.680286610703206, -10.95116128603305],
          [53.339466298203206, -8.438948520327026],
          [54.613880360703206, -6.827435160865552],
          [55.624622548203206, -6.914694536706059],
          [56.108020985703206, -11.511507059571993],
          [58.788685048203206, -15.865441173681486],
          [56.942981923203206, -19.631456469862268],
          [54.438099110703206, -20.539442163648662],
          [54.130481923203206, -21.482966628121225],
          [54.965442860703206, -22.420415520660942],
          [55.844349110703206, -22.095048738332846],
          [57.074817860703206, -21.196440284100703],
          [58.481067860703206, -20.827232047085705],
          [59.184192860703206, -17.883867297837703],
          [63.754505360703206, -20.909357190677294],
          [64.9849741107032, -20.00354040738218],
          [63.666614735703206, -19.009403584868657],
          [61.776966298203206, -19.175515382142862],
          [60.370716298203206, -18.009288625640345],
          [60.458606923203206, -15.187980739313776],
          [58.964466298203206, -15.187980739313776],
          [56.811145985703206, -11.55456509703201],
          [57.514270985703206, -10.216806458907836],
          [56.327747548203206, -9.17720313716965],
          [56.327747548203206, -7.786369242288465],
          [57.250599110703206, -7.089164748909251],
          [56.108020985703206, -5.866575713917645],
          [57.602161610703206, -5.647957630653708],
          [57.206653798203206, -4.422260866394937],
          [56.547474110703206, -3.4138941523262103]]]),
    no_reef = /* color: #01ff14 */ee.Geometry.Polygon(
        [[[55.2248077855843, -20.980851493012523],
          [55.33741764886555, -21.08595829180467],
          [55.4884796605843, -21.2191575703884],
          [55.5763702855843, -21.37014202611179],
          [55.5763702855843, -21.549074333518252],
          [55.95265202386555, -21.487750868105195],
          [56.05702214105305, -21.23195887279921],
          [55.8839874730843, -20.93981411727935],
          [55.6917267308968, -20.672797751973356],
          [55.42530827386555, -20.62910598668815],
          [55.1479034887093, -20.793527159750223],
          [55.1204376683968, -20.867971649301655]]]),
    low_rrs = ee.Image("projects/coral_atlas/workflow/mapping/west_indian_ocean/west_indian_ocean_islands_low_tide_normalized_sr_jan2018_jan2020_v2_shift_mosaic/20200131T210330Z/west_indian_ocean_islands_low_tide_normalized_sr_jan2018_jan2020_v2_shift_mosaic"),
    wio_geo = ee.Image("projects/coral_atlas/west_indian_ocean/in_out/wio_geo"),
    wio_benthic = ee.Image("projects/coral_atlas/west_indian_ocean/in_out/wio_benthic"),
    geoclean1 = ee.Image("projects/coral_atlas/west_indian_ocean/in_out/wio_geo-clean"),
    geoclean2 = ee.Image("projects/coral_atlas/west_indian_ocean/in_out/wio_geo-clean2"),
    notBRS = /* color: #6a87ff */ee.Geometry.MultiPolygon(
        [[[[63.387482463052024, -19.645365472856682],
           [63.40773850553249, -19.668644153784328],
           [63.41529160611843, -19.678989149430404],
           [63.436920939614524, -19.671877036660018],
           [63.4520271407864, -19.656035287644524],
           [63.430397807290305, -19.644072113765077]]],
         [[[56.291036095816565, -7.0867722217660205],
           [56.28940531273551, -7.121011289921165],
           [56.27386995812125, -7.1471573153460355],
           [56.25842161681023, -7.177303878051007],
           [56.23473116417594, -7.20216979235917],
           [56.2546438839025, -7.205916530014025],
           [56.27601572533317, -7.1734721625084825],
           [56.300101054839665, -7.133589380808558],
           [56.30795112093978, -7.104245236291353],
           [56.30014052828841, -7.090191683349689]]],
         [[[55.2730685259352, -5.999629727622204],
           [55.30551252617934, -6.0411133762831986],
           [55.33572492852309, -6.028480831205856],
           [55.292466261530905, -5.981020808937045]]],
         [[[55.36012077800136, -5.810591344497242],
           [55.36406898967128, -5.819642578989526],
           [55.37488365641933, -5.818617918244809],
           [55.39239311686855, -5.868824092344553],
           [55.387071614183, -5.876166794106461],
           [55.394453053391985, -5.894608501413393],
           [55.41556740275722, -5.850723065832636],
           [55.38586998454433, -5.807517307218006]]],
         [[[55.48387169271242, -4.637219583131101],
           [55.48425732674021, -4.595983309592369],
           [55.469805231341965, -4.56633766598496],
           [55.44728591632287, -4.548840935771542],
           [55.44447457485944, -4.620279988603722],
           [55.51459907918703, -4.701378951626519],
           [55.50653099447023, -4.744319659933407],
           [55.51116585164797, -4.781441546865494],
           [55.54103493123781, -4.808811235810369],
           [55.5542528572632, -4.791705308715674],
           [55.53929774107125, -4.7251322338930795],
           [55.546055089364295, -4.66534661872443]]],
         [[[55.50949121607328, -4.615556906649137],
           [55.50193811548734, -4.644644106697568],
           [55.51721597803617, -4.642077637192425],
           [55.520820866952185, -4.622914370181706]]],
         [[[55.50228143824125, -4.595537375921035],
           [55.5050280202725, -4.613674752558617],
           [55.52099252832914, -4.601697291529005]]],
         [[[55.249847228469854, -4.468732409512815],
           [55.209335143508916, -4.500991498844698],
           [55.23238150961814, -4.521922788797144],
           [55.269803689793925, -4.495568746798674],
           [55.260007318970054, -4.4783539047080065]]],
         [[[55.234832164921386, -4.384276051805047],
           [55.23676325697225, -4.40085686758109],
           [55.249337551273925, -4.404515335694935],
           [55.255088207401855, -4.395058994482067],
           [55.248307583012206, -4.39681334739751],
           [55.23779332367383, -4.382179350426744]]],
         [[[59.58320527844629, -16.423968090345323],
           [59.61753755383692, -16.471383478899316],
           [59.66422944836817, -16.481918657792697],
           [59.69169526868067, -16.547750528447033],
           [59.69856172375879, -16.60829600897816],
           [59.66285615735254, -16.68460876375893],
           [59.59556489758692, -16.770095486035274],
           [59.48570161633692, -16.820054554554602],
           [59.42665010266504, -16.830570576779582],
           [59.56809907727442, -16.867372054843788],
           [59.76173311047754, -16.66882241231975],
           [59.71778779797754, -16.441091650114952],
           [59.63538737136394, -16.406194869823004]]],
         [[[55.828112600685486, -4.33543569353075],
           [55.816439627052674, -4.357944236441032],
           [55.81935787046088, -4.377200059743823],
           [55.8370470899073, -4.38572574892624],
           [55.84176799665467, -4.3695082258315034],
           [55.85953473028816, -4.35654261774953],
           [55.84219279949729, -4.33469217128254]]],
         [[[55.920225785017635, -4.330324164971091],
           [55.92168490672174, -4.355229183853476],
           [55.934473679304745, -4.338540344514846]]],
         [[[55.889240906477596, -4.341474963063471],
           [55.887781784773495, -4.329749808490764],
           [55.87542216563287, -4.340362364970015]]],
         [[[55.86218624837686, -4.282937819597402],
           [55.873000915124905, -4.289699478636757],
           [55.87407379873086, -4.283665342744513],
           [55.86733608968545, -4.280412880955775]]],
         [[[55.21067641039947, -3.704742576824706],
           [55.19780180712799, -3.7368612393882796],
           [55.21891615649322, -3.732835764595293],
           [55.22664091845611, -3.7144211236621274]]],
         [[[55.671871107340266, -3.7872876060180074],
           [55.65470496964495, -3.8306220000104907],
           [55.68474571061175, -3.8301081662486345],
           [55.691097181559016, -3.7927687564602595]]],
         [[[53.35571387720689, -5.075299855178982],
           [53.33065131617173, -5.12163602705173],
           [53.34747413111314, -5.129928309541868],
           [53.374768290048685, -5.080429485078754]]],
         [[[53.31915000391587, -5.10966759466591],
           [53.30181220484361, -5.127705646446462],
           [53.31674674463853, -5.1321509648966686],
           [53.327303919321146, -5.1204391938878775]]],
         [[[53.36076496268776, -5.418901278323088],
           [53.31141231681374, -5.44034811903238],
           [53.34153888846901, -5.462221400086802],
           [53.37724445487526, -5.454702549625735],
           [53.38024852897194, -5.4321454334280554]]],
         [[[53.27836750175026, -5.417790465007561],
           [53.28137157584694, -5.431547316565776],
           [53.29733608390358, -5.435563232677452],
           [53.31175563956764, -5.420097536532065],
           [53.2873797240403, -5.4095874727034285]]]]),
    notRC = /* color: #8b1b05 */ee.Geometry.MultiPolygon(
        [[[[63.35897378005308, -19.66080560630316],
           [63.35382393874448, -19.66500854682159],
           [63.325328150170265, -19.66274543869308],
           [63.30987862624448, -19.67826325284056],
           [63.29820565261167, -19.70864795124732],
           [63.294085779564796, -19.73353324505831],
           [63.30438546218198, -19.75873777212658],
           [63.31743172683042, -19.770692373502364],
           [63.31846169509214, -19.799444363645353],
           [63.32910470046323, -19.82302358011929],
           [63.34009102858823, -19.830128959683012],
           [63.358287134545265, -19.83174377436466],
           [63.37510994948667, -19.830451923932362],
           [63.39982918776792, -19.826253337486527],
           [63.42386178054136, -19.811718912556213],
           [63.425921717064796, -19.800736466018027],
           [63.442401209252296, -19.77812316037616],
           [63.457164087670265, -19.766815303694507],
           [63.459910669701515, -19.75001357856354],
           [63.43107155837339, -19.756152875621353],
           [63.39742592849058, -19.771984709150466],
           [63.35897378005308, -19.781030765265317],
           [63.34112099684995, -19.757122216719434],
           [63.32498482741636, -19.746136006090286],
           [63.327044763939796, -19.721575860180597],
           [63.338031092064796, -19.705092593062616],
           [63.37579659499448, -19.693133081161477],
           [63.40806893386167, -19.67147439401659],
           [63.39502266921323, -19.65789581372209],
           [63.363780298607765, -19.658865750448278]]],
         [[[59.61153532059345, -16.42994585013174],
           [59.5926525691286, -16.444105389151165],
           [59.64689756424579, -16.55339537348498],
           [59.63694120438251, -16.616570980797796],
           [59.663033733679384, -16.646177397268854],
           [59.63488126785907, -16.695182407777324],
           [59.599862346960634, -16.715241237803752],
           [59.56381345780048, -16.71063775825573],
           [59.55282712967548, -16.732338903472332],
           [59.4772961238161, -16.8141891381164],
           [59.48313261063251, -16.828320345564016],
           [59.503731975866884, -16.82601998825323],
           [59.52055479080829, -16.821747822006593],
           [59.54149747879657, -16.810902659816936],
           [59.5593502619997, -16.80794478065039],
           [59.58544279129657, -16.78493747978403],
           [59.62252164871845, -16.735626740311236],
           [59.66097379715595, -16.70340349462209],
           [59.67710996658954, -16.67906805138719],
           [59.69015623123798, -16.6692014485878],
           [59.69736600907001, -16.635980147574422],
           [59.70938230545673, -16.58169534592866],
           [59.70457578690204, -16.567216809781215],
           [59.70732236893329, -16.547142493345337],
           [59.70903898270282, -16.523445529238447],
           [59.708695659948916, -16.495466204098182],
           [59.69564939530048, -16.48624859887297],
           [59.6860363581911, -16.473409060251615],
           [59.67607999832782, -16.47703055475724],
           [59.675736675573916, -16.465507382754478],
           [59.66818357498798, -16.457605383167138],
           [59.64243436844501, -16.444105389151165],
           [59.6201183894411, -16.4335681560471]]],
         [[[56.25391150735489, -7.18135521990668],
           [56.257730982047896, -7.178246962093158],
           [56.26244096981338, -7.171913277502194],
           [56.26758004788727, -7.163876326179949],
           [56.257173073517, -7.174542578174112],
           [56.24824668191544, -7.175990273077357],
           [56.24258185647599, -7.1814403772826685],
           [56.24043608926407, -7.188508383878869],
           [56.23897695862647, -7.196598126839712],
           [56.24301100991837, -7.194809887396047],
           [56.24970580361954, -7.186549790651255],
           [56.252366554962315, -7.181781006627136]]],
         [[[55.356000904954485, -5.81451925659536],
           [55.34192467204433, -5.8389400071692625],
           [55.356000904954485, -5.871385510927723],
           [55.3841533707748, -5.885558480768036],
           [55.391706471360735, -5.8787281789197365],
           [55.39359474650722, -5.86455503521865],
           [55.3896465348373, -5.8445754139999195],
           [55.37780189982753, -5.816227035912315],
           [55.36904716960292, -5.814006921789408]]],
         [[[55.760208460300966, -4.586693132071576],
           [55.76434979101996, -4.586864243678628],
           [55.767203661411806, -4.581688099434422],
           [55.761731955021425, -4.5807897565333375]]],
         [[[55.76510413521519, -4.589938076120206],
           [55.76654180011148, -4.591991406255027],
           [55.769202551454256, -4.590708077420064],
           [55.76883777102823, -4.587820579103629],
           [55.76594098529215, -4.587884745859778]]],
         [[[55.19917509814361, -3.7365186465077436],
           [55.203123309813535, -3.732064926891052],
           [55.20365813015946, -3.7288413225669137],
           [55.20846464871415, -3.7243019146163796],
           [55.2112112307454, -3.720105082664645],
           [55.210782077303016, -3.7159082307250575],
           [55.21498778103837, -3.7132530691853836],
           [55.21515944241532, -3.7035745095572596],
           [55.19722082852372, -3.703660160991948],
           [55.19576170681962, -3.7330381128393753]]],
         [[[53.38371079902288, -4.865353532696892],
           [53.372123602219546, -4.879079531184894],
           [53.359420660325014, -4.913970649101185],
           [53.378389242478335, -4.919272571180837],
           [53.38903224784943, -4.90456390937379],
           [53.39031970817658, -4.871126154412039]]],
         [[[53.32867721033677, -5.082481325608958],
           [53.31863501978501, -5.094621248270158],
           [53.32962134791001, -5.119840776465828],
           [53.34841826868638, -5.111377384420133],
           [53.360005411630716, -5.0888932851326185],
           [53.36300944129869, -5.079147054884135],
           [53.35193732691392, -5.0747013956996945]]],
         [[[53.304387125497904, -5.108556228879029],
           [53.30816367579087, -5.124884562914209],
           [53.31992248011216, -5.112574234532677]]],
         [[[53.32170533027678, -5.4060567630058545],
           [53.32056807195998, -5.407652255397203],
           [53.31730650579787, -5.421935362068974],
           [53.316276537536154, -5.4341113896819175],
           [53.322756754516135, -5.441246000295406],
           [53.331768976806174, -5.448850462148551],
           [53.347003924010764, -5.451499184688541],
           [53.35331247961379, -5.447739704058611],
           [53.35562990820266, -5.423088891014472],
           [53.347990976928244, -5.417663013444322],
           [53.34713267004348, -5.415526827800499],
           [53.34365652716018, -5.415526827800499],
           [53.336017595885764, -5.4086482587430895],
           [53.329494463561545, -5.405230307146103],
           [53.32292841589309, -5.405913899009305]]]]),
    notSL = /* color: #18faff */ee.Geometry.MultiPolygon(
        [[[[59.638051022284046, -16.385113304999265],
           [59.63747166513683, -16.386719023397536],
           [59.63845871805431, -16.39303883777417],
           [59.64547537683727, -16.392704773877227],
           [59.65266369699718, -16.385870295888406],
           [59.6491017234254, -16.379262033499604],
           [59.63888787149669, -16.384038120978833]]],
         [[[55.92726365830179, -4.580810414679744],
           [55.92842237259622, -4.589323237524131],
           [55.93945161606546, -4.596723749769661],
           [55.952111642615755, -4.593087669534037],
           [55.93855039383646, -4.580938749445284],
           [55.93352929856058, -4.57871427691615]]],
         [[[53.38542735893341, -4.868646049930336],
           [53.3902338774881, -4.883612058595852],
           [53.39092054418197, -4.893574839600482],
           [53.38800227958771, -4.909010748322284],
           [53.3752135070047, -4.918417425313263],
           [53.394353750534975, -4.9193580857071755],
           [53.402850988694155, -4.894643931190626],
           [53.3986452849588, -4.87181031955577],
           [53.3905782199801, -4.866171016616823]]]]),
    notRS = /* color: #cdffb1 */ee.Geometry.MultiPolygon(
        [[[[56.23603116066767, -7.200658750714251],
           [56.26326009071769, -7.168513765468862],
           [56.27244397438468, -7.149267247496633],
           [56.289781773456944, -7.113326889815983],
           [56.292270863422765, -7.081983238164409],
           [56.28712102211417, -7.082153589863299],
           [56.26600667274894, -7.1265532211206315],
           [56.23888417519034, -7.169049882923931],
           [56.23064442909659, -7.194000986881247],
           [56.234850132831944, -7.20149456621353]]],
         [[[55.3376331376205, -5.814690034760336],
           [55.33196831218105, -5.831426043231253],
           [55.34690285197597, -5.868311807215317],
           [55.38209343425136, -5.896657542209159],
           [55.39273643962245, -5.891193416609064],
           [55.38655663005214, -5.875825275240834],
           [55.39204979411464, -5.868824092344553],
           [55.37454033366542, -5.819642578989526],
           [55.36458397380214, -5.82083801416446],
           [55.36012077800136, -5.811274461613691]]],
         [[[55.410114515192056, -4.556027157040039],
           [55.367686235535324, -4.597908836878544],
           [55.351206743347824, -4.649239661902916],
           [55.36501522396936, -4.664200662875082],
           [55.37149051613818, -4.665821022733948],
           [55.39101204901779, -4.662907184890436],
           [55.39976673330511, -4.671248000462848],
           [55.40968022376144, -4.678861445927304],
           [55.41894295169075, -4.72270419385055],
           [55.456365131866534, -4.816448866093658],
           [55.543225788604815, -4.812343528772174],
           [55.50443031741341, -4.776762903523618],
           [55.50065376712044, -4.712439404403126],
           [55.43954231692513, -4.641608243008132],
           [55.44778206301888, -4.549551343988759]]],
         [[[55.493398993223856, -4.596932859210054],
           [55.485159247130106, -4.613188044883674],
           [55.48378595611448, -4.635431379913749],
           [55.50181040069456, -4.647066076478262],
           [55.510393469542215, -4.6227698748294275],
           [55.50181040069456, -4.594879546193957]]],
         [[[55.212800440307944, -4.497264329196222],
           [55.248763498779624, -4.468513445069405],
           [55.22172683190951, -4.454479865518051],
           [55.19589179467806, -4.469968130037858],
           [55.19898169946322, -4.494012797884519]]],
         [[[55.237321254887206, -4.381708661553993],
           [55.24822175232373, -4.397198448704215],
           [55.25766312805615, -4.394117632678941],
           [55.25186955658398, -4.383676994868549],
           [55.24092614380322, -4.381195182445789]]],
         [[[59.542178209354496, -16.45623815582866],
           [59.536685045291996, -16.70170917344621],
           [59.56003099255762, -16.739193173043283],
           [59.618395860721684, -16.720123286782073],
           [59.665087755252934, -16.65237691127468],
           [59.663027818729496, -16.567495712295862],
           [59.61976915173731, -16.438457354556203],
           [59.55179124646387, -16.435823023261843]]],
         [[[55.852925767275465, -4.359623588421032],
           [55.836703767153395, -4.373402219247135],
           [55.83327053961433, -4.386667121315257],
           [55.8439993756739, -4.387522913366598],
           [55.861680497500075, -4.3633892020885]]],
         [[[55.91087023997369, -4.340508790930588],
           [55.921513245344784, -4.355913846289375],
           [55.92013995432916, -4.330580921933151]]],
         [[[55.85276286387506, -4.310749537479082],
           [55.86495082163873, -4.335740786110828],
           [55.8756796576983, -4.340447949496965],
           [55.8881251075274, -4.3300921513473485],
           [55.873018906355526, -4.308096308642123],
           [55.86168925547662, -4.307582779410871]]],
         [[[55.8547189784794, -4.2807552460055325],
           [55.84690838582803, -4.2804984722325745],
           [55.8446338725834, -4.286061884687516],
           [55.85806637532998, -4.298044481629411],
           [55.87428837545205, -4.299756265830215],
           [55.874717528894436, -4.290854946031404],
           [55.861757094934475, -4.282723842069514]]],
         [[[55.692185617195754, -4.27719858268964],
           [55.66368981902183, -4.291235487690717],
           [55.65188294437173, -4.3242297560663445],
           [55.6581109773296, -4.334280744907191],
           [55.66257685471414, -4.3334864155632],
           [55.66558359747043, -4.3316650437860895],
           [55.667783027973876, -4.332766906986063],
           [55.637935460377456, -4.344855793288283],
           [55.66265469929278, -4.361244961572723],
           [55.65733319476932, -4.3660375487809135],
           [55.64617520141965, -4.372199401620932],
           [55.753291937408044, -4.39154044383805],
           [55.78762422447517, -4.369289643969999],
           [55.80341707634194, -4.3398491101844705],
           [55.796550618493555, -4.2771985823949255],
           [55.723766170265144, -4.272063065314076]]],
         [[[55.76308989797191, -4.576926577884321],
           [55.76097631744807, -4.577439916803712],
           [55.75812244705622, -4.57989967405843],
           [55.760311129612376, -4.585867223885809],
           [55.763100626987864, -4.583963602291873],
           [55.76498890213435, -4.577568252173901]]],
         [[[55.18449805041412, -3.7018304269569944],
           [55.18398306628326, -3.7204166304280624],
           [55.19780180712799, -3.7363473500172995],
           [55.2109339024649, -3.703457806005205]]],
         [[[55.671871107340266, -3.787630178938081],
           [55.69058219742816, -3.789171755400169],
           [55.6929854567055, -3.756284196870975],
           [55.64783851456683, -3.7561129042498282],
           [55.63153068375628, -3.7691310475296937],
           [55.63874046158831, -3.814350447954211],
           [55.655391615152766, -3.828224106482748]]],
         [[[53.36628813514123, -4.8715873424663325],
           [53.346461246103146, -4.9105836146244215],
           [53.3700646854342, -4.923239810183643],
           [53.38113684424768, -4.914089746933494],
           [53.39049238929162, -4.884158757105654],
           [53.38405508765588, -4.865515350480603]]],
         [[[53.3014688820897, -5.128047595118687],
           [53.32129577112779, -5.107701330808468],
           [53.29915145350083, -5.107188391418856]]],
         [[[53.33768943262681, -5.076069302265164],
           [53.31314185572251, -5.086841465033535],
           [53.3303938241063, -5.122234442793429],
           [53.3564005227147, -5.0738464526234965]]],
         [[[53.29619832639789, -5.3330725369637175],
           [53.263925987530705, -5.369989775096002],
           [53.30443807249164, -5.3834913555177035],
           [53.32795568113422, -5.352385999671645]]],
         [[[53.31141231681374, -5.440177230889103],
           [53.36196659232643, -5.4183031483301045],
           [53.346688729777604, -5.4018116169021475],
           [53.319023119567404, -5.389080225112215],
           [53.29438971197463, -5.393438226116041],
           [53.28683661138869, -5.409844537241894],
           [53.31018255865432, -5.419243785958078],
           [53.30983923590041, -5.430693582195367]]]]),
    Deep = /* color: #0c16c2 */ee.Geometry.MultiPolygon(
        [[[[55.22752818329987, -4.408108871795463],
           [55.24091777070221, -4.414227587181845],
           [55.24602469666657, -4.4121737582671585],
           [55.238085357982484, -4.401818951026618],
           [55.22963103516754, -4.401690584742926]]],
         [[[55.10923834644881, -4.2909914005764485],
           [55.04881354176131, -4.30331627503444],
           [55.074219425550375, -4.350559774055848],
           [55.22734137379256, -4.338235667410778],
           [55.28364630543319, -4.403277280043641],
           [55.2019354900035, -4.459413893211122],
           [55.22184820973006, -4.447091587584681],
           [55.241760929456625, -4.451883619850726],
           [55.274719913831625, -4.492956898680837],
           [55.24794073902694, -4.513492671837868],
           [55.23214789234725, -4.532658869311558],
           [55.21360846363631, -4.5107546022620015],
           [55.17652960621444, -4.495695035243141],
           [55.11679144703475, -4.490903289511004],
           [54.978089054456625, -4.531974370997968],
           [54.91697760426131, -4.6524360040557715],
           [54.980714183904006, -4.867446367255372],
           [55.07272468195088, -4.967327610463236],
           [55.26017890558369, -4.968011676737542],
           [55.273254757092175, -4.845957072348354],
           [55.30716420883822, -4.645328294065157],
           [55.34836293930697, -4.535817464465671],
           [55.39436818833041, -4.29072742675142],
           [55.19455434555697, -4.305791140344339]]],
         [[[55.79562920448245, -4.47278322018755],
           [55.7818962943262, -4.549449268891032],
           [55.83614128944339, -4.630213595310534],
           [55.8917595755762, -4.591885902082193],
           [55.93982476112308, -4.46799132425887],
           [55.82790154334964, -4.441293046025351]]],
         [[[56.51728440642244, -5.164048643290083],
           [56.875713361500566, -5.140797029815418],
           [56.82764817595369, -4.774132471344284],
           [56.521404279469316, -4.750867128151854]]],
         [[[59.55351282951431, -16.533729913227678],
           [59.53497340080337, -16.611388274644575],
           [59.56106593010025, -16.675202579352693],
           [59.593338268967436, -16.656784137184257],
           [59.5967714965065, -16.635732319737603],
           [59.58647181388931, -16.59493784820497],
           [59.60295130607681, -16.533729913227678],
           [59.5747988402565, -16.4955473878938]]],
         [[[55.82117717051568, -4.308927445808635],
           [55.810190836200114, -4.319197927056913],
           [55.82289378428521, -4.319882641422618],
           [55.83267848277154, -4.319283533248809],
           [55.82993190074029, -4.306873329048051]]],
         [[[55.7622374049447, -4.5610817119859774],
           [55.7576454631112, -4.567541377858183],
           [55.762602185370724, -4.570129505810936],
           [55.76743016159753, -4.561680623849451],
           [55.7652629367135, -4.5610817119859774]]],
         [[[55.71091965100533, -3.7313159072799964],
           [55.7095463599897, -3.8080538077779056],
           [55.791247143559765, -3.9298266636375776],
           [55.891507419560014, -3.993361063616616],
           [55.8908207740522, -3.751528778021327]]],
         [[[55.12287161608795, -3.724099564361653],
           [55.12364409228424, -3.7459399019339044],
           [55.19805929919342, -3.741743173392664],
           [55.19402525683502, -3.731122791000546],
           [55.18072150012115, -3.705085182061557]]],
         [[[55.320491846662975, -3.747443628452631],
           [55.31980520115516, -3.8580927030910788],
           [55.404605921370006, -3.843363153383337],
           [55.41078573094032, -3.746073272679222]]],
         [[[53.26492169506689, -4.873348693067708],
           [53.29401773333353, -4.967073279212991],
           [53.38963264885736, -4.9669022625227965],
           [53.40113390568452, -4.941762443327266],
           [53.35332481042124, -4.9229506204654285],
           [53.31581861812553, -4.891479944724156]]],
         [[[53.124339277890286, -5.25163236231433],
           [53.218753035214505, -5.4560435993407665],
           [53.36535185113247, -5.181200792805181],
           [53.25411527886685, -5.109393539012181]]],
         [[[53.33688933180449, -5.399080786231485],
           [53.33997923658965, -5.404976800540399],
           [53.35293967054961, -5.412923511595184],
           [53.36366850660918, -5.418648496781997],
           [53.36461264418242, -5.421553692394682],
           [53.368818347917774, -5.423177177971778],
           [53.37645727919219, -5.411641791065571],
           [53.36263853834746, -5.394466474160993],
           [53.35087973402617, -5.383357801229904]]],
         [[[53.44910670219687, -5.4547502049421155],
           [53.341646680224216, -5.486533789670236],
           [53.422327527392184, -5.59895883502795],
           [53.51708460747031, -5.521391257645976]]]]),
    notSRS = /* color: #e7ff78 */ee.Geometry.MultiPolygon(
        [[[[55.76433165988321, -4.589617246095629],
           [55.76585515460367, -4.592461959582767],
           [55.76933129748697, -4.591841684676566],
           [55.768987974733065, -4.5874997452364195],
           [55.76493247470255, -4.587927523694005]]],
         [[[55.7651041360795, -4.57853440232471],
           [55.76184256991739, -4.5870044743944804],
           [55.76731427630777, -4.586041971260488],
           [55.76885922870035, -4.579111910425983]]],
         [[[53.3686055637301, -4.876205440500802],
           [53.35641760596643, -4.895276138308276],
           [53.35993666419397, -4.906820915542953],
           [53.37924856910119, -4.913576655552374],
           [53.3865441776217, -4.890829207974152],
           [53.384913394540646, -4.8732977528464385],
           [53.377703616708615, -4.8717583837001905]]]]),
    notTRF = /* color: #007a00 */ee.Geometry.MultiPolygon(
        [[[[55.93983436648838, -4.5775170906586435],
           [55.94567085330478, -4.59719490946505],
           [55.95803047244541, -4.58701384482381],
           [55.952880631136814, -4.582650486954896],
           [55.946357475403445, -4.57948492187818]]],
         [[[56.55640098204929, -10.367126295717428],
           [56.675877300408665, -10.515686790330534],
           [56.744541851189915, -10.477202937392848],
           [56.64909812560398, -10.333352679822562],
           [56.581463543084446, -10.328961842868994]]]]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
// little viewing script for looking at reefs and classifications for each region. 
//The map_viewer WIO script is going to be used from the very beginning
//in the workflow to annotate masks 

// Current Region: West Indian Ocean  <--------- Indicate region here

// imports
var pkg_vis = require('users/mitchest/global_reefs:Modules/pkg_vis')
var map_palettes = require('users/mitchest/global_reefs:Modules/colour_pals')

// choogse where to centre (link this dynamically to map app?)
var centre_map = ee.Geometry.Point([50.26077595263271,-9.927142570159555]) // <---- change for region
Map.centerObject(centre_map, 5)

//splitting North Cari regions


//4. add turbidity for reference
//Map.addLayer(turbidity.focal_mode(5), {min:5, max:20, palette: ['#ffffe5','#fff7bc','#fee391','#fec44f','#fe9929','#ec7014','#cc4c02','#993404','#662506']}, "Accumulative turbidity (smooth)", false)
//Map.addLayer(turbidity, {min:5, max:20, palette: ['#ffffe5','#fff7bc','#fee391','#fec44f','#fe9929','#ec7014','#cc4c02','#993404','#662506']}, "Accumulative turbidity", false)



// add some background data
//Map.addLayer(any_rrs, {bands: ['b3','b2','b1'], min: 66, max: 1260}, "Any tide mosaic", false)
//Map.addLayer(high_rrs, {bands: ['b3','b2','b1'], min: 66, max: 1260}, "High tide mosaic", false)

var imageVisParam = {"opacity":1,"bands":["b3","b2","b1"],"max":1536,"gamma":1};
Map.addLayer(low_rrs, imageVisParam, 'Dove sr lowtide', false)
//Map.addLayer(Artifact_layer, {color: 'ffff00'}, 'Artifact Layer', false)

// West Indian Ocean classification

//Map.addLayer(benthic.updateMask(geo.gt(2)), map_palettes.benthic, "Nth. Cari & Baha Benthic - RAW", false)
//Map.addLayer(ee.ImageCollection([benthic_baha,benthic_cari]).mosaic(), map_palettes.benthic, "Nth. Cari & Baha Benthic - RAW", false)
//Map.addLayer(benthic_clean, map_palettes.benthic, "Nth. Cari & Baha Benthic - FINAL", false)
Map.addLayer(wio_geo, map_palettes.geo, "wio_geo - RAW", false)
Map.addLayer(geoclean1, map_palettes.geo, "wio_geo - firstPass", false)
Map.addLayer(geoclean2, map_palettes.geo, "wio_geo - 2ndPass", false)
//Map.addLayer(geoclean3, map_palettes.geo, "wio_geo - manual", false)
Map.addLayer(wio_benthic, map_palettes.benthic, "wio_benthic - RAW", false)
//Map.addLayer(ee.ImageCollection([hawaii_geo_west, hawaii_geo_east]).mosaic(), map_palettes.geo, "Hawaii east/west Geo - RAW", false)
//Map.addLayer(geo_clean, map_palettes.geo, "Nth. Cari & Baha Geo - FINAL", false)


//Map.addLayer(any_depth, {min: -1, max: 1200, palette:['#d0d1e6','#a6bddb','#74a9cf','#3690c0','#0570b0','#045a8d','#023858']}, "Any tide depth", false)
//Map.addLayer(high_depth, {min: -1, max: 1200, palette:['#d0d1e6','#a6bddb','#74a9cf','#3690c0','#0570b0','#045a8d','#023858']}, "High tide depth", false)
//Map.addLayer(low_depth, {min: -1, max: 1200, palette:['#d0d1e6','#a6bddb','#74a9cf','#3690c0','#0570b0','#045a8d','#023858']}, "Low tide depth", false)
//Map.addLayer(pixels.select('depth'), {min: -1, max: 2500, palette:['#d0d1e6','#a6bddb','#74a9cf','#3690c0','#0570b0','#045a8d','#023858']}, "Depth covariate (S2/LS8/Dove)", false)

/*

// nth cari
//Map.addLayer(benthic.updateMask(geo.gt(2)), map_palettes.benthic, "Nth. Cari & Baha Benthic - RAW", false)
Map.addLayer(ee.ImageCollection([benthic_baha,benthic_cari]).mosaic(), map_palettes.benthic, "Nth. Cari & Baha Benthic - RAW", false)
Map.addLayer(benthic_clean, map_palettes.benthic, "Nth. Cari & Baha Benthic - FINAL", false)
Map.addLayer(geo, map_palettes.geo, "Nth. Cari & Baha Geo - RAW", false)
Map.addLayer(geo_clean, map_palettes.geo, "Nth. Cari & Baha Geo - FINAL", false)

// wave data
var kd1 = ee.Image('users/danleeharris/reefwave/fiji_v1_kd1')
var kd2 = ee.Image('users/danleeharris/reefwave/fiji_v1_kd2')

Map.addLayer(kd1, {}, "waves - kd1", false)
Map.addLayer(kd2, {}, "waves - kd2", false)*/

// add training data / sample point distributions
// ----> possibly - points are only intermediate in the mapping script, so will have to pull those out if we want that
//Map.addLayer(ee.Image().byte().paint(fiji_training_geo_oldmaps, 'class_num'), map_palettes.geo, "Training data - geo (old maps) ", false)
//Map.addLayer(ee.Image().byte().paint(fiji_training_geo, 'class_num'), map_palettes.geo, "Training data - geo (new maps)", false)
//Map.addLayer(ee.Image().byte().paint(fiji_training_benthic, 'class_num'), map_palettes.benthic, "Training - benthic (manual curation)", false)
//Map.addLayer(geo_train, {}, "geomorphic training locations", false)

// WCMC

//Map.addLayer(Artifact_layer, {color: 'ffff00'}, 'Artifact Layer', false)
//Map.addLayer(any_depth, {min: -1, max: 1200, palette:['#d0d1e6','#a6bddb','#74a9cf','#3690c0','#0570b0','#045a8d','#023858']}, "Any tide depth", false)
//Map.addLayer(high_depth, {min: -1, max: 1200, palette:['#d0d1e6','#a6bddb','#74a9cf','#3690c0','#0570b0','#045a8d','#023858']}, "High tide depth", false)
//Map.addLayer(low_depth, {min: -1, max: 1200, palette:['#d0d1e6','#a6bddb','#74a9cf','#3690c0','#0570b0','#045a8d','#023858']}, "Low tide depth", false)
//Map.addLayer(pixels.select('depth'), {min: -1, max: 2500, palette:['#d0d1e6','#a6bddb','#74a9cf','#3690c0','#0570b0','#045a8d','#023858']}, "Depth covariate (S2/LS8/Dove)", false)
/*

// nth cari
//Map.addLayer(benthic.updateMask(geo.gt(2)), map_palettes.benthic, "Nth. Cari & Baha Benthic - RAW", false)
Map.addLayer(ee.ImageCollection([benthic_baha,benthic_cari]).mosaic(), map_palettes.benthic, "Nth. Cari & Baha Benthic - RAW", false)
Map.addLayer(benthic_clean, map_palettes.benthic, "Nth. Cari & Baha Benthic - FINAL", false)
Map.addLayer(geo, map_palettes.geo, "Nth. Cari & Baha Geo - RAW", false)
Map.addLayer(geo_clean, map_palettes.geo, "Nth. Cari & Baha Geo - FINAL", false)

// wave data
var kd1 = ee.Image('users/danleeharris/reefwave/fiji_v1_kd1')
var kd2 = ee.Image('users/danleeharris/reefwave/fiji_v1_kd2')

Map.addLayer(kd1, {}, "waves - kd1", false)
Map.addLayer(kd2, {}, "waves - kd2", false)*/
// add training data / sample point distributions
// ----> possibly - points are only intermediate in the mapping script, so will have to pull those out if we want that
//Map.addLayer(ee.Image().byte().paint(fiji_training_geo_oldmaps, 'class_num'), map_palettes.geo, "Training data - geo (old maps) ", false)
//Map.addLayer(ee.Image().byte().paint(fiji_training_geo, 'class_num'), map_palettes.geo, "Training data - geo (new maps)", false)
//Map.addLayer(ee.Image().byte().paint(fiji_training_benthic, 'class_num'), map_palettes.benthic, "Training - benthic (manual curation)", false)
//Map.addLayer(geo_train, {}, "geomorphic training locations", false)
// WCMC
//filter wcmc by hawaii extent

var wcmc=wcmc.filterBounds(BondariesWCMCForWIO)

Map.addLayer(wcmc, {color:'#ffff00'}, "WCMC layer", false)

// #############
// example confidence layers

/*
// depth and nir combos
var depth_nir_flag = fiji_dove_ocean.select('b4').multiply(fiji_high_depth_ocean).gt(250000)
//Map.addLayer(depth_nir_flag, {}, "NIR flag", false)
var conf_flag = fiji_high_depth_ocean.eq(-1)
                        .or(fiji_high_depth_ocean.gt(1000))
                        .add(depth_nir_flag.eq(1))
                        .selfMask()
Map.addLayer(conf_flag, {min:1,max:2,palette:["#f7f7f7","#bababa"]}, "Confidence flag", false)

//straight depth missing/-1
var depth_flag = fiji_high_depth_ocean.gt(0).selfMask()
//Map.addLayer(depth_flag, {min:0,max:1,palette:["#ffff00"]}, "Valid depth retrievals", false)

//Map.addLayer(fiji_geo_clean.gt(0).updateMask(fiji_high_depth_ocean.lte(0)), {min:0,max:1,palette:["#ff0000"]}, "Unmapped area via original algorithm", false)
*/

////////// UI SET UP //////////


//Generate title
var title = ui.Label({
  value: 'Coral Atlas map classes',
  style: {fontWeight: 'bold', fontSize: '18px'}
})

// generate the legend
var geo_legend = pkg_vis.discrete_legend(map_palettes.geo_atlas_names, map_palettes.geo_atlas_cols, 'Geomorphic Zone', false)
var benthic_legend = pkg_vis.discrete_legend(map_palettes.benthic_atlas_names, map_palettes.benthic_atlas_cols, 'Benthic Habitat', false)
//var mask_legend = pkg_vis.discrete_legend(["Low confidence depth","Water conditions"], ["#f7f7f7","#bababa"], 'Confidence Mask reason', false)
pkg_vis.add_lgds([title, geo_legend, benthic_legend])//, mask_legend])


//show confidence layers
var conf_str = {"opacity":1,"bands":["constant"],"min":0,"max":9,"palette":["4d004b","810f7c","88419d","8c6bb1","8c96c6","9ebcda","bfd3e6","e0ecf4","f7fcfd"]};
Map.addLayer(benthic_conf_clean,conf_str,'confidence_benthic',false);
Map.addLayer(geo_conf_clean,conf_str,'confidence_geo',false);

//Confidence legend

var legend=ui.Panel({
  style: {
    position: 'bottom-right',
    padding: "8px 15px"
  }
});

//var vis = {min: 'low', max: 'high', palette: 'ece2f0,a6bddb,1c9099'};
var vis = {min: 'low', max: 'high', palette: '4d004b,810f7c,88419d,8c6bb1,8c96c6,9ebcda,bfd3e6,e0ecf4,f7fcfd'};

function makeColorBarParams(palette) {
  return {
    bbox: [0, 0, 1, 0.1],
    dimensions: '100x10',
    format: 'png',
    min: 0,
    max: 1,
    palette: palette,
  };
}

var colorBar=ui.Thumbnail({
  image: ee.Image.pixelLonLat().select(0),
  params: makeColorBarParams(vis.palette),
  style:{stretch:'horizontal', margin: '0px 8px',maxHeight: '24px'}
})
// Create a panel with three numbers for the legend.
var legendLabels = ui.Panel({
  widgets: [
    ui.Label(vis.min, {margin: '4px 8px'}),
    ui.Label(
        (' '),
        {margin: '4px 8px', textAlign: 'center', stretch: 'horizontal'}),
    ui.Label(vis.max, {margin: '4px 8px'})
  ],
  layout: ui.Panel.Layout.flow('horizontal')
});

var legendTitle = ui.Label({
  value: 'Confidence Layer Legend',
  style: {fontWeight: 'bold',position: 'bottom-right'}
});

legend.add(legendTitle);
legend.add(colorBar)
legend.add(legendLabels);

Map.add(legend)