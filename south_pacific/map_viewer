/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var centre_map = /* color: #d63000 */ee.Geometry.Point([178.66718749999995, -17.911111431319622]),
    pixels_east = ee.Image("projects/coral_atlas/sw_pacific/in_out/swp_pixels_east"),
    pixels_west = ee.Image("projects/coral_atlas/sw_pacific/in_out/swp_pixels_west"),
    mid_mask = /* color: #98ff00 */ee.Geometry.MultiPolygon(
        [[[[178.50957506843622, -18.17420088978383],
           [178.51138524796332, -18.175939445901463],
           [178.51152172812422, -18.179716646742296],
           [178.51303151262516, -18.178764130082104],
           [178.5120015538885, -18.17407509015142],
           [178.51388981950993, -18.171017022993443],
           [178.51878227540544, -18.170568555400234],
           [178.52281633452168, -18.168733696971707],
           [178.52994015825504, -18.167184116557458],
           [178.53723567283677, -18.164982271359477],
           [178.53923124107413, -18.165777374541797],
           [178.54002520410094, -18.16804041413426],
           [178.5400896179755, -18.170874292100663],
           [178.53952101003657, -18.173025176458296],
           [178.53757908952946, -18.17387126035105],
           [178.53028365950277, -18.176317815660493],
           [178.52612083385293, -18.176970157169723],
           [178.52266609627716, -18.1781117771671],
           [178.52070808757927, -18.180558194995513],
           [178.51832089557695, -18.180965934129816],
           [178.5155045385815, -18.18039509727916],
           [178.51208737505192, -18.18096587670093],
           [178.5124735560339, -18.1843092287169],
           [178.51526303637573, -18.185369325592987],
           [178.52341696929363, -18.183697760736557],
           [178.52637813788175, -18.18449276272807],
           [178.52693608415836, -18.186021634141554],
           [178.52496198530693, -18.187570934481034],
           [178.52277328822152, -18.18740785069224],
           [178.52193641947258, -18.18846791088564],
           [178.52633526933903, -18.191811111847997],
           [178.53148509870675, -18.191933422354975],
           [178.5341458619904, -18.19124032681271],
           [178.5404973329377, -18.191484949199502],
           [178.5454755128693, -18.192218814300563],
           [178.547535440722, -18.19278959270027],
           [178.55011037004704, -18.19360499550779],
           [178.54908040178532, -18.196866554869278],
           [178.5442309758266, -18.19870121584023],
           [178.53938153398747, -18.19743732148307],
           [178.5360340696798, -18.194909753523312],
           [178.52968266618961, -18.19368653523557],
           [178.52616360796208, -18.19368653523557],
           [178.52277935590033, -18.194216688178532],
           [178.521117907901, -18.19577613755491],
           [178.51894145579863, -18.196030945724743],
           [178.51647992317498, -18.195546791244194],
           [178.51564919963482, -18.193513376884418],
           [178.51456175405428, -18.189784118104324],
           [178.51527675179852, -18.186625651209614],
           [178.51238688440884, -18.18542414283101],
           [178.51310187821244, -18.189115222815236],
           [178.51212863333166, -18.190667028634895],
           [178.51029706840933, -18.190751081009534],
           [178.5042030895275, -18.19050645759315],
           [178.49398923759878, -18.190669539908864],
           [178.49055601005972, -18.191648030600017],
           [178.4788830364269, -18.23697874009311],
           [178.46515012627066, -18.287187456396726],
           [178.5612804973644, -18.29859650229789],
           [178.61689878349722, -18.30381181595877],
           [178.66736722832144, -18.287839422106845],
           [178.69998288994253, -18.269909471986345],
           [178.77208066826284, -18.23860912117723],
           [178.75525571438578, -18.195400986215194],
           [178.69105649834097, -18.195888093468643],
           [178.654320963673, -18.217165522259304],
           [178.6488277996105, -18.203285361161893],
           [178.63612485771597, -18.186651382969966],
           [178.62239194755972, -18.165122703171825],
           [178.61861539726675, -18.166101337134208],
           [178.61415220146597, -18.168711000885462],
           [178.60625577812613, -18.17393021136018],
           [178.60076261406363, -18.174582601696688],
           [178.59114957695425, -18.17914926576564],
           [178.58634305839956, -18.18795606606802],
           [178.5832531536144, -18.18143255298171],
           [178.58187986259878, -18.174582601696688],
           [178.58084989433706, -18.171646825979042],
           [178.57535673027456, -18.167406173885492],
           [178.56952024345816, -18.166753756728728],
           [178.5616238201183, -18.1677323815497],
           [178.55939222221792, -18.16137122217694],
           [178.55304061985342, -18.156967109350987],
           [178.55132413750113, -18.14979005522289],
           [178.5437710369152, -18.14554887251442],
           [178.533471354298, -18.15076877508011],
           [178.5327847087902, -18.15435736766349],
           [178.52591825371206, -18.16414406372492],
           [178.5231716716808, -18.165448915102036],
           [178.51836515312613, -18.164796490632238],
           [178.51424528007925, -18.16218676837857],
           [178.5053188884777, -18.152073726364016],
           [178.50360227470816, -18.137392462747588],
           [178.4998257244152, -18.130867061062272],
           [178.4950192058605, -18.127277986398415],
           [178.48197294121206, -18.133803521940948],
           [178.47682309990347, -18.13837125200592],
           [178.4723599041027, -18.14424387251854],
           [178.4668667400402, -18.15305243343235],
           [178.4646351421398, -18.16169744111456],
           [178.468068207388, -18.17360390808747],
           [178.47750974541128, -18.175561182628943],
           [178.4836466341627, -18.17639708290507],
           [178.4847195232433, -18.176091245009502],
           [178.48434402012933, -18.175020925410607],
           [178.48521305628682, -18.174317572789082],
           [178.48707986717642, -18.174052534734017],
           [178.48770214330733, -18.174949569273647],
           [178.48853899615938, -18.174664147435703],
           [178.48883940178433, -18.173257428676973],
           [178.48969770317495, -18.172870071862334],
           [178.4903092385638, -18.17270697359794],
           [178.49083494459248, -18.173277818533784],
           [178.49222969404653, -18.175071891400695],
           [178.49398923759878, -18.17719213865542],
           [178.4963280621378, -18.176539764200072],
           [178.49789438493266, -18.174908795950458],
           [178.50132761247173, -18.171973025719446],
           [178.50506124131525, -18.172054611373188],
           [178.5081511522056, -18.172870071862334]]],
         [[[179.25387449972985, -17.468008890105484],
           [179.36923094504235, -17.38841137346063],
           [179.37541075461266, -17.368096989273653],
           [179.3726641725814, -17.355645123932295],
           [179.36579771750328, -17.33991524303029],
           [179.35961790793297, -17.31893997106699],
           [179.35584135764, -17.305829209853062],
           [179.35523651606175, -17.29842027195481],
           [179.35592316156956, -17.29170037384915],
           [179.35557983881566, -17.285635864933585],
           [179.35231827265355, -17.283505044104686],
           [179.3495716906223, -17.284160683909157],
           [179.34613846308324, -17.285799773206733],
           [179.34425018793675, -17.283505044104686],
           [179.34510849482152, -17.27858767116694],
           [179.34751175409886, -17.27858767116694],
           [179.3495716906223, -17.279735069929064],
           [179.3502583361301, -17.275309349607365],
           [179.34974335199925, -17.269266730930667],
           [179.3466534472141, -17.26582431763703],
           [179.3437352038059, -17.26189005230034],
           [179.34304855829808, -17.25533275686526],
           [179.33961533075902, -17.251562206430634],
           [179.33686874872777, -17.249430991663647],
           [179.33738373285863, -17.24404330746359],
           [179.34528015619847, -17.238305131734744],
           [179.34837006098363, -17.229451596545818],
           [179.35386322504613, -17.22502466983371],
           [179.36210297113988, -17.22371296747824],
           [179.36656616694066, -17.2253525939679],
           [179.36759613520238, -17.228467844219992],
           [179.3660511828098, -17.231910954443386],
           [179.3667378283176, -17.236337716146657],
           [179.36622284418675, -17.241584111132447],
           [179.36107300287816, -17.247650069485136],
           [179.35901306635472, -17.250109184995697],
           [179.36038635737034, -17.253715828462134],
           [179.36330460077855, -17.253387954696784],
           [179.36690948969456, -17.248797660801465],
           [179.3696560717258, -17.247486127285967],
           [179.37326096064183, -17.24715824245071],
           [179.37755249506566, -17.246666414105615],
           [179.38115738398167, -17.24568275348345],
           [179.38888214594456, -17.243715416512277],
           [179.38853882319066, -17.239616730481586],
           [179.38716553217503, -17.235681906292864],
           [179.38885223926513, -17.228139925614073],
           [179.3926287895581, -17.227320126553213],
           [179.3952037102124, -17.2304353436336],
           [179.39640533985107, -17.23486214070079],
           [179.39571869434326, -17.239452781147733],
           [179.39709198535888, -17.241420163545612],
           [179.40704834522217, -17.242567793596095],
           [179.41374313892334, -17.242567793596095],
           [179.4200946098706, -17.239780679669845],
           [179.4255877739331, -17.238305131734744],
           [179.43005096973388, -17.235681906292864],
           [179.43235092885467, -17.230096304860666],
           [179.43733524339032, -17.226647301409407],
           [179.4411117936833, -17.224679761660433],
           [179.44265674607587, -17.226483340563778],
           [179.44128345506024, -17.229926487769518],
           [179.4395668412907, -17.23386143457426],
           [179.43991016404462, -17.242058971160137],
           [179.43973850266767, -17.24615760296759],
           [179.44042514817548, -17.251895534587565],
           [179.4417984391911, -17.25517427254239],
           [179.44265674607587, -17.259928339060362],
           [179.44128345506024, -17.26255121985189],
           [179.44076847092938, -17.26664939639187],
           [179.44059680955243, -17.26927218156394],
           [179.44042514817548, -17.273698046904695],
           [179.4414551164372, -17.278779464898243],
           [179.44488834397626, -17.285827651324567],
           [179.44969486253095, -17.292547763856465],
           [179.45398639695478, -17.2997593189771],
           [179.4575912858708, -17.30647892271775],
           [179.45982288377118, -17.31188720591645],
           [179.46068119065595, -17.316312046549367],
           [179.4608528520329, -17.32155616415289],
           [179.45947956101728, -17.32483366164284],
           [179.45741962449384, -17.328438841334012],
           [179.45432971970868, -17.33269941699128],
           [179.44883655564618, -17.340400975901915],
           [179.4436867143376, -17.349576879411035],
           [179.4381935502751, -17.355803123925615],
           [179.43321537034345, -17.358916166892435],
           [179.42832043304907, -17.376802976568847],
           [179.42540218964086, -17.378768889756294],
           [179.42076733246313, -17.38384740110687],
           [179.413900877385, -17.388106689063296],
           [179.40651943817602, -17.39220206474816],
           [179.40118267214237, -17.395783173558304],
           [179.39311458742557, -17.402007847088793],
           [179.3783517090076, -17.409870289647348],
           [179.36942531740604, -17.4144565582506],
           [179.36564876711307, -17.41674964937482],
           [179.2609568938983, -17.489931997828588],
           [179.48480332944519, -17.52005498067853],
           [179.5795604095233, -17.3510399468179],
           [179.5795604095233, -17.193676650461555],
           [179.47746944003646, -17.10705585116207],
           [179.31404780917708, -17.09261743698325],
           [179.25087642245833, -17.133304643978217],
           [179.2330236392552, -17.197598511200585],
           [179.23714351230208, -17.333984906634726]]]]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
// Viewing script for looking at reefs and classifications for each region. 
// From this region Timor Sea onwards the map_viewer script is going to be used from the very beginning
// in the workflow 

// Load and libraries needed
var map_palettes = require('users/mitchest/global_reefs:Modules/colour_pals');
var param_module = require('users/mitchest/global_reefs:Modules/reef_params');
var pkg_vis = require('users/mitchest/global_reefs:Modules/pkg_vis');

// ###########################################
// SENSOR GENERICS
var sensor_params = param_module.dove  ;      //<------------ THIS IS WHERE YOU CHOOSE THE SENSOR
// REGION AND SENSOR SPECIFIC LOAD PATHS
var region_params = param_module.swpac;       //<------------ THIS IS WHERE YOU CHOOSE THE REGION
//  ^^ all the data paths are in this module ^^
// ###########################################

// Choose which layers will be shown in the map viewer
var vars = {
  raw: true,
  geo_clean1: true,
  geo_clean2: true,
  geo_clean3: false,
  benthic_clean1: false,
};

// choose where to centre the map (link this dynamically to map app?)
Map.centerObject(centre_map, 6);

// Add low-tide base map
var pixels = ee.ImageCollection([pixels_east, pixels_west]).mosaic();
Map.addLayer(pixels, {bands: ['b3','b2','b1'], min: 0, max: 3000}, sensor_params.sname, false); // image data

// Load the raw classifications
if (vars.raw) {
// geo raw (test if more than one map exists for the region)
  if (ee.List(region_params.geo_map).length().getInfo() > 1) {
    var geo_map_raw = ee.Image(region_params.geo_map[0]).unmask(0, false)
                 .add(ee.Image(region_params.geo_map[1]).unmask(0, false))
                 .selfMask();
  } else {
    var geo_map_raw = ee.Image(region_params.geo_map);
  }

  // benthic raw (test if more than one map exists for the region)
  if (ee.List(region_params.benthic_map).length().getInfo() > 1) {
    var benthic_map_raw = ee.Image(region_params.benthic_map[0]).unmask(0, false)
                     .add(ee.Image(region_params.benthic_map[1]).unmask(0, false))
                     .selfMask();
  } else {
      var benthic_map_raw = ee.Image(region_params.benthic_map);
  }

  // Add the raw region classification to the viewer
  Map.addLayer(geo_map_raw, map_palettes.geo, 'Geomorphic RAW', false);
  Map.addLayer(benthic_map_raw.updateMask(geo_map_raw.gt(2)), map_palettes.benthic, 'Benthic RAW', false);
}

// Load the clean classifications
var geo_clean1 = ee.Image(region_params.geo_map_clean1);
var geo_clean2 = ee.Image(region_params.geo_map_clean2);
var geo_clean3 = ee.Image(region_params.geo_map_clean3);

if (vars.geo_clean1) Map.addLayer(geo_clean1, map_palettes.geo, 'Geomorphic clean - stage 1', false);
if (vars.geo_clean2) Map.addLayer(geo_clean2, map_palettes.geo, 'Geomorphic clean - stage 2', false);
if (vars.geo_clean3) Map.addLayer(geo_clean3, map_palettes.geo, 'Geomorphic clean - stage 3', false);

// Geo Training Data
var geo_train = ee.FeatureCollection(region_params.geo_train_library);

var geo_buff = function(feature) {
  return feature.buffer(20);   // substitute in your value of Z here
};

var geo_train_buff = geo_train.map(geo_buff)

// Create an empty image into which to paint the features, cast to byte.
var empty = ee.Image().byte();

// Paint the interior of the polygons with different colors.
var geo_fill = empty.paint({
  featureCollection: geo_train_buff,
  color: 'class_num',
});

Map.addLayer(geo_fill, map_palettes.geo, 'Geo Training Data');


////////// UI SET UP //////////

//Generate title
var title = ui.Label({
  value: 'Coral Atlas map classes',
  style: {fontWeight: 'bold', fontSize: '18px'}
});

// generate the legend
var geo_legend = pkg_vis.discrete_legend(map_palettes.geo_atlas_names, map_palettes.geo_atlas_cols, 'Geomorphic Zone', false);
var benthic_legend = pkg_vis.discrete_legend(map_palettes.benthic_atlas_names, map_palettes.benthic_atlas_cols, 'Benthic Habitat', false);
//var mask_legend = pkg_vis.discrete_legend(["Low confidence depth","Water conditions"], ["#f7f7f7","#bababa"], 'Confidence Mask reason', false)
pkg_vis.add_lgds([title, geo_legend, benthic_legend]);//, mask_legend])
// generate the legend

