/* 
Little script to generate reef outline for the purposes of 
generating a reef outline as input to wave model

Bare bones at the moment - if it proves to be useful,
then we'll buff it out like the other modules in the mapping pipline
*/

// load analysis params module - to ensure using same data as mapping
var param_module = require('users/mitchest/global_reefs:Modules/reef_params')

// Choose the region to generate outline from
var region_params = param_module.fiji_htv2      //<------------ THIS IS WHERE YOU CHOOSE THE REGION

// Choose contour depth
var contour_depth = 5

/* 
#######
From here is where i would expect eventually it's all automated
(but quite not)
#######
*/
// get the depth data
var depth = ee.Image(region_params.dove_depth).divide(100) // cause it's in scaled integer values

// make a contour mask
var contour_mask = depth.lt(contour_depth)

// make contour vector, after smoothing
var contour_smooth = contour_mask.unmask(2,false)
                                 .focal_mode(5)
                                 .eq(1)
                                 .selfMask()

var contour_boundary = depth.geometry().bounds(50) // to bound vectorisation

var contour_vector = contour_smooth.reduceToVectors({
  geometry: contour_boundary,
  scale: 10,
  bestEffort: true,
  maxPixels: 1e13
})



// add them all to map to inspect
Map.centerObject(depth, 8)
Map.addLayer(depth, {min:-1,max:15,palette:['#a6bddb','#74a9cf','#3690c0','#0570b0','#045a8d','#023858']}, "Depth data", false)
Map.addLayer(contour_mask, {}, "Wave contour mask", false)
Map.addLayer(contour_smooth, {}, "Wave contour mask (smooth)", false)
Map.addLayer(contour_vector, {}, "Wave contour vector", false)


