/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var land_dist = ee.Image("projects/coral_atlas/global_datasets/mod44w6_global_distToLand"),
    imageVisParam = {"opacity":1,"bands":["depth"],"min":1500,"max":2500,"gamma":1},
    not_reef_crest = /* color: #d63000 */ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                118.94398658299858,
                -17.505508014499394
              ],
              [
                118.94134729021927,
                -17.507042801888687
              ],
              [
                118.94057481428378,
                -17.507677176888595
              ],
              [
                118.93984525367812,
                -17.50827062246334
              ],
              [
                118.93793552150447,
                -17.50998955732359
              ],
              [
                118.93705575724482,
                -17.510542068644856
              ],
              [
                118.93440437886767,
                -17.51429834862424
              ],
              [
                118.93273068100761,
                -17.517470074733072
              ],
              [
                118.93236590070498,
                -17.517510999869046
              ],
              [
                118.93228007004548,
                -17.517777013028518
              ],
              [
                118.93187237441305,
                -17.518063488302676
              ],
              [
                118.9313359327914,
                -17.518431812990812
              ],
              [
                118.93120718680207,
                -17.519475395548668
              ],
              [
                118.92830375200651,
                -17.524214818339384
              ],
              [
                118.9257073745583,
                -17.52842990221335
              ],
              [
                118.92459157598567,
                -17.529064202474036
              ],
              [
                118.92433408400734,
                -17.530844323616662
              ],
              [
                118.92424825334786,
                -17.532747192415016
              ],
              [
                118.9226818438134,
                -17.538087394975495
              ],
              [
                118.92216685985696,
                -17.539110404334572
              ],
              [
                118.92075065397681,
                -17.54267043190167
              ],
              [
                118.91946319408584,
                -17.544143526304396
              ],
              [
                118.91877654881107,
                -17.549462934175715
              ],
              [
                118.91199592672149,
                -17.560672050165056
              ],
              [
                118.90873436166659,
                -17.56509085825812
              ],
              [
                118.905344050624,
                -17.571718868125586
              ],
              [
                118.90332703013004,
                -17.573887238400562
              ],
              [
                118.90285496150473,
                -17.576587436746895
              ],
              [
                118.89895006874477,
                -17.579726295275247
              ],
              [
                118.89961541349474,
                -17.581377543560222
              ],
              [
                118.89917561243186,
                -17.582469090200814
              ],
              [
                118.89925611665299,
                -17.58301486490909
              ],
              [
                118.89899596127665,
                -17.583492304477485
              ],
              [
                118.89903754419421,
                -17.583894665295983
              ],
              [
                118.89890746502499,
                -17.584787947200947
              ],
              [
                118.89849981235228,
                -17.5855266766201
              ],
              [
                118.89895046666248,
                -17.586429045110208
              ],
              [
                118.89843552204813,
                -17.587310958599137
              ],
              [
                118.89755577456901,
                -17.58754736796352
              ],
              [
                118.8972339234345,
                -17.58823377775644
              ],
              [
                118.89644000402005,
                -17.589115721133265
              ],
              [
                118.89586065289177,
                -17.59044766047817
              ],
              [
                118.89494065874003,
                -17.592286284397634
              ],
              [
                118.8949218810951,
                -17.592611298877344
              ],
              [
                118.89462683076098,
                -17.592974971222276
              ],
              [
                118.8944658792382,
                -17.59378413558441
              ],
              [
                118.89675108266185,
                -17.596740997333136
              ],
              [
                118.89656334203836,
                -17.599119404439914
              ],
              [
                118.89724194155218,
                -17.6002881694256
              ],
              [
                118.89629378462936,
                -17.601322529400036
              ],
              [
                118.895884070333,
                -17.60220786739752
              ],
              [
                118.89675209338714,
                -17.603693637099415
              ],
              [
                118.89727193739184,
                -17.605622780222486
              ],
              [
                118.89686667201639,
                -17.60655666899314
              ],
              [
                118.89593447540446,
                -17.60681908740728
              ],
              [
                118.89513102150154,
                -17.607245121819894
              ],
              [
                118.89294229478067,
                -17.608174870787785
              ],
              [
                118.89289931644551,
                -17.610290846500526
              ],
              [
                118.89266864272192,
                -17.612086152010118
              ],
              [
                118.89372543654315,
                -17.613636034055503
              ],
              [
                118.89297441827605,
                -17.616264058516553
              ],
              [
                118.89273838396363,
                -17.617255948850357
              ],
              [
                118.89286712995278,
                -17.617603620460162
              ],
              [
                118.89303879127144,
                -17.61775700478086
              ],
              [
                118.89298514710953,
                -17.61796151700576
              ],
              [
                118.89310316426612,
                -17.61816602899876
              ],
              [
                118.89310316426648,
                -17.618738661346047
              ],
              [
                118.89346240518333,
                -17.61907231604025
              ],
              [
                118.89346240518356,
                -17.619450660715707
              ],
              [
                118.89415977929022,
                -17.619644945510583
              ],
              [
                118.89419196578761,
                -17.619859681093477
              ],
              [
                118.89449237309513,
                -17.61999261251656
              ],
              [
                118.89526411235953,
                -17.62075640820095
              ],
              [
                118.89544650251135,
                -17.622351570884952
              ],
              [
                118.89663740290858,
                -17.62218796510442
              ],
              [
                118.89673396240109,
                -17.6237831151285
              ],
              [
                118.8977102861503,
                -17.623885367853568
              ],
              [
                118.89891191538109,
                -17.626160476000692
              ],
              [
                118.89899238162442,
                -17.626743308076414
              ],
              [
                118.89892800862998,
                -17.626814883815513
              ],
              [
                118.8989548307112,
                -17.627172762084758
              ],
              [
                118.89943226375338,
                -17.627331250805426
              ],
              [
                118.89996334095751,
                -17.627280125426584
              ],
              [
                118.90012427344448,
                -17.629176867265883
              ],
              [
                118.90488787503583,
                -17.636620491462487
              ],
              [
                118.91319199131908,
                -17.64596548543999
              ],
              [
                118.91840620386726,
                -17.64966654159266
              ],
              [
                118.91842766153219,
                -17.650832051815406
              ],
              [
                118.92606659020194,
                -17.65543267639499
              ],
              [
                118.93037958082697,
                -17.65643457460292
              ],
              [
                118.93246097431258,
                -17.65686395784224
              ],
              [
                118.93295450060305,
                -17.656741277021425
              ],
              [
                118.93381280719528,
                -17.655718933595733
              ],
              [
                118.93973512268114,
                -17.653817359381915
              ],
              [
                118.9513651770081,
                -17.646865196702144
              ],
              [
                118.95810288376147,
                -17.640648918115357
              ],
              [
                118.96389645326916,
                -17.629401816467823
              ],
              [
                118.96355313063307,
                -17.628297517745494
              ],
              [
                118.97149246662853,
                -17.613859212356356
              ],
              [
                118.97672813685767,
                -17.602037756640495
              ],
              [
                118.97608440691927,
                -17.59626991428835
              ],
              [
                118.97393864044207,
                -17.590992790822025
              ],
              [
                118.97213619660589,
                -17.581542673085412
              ],
              [
                118.97080582139797,
                -17.569555449593576
              ],
              [
                118.97011917612974,
                -17.562681871049715
              ],
              [
                118.9721361966422,
                -17.545660458215057
              ],
              [
                118.96921795423091,
                -17.536903627722413
              ],
              [
                118.9691750389076,
                -17.530192499389567
              ],
              [
                118.96938961555782,
                -17.528473755849333
              ],
              [
                118.96655720380373,
                -17.52047819413371
              ],
              [
                118.96192234820367,
                -17.508077658494205
              ],
              [
                118.95771664589252,
                -17.504271383650156
              ],
              [
                118.95166558440036,
                -17.503043536039975
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                119.34061014993645,
                -17.254288350541824
              ],
              [
                119.33822834833123,
                -17.260739972863185
              ],
              [
                119.33762753351189,
                -17.26592420184713
              ],
              [
                119.33582508905388,
                -17.26713315128029
              ],
              [
                119.3343874250219,
                -17.266989717016333
              ],
              [
                119.3320270810888,
                -17.266482676089698
              ],
              [
                119.33245623453118,
                -17.267712112398023
              ],
              [
                119.32936632974602,
                -17.275068068304584
              ],
              [
                119.32837927682854,
                -17.27525247568232
              ],
              [
                119.32769263132073,
                -17.277588286490115
              ],
              [
                119.32477438791253,
                -17.2802314051048
              ],
              [
                119.32213509424187,
                -17.290721548319173
              ],
              [
                119.32177031381585,
                -17.29488056070846
              ],
              [
                119.31728209165476,
                -17.30149790881065
              ],
              [
                119.31704605726145,
                -17.30668099044911
              ],
              [
                119.31615259797705,
                -17.3111385377848
              ],
              [
                119.31630280168189,
                -17.31476447150863
              ],
              [
                119.31756880433691,
                -17.323040346024197
              ],
              [
                119.31752588899268,
                -17.325334581870496
              ],
              [
                119.31853439958228,
                -17.327710724500594
              ],
              [
                119.31759026200903,
                -17.329574745906648
              ],
              [
                119.31823399217261,
                -17.334511238650546
              ],
              [
                119.31782629640234,
                -17.336863767174005
              ],
              [
                119.3175473466648,
                -17.349073509825132
              ],
              [
                119.31971457154883,
                -17.355975635792756
              ],
              [
                119.319564367844,
                -17.357040629123286
              ],
              [
                119.31992914827002,
                -17.359354920220984
              ],
              [
                119.32173159272803,
                -17.362222142998906
              ],
              [
                119.32645228059424,
                -17.369226169982525
              ],
              [
                119.32800796182288,
                -17.373550826566447
              ],
              [
                119.32805087716712,
                -17.374810264501303
              ],
              [
                119.32849075944556,
                -17.375864909116096
              ],
              [
                119.32880189569129,
                -17.37640758795859
              ],
              [
                119.33247859711281,
                -17.37928333402071
              ],
              [
                119.34296454439617,
                -17.388669029131275
              ],
              [
                119.3520840550468,
                -17.393644883317506
              ],
              [
                119.35826386461711,
                -17.39499632651233
              ],
              [
                119.36092461595989,
                -17.394361558982695
              ],
              [
                119.36223353395916,
                -17.394934897492856
              ],
              [
                119.36302746782756,
                -17.39470965757821
              ],
              [
                119.3676623250053,
                -17.390716722139683
              ],
              [
                119.37242592821575,
                -17.383426830600964
              ],
              [
                119.37783326158977,
                -17.373679218569542
              ],
              [
                119.37856282244182,
                -17.37060738455641
              ],
              [
                119.38182438860393,
                -17.36282517449639
              ],
              [
                119.38208188066936,
                -17.35958931618298
              ],
              [
                119.38299415783817,
                -17.35083409151861
              ],
              [
                119.38282249646122,
                -17.34391128999151
              ],
              [
                119.38277958111698,
                -17.336742433213754
              ],
              [
                119.38277958111698,
                -17.328139435467424
              ],
              [
                119.38217876629764,
                -17.322117097220488
              ],
              [
                119.3812346287244,
                -17.311628744378
              ],
              [
                119.37769751889849,
                -17.298959396650307
              ],
              [
                119.37550883634233,
                -17.291051221517392
              ],
              [
                119.37439303739214,
                -17.283511504990607
              ],
              [
                119.37404971463823,
                -17.279290768016082
              ],
              [
                119.37550883634233,
                -17.277569663041113
              ],
              [
                119.3746934448018,
                -17.276791062650542
              ],
              [
                119.37276225431108,
                -17.274332302971395
              ],
              [
                119.37091689450884,
                -17.271381748044284
              ],
              [
                119.36087470395708,
                -17.259783970270625
              ],
              [
                119.35533862455034,
                -17.25285774095087
              ],
              [
                119.34911589963579,
                -17.250849495652165
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                119.61415139722394,
                -17.032019757169802
              ],
              [
                119.61125066883933,
                -17.034386734469265
              ],
              [
                119.60767590744125,
                -17.036637095494264
              ],
              [
                119.60753434353632,
                -17.037410280537053
              ],
              [
                119.6011269977636,
                -17.050000292345885
              ],
              [
                119.60131343017052,
                -17.05211031623106
              ],
              [
                119.60149246485071,
                -17.05341151962585
              ],
              [
                119.60093825017756,
                -17.053446704386488
              ],
              [
                119.59943986552692,
                -17.059307874998204
              ],
              [
                119.59965444224814,
                -17.060251496786673
              ],
              [
                119.60012651103479,
                -17.060743819304832
              ],
              [
                119.59931111949419,
                -17.065995178711805
              ],
              [
                119.59952569621544,
                -17.072764291202283
              ],
              [
                119.59918237346147,
                -17.07636106094819
              ],
              [
                119.59853864329786,
                -17.078248127296142
              ],
              [
                119.59716535228213,
                -17.081365847253338
              ],
              [
                119.59656453746274,
                -17.08370410301163
              ],
              [
                119.59536290782401,
                -17.084647601417124
              ],
              [
                119.59519124644704,
                -17.08559109504749
              ],
              [
                119.59456897611005,
                -17.086216668914975
              ],
              [
                119.594118362841,
                -17.08708836861491
              ],
              [
                119.59374285687298,
                -17.088360012405186
              ],
              [
                119.59315276759556,
                -17.089631655052784
              ],
              [
                119.59279336662283,
                -17.09063804272848
              ],
              [
                119.59271290065269,
                -17.092075112486484
              ],
              [
                119.59291137650882,
                -17.092712288954864
              ],
              [
                119.59268069880893,
                -17.093390485210698
              ],
              [
                119.59257341506174,
                -17.09496973811745
              ],
              [
                119.59270215648104,
                -17.095585023114957
              ],
              [
                119.5915005268423,
                -17.09706170696775
              ],
              [
                119.59064221995745,
                -17.0980871749783
              ],
              [
                119.59064221995745,
                -17.099604857273007
              ],
              [
                119.59042764323628,
                -17.10075336538354
              ],
              [
                119.59064221995749,
                -17.101491688285886
              ],
              [
                119.59077096599019,
                -17.103173412858226
              ],
              [
                119.59094262736714,
                -17.10432189896006
              ],
              [
                119.59184384959623,
                -17.104896139354477
              ],
              [
                119.59519124644704,
                -17.107849347691527
              ],
              [
                119.59562039988946,
                -17.11638057524589
              ],
              [
                119.59750867503607,
                -17.129832870003593
              ],
              [
                119.60506177562254,
                -17.14394032848096
              ],
              [
                119.609954124866,
                -17.155340340638183
              ],
              [
                119.61999631541849,
                -17.161983190335114
              ],
              [
                119.63098264354421,
                -17.16239323499254
              ],
              [
                119.64900708812527,
                -17.158333752960495
              ],
              [
                119.65316996259202,
                -17.152859247777343
              ],
              [
                119.65664601940024,
                -17.14656485372921
              ],
              [
                119.65887761730072,
                -17.143202174071853
              ],
              [
                119.6597786645909,
                -17.134138379185632
              ],
              [
                119.65997186786983,
                -17.129668408608165
              ],
              [
                119.65956426280862,
                -17.12290177867304
              ],
              [
                119.66001486749646,
                -17.120092288608568
              ],
              [
                119.65943551677573,
                -17.1100232072251
              ],
              [
                119.65778311208274,
                -17.102127316196565
              ],
              [
                119.65646351922963,
                -17.09590275734019
              ],
              [
                119.6560022892366,
                -17.090416537457532
              ],
              [
                119.65454316753241,
                -17.086970800710553
              ],
              [
                119.65355611461513,
                -17.083401934783744
              ],
              [
                119.65308404582848,
                -17.08155594284074
              ],
              [
                119.65325570720543,
                -17.078766409230024
              ],
              [
                119.65239740032062,
                -17.074499982999086
              ],
              [
                119.65114941391644,
                -17.071036729630283
              ],
              [
                119.64930405411411,
                -17.06816498833883
              ],
              [
                119.64869250421707,
                -17.06615473736896
              ],
              [
                119.64786639008197,
                -17.064923970085534
              ],
              [
                119.6474694144574,
                -17.06393934073762
              ],
              [
                119.6459137419192,
                -17.061600842303527
              ],
              [
                119.64597811493557,
                -17.060329012314796
              ],
              [
                119.64563479218161,
                -17.059696951159538
              ],
              [
                119.64552750382101,
                -17.058507162847352
              ],
              [
                119.64490523132955,
                -17.057604559760215
              ],
              [
                119.64432587418229,
                -17.056927604581706
              ],
              [
                119.64400400910048,
                -17.055512144915003
              ],
              [
                119.64351048264167,
                -17.055122378775167
              ],
              [
                119.64327444824836,
                -17.05522494889082
              ],
              [
                119.64305987152717,
                -17.05497878051858
              ],
              [
                119.64278092178957,
                -17.054855696210808
              ],
              [
                119.64222302231447,
                -17.05497878051858
              ],
              [
                119.64185824188843,
                -17.054794154026485
              ],
              [
                119.64162220749508,
                -17.054383872279477
              ],
              [
                119.64037766251205,
                -17.0537684479691
              ],
              [
                119.63638543933433,
                -17.048835005065573
              ],
              [
                119.6371793732028,
                -17.047296394787043
              ],
              [
                119.63668584674404,
                -17.045039743461164
              ],
              [
                119.63675021976039,
                -17.044588409925858
              ],
              [
                119.63402509540113,
                -17.041757292888448
              ],
              [
                119.63398218005686,
                -17.040916155650635
              ],
              [
                119.63263034671323,
                -17.039562121902865
              ],
              [
                119.63138580173025,
                -17.036730928739644
              ],
              [
                119.6305060371733,
                -17.036689896639498
              ],
              [
                119.62840318530547,
                -17.03474086151088
              ],
              [
                119.62675094455219,
                -17.032976454296787
              ],
              [
                119.62469100802862,
                -17.032114761002752
              ],
              [
                119.6232318863244,
                -17.03125306373869
              ],
              [
                119.62074279635843,
                -17.030145161423114
              ],
              [
                119.61971282809667,
                -17.02928345508537
              ],
              [
                119.61700916140944,
                -17.029775859192995
              ],
              [
                119.61533546298404,
                -17.029981027188633
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                121.76298583363628,
                -14.074177833378993
              ],
              [
                121.74521888112163,
                -14.074261087561784
              ],
              [
                121.74109900807476,
                -14.069432294832467
              ],
              [
                121.73749411915874,
                -14.073428544369179
              ],
              [
                121.7288252196226,
                -14.090994562377295
              ],
              [
                121.72577206968758,
                -14.105324730367613
              ],
              [
                121.72053639769051,
                -14.126467430759478
              ],
              [
                121.71967809080574,
                -14.13911881657058
              ],
              [
                121.72002141355965,
                -14.152102401886214
              ],
              [
                121.7231113183448,
                -14.158593916399552
              ],
              [
                121.73255269407723,
                -14.16683287916371
              ],
              [
                121.73800294279549,
                -14.172658227924043
              ],
              [
                121.73830335020516,
                -14.173448799445044
              ],
              [
                121.7398053872535,
                -14.175029934222351
              ],
              [
                121.74203698515389,
                -14.176652666350202
              ],
              [
                121.76014726042244,
                -14.191048704400657
              ],
              [
                121.77903001188729,
                -14.199952154601505
              ],
              [
                121.8089029659569,
                -14.207365130799632
              ],
              [
                121.82587947113869,
                -14.211146592021715
              ],
              [
                121.84085692627785,
                -14.207984815493825
              ],
              [
                121.88179816468117,
                -14.188305924159433
              ],
              [
                121.88248481018898,
                -14.187432191672494
              ],
              [
                121.9011322320748,
                -14.177133699067976
              ],
              [
                121.91924250734336,
                -14.167064272084014
              ],
              [
                121.93323290956504,
                -14.158991764197767
              ],
              [
                121.9509140313912,
                -14.147090533424953
              ],
              [
                121.9624582589913,
                -14.136853311933026
              ],
              [
                121.96636355531699,
                -14.131984227829435
              ],
              [
                121.97383082521445,
                -14.119873489995332
              ],
              [
                121.97613201201284,
                -14.113782675528167
              ],
              [
                121.97819194853628,
                -14.100505548653684
              ],
              [
                121.97707614958608,
                -14.090266233299497
              ],
              [
                121.97445831358755,
                -14.079069057848765
              ],
              [
                121.97441539824331,
                -14.077430166282864
              ],
              [
                121.97411499083364,
                -14.076347874550237
              ],
              [
                121.968235588673,
                -14.065274903156674
              ],
              [
                121.96484527647817,
                -14.06381789331254
              ],
              [
                121.96107638596482,
                -14.051601249956763
              ],
              [
                121.96030390976853,
                -14.051601249956763
              ],
              [
                121.95796502350754,
                -14.049415601107553
              ],
              [
                121.95326579331345,
                -14.047937674347121
              ],
              [
                121.92000640152878,
                -14.134390719730586
              ],
              [
                121.8554617237944,
                -14.173340060195978
              ],
              [
                121.8170095753569,
                -14.183658851239132
              ],
              [
                121.76928771256394,
                -14.159691906066605
              ],
              [
                121.79091704606003,
                -14.073123572164228
              ],
              [
                121.783707268228,
                -14.046813610987897
              ],
              [
                121.77357924698777,
                -14.051309831315804
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                121.83626157257113,
                -13.941993475757169
              ],
              [
                121.82853681060824,
                -13.946699998074939
              ],
              [
                121.81931001159701,
                -13.952322708602068
              ],
              [
                121.81506139251742,
                -13.964109130905127
              ],
              [
                121.81282979461703,
                -13.974853824492264
              ],
              [
                121.81861206798611,
                -13.993571443299802
              ],
              [
                121.8239764860159,
                -13.99910972796703
              ],
              [
                121.84062763958035,
                -14.00777083789925
              ],
              [
                121.84582039623318,
                -14.010019341889647
              ],
              [
                121.84895321636257,
                -14.010227535589939
              ],
              [
                121.85015484600125,
                -14.012934036515583
              ],
              [
                121.85633465557156,
                -14.019387871492631
              ],
              [
                121.85924811980394,
                -14.0220470825783
              ],
              [
                121.86959071776536,
                -14.025336348582353
              ],
              [
                121.87989040038255,
                -14.027376502529393
              ],
              [
                121.89079089781907,
                -14.021755626353974
              ],
              [
                121.899951713888,
                -14.01531081032055
              ],
              [
                121.90093876680548,
                -14.013770206578238
              ],
              [
                121.911839264242,
                -14.006191951195406
              ],
              [
                121.91437126955206,
                -14.006358508946477
              ],
              [
                121.91480042299445,
                -14.00544243982103
              ],
              [
                121.93046452364142,
                -13.994366042246652
              ],
              [
                121.94203214759453,
                -13.981998155723158
              ],
              [
                121.94529371375664,
                -13.967797169937494
              ],
              [
                121.94319086188897,
                -13.95900961116429
              ],
              [
                121.94078760261162,
                -13.95184604524225
              ],
              [
                121.93988638038262,
                -13.950305016510649
              ],
              [
                121.93769769782647,
                -13.948555728176247
              ],
              [
                121.9351656925164,
                -13.946639825732658
              ],
              [
                121.92726926917656,
                -13.940808720407352
              ],
              [
                121.92151861304863,
                -13.937434942193033
              ],
              [
                121.91765623206719,
                -13.933186410607586
              ],
              [
                121.91804247016533,
                -13.932311703225412
              ],
              [
                121.91709833259209,
                -13.931312033589377
              ],
              [
                121.9172270786248,
                -13.930770544063384
              ],
              [
                121.91611127967461,
                -13.929979134011239
              ],
              [
                121.91538171882256,
                -13.928021423812446
              ],
              [
                121.91392259711846,
                -13.92710504312578
              ],
              [
                121.90885858649834,
                -13.91994048703543
              ],
              [
                121.90525585472743,
                -13.92087071393246
              ],
              [
                121.9033246642367,
                -13.919683546979485
              ],
              [
                121.90042787850062,
                -13.914580742419481
              ],
              [
                121.9045477515475,
                -13.91249793268901
              ],
              [
                121.90046630493929,
                -13.903221445152127
              ],
              [
                121.8947585641556,
                -13.893473255705496
              ],
              [
                121.88518844239046,
                -13.882901420438207
              ],
              [
                121.87175593964388,
                -13.877568660648015
              ],
              [
                121.85617766968538,
                -13.880110069283134
              ],
              [
                121.84494071702333,
                -13.88300807802977
              ],
              [
                121.84249454240175,
                -13.886028530698812
              ],
              [
                121.84039169053408,
                -13.89629777528808
              ],
              [
                121.84003771368633,
                -13.90292247057892
              ],
              [
                121.84355677191387,
                -13.92016828374217
              ],
              [
                121.84149683539043,
                -13.933247583745674
              ],
              [
                121.8386644226707,
                -13.939412092560758
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                121.99529448152809,
                -13.62632523814775
              ],
              [
                121.99096003176003,
                -13.628952789741481
              ],
              [
                121.98289194704323,
                -13.642548859707482
              ],
              [
                121.97864332796364,
                -13.650389182158994
              ],
              [
                121.97641400201096,
                -13.656684066043704
              ],
              [
                121.97607067925705,
                -13.663773305759047
              ],
              [
                121.97927762629023,
                -13.67458619828395
              ],
              [
                121.98528577448359,
                -13.683759770765665
              ],
              [
                121.98863317133417,
                -13.687178919948026
              ],
              [
                121.99670125605097,
                -13.691848897080732
              ],
              [
                122.00708676935663,
                -13.698603521360656
              ],
              [
                122.01093832042875,
                -13.69953171565057
              ],
              [
                122.01574483898344,
                -13.698531046768549
              ],
              [
                122.02218214061918,
                -13.697863931813911
              ],
              [
                122.0275894739932,
                -13.697572068425924
              ],
              [
                122.04329648998441,
                -13.695945965773912
              ],
              [
                122.05093542125883,
                -13.692610335394495
              ],
              [
                122.05464708256969,
                -13.686003984564845
              ],
              [
                122.04778062749156,
                -13.67241042006451
              ],
              [
                122.03675138402232,
                -13.659470229919595
              ],
              [
                122.03185903477916,
                -13.650754446097316
              ],
              [
                122.02709543156871,
                -13.642747317838223
              ],
              [
                122.02700960088023,
                -13.641079131925906
              ],
              [
                122.02602254796275,
                -13.639786279736386
              ],
              [
                122.02241765904674,
                -13.637867840861109
              ],
              [
                122.02138769078502,
                -13.635949386400641
              ],
              [
                122.02018606114635,
                -13.63353044334822
              ],
              [
                122.01636659550914,
                -13.631445127732457
              ],
              [
                122.01040136266002,
                -13.628859310807604
              ],
              [
                121.99988710332164,
                -13.625439315932828
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                122.98403184040752,
                -12.269460679807587
              ],
              [
                123.01724831684795,
                -12.293446472466906
              ],
              [
                123.0414956958572,
                -12.290847784466727
              ],
              [
                123.06591431721417,
                -12.288917853872361
              ],
              [
                123.09638421162335,
                -12.286988974124993
              ],
              [
                123.10196319938167,
                -12.289882559966767
              ],
              [
                123.11097550540721,
                -12.290260034949394
              ],
              [
                123.12071733046469,
                -12.288331056493472
              ],
              [
                123.12899987324444,
                -12.287995347931776
              ],
              [
                123.13440750801337,
                -12.290091734189259
              ],
              [
                123.13745453643735,
                -12.289294820478473
              ],
              [
                123.13811966301397,
                -12.281516227551247
              ],
              [
                123.13630641494579,
                -12.276201251899678
              ],
              [
                123.13943383645115,
                -12.271866425905506
              ],
              [
                123.1417699751821,
                -12.273557017570308
              ],
              [
                123.14608018025127,
                -12.265015520212742
              ],
              [
                123.15181524730578,
                -12.253791559253028
              ],
              [
                123.1541676894879,
                -12.249269976498999
              ],
              [
                123.15591935343068,
                -12.244245175085
              ],
              [
                123.14875226379914,
                -12.232501687315048
              ],
              [
                123.14656380838673,
                -12.218577184581138
              ],
              [
                123.14300144703543,
                -12.210146134751499
              ],
              [
                123.13583457160419,
                -12.195674969964893
              ],
              [
                123.12888268656056,
                -12.191396598022868
              ],
              [
                123.11497806984146,
                -12.188460471902482
              ],
              [
                123.10553673929493,
                -12.191396598022868
              ],
              [
                123.08056000894825,
                -12.203644985326793
              ],
              [
                123.0635655326299,
                -12.181077312094514
              ],
              [
                123.04948929971974,
                -12.196514143746363
              ],
              [
                123.03266648477833,
                -12.201653075023625
              ],
              [
                123.03052071756642,
                -12.202995339716232
              ],
              [
                123.02846078104298,
                -12.206686532554382
              ],
              [
                123.01515702432911,
                -12.20970656115969
              ],
              [
                123.01610116190236,
                -12.21255877877075
              ],
              [
                122.99129609293263,
                -12.228245426143218
              ],
              [
                122.9829705161504,
                -12.222960723713669
              ],
              [
                122.97447837837842,
                -12.225684479924785
              ],
              [
                122.97241844185498,
                -12.225516711592046
              ],
              [
                122.93997444161084,
                -12.233569471473944
              ],
              [
                122.93388046272901,
                -12.236002027768171
              ],
              [
                122.9306188965669,
                -12.242460775441783
              ],
              [
                122.93576873787549,
                -12.249674254919293
              ],
              [
                122.94392265328077,
                -12.255377796783936
              ],
              [
                122.96280540474561,
                -12.262339305744597
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                123.32885219768488,
                -11.983136934874077
              ],
              [
                123.33889438823664,
                -11.984984055825112
              ],
              [
                123.35305645183527,
                -11.9840604969296
              ],
              [
                123.37185337261164,
                -11.982885053765077
              ],
              [
                123.38180973247492,
                -11.982297330263458
              ],
              [
                123.38704540447199,
                -11.979022847333475
              ],
              [
                123.38831252565011,
                -11.975872080252588
              ],
              [
                123.3876258801423,
                -11.973898952195922
              ],
              [
                123.38681048860177,
                -11.972261664782977
              ],
              [
                123.38556594361886,
                -11.970771304794171
              ],
              [
                123.3834845494233,
                -11.968588227437785
              ],
              [
                123.38127440919503,
                -11.968819130684393
              ],
              [
                123.38030881394967,
                -11.96697189918833
              ],
              [
                123.37979382981881,
                -11.965943321633931
              ],
              [
                123.37831325044259,
                -11.965523492936041
              ],
              [
                123.37666100968941,
                -11.964935731663745
              ],
              [
                123.3750731419526,
                -11.964452926805635
              ],
              [
                123.36858620507533,
                -11.9682733590563
              ],
              [
                123.35461726052577,
                -11.972261664782977
              ],
              [
                123.35639824731166,
                -11.969469856954461
              ],
              [
                123.35401644570643,
                -11.968672192277554
              ],
              [
                123.35223545892055,
                -11.96919697193519
              ],
              [
                123.34225764138515,
                -11.971715900107197
              ],
              [
                123.33476891381557,
                -11.973395172510266
              ],
              [
                123.33414664132411,
                -11.974087869335854
              ],
              [
                123.32547774178798,
                -11.975389294932205
              ],
              [
                123.32311162091446,
                -11.977005572830896
              ],
              [
                123.32366952038956,
                -11.980427012316497
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                123.55313690061399,
                -12.525575265937889
              ],
              [
                123.54330928678343,
                -12.526287461745483
              ],
              [
                123.53828819150755,
                -12.53068627460955
              ],
              [
                123.53691490049192,
                -12.536760702308124
              ],
              [
                123.53773029203245,
                -12.539818808268384
              ],
              [
                123.53966148252317,
                -12.542039054232433
              ],
              [
                123.54318054075071,
                -12.543672807906868
              ],
              [
                123.54549796933958,
                -12.543589025919283
              ],
              [
                123.54996116514036,
                -12.543924153706083
              ],
              [
                123.55120571012327,
                -12.54425928105673
              ],
              [
                123.55172069425413,
                -12.543714698890442
              ],
              [
                123.55378063077757,
                -12.543630916916484
              ],
              [
                123.55832965726682,
                -12.542416075231055
              ],
              [
                123.56880100126097,
                -12.540028266252353
              ],
              [
                123.57800010879704,
                -12.53504312002893
              ],
              [
                123.58134750564763,
                -12.529638945020393
              ],
              [
                123.57602600296208,
                -12.52746048584683
              ],
              [
                123.56722835739323,
                -12.525868523273322
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                123.55521581175083,
                -14.108842581083513
              ],
              [
                123.55352065565341,
                -14.105575326645635
              ],
              [
                123.55090281965488,
                -14.103306950486827
              ],
              [
                123.54725501539463,
                -14.101454773403585
              ],
              [
                123.54465863706821,
                -14.1007888184164
              ],
              [
                123.54227683546299,
                -14.100996929558766
              ],
              [
                123.54019544126743,
                -14.102099915443157
              ],
              [
                123.53839299680942,
                -14.1036191136825
              ],
              [
                123.53809258939975,
                -14.104451546781869
              ],
              [
                123.53768272865021,
                -14.107043144195687
              ],
              [
                123.53672779210397,
                -14.109082551684317
              ],
              [
                123.53670094368849,
                -14.110185514913885
              ],
              [
                123.53690210582982,
                -14.111361308062024
              ],
              [
                123.5370670714203,
                -14.112448649401136
              ],
              [
                123.53751434473664,
                -14.113575001195509
              ],
              [
                123.538875248793,
                -14.11478328135615
              ],
              [
                123.54065004766775,
                -14.116240599452594
              ],
              [
                123.54319735038483,
                -14.117697898270093
              ],
              [
                123.54562206733429,
                -14.118176518108019
              ],
              [
                123.55094357001984,
                -14.11957075277394
              ],
              [
                123.55274601447785,
                -14.11880080334188
              ],
              [
                123.55478449332917,
                -14.116366081255126
              ],
              [
                123.5554925965091,
                -14.113723233813541
              ],
              [
                123.55596466529572,
                -14.110435239091077
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                125.71947433209338,
                -13.958349281901514
              ],
              [
                125.72067596173206,
                -13.975341084791815
              ],
              [
                125.72513915753284,
                -13.990166241342234
              ],
              [
                125.73475219464221,
                -14.003491409202336
              ],
              [
                125.74728347515979,
                -14.01198580037719
              ],
              [
                125.75964309430042,
                -14.015816501431928
              ],
              [
                125.77629424786487,
                -14.02014678216268
              ],
              [
                125.79689361309924,
                -14.02797438993412
              ],
              [
                125.80676414227405,
                -14.032221171719721
              ],
              [
                125.81182815289417,
                -14.036800946263716
              ],
              [
                125.81466056561389,
                -14.03763362271254
              ],
              [
                125.8208403751842,
                -14.042296554908015
              ],
              [
                125.82556106305042,
                -14.046709599743464
              ],
              [
                125.85148193097034,
                -14.023477711733854
              ],
              [
                125.83483077740588,
                -14.003907808248735
              ],
              [
                125.79071380352893,
                -13.950852499980469
              ],
              [
                125.79517699932971,
                -13.91903011490841
              ],
              [
                125.80118712446169,
                -13.913529643470024
              ],
              [
                125.80256041547732,
                -13.903032043822767
              ],
              [
                125.81165846845583,
                -13.869036551176725
              ],
              [
                125.82659300825075,
                -13.855870291466625
              ],
              [
                125.82845960551619,
                -13.83984916066733
              ],
              [
                125.82767641893248,
                -13.836833283352805
              ],
              [
                125.82946814408217,
                -13.83573421979374
              ],
              [
                125.83124911499812,
                -13.832536013859007
              ],
              [
                125.82966123515486,
                -13.830473349480409
              ],
              [
                125.82867418223738,
                -13.82547276238378
              ],
              [
                125.82282672746231,
                -13.818023686365125
              ],
              [
                125.81946865043746,
                -13.810907911187295
              ],
              [
                125.81618581706404,
                -13.811262174571928
              ],
              [
                125.8115509598863,
                -13.814762810393075
              ],
              [
                125.8044995329296,
                -13.807652284087725
              ],
              [
                125.78441515182608,
                -13.820821273434978
              ],
              [
                125.77720537399405,
                -13.829822432709694
              ],
              [
                125.76810732101553,
                -13.85432382431381
              ],
              [
                125.76398744796866,
                -13.860157108308039
              ],
              [
                125.75471773361319,
                -13.881155717009593
              ],
              [
                125.74561968063468,
                -13.900652722366177
              ],
              [
                125.73686495041007,
                -13.915815924879452
              ],
              [
                125.73171510910147,
                -13.926479559787085
              ],
              [
                125.72278871749991,
                -13.94397351967664
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                124.10382299847242,
                -15.918785794969498
              ],
              [
                124.0859702152693,
                -15.817071806981522
              ],
              [
                124.0310385746443,
                -15.827972187458093
              ],
              [
                124.03481512493727,
                -16.000647974115797
              ],
              [
                124.17283087200758,
                -16.044206117734397
              ],
              [
                124.29162054485914,
                -16.035297271256074
              ],
              [
                124.30226355023024,
                -16.0296877932723
              ],
              [
                124.37264471478102,
                -15.88510697861677
              ],
              [
                124.33281927532789,
                -15.838541691950345
              ],
              [
                124.22673254437086,
                -15.844486795177534
              ],
              [
                124.15669470257399,
                -15.874539913796248
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    outer = 
    /* color: #ef3dff */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[118.17062403776815, -17.45084971526682],
          [119.02755763151815, -18.14124675533064],
          [122.71896388151815, -13.726673468011827],
          [123.55392481901815, -14.472542073271828],
          [124.03732325651815, -14.046629732342849],
          [123.26828028776815, -13.213838336950676],
          [124.80636622526815, -11.475275595307592],
          [129.60423123885968, -10.12830564343977],
          [129.59585259552577, -9.368874063395277],
          [123.61984278776815, -10.936433881827663],
          [121.48849513151815, -13.27800259234443]]]),
    inner = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[120.98677765293615, -16.891338232004127],
          [122.23921905918615, -17.918686136314374],
          [124.61226593418615, -16.386076635784576],
          [126.15035187168615, -14.841317375944321],
          [127.16109405918615, -14.288389915330946],
          [129.90767609043615, -14.862555957219627],
          [131.24800812168615, -12.643069637710298],
          [132.98384796543615, -12.385662394017446],
          [135.88423859043615, -12.793104504917128],
          [134.82955109043615, -15.286885279551102],
          [140.32271515293615, -18.357182292973924],
          [140.91597687168615, -15.625732585548311],
          [138.93843780918615, -15.01116738037152],
          [137.46626984043615, -14.458668781396298],
          [138.27925812168615, -10.62016932130365],
          [134.87349640293615, -11.267357463993088],
          [133.62105499668615, -11.008652152384679],
          [133.00582062168615, -10.4257413762333],
          [129.97359405918615, -10.90079085372523],
          [129.68794952793615, -12.149482321501976],
          [128.54537140293615, -13.926120826322153],
          [126.45796905918615, -13.092905792744665],
          [125.55709015293615, -13.285443251877613],
          [122.94234405918615, -15.223290002478876]]]),
    mid_mask = /* color: #d63000 */ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                138.95421392366072,
                -15.517297537859836
              ],
              [
                138.46806890412947,
                -16.85458273026955
              ],
              [
                138.75920659944197,
                -16.975459552472827
              ],
              [
                139.26183111116072,
                -15.59932172361471
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                122.89314767388754,
                -12.225521784659392
              ],
              [
                122.91786691216879,
                -12.276686184128721
              ],
              [
                122.9431011345809,
                -12.26578312789007
              ],
              [
                122.92215844659262,
                -12.24179481682996
              ],
              [
                122.9262783196395,
                -12.234748884681588
              ],
              [
                122.97365685967856,
                -12.219985370080801
              ],
              [
                122.96850701836996,
                -12.20706661890133
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                122.38795513652765,
                -16.882147565441134
              ],
              [
                122.11879009746515,
                -17.11197581332371
              ],
              [
                122.0611118748089,
                -17.507925104918197
              ],
              [
                122.17921490215265,
                -17.514473355798813
              ],
              [
                122.65643353008234,
                -17.028613584839665
              ],
              [
                122.92092114890643,
                -16.83549097865235
              ],
              [
                122.83989697898456,
                -16.609274212648568
              ],
              [
                122.78410223586455,
                -16.578883752237832
              ],
              [
                122.7793811000615,
                -16.582111958662487
              ],
              [
                122.77568975540831,
                -16.586985299863162
              ],
              [
                122.75818616355487,
                -16.55399459332653
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                123.08961193278267,
                -16.67545425940004
              ],
              [
                123.12905086073526,
                -16.673398752285234
              ],
              [
                123.13776294901803,
                -16.67923639365902
              ],
              [
                123.14205448344185,
                -16.687869245940668
              ],
              [
                123.14583103373482,
                -16.69230884672426
              ],
              [
                123.14986507609322,
                -16.70003679459735
              ],
              [
                123.14960758402779,
                -16.703736233437976
              ],
              [
                123.14763347819283,
                -16.70644910969991
              ],
              [
                123.14248363688424,
                -16.712039157391658
              ],
              [
                123.17715923502877,
                -16.71113489607133
              ],
              [
                123.1759576053901,
                -16.660571657356915
              ],
              [
                123.13355724528267,
                -16.658104815938014
              ],
              [
                123.08918377530031,
                -16.650335018852264
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                139.0686846562806,
                -17.143295961809102
              ],
              [
                139.2279864140931,
                -17.389839404376474
              ],
              [
                139.47929866995247,
                -17.438322304737
              ],
              [
                139.54521663870247,
                -17.349208699805782
              ],
              [
                139.34059627737435,
                -17.240378992341842
              ],
              [
                139.24034603323372,
                -17.15641826263108
              ],
              [
                139.20326717581185,
                -17.106548589200422
              ],
              [
                139.1840411015931,
                -17.052726850801545
              ],
              [
                139.1565752812806,
                -16.997576302696423
              ],
              [
                139.12773616995247,
                -16.968681439251384
              ],
              [
                139.06044491018685,
                -16.918761658948988
              ],
              [
                139.02611263479622,
                -16.879341956715933
              ],
              [
                138.97392757620247,
                -16.82545505566457
              ],
              [
                138.84071834768685,
                -16.805736503164674
              ],
              [
                138.80775936331185,
                -16.893796804141168
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                129.19283102654504,
                -14.448520331615068
              ],
              [
                129.32947348259972,
                -14.522315119655197
              ],
              [
                129.4537563195138,
                -14.45118002942905
              ],
              [
                129.3933315148263,
                -14.342106390179678
              ],
              [
                129.39676474236535,
                -14.292207430728691
              ],
              [
                129.40294455193566,
                -14.274241092751163
              ],
              [
                129.4001979699044,
                -14.254276813876707
              ],
              [
                129.41478645115717,
                -14.228766447138446
              ],
              [
                129.42405616551264,
                -14.227102489405556
              ],
              [
                129.42989265232904,
                -14.226436902881687
              ],
              [
                129.433669202622,
                -14.216785678042367
              ],
              [
                129.43744575291498,
                -14.210462238420018
              ],
              [
                129.44053565770014,
                -14.200810331968288
              ],
              [
                129.4432822397314,
                -14.191823704351927
              ],
              [
                129.4501486948095,
                -14.187163831164748
              ],
              [
                129.45941840916498,
                -14.183502435016614
              ],
              [
                129.46800147801264,
                -14.173849379936595
              ],
              [
                129.49546729832514,
                -14.098883929391574
              ],
              [
                129.49512397557123,
                -14.09305669167015
              ],
              [
                129.47812949925287,
                -14.078071683006225
              ],
              [
                129.47194968968256,
                -14.056424935515095
              ],
              [
                129.4685164621435,
                -14.052261864596526
              ],
              [
                129.46765815525873,
                -14.046433438117841
              ],
              [
                129.46800147801264,
                -14.040438330410582
              ],
              [
                129.47315131932123,
                -14.037440717724426
              ],
              [
                129.48053275853022,
                -14.036108432832625
              ],
              [
                129.49816039846843,
                -14.035580161184056
              ],
              [
                129.5209913616032,
                -14.032082868436444
              ],
              [
                129.53626922415202,
                -14.036246306133561
              ],
              [
                129.53953079031413,
                -14.053398871498818
              ],
              [
                129.5433073406071,
                -14.070550151591217
              ],
              [
                129.54450897024577,
                -14.079708075233967
              ],
              [
                129.54468063162273,
                -14.090530602591093
              ],
              [
                129.5429640178532,
                -14.105514793327316
              ],
              [
                129.53901580618327,
                -14.107512611050655
              ],
              [
                129.5355825786442,
                -14.11650257412163
              ],
              [
                129.53678420828288,
                -14.121163896815183
              ],
              [
                129.5348959331364,
                -14.123660994730695
              ],
              [
                129.53111938284343,
                -14.130153321144354
              ],
              [
                129.5352392558903,
                -14.13198445665312
              ],
              [
                129.53970245169108,
                -14.13165152402015
              ],
              [
                129.55189040945476,
                -14.123993939050552
              ],
              [
                129.5520620708317,
                -14.11733496016967
              ],
              [
                129.55635360525554,
                -14.092029065946596
              ],
              [
                129.55995849417155,
                -14.085369153522205
              ],
              [
                129.5623617534489,
                -14.080540595546614
              ],
              [
                129.56630996511882,
                -14.078209531025797
              ],
              [
                129.56957153128093,
                -14.076710976988634
              ],
              [
                129.5733480815739,
                -14.0762114567922
              ],
              [
                129.5759230022282,
                -14.075212413123433
              ],
              [
                129.5791845683903,
                -14.074379873396438
              ],
              [
                129.58553603933757,
                -14.073713839431141
              ],
              [
                129.5894842510075,
                -14.074879397596595
              ],
              [
                129.59188751028483,
                -14.078376036423235
              ],
              [
                129.59514907644694,
                -14.077043989846276
              ],
              [
                129.59635070608562,
                -14.070050617929637
              ],
              [
                129.59995559500163,
                -14.066220823597135
              ],
              [
                129.60390380667155,
                -14.062390965122944
              ],
              [
                129.60733703421062,
                -14.05689583878675
              ],
              [
                129.60733703421062,
                -14.053731918304454
              ],
              [
                129.6066503887028,
                -14.048902692197016
              ],
              [
                129.60476211355632,
                -14.045239073410391
              ],
              [
                129.6008139018864,
                -14.042574586573192
              ],
              [
                129.59583572195476,
                -14.04157539601876
              ],
              [
                129.583991086945,
                -14.033748252589975
              ],
              [
                129.583991086945,
                -14.021757216707124
              ],
              [
                129.59102920340007,
                -14.002437007494237
              ],
              [
                129.59806731985515,
                -14.002603567967762
              ],
              [
                129.60287383840983,
                -14.005268519121762
              ],
              [
                129.60527709768718,
                -14.011930761734694
              ],
              [
                129.60819534109538,
                -14.01742696636539
              ],
              [
                129.60871032522624,
                -14.023089584986517
              ],
              [
                129.6121435527653,
                -14.025254666936112
              ],
              [
                129.6176367168278,
                -14.02692010068326
              ],
              [
                129.62175658987468,
                -14.02608738532134
              ],
              [
                129.62724975393718,
                -14.032249407396236
              ],
              [
                129.63857940481608,
                -14.033914790339898
              ],
              [
                129.6483641033024,
                -14.033748252589975
              ],
              [
                129.65145400808757,
                -14.030584012354405
              ],
              [
                129.65814880178874,
                -14.029418228627398
              ],
              [
                129.67119506643718,
                -14.024755034453845
              ],
              [
                129.68218139456218,
                -14.016760766752684
              ],
              [
                129.69557098196452,
                -13.998772646530291
              ],
              [
                129.70724395559733,
                -13.987446070583745
              ],
              [
                129.71548370169108,
                -13.976452095808359
              ],
              [
                129.7213201885075,
                -13.964791245771252
              ],
              [
                129.7271566753239,
                -13.955128951478256
              ],
              [
                129.72990325735515,
                -13.945466252258857
              ],
              [
                129.73196319387858,
                -13.935469930677545
              ],
              [
                129.73196319387858,
                -13.920141397144766
              ],
              [
                129.7189730225054,
                -13.903170272967408
              ],
              [
                129.71141992191946,
                -13.893505400981974
              ],
              [
                129.7086733398882,
                -13.88350683317169
              ],
              [
                129.71073327641164,
                -13.872841218806682
              ],
              [
                129.7134798584429,
                -13.846841730140225
              ],
              [
                129.73270593266164,
                -13.823839757918822
              ],
              [
                129.75770358011434,
                -13.799551173909714
              ],
              [
                129.76127428186675,
                -13.76073302298954
              ],
              [
                129.78022726013472,
                -13.742658131313677
              ],
              [
                129.77597122510056,
                -13.71761287550173
              ],
              [
                129.78133114939456,
                -13.686557335065519
              ],
              [
                129.7868402367535,
                -13.654364313633819
              ],
              [
                129.79476462191366,
                -13.648276775412508
              ],
              [
                129.7935812619977,
                -13.63556162250807
              ],
              [
                129.2059222138477,
                -13.712574666571781
              ],
              [
                129.0782061493946,
                -14.25759955242258
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                130.45686333761068,
                -11.365832373370504
              ],
              [
                130.3877500240231,
                -11.3456362698991
              ],
              [
                130.34586464804653,
                -11.354724693381426
              ],
              [
                130.19826534134927,
                -11.63888644295029
              ],
              [
                130.20169856888833,
                -11.654690380225233
              ],
              [
                130.19345882279458,
                -11.72698717757588
              ],
              [
                130.62535884720864,
                -11.768667450185927
              ],
              [
                130.6555712495524,
                -11.737071692554487
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                123.74470137933088,
                -16.142283968727348
              ],
              [
                123.7486495910008,
                -16.14195418146066
              ],
              [
                123.75646018365217,
                -16.144922247081325
              ],
              [
                123.77190970757795,
                -16.145416920357736
              ],
              [
                123.77534293511701,
                -16.148467378240426
              ],
              [
                123.78135108331037,
                -16.14574670185514
              ],
              [
                123.78246688226056,
                -16.137501999592097
              ],
              [
                123.78281020501447,
                -16.125793932576325
              ],
              [
                123.77474212029767,
                -16.127525450873332
              ],
              [
                123.7555555328687,
                -16.123472938305145
              ],
              [
                123.73680152743657,
                -16.118030861447167
              ],
              [
                123.73233833163579,
                -16.118443145227108
              ],
              [
                123.73053588717778,
                -16.117206291315412
              ],
              [
                123.71658840030034,
                -16.118772971633803
              ],
              [
                123.72525729983647,
                -16.123472938305145
              ],
              [
                123.72748809326299,
                -16.126982937007096
              ],
              [
                123.72881846893438,
                -16.129332836928366
              ],
              [
                123.73100715149053,
                -16.13092003426305
              ],
              [
                123.73407559860357,
                -16.132321704452426
              ],
              [
                123.73628573883184,
                -16.134650928566785
              ],
              [
                123.73956876266607,
                -16.136547267793443
              ],
              [
                123.74270158279546,
                -16.138299304200746
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                123.60239866986512,
                -16.096340761352298
              ],
              [
                123.60520962491273,
                -16.097804524904966
              ],
              [
                123.60673311963319,
                -16.098773489207527
              ],
              [
                123.60795620694398,
                -16.09947443915918
              ],
              [
                123.60890034451722,
                -16.100175386635755
              ],
              [
                123.61158255353212,
                -16.100525859445867
              ],
              [
                123.61308459058046,
                -16.10025785088204
              ],
              [
                123.61748341336488,
                -16.092794697870893
              ],
              [
                123.61259106412172,
                -16.0909391743032
              ],
              [
                123.60319260373353,
                -16.094402804273344
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                124.17669526197406,
                -16.278179354651876
              ],
              [
                124.15924829536186,
                -16.28407751200753
              ],
              [
                124.1443771138853,
                -16.275639083652315
              ],
              [
                124.13557828627859,
                -16.269636888140575
              ],
              [
                124.13034131107182,
                -16.262246095590026
              ],
              [
                124.12089796068567,
                -16.261964969454464
              ],
              [
                124.1064750137258,
                -16.264037216478872
              ],
              [
                124.0872435291795,
                -16.26290491469641
              ],
              [
                124.07075525857273,
                -16.25898890395233
              ],
              [
                124.05220295290701,
                -16.248186181871723
              ],
              [
                124.02746059465974,
                -16.247667417431053
              ],
              [
                123.98931014747862,
                -16.245955965021274
              ],
              [
                123.97309752690772,
                -16.23807570728294
              ],
              [
                123.94017030669687,
                -16.226469200094375
              ],
              [
                123.9278456587051,
                -16.20711366387292
              ],
              [
                123.90491499165888,
                -16.205321927832234
              ],
              [
                123.9167288597502,
                -16.220530454293133
              ],
              [
                123.92730909090675,
                -16.22787122778139
              ],
              [
                123.96117125381163,
                -16.24815757543942
              ],
              [
                123.96744091439109,
                -16.257415480931865
              ],
              [
                124.15455094434708,
                -16.321182174517997
              ],
              [
                124.20364609815567,
                -16.37784578319699
              ],
              [
                124.26681748487442,
                -16.406171416446814
              ],
              [
                124.30835953809708,
                -16.29086699161242
              ],
              [
                124.20227280714005,
                -16.244726198616053
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                124.08330408275539,
                -16.107962087138734
              ],
              [
                124.09420458019191,
                -16.109281459196943
              ],
              [
                124.09901109874659,
                -16.09864377221666
              ],
              [
                124.08459154308252,
                -16.093530882605304
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    not_deep_water = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                118.94398658299858,
                -17.505508014499394
              ],
              [
                118.94134729021927,
                -17.507042801888687
              ],
              [
                118.94057481428378,
                -17.507677176888595
              ],
              [
                118.93984525367812,
                -17.50827062246334
              ],
              [
                118.93793552150447,
                -17.50998955732359
              ],
              [
                118.93705575724482,
                -17.510542068644856
              ],
              [
                118.93440437886767,
                -17.51429834862424
              ],
              [
                118.93273068100761,
                -17.517470074733072
              ],
              [
                118.93236590070498,
                -17.517510999869046
              ],
              [
                118.93228007004548,
                -17.517777013028518
              ],
              [
                118.93187237441305,
                -17.518063488302676
              ],
              [
                118.9313359327914,
                -17.518431812990812
              ],
              [
                118.93120718680207,
                -17.519475395548668
              ],
              [
                118.92830375200651,
                -17.524214818339384
              ],
              [
                118.9257073745583,
                -17.52842990221335
              ],
              [
                118.92459157598567,
                -17.529064202474036
              ],
              [
                118.92433408400734,
                -17.530844323616662
              ],
              [
                118.92424825334786,
                -17.532747192415016
              ],
              [
                118.9226818438134,
                -17.538087394975495
              ],
              [
                118.92216685985696,
                -17.539110404334572
              ],
              [
                118.92075065397681,
                -17.54267043190167
              ],
              [
                118.91946319408584,
                -17.544143526304396
              ],
              [
                118.91877654881107,
                -17.549462934175715
              ],
              [
                118.91199592672149,
                -17.560672050165056
              ],
              [
                118.90873436166659,
                -17.56509085825812
              ],
              [
                118.905344050624,
                -17.571718868125586
              ],
              [
                118.90332703013004,
                -17.573887238400562
              ],
              [
                118.90285496150473,
                -17.576587436746895
              ],
              [
                118.89895006874477,
                -17.579726295275247
              ],
              [
                118.89961541349474,
                -17.581377543560222
              ],
              [
                118.89917561243186,
                -17.582469090200814
              ],
              [
                118.89925611665299,
                -17.58301486490909
              ],
              [
                118.89899596127665,
                -17.583492304477485
              ],
              [
                118.89903754419421,
                -17.583894665295983
              ],
              [
                118.89890746502499,
                -17.584787947200947
              ],
              [
                118.89849981235228,
                -17.5855266766201
              ],
              [
                118.89895046666248,
                -17.586429045110208
              ],
              [
                118.89843552204813,
                -17.587310958599137
              ],
              [
                118.89755577456901,
                -17.58754736796352
              ],
              [
                118.8972339234345,
                -17.58823377775644
              ],
              [
                118.89644000402005,
                -17.589115721133265
              ],
              [
                118.89586065289177,
                -17.59044766047817
              ],
              [
                118.89494065874003,
                -17.592286284397634
              ],
              [
                118.8949218810951,
                -17.592611298877344
              ],
              [
                118.89462683076098,
                -17.592974971222276
              ],
              [
                118.8944658792382,
                -17.59378413558441
              ],
              [
                118.89675108266185,
                -17.596740997333136
              ],
              [
                118.89656334203836,
                -17.599119404439914
              ],
              [
                118.89724194155218,
                -17.6002881694256
              ],
              [
                118.89629378462936,
                -17.601322529400036
              ],
              [
                118.895884070333,
                -17.60220786739752
              ],
              [
                118.89675209338714,
                -17.603693637099415
              ],
              [
                118.89727193739184,
                -17.605622780222486
              ],
              [
                118.89686667201639,
                -17.60655666899314
              ],
              [
                118.89593447540446,
                -17.60681908740728
              ],
              [
                118.89513102150154,
                -17.607245121819894
              ],
              [
                118.89294229478067,
                -17.608174870787785
              ],
              [
                118.89289931644551,
                -17.610290846500526
              ],
              [
                118.89266864272192,
                -17.612086152010118
              ],
              [
                118.89372543654315,
                -17.613636034055503
              ],
              [
                118.89297441827605,
                -17.616264058516553
              ],
              [
                118.89273838396363,
                -17.617255948850357
              ],
              [
                118.89286712995278,
                -17.617603620460162
              ],
              [
                118.89303879127144,
                -17.61775700478086
              ],
              [
                118.89298514710953,
                -17.61796151700576
              ],
              [
                118.89310316426612,
                -17.61816602899876
              ],
              [
                118.89310316426648,
                -17.618738661346047
              ],
              [
                118.89346240518333,
                -17.61907231604025
              ],
              [
                118.89346240518356,
                -17.619450660715707
              ],
              [
                118.89415977929022,
                -17.619644945510583
              ],
              [
                118.89419196578761,
                -17.619859681093477
              ],
              [
                118.89449237309513,
                -17.61999261251656
              ],
              [
                118.89526411235953,
                -17.62075640820095
              ],
              [
                118.89544650251135,
                -17.622351570884952
              ],
              [
                118.89663740290858,
                -17.62218796510442
              ],
              [
                118.89673396240109,
                -17.6237831151285
              ],
              [
                118.8977102861503,
                -17.623885367853568
              ],
              [
                118.89891191538109,
                -17.626160476000692
              ],
              [
                118.89899238162442,
                -17.626743308076414
              ],
              [
                118.89892800862998,
                -17.626814883815513
              ],
              [
                118.8989548307112,
                -17.627172762084758
              ],
              [
                118.89943226375338,
                -17.627331250805426
              ],
              [
                118.89996334095751,
                -17.627280125426584
              ],
              [
                118.90012427344448,
                -17.629176867265883
              ],
              [
                118.90488787503583,
                -17.636620491462487
              ],
              [
                118.91319199131908,
                -17.64596548543999
              ],
              [
                118.91840620386726,
                -17.64966654159266
              ],
              [
                118.91842766153219,
                -17.650832051815406
              ],
              [
                118.92606659020194,
                -17.65543267639499
              ],
              [
                118.93037958082697,
                -17.65643457460292
              ],
              [
                118.93246097431258,
                -17.65686395784224
              ],
              [
                118.93295450060305,
                -17.656741277021425
              ],
              [
                118.93381280719528,
                -17.655718933595733
              ],
              [
                118.93973512268114,
                -17.653817359381915
              ],
              [
                118.9513651770081,
                -17.646865196702144
              ],
              [
                118.95810288376147,
                -17.640648918115357
              ],
              [
                118.96389645326916,
                -17.629401816467823
              ],
              [
                118.96355313063307,
                -17.628297517745494
              ],
              [
                118.97149246662853,
                -17.613859212356356
              ],
              [
                118.97672813685767,
                -17.602037756640495
              ],
              [
                118.97608440691927,
                -17.59626991428835
              ],
              [
                118.97393864044207,
                -17.590992790822025
              ],
              [
                118.97213619660589,
                -17.581542673085412
              ],
              [
                118.97080582139797,
                -17.569555449593576
              ],
              [
                118.97011917612974,
                -17.562681871049715
              ],
              [
                118.9721361966422,
                -17.545660458215057
              ],
              [
                118.96921795423091,
                -17.536903627722413
              ],
              [
                118.9691750389076,
                -17.530192499389567
              ],
              [
                118.96938961555782,
                -17.528473755849333
              ],
              [
                118.96655720380373,
                -17.52047819413371
              ],
              [
                118.96192234820367,
                -17.508077658494205
              ],
              [
                118.95771664589252,
                -17.504271383650156
              ],
              [
                118.95166558440036,
                -17.503043536039975
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                119.34061014993645,
                -17.254288350541824
              ],
              [
                119.33822834833123,
                -17.260739972863185
              ],
              [
                119.33762753351189,
                -17.26592420184713
              ],
              [
                119.33582508905388,
                -17.26713315128029
              ],
              [
                119.3343874250219,
                -17.266989717016333
              ],
              [
                119.3320270810888,
                -17.266482676089698
              ],
              [
                119.33245623453118,
                -17.267712112398023
              ],
              [
                119.32936632974602,
                -17.275068068304584
              ],
              [
                119.32837927682854,
                -17.27525247568232
              ],
              [
                119.32769263132073,
                -17.277588286490115
              ],
              [
                119.32477438791253,
                -17.2802314051048
              ],
              [
                119.32213509424187,
                -17.290721548319173
              ],
              [
                119.32177031381585,
                -17.29488056070846
              ],
              [
                119.31728209165476,
                -17.30149790881065
              ],
              [
                119.31704605726145,
                -17.30668099044911
              ],
              [
                119.31615259797705,
                -17.3111385377848
              ],
              [
                119.31630280168189,
                -17.31476447150863
              ],
              [
                119.31756880433691,
                -17.323040346024197
              ],
              [
                119.31752588899268,
                -17.325334581870496
              ],
              [
                119.31853439958228,
                -17.327710724500594
              ],
              [
                119.31759026200903,
                -17.329574745906648
              ],
              [
                119.31823399217261,
                -17.334511238650546
              ],
              [
                119.31782629640234,
                -17.336863767174005
              ],
              [
                119.3175473466648,
                -17.349073509825132
              ],
              [
                119.31971457154883,
                -17.355975635792756
              ],
              [
                119.319564367844,
                -17.357040629123286
              ],
              [
                119.31992914827002,
                -17.359354920220984
              ],
              [
                119.32173159272803,
                -17.362222142998906
              ],
              [
                119.32645228059424,
                -17.369226169982525
              ],
              [
                119.32800796182288,
                -17.373550826566447
              ],
              [
                119.32805087716712,
                -17.374810264501303
              ],
              [
                119.32849075944556,
                -17.375864909116096
              ],
              [
                119.32880189569129,
                -17.37640758795859
              ],
              [
                119.33247859711281,
                -17.37928333402071
              ],
              [
                119.34296454439617,
                -17.388669029131275
              ],
              [
                119.3520840550468,
                -17.393644883317506
              ],
              [
                119.35826386461711,
                -17.39499632651233
              ],
              [
                119.36092461595989,
                -17.394361558982695
              ],
              [
                119.36223353395916,
                -17.394934897492856
              ],
              [
                119.36302746782756,
                -17.39470965757821
              ],
              [
                119.3676623250053,
                -17.390716722139683
              ],
              [
                119.37242592821575,
                -17.383426830600964
              ],
              [
                119.37783326158977,
                -17.373679218569542
              ],
              [
                119.37856282244182,
                -17.37060738455641
              ],
              [
                119.38182438860393,
                -17.36282517449639
              ],
              [
                119.38208188066936,
                -17.35958931618298
              ],
              [
                119.38299415783817,
                -17.35083409151861
              ],
              [
                119.38282249646122,
                -17.34391128999151
              ],
              [
                119.38277958111698,
                -17.336742433213754
              ],
              [
                119.38277958111698,
                -17.328139435467424
              ],
              [
                119.38217876629764,
                -17.322117097220488
              ],
              [
                119.3812346287244,
                -17.311628744378
              ],
              [
                119.37769751889849,
                -17.298959396650307
              ],
              [
                119.37550883634233,
                -17.291051221517392
              ],
              [
                119.37439303739214,
                -17.283511504990607
              ],
              [
                119.37404971463823,
                -17.279290768016082
              ],
              [
                119.37550883634233,
                -17.277569663041113
              ],
              [
                119.3746934448018,
                -17.276791062650542
              ],
              [
                119.37276225431108,
                -17.274332302971395
              ],
              [
                119.37091689450884,
                -17.271381748044284
              ],
              [
                119.36087470395708,
                -17.259783970270625
              ],
              [
                119.35533862455034,
                -17.25285774095087
              ],
              [
                119.34911589963579,
                -17.250849495652165
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                119.61415139722394,
                -17.032019757169802
              ],
              [
                119.61125066883933,
                -17.034386734469265
              ],
              [
                119.60767590744125,
                -17.036637095494264
              ],
              [
                119.60753434353632,
                -17.037410280537053
              ],
              [
                119.6011269977636,
                -17.050000292345885
              ],
              [
                119.60131343017052,
                -17.05211031623106
              ],
              [
                119.60149246485071,
                -17.05341151962585
              ],
              [
                119.60093825017756,
                -17.053446704386488
              ],
              [
                119.59943986552692,
                -17.059307874998204
              ],
              [
                119.59965444224814,
                -17.060251496786673
              ],
              [
                119.60012651103479,
                -17.060743819304832
              ],
              [
                119.59931111949419,
                -17.065995178711805
              ],
              [
                119.59952569621544,
                -17.072764291202283
              ],
              [
                119.59918237346147,
                -17.07636106094819
              ],
              [
                119.59853864329786,
                -17.078248127296142
              ],
              [
                119.59716535228213,
                -17.081365847253338
              ],
              [
                119.59656453746274,
                -17.08370410301163
              ],
              [
                119.59536290782401,
                -17.084647601417124
              ],
              [
                119.59519124644704,
                -17.08559109504749
              ],
              [
                119.59456897611005,
                -17.086216668914975
              ],
              [
                119.594118362841,
                -17.08708836861491
              ],
              [
                119.59374285687298,
                -17.088360012405186
              ],
              [
                119.59315276759556,
                -17.089631655052784
              ],
              [
                119.59279336662283,
                -17.09063804272848
              ],
              [
                119.59271290065269,
                -17.092075112486484
              ],
              [
                119.59291137650882,
                -17.092712288954864
              ],
              [
                119.59268069880893,
                -17.093390485210698
              ],
              [
                119.59257341506174,
                -17.09496973811745
              ],
              [
                119.59270215648104,
                -17.095585023114957
              ],
              [
                119.5915005268423,
                -17.09706170696775
              ],
              [
                119.59064221995745,
                -17.0980871749783
              ],
              [
                119.59064221995745,
                -17.099604857273007
              ],
              [
                119.59042764323628,
                -17.10075336538354
              ],
              [
                119.59064221995749,
                -17.101491688285886
              ],
              [
                119.59077096599019,
                -17.103173412858226
              ],
              [
                119.59094262736714,
                -17.10432189896006
              ],
              [
                119.59184384959623,
                -17.104896139354477
              ],
              [
                119.59519124644704,
                -17.107849347691527
              ],
              [
                119.59562039988946,
                -17.11638057524589
              ],
              [
                119.59750867503607,
                -17.129832870003593
              ],
              [
                119.60506177562254,
                -17.14394032848096
              ],
              [
                119.609954124866,
                -17.155340340638183
              ],
              [
                119.61999631541849,
                -17.161983190335114
              ],
              [
                119.63098264354421,
                -17.16239323499254
              ],
              [
                119.64900708812527,
                -17.158333752960495
              ],
              [
                119.65316996259202,
                -17.152859247777343
              ],
              [
                119.65664601940024,
                -17.14656485372921
              ],
              [
                119.65887761730072,
                -17.143202174071853
              ],
              [
                119.6597786645909,
                -17.134138379185632
              ],
              [
                119.65997186786983,
                -17.129668408608165
              ],
              [
                119.65956426280862,
                -17.12290177867304
              ],
              [
                119.66001486749646,
                -17.120092288608568
              ],
              [
                119.65943551677573,
                -17.1100232072251
              ],
              [
                119.65778311208274,
                -17.102127316196565
              ],
              [
                119.65646351922963,
                -17.09590275734019
              ],
              [
                119.6560022892366,
                -17.090416537457532
              ],
              [
                119.65454316753241,
                -17.086970800710553
              ],
              [
                119.65355611461513,
                -17.083401934783744
              ],
              [
                119.65308404582848,
                -17.08155594284074
              ],
              [
                119.65325570720543,
                -17.078766409230024
              ],
              [
                119.65239740032062,
                -17.074499982999086
              ],
              [
                119.65114941391644,
                -17.071036729630283
              ],
              [
                119.64930405411411,
                -17.06816498833883
              ],
              [
                119.64869250421707,
                -17.06615473736896
              ],
              [
                119.64786639008197,
                -17.064923970085534
              ],
              [
                119.6474694144574,
                -17.06393934073762
              ],
              [
                119.64750696485679,
                -17.06272906661997
              ],
              [
                119.64731116641057,
                -17.061611094704695
              ],
              [
                119.64677204880398,
                -17.06090338822132
              ],
              [
                119.64597811493557,
                -17.060329012314796
              ],
              [
                119.64563479218161,
                -17.059696951159538
              ],
              [
                119.64552750382101,
                -17.058507162847352
              ],
              [
                119.64490523132955,
                -17.057604559760215
              ],
              [
                119.64432587418229,
                -17.056927604581706
              ],
              [
                119.64400400910048,
                -17.055512144915003
              ],
              [
                119.64351048264167,
                -17.055122378775167
              ],
              [
                119.64327444824836,
                -17.05522494889082
              ],
              [
                119.64305987152717,
                -17.05497878051858
              ],
              [
                119.64278092178957,
                -17.054855696210808
              ],
              [
                119.64222302231447,
                -17.05497878051858
              ],
              [
                119.64185824188843,
                -17.054794154026485
              ],
              [
                119.64162220749508,
                -17.054383872279477
              ],
              [
                119.64037766251205,
                -17.0537684479691
              ],
              [
                119.63638543933433,
                -17.048835005065573
              ],
              [
                119.6371793732028,
                -17.047296394787043
              ],
              [
                119.63668584674404,
                -17.045039743461164
              ],
              [
                119.63675021976039,
                -17.044588409925858
              ],
              [
                119.63402509540113,
                -17.041757292888448
              ],
              [
                119.63398218005686,
                -17.040916155650635
              ],
              [
                119.63263034671323,
                -17.039562121902865
              ],
              [
                119.63138580173025,
                -17.036730928739644
              ],
              [
                119.6305060371733,
                -17.036689896639498
              ],
              [
                119.62840318530547,
                -17.03474086151088
              ],
              [
                119.62675094455219,
                -17.032976454296787
              ],
              [
                119.62469100802862,
                -17.032114761002752
              ],
              [
                119.6232318863244,
                -17.03125306373869
              ],
              [
                119.62074279635843,
                -17.030145161423114
              ],
              [
                119.61971282809667,
                -17.02928345508537
              ],
              [
                119.61700916140944,
                -17.029775859192995
              ],
              [
                119.61533546298404,
                -17.029981027188633
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                121.7428582703712,
                -14.087623118670262
              ],
              [
                121.74534735798217,
                -14.074053092352317
              ],
              [
                121.74122748865243,
                -14.069224299648473
              ],
              [
                121.73762260304382,
                -14.073220549208353
              ],
              [
                121.72895371152921,
                -14.090786567275547
              ],
              [
                121.72590056448722,
                -14.105116735287806
              ],
              [
                121.7206648974373,
                -14.126259435718676
              ],
              [
                121.71980659143988,
                -14.138910821536339
              ],
              [
                121.72014991398544,
                -14.151894406849342
              ],
              [
                121.72323981599368,
                -14.158385921339349
              ],
              [
                121.73268118313996,
                -14.166624884035976
              ],
              [
                121.73813142690425,
                -14.172450232759893
              ],
              [
                121.738431834044,
                -14.173240804278944
              ],
              [
                121.73993386972603,
                -14.174821939046577
              ],
              [
                121.74216546559113,
                -14.176444671160315
              ],
              [
                121.76027572433071,
                -14.190840709107917
              ],
              [
                121.77915845849877,
                -14.19974415922365
              ],
              [
                121.80903138514377,
                -14.20715713533327
              ],
              [
                121.82600787472676,
                -14.21093859653025
              ],
              [
                121.84098531609673,
                -14.20777681999538
              ],
              [
                121.88192651692485,
                -14.188097928714418
              ],
              [
                121.88261316180493,
                -14.18722419622928
              ],
              [
                121.9012605666194,
                -14.176925703685113
              ],
              [
                121.91937082533353,
                -14.166856276780853
              ],
              [
                121.93336121478535,
                -14.1587837689704
              ],
              [
                121.95104232050734,
                -14.14688253831112
              ],
              [
                121.96258653762834,
                -14.136645316904012
              ],
              [
                121.96649183042457,
                -14.131776232831019
              ],
              [
                121.97395909360564,
                -14.119665495058126
              ],
              [
                121.9762602783582,
                -14.113574680610533
              ],
              [
                121.97832021312432,
                -14.10029755375385
              ],
              [
                121.97720441528561,
                -14.090058238389986
              ],
              [
                121.97458658177327,
                -14.07886106291686
              ],
              [
                121.97454366648283,
                -14.077222171350595
              ],
              [
                121.97424325935637,
                -14.076139879615427
              ],
              [
                121.96836386264246,
                -14.065066908173272
              ],
              [
                121.96497355354329,
                -14.063609898302117
              ],
              [
                121.9632646030798,
                -14.06413206156641
              ],
              [
                121.96163382070058,
                -14.064964638607265
              ],
              [
                121.95895161382802,
                -14.067025255731133
              ],
              [
                121.95558276358545,
                -14.068211663402618
              ],
              [
                121.95199407212853,
                -14.070287050820461
              ],
              [
                121.94892013266936,
                -14.08310276386386
              ],
              [
                121.94036792810307,
                -14.104071981169776
              ],
              [
                121.93424906856897,
                -14.107716734524768
              ],
              [
                121.93281892842283,
                -14.1113353419546
              ],
              [
                121.93330545936705,
                -14.114476519526841
              ],
              [
                121.93354872904901,
                -14.120874940278318
              ],
              [
                121.9324186873416,
                -14.124942713799877
              ],
              [
                121.93127480712576,
                -14.129849637841604
              ],
              [
                121.93173361517256,
                -14.136334296629935
              ],
              [
                121.9226939908177,
                -14.14863805322178
              ],
              [
                121.90640182127434,
                -14.160649029065
              ],
              [
                121.88913167550162,
                -14.168347463891413
              ],
              [
                121.8811280279513,
                -14.171551844027961
              ],
              [
                121.85584759204552,
                -14.181120847198507
              ],
              [
                121.84037791109596,
                -14.187924413613803
              ],
              [
                121.82241758683426,
                -14.19439429338488
              ],
              [
                121.80675248329781,
                -14.192021752556736
              ],
              [
                121.7925467569084,
                -14.186344047276913
              ],
              [
                121.77636745377133,
                -14.177585532251062
              ],
              [
                121.76323636405793,
                -14.166724192281254
              ],
              [
                121.75594032687155,
                -14.153491797175127
              ],
              [
                121.75345119571085,
                -14.148331670600834
              ],
              [
                121.75379499682668,
                -14.141090893606739
              ],
              [
                121.74263701741327,
                -14.123445515240704
              ],
              [
                121.74074874386527,
                -14.104716613100555
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                121.83626157257113,
                -13.941993475757169
              ],
              [
                121.82853681060824,
                -13.946699998074939
              ],
              [
                121.81931001159701,
                -13.952322708602068
              ],
              [
                121.81506139251742,
                -13.964109130905127
              ],
              [
                121.81282979461703,
                -13.974853824492264
              ],
              [
                121.81861206798611,
                -13.993571443299802
              ],
              [
                121.8239764860159,
                -13.99910972796703
              ],
              [
                121.84062763958035,
                -14.00777083789925
              ],
              [
                121.84582039623318,
                -14.010019341889647
              ],
              [
                121.84556290066554,
                -14.011830615993752
              ],
              [
                121.8468503644949,
                -14.013142227572986
              ],
              [
                121.84807345255484,
                -14.01407909056813
              ],
              [
                121.85015484600125,
                -14.012934036515583
              ],
              [
                121.85633465557156,
                -14.019387871492631
              ],
              [
                121.85924811980394,
                -14.0220470825783
              ],
              [
                121.86959071776536,
                -14.025336348582353
              ],
              [
                121.87989040038255,
                -14.027376502529393
              ],
              [
                121.89079089781907,
                -14.021755626353974
              ],
              [
                121.899951713888,
                -14.01531081032055
              ],
              [
                121.90093876680548,
                -14.013770206578238
              ],
              [
                121.911839264242,
                -14.006191951195406
              ],
              [
                121.91437126955206,
                -14.006358508946477
              ],
              [
                121.91480042299445,
                -14.00544243982103
              ],
              [
                121.93046452364142,
                -13.994366042246652
              ],
              [
                121.94203214759453,
                -13.981998155723158
              ],
              [
                121.94529371375664,
                -13.967797169937494
              ],
              [
                121.94319086188897,
                -13.95900961116429
              ],
              [
                121.94078760261162,
                -13.95184604524225
              ],
              [
                121.93988638038262,
                -13.950305016510649
              ],
              [
                121.93769769782647,
                -13.948555728176247
              ],
              [
                121.9351656925164,
                -13.946639825732658
              ],
              [
                121.92726926917656,
                -13.940808720407352
              ],
              [
                121.92151861304863,
                -13.937434942193033
              ],
              [
                121.91765623206719,
                -13.933186410607586
              ],
              [
                121.91804247016533,
                -13.932311703225412
              ],
              [
                121.91709833259209,
                -13.931312033589377
              ],
              [
                121.9172270786248,
                -13.930770544063384
              ],
              [
                121.91611127967461,
                -13.929979134011239
              ],
              [
                121.91538171882256,
                -13.928021423812446
              ],
              [
                121.91392259711846,
                -13.92710504312578
              ],
              [
                121.90885858649834,
                -13.91994048703543
              ],
              [
                121.90916115105311,
                -13.91708008933577
              ],
              [
                121.90868908226649,
                -13.915518000678667
              ],
              [
                121.90755182564418,
                -13.914539086408695
              ],
              [
                121.9045477515475,
                -13.91249793268901
              ],
              [
                121.90046630493929,
                -13.903221445152127
              ],
              [
                121.8947585641556,
                -13.893473255705496
              ],
              [
                121.88518844239046,
                -13.882901420438207
              ],
              [
                121.87175593964388,
                -13.877568660648015
              ],
              [
                121.85617766968538,
                -13.880110069283134
              ],
              [
                121.84494071702333,
                -13.88300807802977
              ],
              [
                121.84249454240175,
                -13.886028530698812
              ],
              [
                121.84039169053408,
                -13.89629777528808
              ],
              [
                121.84003771368633,
                -13.90292247057892
              ],
              [
                121.84355677191387,
                -13.92016828374217
              ],
              [
                121.84149683539043,
                -13.933247583745674
              ],
              [
                121.8386644226707,
                -13.939412092560758
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                121.99529448152809,
                -13.62632523814775
              ],
              [
                121.99096003176003,
                -13.628952789741481
              ],
              [
                121.98289194704323,
                -13.642548859707482
              ],
              [
                121.97864332796364,
                -13.650389182158994
              ],
              [
                121.97641400201096,
                -13.656684066043704
              ],
              [
                121.97607067925705,
                -13.663773305759047
              ],
              [
                121.97927762629023,
                -13.67458619828395
              ],
              [
                121.98528577448359,
                -13.683759770765665
              ],
              [
                121.98863317133417,
                -13.687178919948026
              ],
              [
                121.99670125605097,
                -13.691848897080732
              ],
              [
                122.00708676935663,
                -13.698603521360656
              ],
              [
                122.01093832042875,
                -13.69953171565057
              ],
              [
                122.01574483898344,
                -13.698531046768549
              ],
              [
                122.02218214061918,
                -13.697863931813911
              ],
              [
                122.0275894739932,
                -13.697572068425924
              ],
              [
                122.04329648998441,
                -13.695945965773912
              ],
              [
                122.05093542125883,
                -13.692610335394495
              ],
              [
                122.05464708256969,
                -13.686003984564845
              ],
              [
                122.04778062749156,
                -13.67241042006451
              ],
              [
                122.03675138402232,
                -13.659470229919595
              ],
              [
                122.03185903477916,
                -13.650754446097316
              ],
              [
                122.02709543156871,
                -13.642747317838223
              ],
              [
                122.02700960088023,
                -13.641079131925906
              ],
              [
                122.02602254796275,
                -13.639786279736386
              ],
              [
                122.02241765904674,
                -13.637867840861109
              ],
              [
                122.02138769078502,
                -13.635949386400641
              ],
              [
                122.02018606114635,
                -13.63353044334822
              ],
              [
                122.01636659550914,
                -13.631445127732457
              ],
              [
                122.01040136266002,
                -13.628859310807604
              ],
              [
                121.99988710332164,
                -13.625439315932828
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                122.98403184040752,
                -12.269460679807587
              ],
              [
                123.01724831684795,
                -12.293446472466906
              ],
              [
                123.0414956958572,
                -12.290847784466727
              ],
              [
                123.06591431721417,
                -12.288917853872361
              ],
              [
                123.09638421162335,
                -12.286988974124993
              ],
              [
                123.10196319938167,
                -12.289882559966767
              ],
              [
                123.11097550540721,
                -12.290260034949394
              ],
              [
                123.12071733046469,
                -12.288331056493472
              ],
              [
                123.12899987324444,
                -12.287995347931776
              ],
              [
                123.13440750801337,
                -12.290091734189259
              ],
              [
                123.13745453643735,
                -12.289294820478473
              ],
              [
                123.13811966301397,
                -12.281516227551247
              ],
              [
                123.13630641494579,
                -12.276201251899678
              ],
              [
                123.13943383645115,
                -12.271866425905506
              ],
              [
                123.1417699751821,
                -12.273557017570308
              ],
              [
                123.14608018025127,
                -12.265015520212742
              ],
              [
                123.15181524730578,
                -12.253791559253028
              ],
              [
                123.1541676894879,
                -12.249269976498999
              ],
              [
                123.15591935343068,
                -12.244245175085
              ],
              [
                123.14875226379914,
                -12.232501687315048
              ],
              [
                123.14656380838673,
                -12.218577184581138
              ],
              [
                123.14300144703543,
                -12.210146134751499
              ],
              [
                123.13583457160419,
                -12.195674969964893
              ],
              [
                123.12888268656056,
                -12.191396598022868
              ],
              [
                123.11497806984146,
                -12.188460471902482
              ],
              [
                123.09867028421681,
                -12.18518829523617
              ],
              [
                123.08605317301075,
                -12.186362850150317
              ],
              [
                123.07798497631825,
                -12.18195845685009
              ],
              [
                123.07068947977345,
                -12.175120468453667
              ],
              [
                123.04296616739552,
                -12.188040776721646
              ],
              [
                123.03266648477833,
                -12.201653075023625
              ],
              [
                123.03052071756642,
                -12.202995339716232
              ],
              [
                123.02846078104298,
                -12.206686532554382
              ],
              [
                123.01987771219532,
                -12.208112661465346
              ],
              [
                123.01798943704884,
                -12.207189873046927
              ],
              [
                122.99588817623696,
                -12.213439978575344
              ],
              [
                122.99275670323762,
                -12.213058566227136
              ],
              [
                122.99117018344843,
                -12.213348238515493
              ],
              [
                122.9898854088653,
                -12.21426312160327
              ],
              [
                122.98886079511658,
                -12.215421771012867
              ],
              [
                122.98784151469036,
                -12.216564630423028
              ],
              [
                122.98683289713185,
                -12.21767591568992
              ],
              [
                122.98545954360559,
                -12.21859868691327
              ],
              [
                122.98168305582325,
                -12.221366903841199
              ],
              [
                122.97447837837842,
                -12.225684479924785
              ],
              [
                122.97241844185498,
                -12.225516711592046
              ],
              [
                122.93997444161084,
                -12.233569471473944
              ],
              [
                122.93388046272901,
                -12.236002027768171
              ],
              [
                122.9306188965669,
                -12.242460775441783
              ],
              [
                122.93576873787549,
                -12.249674254919293
              ],
              [
                122.94392265328077,
                -12.255377796783936
              ],
              [
                122.96280540474561,
                -12.262339305744597
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                123.32885219768488,
                -11.983136934874077
              ],
              [
                123.33889438823664,
                -11.984984055825112
              ],
              [
                123.35305645183527,
                -11.9840604969296
              ],
              [
                123.37185337261164,
                -11.982885053765077
              ],
              [
                123.38180973247492,
                -11.982297330263458
              ],
              [
                123.38704540447199,
                -11.979022847333475
              ],
              [
                123.38831252565011,
                -11.975872080252588
              ],
              [
                123.3876258801423,
                -11.973898952195922
              ],
              [
                123.38681048860177,
                -11.972261664782977
              ],
              [
                123.38556594361886,
                -11.970771304794171
              ],
              [
                123.3834845494233,
                -11.968588227437785
              ],
              [
                123.38127440919503,
                -11.968819130684393
              ],
              [
                123.38030881394967,
                -11.96697189918833
              ],
              [
                123.37979382981881,
                -11.965943321633931
              ],
              [
                123.37831325044259,
                -11.965523492936041
              ],
              [
                123.37666100968941,
                -11.964935731663745
              ],
              [
                123.3750731419526,
                -11.964452926805635
              ],
              [
                123.37150444848353,
                -11.964033095793459
              ],
              [
                123.36538901192958,
                -11.965964313051707
              ],
              [
                123.35614075524623,
                -11.968462280129204
              ],
              [
                123.35401644570643,
                -11.968672192277554
              ],
              [
                123.35223545892055,
                -11.96919697193519
              ],
              [
                123.34225764138515,
                -11.971715900107197
              ],
              [
                123.33476891381557,
                -11.973395172510266
              ],
              [
                123.33414664132411,
                -11.974087869335854
              ],
              [
                123.32547774178798,
                -11.975389294932205
              ],
              [
                123.32311162091446,
                -11.977005572830896
              ],
              [
                123.32366952038956,
                -11.980427012316497
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                123.55313690061399,
                -12.525575265937889
              ],
              [
                123.54330928678343,
                -12.526287461745483
              ],
              [
                123.53828819150755,
                -12.53068627460955
              ],
              [
                123.53691490049192,
                -12.536760702308124
              ],
              [
                123.53773029203245,
                -12.539818808268384
              ],
              [
                123.53966148252317,
                -12.542039054232433
              ],
              [
                123.54318054075071,
                -12.543672807906868
              ],
              [
                123.54549796933958,
                -12.543589025919283
              ],
              [
                123.54996116514036,
                -12.543924153706083
              ],
              [
                123.55120571012327,
                -12.54425928105673
              ],
              [
                123.55172069425413,
                -12.543714698890442
              ],
              [
                123.55378063077757,
                -12.543630916916484
              ],
              [
                123.55832965726682,
                -12.542416075231055
              ],
              [
                123.56880100126097,
                -12.540028266252353
              ],
              [
                123.57800010879704,
                -12.53504312002893
              ],
              [
                123.58134750564763,
                -12.529638945020393
              ],
              [
                123.57602600296208,
                -12.52746048584683
              ],
              [
                123.56722835739323,
                -12.525868523273322
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                123.55521581175083,
                -14.108842581083513
              ],
              [
                123.55352065565341,
                -14.105575326645635
              ],
              [
                123.55090281965488,
                -14.103306950486827
              ],
              [
                123.54725501539463,
                -14.101454773403585
              ],
              [
                123.54465863706821,
                -14.1007888184164
              ],
              [
                123.54227683546299,
                -14.100996929558766
              ],
              [
                123.54019544126743,
                -14.102099915443157
              ],
              [
                123.53839299680942,
                -14.1036191136825
              ],
              [
                123.53809258939975,
                -14.104451546781869
              ],
              [
                123.53768272865021,
                -14.107043144195687
              ],
              [
                123.53672779210397,
                -14.109082551684317
              ],
              [
                123.53670094368849,
                -14.110185514913885
              ],
              [
                123.53690210582982,
                -14.111361308062024
              ],
              [
                123.5370670714203,
                -14.112448649401136
              ],
              [
                123.53751434473664,
                -14.113575001195509
              ],
              [
                123.538875248793,
                -14.11478328135615
              ],
              [
                123.54065004766775,
                -14.116240599452594
              ],
              [
                123.54319735038483,
                -14.117697898270093
              ],
              [
                123.54562206733429,
                -14.118176518108019
              ],
              [
                123.55094357001984,
                -14.11957075277394
              ],
              [
                123.55274601447785,
                -14.11880080334188
              ],
              [
                123.55478449332917,
                -14.116366081255126
              ],
              [
                123.5554925965091,
                -14.113723233813541
              ],
              [
                123.55596466529572,
                -14.110435239091077
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                125.71947433209338,
                -13.958349281901514
              ],
              [
                125.72067596173206,
                -13.975341084791815
              ],
              [
                125.72513915753284,
                -13.990166241342234
              ],
              [
                125.73475219464221,
                -14.003491409202336
              ],
              [
                125.74728347515979,
                -14.01198580037719
              ],
              [
                125.75964309430042,
                -14.015816501431928
              ],
              [
                125.77629424786487,
                -14.02014678216268
              ],
              [
                125.79689361309924,
                -14.02797438993412
              ],
              [
                125.80676414227405,
                -14.032221171719721
              ],
              [
                125.81182815289417,
                -14.036800946263716
              ],
              [
                125.81466056561389,
                -14.03763362271254
              ],
              [
                125.8208403751842,
                -14.042296554908015
              ],
              [
                125.82556106305042,
                -14.046709599743464
              ],
              [
                125.85148193097034,
                -14.023477711733854
              ],
              [
                125.83483077740588,
                -14.003907808248735
              ],
              [
                125.79071380352893,
                -13.950852499980469
              ],
              [
                125.79517699932971,
                -13.91903011490841
              ],
              [
                125.80118712446169,
                -13.913529643470024
              ],
              [
                125.80256041547732,
                -13.903032043822767
              ],
              [
                125.81165846845583,
                -13.869036551176725
              ],
              [
                125.82659300825075,
                -13.855870291466625
              ],
              [
                125.82845960551619,
                -13.83984916066733
              ],
              [
                125.82767641893248,
                -13.836833283352805
              ],
              [
                125.82946814408217,
                -13.83573421979374
              ],
              [
                125.83124911499812,
                -13.832536013859007
              ],
              [
                125.82966123515486,
                -13.830473349480409
              ],
              [
                125.82867418223738,
                -13.82547276238378
              ],
              [
                125.82282672746231,
                -13.818023686365125
              ],
              [
                125.81946865043746,
                -13.810907911187295
              ],
              [
                125.81618581706404,
                -13.811262174571928
              ],
              [
                125.8115509598863,
                -13.814762810393075
              ],
              [
                125.8044995329296,
                -13.807652284087725
              ],
              [
                125.78441515182608,
                -13.820821273434978
              ],
              [
                125.77720537399405,
                -13.829822432709694
              ],
              [
                125.76810732101553,
                -13.85432382431381
              ],
              [
                125.76398744796866,
                -13.860157108308039
              ],
              [
                125.75471773361319,
                -13.881155717009593
              ],
              [
                125.74561968063468,
                -13.900652722366177
              ],
              [
                125.73686495041007,
                -13.915815924879452
              ],
              [
                125.73171510910147,
                -13.926479559787085
              ],
              [
                125.72278871749991,
                -13.94397351967664
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    reef_slope = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.MultiPolygon(
        [[[[118.90674646669093, -17.649937200896062],
           [118.92966326051418, -17.665313132039188],
           [118.96451052003566, -17.639794910610778],
           [118.9841155090667, -17.601956791595796],
           [118.97376828934433, -17.48959387606441],
           [118.94183927323105, -17.485991874165894],
           [118.88484769608262, -17.585511806038696],
           [118.88107114578965, -17.613982773441773],
           [118.90167051102402, -17.6473568086939],
           [118.90566163803818, -17.649278899454266],
           [118.91192727829697, -17.642040280610377],
           [118.8957052781749, -17.61402367677474],
           [118.89656358505967, -17.594061749005082],
           [118.90282922531846, -17.578401391310194],
           [118.91407304550889, -17.558108201700804],
           [118.9257460191417, -17.53201679739298],
           [118.93947892929795, -17.50991763991729],
           [118.951447561644, -17.502386942146185],
           [118.96148975219576, -17.50639789612256],
           [118.97093112792818, -17.541019386111028],
           [118.96942675138284, -17.56560977520722],
           [118.9728599789219, -17.588111233636102],
           [118.97594988370706, -17.60046538890808],
           [118.96075122676007, -17.630689577575],
           [118.9514815124046, -17.64492205873476],
           [118.93517368159405, -17.653510080990706],
           [118.92933719477764, -17.6549004841631],
           [118.91251437983624, -17.643122611704708]]],
         [[[119.35752840735466, -17.399207642875357],
           [119.3676564285949, -17.39650480874183],
           [119.38276262976677, -17.37553601159828],
           [119.39100237586052, -17.346781921645256],
           [119.37967272498162, -17.268443097026378],
           [119.3652519615848, -17.25245990079905],
           [119.34843035437615, -17.23991817701259],
           [119.33572741248162, -17.244180801631643],
           [119.31238146521599, -17.29696360310891],
           [119.30903412565422, -17.326296494799248],
           [119.31169481970818, -17.358251330263858],
           [119.33229418494255, -17.39003422535536],
           [119.35155351070186, -17.398207202170465],
           [119.35365636256954, -17.392637651651466],
           [119.34155423549434, -17.38600311279996],
           [119.33026749995967, -17.374330655085195],
           [119.32160431658905, -17.359991395742835],
           [119.31950146472137, -17.352782205354853],
           [119.31857004179163, -17.331506628871452],
           [119.317196750776, -17.31175953872001],
           [119.33544735566232, -17.259039263486144],
           [119.3508968795881, -17.250514602206344],
           [119.36857800141428, -17.269366690610486],
           [119.37512086854149, -17.277093077988525],
           [119.37561439500023, -17.27756433574017],
           [119.37432693467308, -17.279428865457728],
           [119.3752353772628, -17.283764414001585],
           [119.3757069522935, -17.291408160684906],
           [119.38004140206156, -17.305749132373634],
           [119.38192967720805, -17.319466080229155],
           [119.38278798409281, -17.332657801681822],
           [119.38253049202739, -17.339949712994883],
           [119.38244179617384, -17.353806292756982],
           [119.38158348928907, -17.36453971270079],
           [119.37793568502882, -17.372198976646057],
           [119.37385872732618, -17.38057918575896],
           [119.37059716116407, -17.386271967300047],
           [119.36643437277296, -17.39175980486759],
           [119.35883835684278, -17.3941760393581],
           [119.354375161042, -17.392988402664972],
           [119.35270146261671, -17.398762701763363]]],
         [[[119.63589891348862, -17.161226742310028],
           [119.62027772818588, -17.160939709340358],
           [119.61079343710922, -17.156265109909018],
           [119.60738958293187, -17.148685325597576],
           [119.6006947892307, -17.137982073005613],
           [119.59804415070579, -17.127599073103294],
           [119.59684252106712, -17.117714893589916],
           [119.59524994155856, -17.1063856005734],
           [119.59374790451022, -17.099576690660154],
           [119.59864025375339, -17.08357887484137],
           [119.60121517440768, -17.07032836232443],
           [119.60348968765231, -17.04911737929163],
           [119.60984115859958, -17.04082926144208],
           [119.617480089874, -17.032540776096045],
           [119.62430362960788, -17.034141056836713],
           [119.6299255397031, -17.038572532031747],
           [119.64070660800208, -17.054174316181932],
           [119.64480502337683, -17.06030794119077],
           [119.64772326678504, -17.059036102394764],
           [119.64933259219397, -17.062769540054283],
           [119.64699370593299, -17.06410289255259],
           [119.65156419009436, -17.072205368292302],
           [119.65340954989661, -17.078564026869277],
           [119.65510493470967, -17.088121814452023],
           [119.65699320985615, -17.10305278790768],
           [119.6592512530286, -17.11429767732567],
           [119.65976623715946, -17.127134940667553],
           [119.65830711545536, -17.138700022826434],
           [119.65084765353001, -17.152094774059925],
           [119.64853022494114, -17.155190753784566],
           [119.64460347094334, -17.157897130843676],
           [119.63726494707859, -17.161136530276337],
           [119.6373936931113, -17.168189204297704],
           [119.64136562918299, -17.168330345885014],
           [119.65647183035486, -17.160293562612658],
           [119.66677151297205, -17.13700132703602],
           [119.66625652884119, -17.109768673751763],
           [119.65698681448572, -17.068255822123554],
           [119.63930569265955, -17.03805885449884],
           [119.62454281424158, -17.020660560302897],
           [119.61115322683924, -17.021809554154583],
           [119.59483172212752, -17.043663064425],
           [119.58161379610213, -17.09994852589239],
           [119.58936083425863, -17.13658935531764],
           [119.60764277090414, -17.168000450066877],
           [119.63605272878988, -17.16824646898924]]],
         [[[121.81193959223143, -14.205488925600447],
           [121.78112637506834, -14.197001739783795],
           [121.76009785639158, -14.187848535879416],
           [121.74001347528807, -14.171122181220351],
           [121.72404896723143, -14.158389353326816],
           [121.72138821588865, -14.140994990504952],
           [121.723791475166, -14.117758155140539],
           [121.7285121630322, -14.093659393974193],
           [121.73936974512449, -14.072596907186991],
           [121.74627911554686, -14.063105665957355],
           [121.7452817288898, -14.058897618452427],
           [121.74064687171206, -14.045409139653213],
           [121.70494130530581, -14.082042660741532],
           [121.69189504065737, -14.145970722557564],
           [121.74339345374331, -14.201893036397873],
           [121.82474775839849, -14.220064533721292],
           [121.90885685668084, -14.184873444719916],
           [121.96360248924908, -14.152955584892611],
           [121.98496286490175, -14.106862980390977],
           [121.98314829739174, -14.079578044840376],
           [121.96795715126807, -14.058101850922293],
           [121.96549038423423, -14.06113893008103],
           [121.96464320942513, -14.065488241449874],
           [121.96967541846148, -14.069754254460696],
           [121.97409496611589, -14.090484258230019],
           [121.97269714066042, -14.110175333930105],
           [121.96633003422097, -14.128512421105407],
           [121.9483800720624, -14.146670025824905],
           [121.93116130954016, -14.158243955946315],
           [121.90589825731843, -14.173349965012001],
           [121.88193434611142, -14.185893704767334],
           [121.85707608162, -14.198487947172127],
           [121.83880940798646, -14.206115177867483],
           [121.82500525046392, -14.208083303550929]]],
         [[[121.76426418810277, -14.050686697193445],
           [121.76074512987523, -14.046356993335491],
           [121.76520832567601, -14.042610068155145],
           [121.77791126757054, -14.044691700822797],
           [121.7810011723557, -14.052726625442267],
           [121.78331860094457, -14.06417486496951],
           [121.78610809832006, -14.073000025769993],
           [121.7841339924851, -14.075643344890775],
           [121.78567894487767, -14.078328259782332],
           [121.79061612781271, -14.076682425102494],
           [121.78984365161642, -14.065359697823274],
           [121.78177556689963, -14.036051213121654],
           [121.76332196887716, -14.03396950195406],
           [121.75173482593283, -14.045043988055962],
           [121.76048955615744, -14.053786625185335]]],
         [[[121.84490087325601, -14.006961745255893],
           [121.82867887313394, -13.999549827917306],
           [121.81786420638589, -13.989888992555507],
           [121.81425931746988, -13.978811845700509],
           [121.81460264022378, -13.96706782210007],
           [121.82215574080972, -13.952657670238004],
           [121.8332278996232, -13.946410214709221],
           [121.84060933883218, -13.93941286367722],
           [121.84461659156499, -13.924396956770353],
           [121.84204167091069, -13.900986089768415],
           [121.84470242225346, -13.886738460059249],
           [121.84890812598881, -13.882655644428002],
           [121.86126774512944, -13.879239355684263],
           [121.8716532584351, -13.879239355684263],
           [121.88289707862553, -13.882905614798625],
           [121.89448422156987, -13.89421968782877],
           [121.89920490943608, -13.901968257153758],
           [121.9048471720916, -13.913193818013047],
           [121.90900996048272, -13.915505728712594],
           [121.90900996048272, -13.917755133155083],
           [121.9075930538644, -13.920823163441781],
           [121.93093900113003, -13.944232021362387],
           [121.94012288479702, -13.953644878652279],
           [121.94222785974021, -13.962877150180372],
           [121.94197036767478, -13.975787449276991],
           [121.93613388085838, -13.985865308658207],
           [121.89527714966538, -14.01527388104407],
           [121.89141476868393, -14.018854704423173],
           [121.88085759400131, -14.025683096449184],
           [121.87287533997299, -14.024600560050757],
           [121.86012948273422, -14.020936552795547],
           [121.8506881070018, -14.013150343118207],
           [121.84472287415268, -14.017272487028524],
           [121.84579575775864, -14.01960417201313],
           [121.88407624481918, -14.033260708157975],
           [121.90690720795395, -14.019468044140986],
           [121.9342013668895, -13.999814517674787],
           [121.95016587494614, -13.984823409761999],
           [121.95462907074692, -13.971663743234316],
           [121.95171082733872, -13.953838692112738],
           [121.92939484833481, -13.92984766341071],
           [121.90519059418442, -13.897689113492099],
           [121.87755311249497, -13.866692709110724],
           [121.83772767304184, -13.873692259378455],
           [121.83299041573233, -13.899627944438297],
           [121.83462119881338, -13.911875277884066],
           [121.83543572251291, -13.934496174709055],
           [121.82685265366526, -13.94166027934861],
           [121.81191811387033, -13.95240601933605],
           [121.80608162705393, -13.96814887367177],
           [121.80771241013498, -13.98530652653557],
           [121.81509384934397, -14.001713376309247],
           [121.84324631516428, -14.016453556999359],
           [121.84644352718321, -14.013080866920873],
           [121.84586415116281, -14.009833084411484]]],
         [[[121.9825652466957, -13.679196849394064],
           [121.97947534191054, -13.673484146888525],
           [121.97604211437148, -13.662892346460506],
           [121.97724374401015, -13.654218391601994],
           [121.98305585748261, -13.643071216524373],
           [121.98927858239716, -13.633478999739024],
           [121.9933555400998, -13.629016400898708],
           [121.99657419091767, -13.626305435219953],
           [122.00112321740693, -13.625971775756513],
           [122.01876142388886, -13.632644875519915],
           [122.0208213604123, -13.635439180060267],
           [122.02382543450898, -13.637899808924777],
           [122.02884652978486, -13.646907994117784],
           [122.03484112371699, -13.656969579080375],
           [122.0415788327624, -13.666435739976494],
           [122.04968983282343, -13.676860587285685],
           [122.05406719793574, -13.685867283708042],
           [122.04947525610224, -13.693122427337983],
           [122.04114967932001, -13.69491533064401],
           [122.02685886968867, -13.69520719733018],
           [122.01050812353388, -13.696166185319504],
           [122.00263315786616, -13.693518535058791],
           [121.99164682974116, -13.68538776920597],
           [121.98314959158198, -13.689494883494795],
           [122.00718218435541, -13.702670522340458],
           [122.0310431157519, -13.702336970974567],
           [122.05181414236323, -13.699001431278033],
           [122.05773645986811, -13.690245414397538],
           [122.0596247350146, -13.68332376084612],
           [122.04775725981224, -13.664726020985821],
           [122.02878867765892, -13.636451309504512],
           [122.02037727018822, -13.626358335673546],
           [122.0014086880349, -13.618684050585722],
           [121.99050819059838, -13.622104143188194],
           [121.973946835633, -13.648179404295869],
           [121.97064235412665, -13.653600802284348],
           [121.96978404724189, -13.662066274529224],
           [121.97335906637682, -13.676806229109927],
           [121.98288627279771, -13.68902356549348],
           [121.99022479666246, -13.685166625079]]],
         [[[123.01997604797225, -12.289664077892184],
           [123.00641479919295, -12.283961278259655],
           [122.98100891540389, -12.267355363871065],
           [122.94856491515975, -12.253096925526162],
           [122.9322570843492, -12.238837716525609],
           [122.98195305297713, -12.22168370694342],
           [122.98817577789168, -12.21136560049405],
           [122.99431267211776, -12.213169200958834],
           [122.99585762451034, -12.213504753177908],
           [122.9969305081163, -12.213211145009467],
           [122.99808922241073, -12.212791704203935],
           [123.0010932965074, -12.21170115499928],
           [123.00461235473495, -12.211030045563513],
           [123.00630633423893, -12.210478609373512],
           [123.0079585749921, -12.209828469131343],
           [123.00852720369583, -12.209755066366233],
           [123.00898854325382, -12.209241244314708],
           [123.00932113734162, -12.209325134159721],
           [123.01011507104008, -12.209042007027481],
           [123.01096264908878, -12.208916172874094],
           [123.01186387131779, -12.208863741959197],
           [123.01272217820255, -12.208360404648063],
           [123.01340882371036, -12.20833943223933],
           [123.0149108607587, -12.207815121481378],
           [123.01576916764347, -12.208947631418042],
           [123.02439515183536, -12.205130634138378],
           [123.0325061518964, -12.201229689979117],
           [123.03602521012394, -12.195315245750255],
           [123.03821389268009, -12.192295053119599],
           [123.03679768632023, -12.190868839086319],
           [123.0379993159589, -12.19078494390432],
           [123.03787056992618, -12.189148982551158],
           [123.04104630539982, -12.184199089319982],
           [123.04589573929874, -12.18554144237332],
           [123.05943027809681, -12.177236457369684],
           [123.05878654793324, -12.17220244092879],
           [123.06500927284779, -12.171363428912304],
           [123.07423607185902, -12.17320925185044],
           [123.08758306463386, -12.18322834416624],
           [123.09908437688972, -12.18364783175945],
           [123.10226011236335, -12.185829156554332],
           [123.11869668920662, -12.190065909236331],
           [123.1326870914283, -12.195519055644361],
           [123.14556169469978, -12.22060208366849],
           [123.15151649669832, -12.246652860674807],
           [123.14267593578523, -12.261834248229711],
           [123.13517922974513, -12.272000809806748],
           [123.13397760010646, -12.287264601710078],
           [123.12685365296291, -12.286174360217142],
           [123.11818475342677, -12.287516195259098],
           [123.10256356812404, -12.28743233076949],
           [123.0869423828213, -12.283993863677638],
           [123.07346696473049, -12.287096872543707],
           [123.05355424500392, -12.284245460354416],
           [123.05355424500392, -12.30143732980775],
           [123.05777586993007, -12.302103120954376],
           [123.15081633623866, -12.311495253224383],
           [123.17141570147304, -12.241381604718077],
           [123.13880003985194, -12.172927358087014],
           [123.09451140459804, -12.174269768137266],
           [123.06292571123866, -12.161852216360899],
           [123.0265334993246, -12.185344392084117],
           [122.96250380572108, -12.221753152917278],
           [122.92654205537686, -12.234503558609186],
           [122.92199172076015, -12.242052637121983],
           [122.93712566518084, -12.258115526156697],
           [122.96513988009899, -12.273169890222091],
           [122.9877991818568, -12.282227591538236],
           [123.0178399228236, -12.302438560032673],
           [123.05088473788707, -12.301348381462356],
           [123.05088473788707, -12.284156506193112]]],
         [[[123.33440823707653, -11.969548114296694],
           [123.3182291522987, -11.973410456207178],
           [123.31632372789129, -11.979203906813146],
           [123.32031485490545, -11.983989672952601],
           [123.3270954792951, -11.989321084437053],
           [123.34048506669744, -11.991336078669983],
           [123.36065527848943, -11.987473993170118],
           [123.3878636067365, -11.986004706997198],
           [123.39196318457961, -11.978218340032459],
           [123.38930243323684, -11.968394623791253],
           [123.3777152902925, -11.958150710347544],
           [123.35640290414186, -11.963193049488375],
           [123.33563187753053, -11.969448483492629],
           [123.33747723733278, -11.973184881719654],
           [123.34228834021155, -11.97231977064152],
           [123.35330543685332, -11.969309452051673],
           [123.35330543685332, -11.96597183745187],
           [123.36454925704375, -11.96364178019308],
           [123.36705980468169, -11.962613189969808],
           [123.37341127562895, -11.960912858776723],
           [123.37714491057768, -11.96108079319749],
           [123.37693033385649, -11.963116989751695],
           [123.3745914475955, -11.963683763384397],
           [123.37847528624907, -11.964082603376733],
           [123.38177976775542, -11.966475630975586],
           [123.38386116195097, -11.968574760551451],
           [123.38510570693389, -11.971093694522958],
           [123.38710127044097, -11.974494218138078],
           [123.38726640697014, -11.979555705756217],
           [123.38029266353142, -11.981969586486617],
           [123.37909103389275, -11.981570772897653],
           [123.37737442012322, -11.980815124481959],
           [123.37615133281243, -11.980941066031445],
           [123.37514282222283, -11.98092007577728],
           [123.37537885661614, -11.982473350177925],
           [123.37115169520867, -11.982494340311318],
           [123.36449271483596, -11.982430098269836],
           [123.35148936553176, -11.984025344012691],
           [123.35080272002395, -11.982472078541734],
           [123.34942942900832, -11.982157226343357],
           [123.34942942900832, -11.983269702467528],
           [123.34846383376296, -11.983101781836906],
           [123.34691888137039, -11.98299683138971],
           [123.34408646865066, -11.983962373964719],
           [123.33756333632644, -11.983584553368415],
           [123.33142644210037, -11.984298214050812],
           [123.3219421510237, -11.979974241002886],
           [123.32301503462966, -11.976321899143292],
           [123.32576161666091, -11.975944067856027],
           [123.33653336806472, -11.973341215739108]]]]),
    litchfield_coast = 
    /* color: #98ff00 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[128.86184913209598, -14.333007298135609],
          [129.54300147584598, -14.636165024799759],
          [130.66910010865848, -13.308871407063991],
          [131.66336280397098, -12.135425416571353],
          [131.25137549928348, -11.86677051686856],
          [130.75424415162723, -12.13811060842463],
          [130.14724952272098, -12.59955616551813],
          [129.83139258912723, -13.185890674650622]]]),
    arnhem_coast = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.MultiPolygon(
        [[[[131.76243413629288, -11.590157041709542],
           [134.10252202691788, -12.363946476027461],
           [135.80540288629288, -12.696410248007176],
           [135.44285405816788, -14.245548182415062],
           [135.90427983941788, -14.724216692772242],
           [136.2801089817156, -13.921466954403057],
           [136.3570132785906, -13.602005924669415],
           [136.74496799050468, -13.043421418375168],
           [136.8562045627703, -12.57607273581098],
           [137.08966403542655, -12.352138503753553],
           [136.82599216042655, -12.169631032785537],
           [136.59390597878593, -11.974907720269986],
           [136.78754001198905, -11.821716172746568],
           [136.71063571511405, -11.636159105817223],
           [135.9443393283953, -12.031324880567055],
           [136.50694795440484, -11.57761744471767],
           [136.8626303274517, -11.032227967145767],
           [136.7294210989361, -10.913587838071367],
           [136.20482393096734, -11.533217386402375],
           [136.09970057270954, -11.470229885665514],
           [135.69638661368822, -11.859251233213032],
           [135.22397450431322, -12.037941566270398],
           [135.07291249259447, -11.980182415070782],
           [134.65543202384447, -11.87269068863828],
           [134.28189686759447, -11.878066285288552],
           [133.94544056876634, -11.693892000711369],
           [133.79163197501634, -11.664305094486227],
           [133.60349110587572, -11.724820385375798],
           [133.52946203268073, -11.595363352295351],
           [133.45255773580573, -11.53952931422112],
           [133.221429809553, -11.646930411174234],
           [133.07036779783425, -11.377798143463803],
           [132.8469954959894, -11.234135167984522],
           [132.63070216102847, -10.84999383277342],
           [131.68038477821597, -11.162736531269152]]],
         [[[139.07023299460087, -17.05198620150955],
           [139.186962730929, -17.396963102192395],
           [139.48496688131962, -17.478194256602155],
           [139.78709090475712, -16.927217261059322],
           [139.21717513327275, -16.817812223982468],
           [139.186962730929, -16.7747556689911],
           [139.1653333974329, -16.76653765998713],
           [139.12758675144084, -16.77053035502813],
           [138.80486336276897, -16.762640897889398],
           [138.7897571615971, -16.955838063891942]]]]),
    timor_land_mask = ee.FeatureCollection("projects/coral_atlas/Timor/mask/timor_land_mask"),
    northern_wa = /* color: #0b4a8b */ee.Geometry.Polygon(
        [[[124.5776999240527, -15.817968794001228],
          [124.5776999240527, -15.627614143565072],
          [124.9732077365527, -15.680508279566318],
          [125.2258932834277, -15.585288995653487],
          [125.2478659396777, -15.304665582545956],
          [125.5664694553027, -15.21987478332911],
          [125.5609762912402, -14.975911594426918],
          [125.3632223849902, -14.72104477803822],
          [125.5280173068652, -14.72104477803822],
          [125.8740866428027, -14.752919535304656],
          [126.1212790256152, -14.710418823009094],
          [126.1926901584277, -14.433963380826846],
          [126.3849509006152, -14.27963660697702],
          [126.6760885959277, -14.300929376522967],
          [127.0276510959277, -14.066598585125421],
          [127.49917383610648, -14.091290615985837],
          [127.5170266193096, -14.045999237371639],
          [127.49848719059867, -13.9713821555741],
          [127.36733789860648, -13.890075318236129],
          [127.28562708317679, -13.868077574329698],
          [127.21970911442679, -13.855411260484376],
          [127.14967127262992, -13.840077430200251],
          [127.09336634098929, -13.822075556764842],
          [127.03568811833304, -13.763393133172194],
          [126.96449539501361, -13.67560717746668],
          [126.89857742626361, -13.650253010907214],
          [126.81961319286518, -13.678275878395223],
          [126.73499510620991, -13.728712928835025],
          [126.69997618531147, -13.7754002541023],
          [126.66015074585835, -13.917405635508711],
          [126.62101195191303, -13.925403352811694],
          [126.58530638550678, -13.921404528749841],
          [126.55234740113178, -13.920071572021818],
          [126.52694151734272, -13.923403949429332],
          [126.4981024060146, -13.92273747779129],
          [126.4761297497646, -13.900742836103804],
          [126.43424437378803, -13.90674158212826],
          [126.37862608765522, -13.932067905800082],
          [126.28112242554585, -14.026683765052487],
          [126.22481749390522, -13.90540854089248],
          [126.14379332398335, -13.844080354618697],
          [126.06208250855366, -13.853413950192632],
          [125.97831175660053, -13.885412001319919],
          [125.94123289917866, -13.956725079145901],
          [125.94054625367085, -14.061328610877077],
          [126.09847472046772, -14.13724808339307],
          [126.06894896363178, -14.22911670180824],
          [126.04148314331928, -14.255738316853432],
          [125.98655150269428, -14.265055140012473],
          [125.96869871949116, -14.320830170723218],
          [125.97487852906147, -14.353427922666635],
          [125.92818663453022, -14.422599252430897],
          [125.8499090466396, -14.399987906036158],
          [125.75446532105366, -14.380034815066606],
          [125.74347899292866, -14.35076705942457],
          [125.75171873902241, -14.282904379540867],
          [125.74416563843647, -14.26560277208235],
          [125.68786070679585, -14.246303258107144],
          [125.6191961560146, -14.22034613703462],
          [125.56769774292866, -14.21834931190129],
          [125.56151793335835, -14.254954968623602],
          [125.56220457886616, -14.351981111293773],
          [125.57868407105366, -14.500275024452291],
          [125.54160521363178, -14.499610250052015],
          [125.51345274781147, -14.486979157552723],
          [125.47568724488178, -14.452406174212962],
          [125.46744749878803, -14.442432198386124],
          [125.46058104370991, -14.433787724268997],
          [125.42075560425678, -14.445756906696325],
          [125.33561156128803, -14.482990241991237],
          [125.25447434265982, -14.548352381776821],
          [125.23799485047232, -14.592878023425067],
          [125.21808213074576, -14.613476393531036],
          [125.1981694110192, -14.622113845282891],
          [125.17001694519888, -14.666624551825272],
          [125.10753220398794, -14.742338378203048],
          [125.10821884949576, -14.810019373945694],
          [124.99972885926138, -14.963310660272663],
          [124.99557976838116, -15.010474756724388],
          [124.99283318634991, -15.090045846965138],
          [124.96948723908429, -15.10330480339613],
          [124.92966179963116, -15.100653078330918],
          [124.88846306916241, -15.0986642627995],
          [124.81876855011944, -15.150367406866364],
          [124.8096849015003, -15.176864190479288],
          [124.75372329261359, -15.224904244894464],
          [124.683717233822, -15.246736460283117],
          [124.66449115960324, -15.257004605538048],
          [124.6459517308923, -15.308337797074435],
          [124.64320514886106, -15.356347776485245],
          [124.66620777337278, -15.374555570605281],
          [124.66058328077577, -15.40197792897822],
          [124.64238717481874, -15.415548188530495],
          [124.63140084669374, -15.429117561903217],
          [124.61526467726014, -15.458239075084602],
          [124.59535195753358, -15.468496815513404],
          [124.54316689893983, -15.460224483846002],
          [124.5088346235492, -15.4638643504875],
          [124.47999551222108, -15.470482125940668],
          [124.45596291944764, -15.458900880119142],
          [124.40583779737733, -15.48867991740401],
          [124.38180520460389, -15.51316169138242],
          [124.37013223097108, -15.582621172179625],
          [124.34197976515077, -15.666602690918015],
          [124.36807229444764, -15.746584479109396],
          [124.36807229444764, -15.837104377943996],
          [124.39279153272889, -15.946731070416222],
          [124.43261697218202, -15.958614708835887]]]),
    wellesly_tiwi = 
    /* color: #ffc82d */
    /* shown: false */
    ee.Geometry.MultiPolygon(
        [[[[139.13101450686634, -16.591553249410353],
           [139.10972849612415, -16.719173796622922],
           [139.1234614062804, -16.769146244997064],
           [139.1674067187804, -16.76585898703789],
           [139.27932993655384, -16.799386350480372],
           [139.5086695361632, -16.74284659090085],
           [139.58832041506946, -16.638927497373068],
           [139.75174204592884, -16.58234023351405],
           [139.8698450732726, -16.509936918273482],
           [139.8712183642882, -16.432237749639807],
           [139.7050501513976, -16.34001198286326],
           [139.30679575686634, -16.38481280725529],
           [139.13788096194446, -16.47965111757788]]],
         [[[130.0638892031177, -11.363571571950068],
           [129.8826147890552, -11.890852904039141],
           [130.5472876406177, -11.923102737995679],
           [130.9427954531177, -12.049377595375072],
           [131.0691382265552, -11.982217472728125],
           [131.3218237734302, -11.820965162773284],
           [131.59373539452395, -11.613885623180082],
           [131.64317387108645, -11.42011349111575],
           [131.4646460390552, -11.185795623950282],
           [131.2833716249927, -11.099561835196296],
           [131.01695316796145, -11.19387872910325],
           [130.7670142031177, -11.26392283789858],
           [130.5417944765552, -11.156155643572497],
           [130.3330542421802, -10.989037596967304],
           [130.2231909609302, -11.08069479224581]]]]),
    tiwi_is = /* color: #00ffff */ee.Geometry.Polygon(
        [[[130.33137701331134, -11.506123896516506],
          [130.4330005484676, -11.579454564734158],
          [130.43574713049884, -11.663525695462907],
          [130.49548528967853, -11.711266772587065],
          [130.62182806311603, -11.762360760487137],
          [130.6074093726015, -11.823863106947039],
          [130.6175390784403, -11.82814642662627],
          [130.62217606920152, -11.840494285940448],
          [130.62217669331, -11.853975618718218],
          [130.63556682998765, -11.847275584958663],
          [130.64329134588408, -11.83787727137564],
          [130.64792560593077, -11.826463392271432],
          [130.65770923633355, -11.802477208974608],
          [130.6761611296171, -11.81064790713308],
          [130.69482816257565, -11.813221412100951],
          [130.70438747703056, -11.802605730420872],
          [130.70158650575948, -11.759054723453847],
          [130.66234014807696, -11.738831810454114],
          [130.4281940299129, -11.368829916464078],
          [130.34922979651446, -11.389024376442373]]]),
    dampier_coast = 
    /* color: #d62cd5 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[122.99068369674967, -16.74794430121512],
          [123.29143442917155, -16.730848035463016],
          [123.62651743698405, -16.657185068508674],
          [123.78032603073405, -16.500557281670005],
          [124.29805674362467, -16.425488859670132],
          [124.29668345260905, -16.354344649207775],
          [124.26921763229655, -16.23043922108004],
          [124.07833018112467, -16.19615370438209],
          [123.9149085502653, -16.10777512409286],
          [123.83937754440592, -16.025956869711923],
          [123.72951426315592, -16.045754693208302],
          [123.5029212455778, -15.940143620791648],
          [123.24748911667155, -16.014077232207345],
          [123.0414954643278, -16.167138226904072],
          [122.74211802292155, -16.579545207951988]]]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
///////////////////////////////
// Global coral atlas project - Timor Sea
// Contact: mitchell.lyons@gmail.com
// Region coordinator: Paul Tudman (tuddy117@gmail.com)
// Description:
// - Developing a process to combine OBIA and supervised classification
// - This script loads the raw classification data (from *_classification script)
// - Then applied some cleanup and object-based relational rules
///////////////////////////////

// Table of contents
// 1. Setting constants
// 2. Data loads & vis
// 3. OBIA clean up rules
// 4. Export

// Load and libraries needed
var map_palettes = require('users/mitchest/global_reefs:Modules/colour_pals');
var pkg_vis = require('users/mitchest/global_reefs:Modules/pkg_vis');
var param_module = require('users/mitchest/global_reefs:Modules/reef_params');

// ###########################################
// SENSOR GENERICS
var sensor_params = param_module.dove;         //<------------ THIS IS WHERE YOU CHOOSE THE SENSOR
// REGION AND SENSOR SPECIFIC LOAD PATHS
var region_params = param_module.timor;  //<------------ THIS IS WHERE YOU CHOOSE THE REGION
//  ^^ all the data paths are in this module ^^
// ###########################################

// 1. Setting constants

// These will get written to the asset metadata 

var vars = {
  
  // analysis type
  geomorphic: true, // map geomorphic zonation (when set to true) or benthic habitat (when set to false)

  // analysis parameters
  image_data_scale: sensor_params.pixel,
  small_object_geo: ee.Number(400).int(), // smallest object szie in pixels (geomorphic)
  small_object_benthic: ee.Number(130).int(), // smallest object szie in pixels (benthic)
  smooth_radius: ee.Number(3), // radius in pixels for initial smooth 
  dist_to_land: 1000, //distance to land in meters to disallow reef crest, and convert to terrestrial reef flat
  wave_height: 0.4, //cut off height for waves in metres, Hs95 threshold
  geo_depth_cutoff: 1000,
  shallowlag_depth_cutoff: 400,
  benthic_depth_cutoff: 750,
  
  //############
  // Clean-up stage selection
  cleanup_stage: 3, // set to 1, 2 or 3
  
  /*
  - GEOMORPHIC 1: The first pass does a small object filter, just to generally clean noise and reduce the amount of cleaning needed
  -            2: The second pass runs the OBIA cleanup rules
  -            3: The third pass is the MANUAL cleanup stage, which includes AT LEAST the no_reef masking
                        - see below where it starts/ends (only that section is run)
                        - please put region specific stuff in here ONLY

  - BENTHIC 1: This is the main benthic stge - it does noise removal, no data reclaim and OBIA rules - review those if needed
            2: The second mas is the MANUAL stage - it's optional, but shuold include ALL region specific stuff
                        - see below where it starts/ends (only that section is run)
                        - please put region specific stuff in here ONLY
  */
  
  // DON'T TOUCH --->
  obia_2nd_pass: null,
  obia_clean: null, // run object-based relationship rules + small object clean up
  fast_clean: null, // run a faster (but less precise) version of the OBIA clean; only applies to geomorphic (`obia_clean: true` also)
  manual_clean: false, // apply manual touch ups
  // --------------<
  //############
  
  smooth_output: false, // run smoother over final output (includes noise removal) (should be false for second pass)
  
  // results/layers to show
  export_small_area: false,
  show_eg_area: false, // constrain the map add to the corresponding example_area polygon geomtery (you can change that)
                              // - you can either set this, or have it false and just navigate to the area you want to see (keeping in mind ALL tiles in the zoom area will calcualte)
  reproject_display: true,
  //reproject_res: ee.Number(sensor_params.pixel).pow(2),
  
  // export options
  do_export: false, // export the results?
  geomorph_output_name: region_params.sname + '_geo_clean', // DO NOT CHANGE - change in the pop up dialouge if you must
  benthic_output_name: region_params.sname + '_benthic_clean', // DO NOT CHANGE - change in the pop up dialouge if you must
  asset_output: region_params.asset // asset path

};


// Clean up stage auto-parameterisation (DON'T TOUCH) --->

if (vars.geomorphic) {
  var temp_outname = vars.geomorph_output_name;
  if (vars.cleanup_stage == 1) {
    vars.obia_2nd_pass = false;
    vars.obia_clean = false;
    vars.fast_clean = true;
    vars.manual_clean = false;
    vars.geomorph_output_name = temp_outname + '1';
  } else if (vars.cleanup_stage == 2) {
    vars.obia_2nd_pass = true;
    vars.obia_clean = true;
    vars.fast_clean = true;
    vars.manual_clean = false;
    vars.geomorph_output_name = temp_outname + '2';
  } else if (vars.cleanup_stage == 3) {
    vars.manual_clean = true;
    vars.obia_2nd_pass = false;
    vars.obia_clean = false;
    vars.fast_clean = false;
    vars.smooth_output = false;
    vars.do_export = false;
    vars.geomorph_output_name = temp_outname + '3';
  }
}

if (!vars.geomorphic) {
  var temp_outname = vars.benthic_output_name;
  if (vars.cleanup_stage == 1) {
    vars.obia_2nd_pass = true,
    vars.obia_clean = true, 
    vars.fast_clean = false, 
    vars.manual_clean = false;
    vars.benthic_output_name = temp_outname + '1';
  } else if (vars.cleanup_stage == 2) {
    vars.manual_clean = true;
    vars.obia_2nd_pass = false,
    vars.obia_clean = false, 
    vars.fast_clean = false,
    vars.smooth_output = false,
    vars.do_export = false;
    vars.benthic_output_name = temp_outname + '2';
  }
}
// -----------------------------------------<

/*
############################
MANUAL ADDITION
- review everything in there
- first review the reef_boundary object - as it is required for all cleanup stages
############################
*/

// This can be hand drawn or imported from elsewhere, or could just be a big box
// Reef_boundary defines export extent and can be used to clip out unwanted areas
var reef_boundary = ee.FeatureCollection([ee.Feature(inner),ee.Feature(outer)]).geometry();
Map.addLayer(reef_boundary, {}, "Manual reef outline", false);



// ############################
// This is the section to add/remove manual cleanups
// You MUST review it for each region
// ############################

if (vars.manual_clean && vars.geomorphic) {
  
  print("Doing GEOMORPHIC manual clean ups - make sure this is what you want to do");
  print("Export the manual map, check 'manual' layer in the viewer for effects");
  
  var depth = ee.Image(region_params.pixels).select('depth');
  var depth_cont = depth.lt(900);
  Map.addLayer(depth_cont, {}, "depth contour", false);
  
  // update these values based on inspection of the layer
  //Map.addLayer(waves.lt(vars.wave_height), {}, vars.wave_height + "m Hs95 threshold", false)
  
  // merged "Rivermouth" and "not reef" extents. Eventually to be moved over to _datagen script, although CR happy to rerun clean up script/assess result and iterate
  
  var midmask = ee.Image().byte().paint(ee.Feature(mid_mask, {zone: 1}), "zone").clip(mid_mask);
  var landmaskfc = ee.FeatureCollection(region_params.land_mask).geometry();
  var landmask = ee.Image().byte().paint(ee.Feature(landmaskfc, {zone: 1}), "zone").clip(landmaskfc);
  var inner_extent = ee.Image().byte().paint(ee.Feature(inner, {zone: 1}), "zone").clip(inner);
  var outer_extent = ee.Image().byte().paint(ee.Feature(outer, {zone: 1}), "zone").clip(outer);
  var notreefcrest = ee.Image().byte().paint(ee.Feature(not_reef_crest, {zone: 1}), "zone").clip(not_reef_crest);
  var notdeepwater = ee.Image().byte().paint(ee.Feature(not_deep_water, {zone: 1}), "zone").clip(not_deep_water);
  var arnhemcoast = ee.Image().byte().paint(ee.Feature(arnhem_coast, {zone: 1}), "zone").clip(arnhem_coast);
  var reefslope = ee.Image().byte().paint(ee.Feature(reef_slope, {zone: 1}), "zone").clip(reef_slope);
  var litchfield = ee.Image().byte().paint(ee.Feature(litchfield_coast, {zone: 1}), "zone").clip(litchfield_coast);
  var northernwa = ee.Image().byte().paint(ee.Feature(northern_wa, {zone: 1}), "zone").clip(northern_wa);
  var dampier = ee.Image().byte().paint(ee.Feature(dampier_coast, {zone: 1}), "zone").clip(dampier_coast);
  var welleslytiwi = ee.Image().byte().paint(ee.Feature(wellesly_tiwi, {zone: 1}), "zone").clip(wellesly_tiwi);
  var tiwi = ee.Image().byte().paint(ee.Feature(tiwi_is, {zone: 1}), "zone").clip(tiwi_is);

  // define the manually edited map - uses the output from the second pass of cleaning
  var man_geo = ee.Image(region_params.geo_map_clean2);
 
  // "LAND MASK" CLEAN
  // remove
  man_geo = man_geo.where({
    test: landmask.eq(1),
    value: ee.Image(0)
  });
  
  // "NOT REEF" CLEAN
  // remove
  man_geo = man_geo.where({
    test: midmask.eq(1),
    value: ee.Image(0)
  });
  
  /*// WAVE clean ############# ---> (to be integrated into RF classifier when feasible)
  // remove
  man_geo = man_geo.where({
    test: waves.lte(vars.wave_height)
               .and(man_geo.eq(22)),
    value: ee.Image(21)
  })*/
  
  // **Deep Water clean**
  
  // Reef crest -> Inner reef flat (inside the reef) + Yawajaba Island (inshore)
  man_geo = man_geo.where({
    test: notreefcrest.eq(1)
                     .and(man_geo.eq(15)),
    value: ee.Image(13)
  });
  
  // Deep water -> Deep lagoon (inside the reef)
  man_geo = man_geo.where({
    test: notdeepwater.eq(1)
                     .and(man_geo.eq(2)),
    value: ee.Image(12)
  });
  
  // Shallow lagoon/Deep lagoon/Shelterd reef slope -> Reef slope (around the reef edge)
  man_geo = man_geo.where({
    test: reefslope.eq(1)
                     .and(man_geo.eq(11)).or(man_geo.eq(12)).or(man_geo.eq(21)),
    value: ee.Image(22)
  });
  
  // Reef slope/Sheletered reef slope -> Deep lagoon (insided the reef)
  man_geo = man_geo.where({
    test: notdeepwater.eq(1)
                     .and(man_geo.eq(22)).or(man_geo.eq(21)),
    value: ee.Image(12)
  });
  

  // **Shallow Water clean**
  
  // Create smoothed depth layer to use in where operations
  var smooth_depth = depth
                      //.unmask(99)
                      .focal_mode({
                        radius: vars.smooth_radius, // relates to smoothness required
                        kernelType: 'circle', units: 'pixels', iterations: 2
                      });
  
  
  // **Litchfield Coast**
  
  // Inner reef flat/Outer reef flat -> TRF
  man_geo = man_geo.where({
    test: litchfield.eq(1)
                     .and(man_geo.eq(13)).or(man_geo.eq(14)),
    value: ee.Image(16)
  });
  
  // Non TRF -> Mask
  man_geo = man_geo.where({
    test: litchfield.eq(1)
                     .neq(man_geo.eq(16)),
    value: ee.Image(0)
  });
  
  // **Arnhem Land Coast**
  
  // Shallow lagoon, IRF, SRS, BRS, RC -> TRF
  man_geo = man_geo.where({
    test: arnhemcoast.eq(1)
                     .and(man_geo.eq(11)).or(man_geo.eq(13)).or(man_geo.eq(21)).or(man_geo.eq(24)).or(man_geo.eq(15))
                     .and(smooth_depth.lte(300)),
    value: ee.Image(16)
  });
  
  // Shallow lagoon, IRF, BRS -> Mask
  man_geo = man_geo.where({
    test: arnhemcoast.eq(1)
                     .and(man_geo.eq(11)).or(man_geo.eq(16)).or(man_geo.eq(21)).or(man_geo.eq(24))
                     .and(smooth_depth.gt(300)),
    value: ee.Image(0)
  });
  
  // **Northern WA Coast** was 150 and BRS
  // Shallow lagoon, IRF, BRS -> TRF 
  man_geo = man_geo.where({
    test: northernwa.eq(1)
                     .and(man_geo.eq(11)).or(man_geo.eq(16)).or(man_geo.eq(24))
                     .and(smooth_depth.gt(150)),
    value: ee.Image(0)
  });
  
  // Shallow lagoon, IRF, Sheltered slope -> TRF
  man_geo = man_geo.where({
    test: northernwa.eq(1)
                     .and(man_geo.eq(11)).or(man_geo.eq(13)).or(man_geo.eq(21)).or(man_geo.eq(24)),
    value: ee.Image(16)
  });
  
  // **Dampier Coast**
  
  // Shallow lagoon, IRF, BRS -> TRF 
  /*man_geo = man_geo.where({
    test: dampier.eq(1)
                     .and(man_geo.eq(11)).or(man_geo.eq(16))
                     .and(smooth_depth.gt(200)),
    value: ee.Image(0)
  });*/
  
  // Shallow lagoon, IRF, Sheltered slope -> TRF
  man_geo = man_geo.where({
    test: dampier.eq(1)
                     .and(man_geo.eq(11)).or(man_geo.eq(13)).or(man_geo.eq(21)),
    value: ee.Image(16)
  });
  
  // **Wellesley Island & Tiwi Islands**
  
  // Shallow lagoon -> BRS 
  man_geo = man_geo.where({
    test: welleslytiwi.eq(1)
                     .and(man_geo.eq(11)),
    value: ee.Image(24)
  });
  
  // IRF, SRS -> TRF 
  man_geo = man_geo.where({
    test: welleslytiwi.eq(1)
                     .and(man_geo.eq(13)).or(man_geo.eq(21)),
    value: ee.Image(16)
  });
  
  // BRS -> TRF
  man_geo = man_geo.where({
    test: tiwi.eq(1)
                     .and(man_geo.eq(24)),
    value: ee.Image(16)
  });
  
  /*// LAND mask clean ############# ---> to be moved to first stage clean up
  var land_mask = mod_land.select('water_mask').mean().eq(0)

  var land_mask_buff = ee.Image(1)
    .cumulativeCost({
      source: land_mask, 
      maxDistance: 2000,
      geodeticDistance: false,
    }).lt(2000).unmask(0)
  
  Map.addLayer(land_mask_buff, {}, "Land mask", false)
  
  */
  
  
  // Add the manual layer to the map
  var image = ee.Image(region_params.image);
  Map.addLayer(image, {bands: ['b3','b2','b1'], min:0, max:4000, gamma:1.5}, sensor_params.sname + ' low tide', true);
  
  var geo_clean1 = ee.Image(region_params.geo_map_clean1);
  Map.addLayer(geo_clean1, map_palettes.geo, 'Geo clean stage 1', false);
  var geo_clean2 = ee.Image(region_params.geo_map_clean2);
  Map.addLayer(geo_clean2, map_palettes.geo, 'Geo clean stage 2', false);
  Map.addLayer(man_geo.updateMask(man_geo.gt(2)), map_palettes.geo, 'Geo clean stage 3 - MANUAL', true);
  
  // Export
  var output_name = (vars.geomorphic) ? vars.geomorph_output_name : vars.benthic_output_name;
  Export.image.toAsset({
    image: man_geo,
    description: output_name,
    assetId: vars.asset_output + 'in_out/' + output_name,
    region: reef_boundary,
    scale: vars.image_data_scale,
    crs: 'EPSG:4326',
    maxPixels: 1e13,
    pyramidingPolicy: {'.default': 'mode'}
  });
  
} 

if (vars.manual_clean && !vars.geomorphic) {
  
  print("Doing BENTHIC manual clean ups - make sure this is what you want to do");
  print("Export the manual map, check 'manual' layer in the viewer for effects");
  
  var depth = ee.Image(region_params.pixels).select('depth');
  var depth_cont = depth.lt(900);
  Map.addLayer(depth_cont, {}, "depth contour", false);
  
  // define the final geomorphic map (the manually edited geo map - stage 3)
  var geo_map = ee.Image(region_params.geo_map_clean3);
  
  var man_benthic = ee.Image(region_params.benthic_map_clean1);
  
  // Generic benthic rules
  
    // Coral in Deep/shallow lagoon -> sand
    man_benthic = man_benthic.where({
      test: man_benthic.eq(15)
                     .and(geo_map.eq(11).or(geo_map.eq(12))),
      value: ee.Image(11)
    });
    
    // BMA on inner/outer RF -> rubble 
    man_benthic = man_benthic.where({
      test: man_benthic.eq(18)
                     .and(geo_map.eq(13).or(geo_map.eq(14))),
      value: ee.Image(12)
    });
    
    
    // manual polygon guided rules
    // West Hawaii
    
    // East and West copied here to run in benthic clean, originally defined under manual cleanup for geo - sort out later PT
    var west_extent = ee.Image().byte().paint(ee.Feature(west, {zone: 1}), "zone").clip(west);
    var east_extent = ee.Image().byte().paint(ee.Feature(east, {zone: 1}), "zone").clip(east);
   
    
    // Sand or BMA on Reef slope == coral/algae (on the steeper reef slope areas)
    man_benthic = man_benthic.where({
     test: steepslope.eq(1)
                      .and(geo_map.eq(22))
                      .and(man_benthic.eq(11).or(man_benthic.eq(18))),
     value: ee.Image(15)
     });
    
    // BMA on Reef Crest == coral/algae
    man_benthic = man_benthic.where({
      test: west_extent.eq(1)
                       .and(geo_map.eq(15))
                       .and(man_benthic.eq(18)),
      value: ee.Image(15)
    });
    
    // East and West Hawaii
    // BMA on DW/DL/SRS/RS/plateau/BRS == sand
    man_benthic = man_benthic.where({
      test: man_benthic.eq(18)
                     .and(geo_map.eq(2).or(geo_map.eq(12)).or(geo_map.eq(21)).or(geo_map.eq(22)).or(geo_map.eq(23)).or(geo_map.eq(24))),
      value: ee.Image(11)
    });
    
    // East Hawaii
    // Sand on RS and plateau == rock
    man_benthic = man_benthic.where({
      test: east_extent.eq(1)
                       .and(man_benthic.eq(11))
                       .and(geo_map.eq(14).or(geo_map.eq(22)).or(geo_map.eq(23))),
      value: ee.Image(13)
    });
  
  
  // Add the manual layer to the map
  //var image = ee.Image(region_params.image);
  //Map.addLayer(image, {bands: ['b3','b2','b1'], min:200, max:1200}, 'Dove low tide', false);
  
  var benthic_clean1 = ee.Image(region_params.benthic_map_clean1);
  Map.addLayer(geo_map, map_palettes.geo, 'Geo clean stage 3 - MANUAL', false);
  Map.addLayer(benthic_clean1, map_palettes.benthic, 'Benthic clean stage 1', false);
  Map.addLayer(man_benthic, map_palettes.benthic, 'Benthic clean stage 2 - MANUAL', true);
  
  // Export
  var output_name = (vars.geomorphic) ? vars.geomorph_output_name : vars.benthic_output_name;
  Export.image.toAsset({
    image: man_benthic,
    description: output_name,
    assetId: vars.asset_output + 'in_out/' + output_name,
    region: reef_boundary,
    scale: vars.image_data_scale,
    crs: 'EPSG:4326',
    maxPixels: 1e13,
    pyramidingPolicy: {'.default': 'mode'}
  });
  
}

// ############################
// END OF MANUAL SECTION
// ############################


// 2. Data loads & vis

// load input data

// define raw geo/benthic outputs
// Run check to see if the region has been split into multiple areas

// geo
if (ee.List(region_params.geo_map).length().getInfo() > 1) {
  var geo_map_raw = ee.Image(region_params.geo_map[0]).unmask(0, false)
               .add(ee.Image(region_params.geo_map[1]).unmask(0,false))
               .selfMask();
} else {
  var geo_map_raw = ee.Image(region_params.geo_map);
}

// benthic
if (ee.List(region_params.benthic_map).length().getInfo() > 1) {
    var benthic_map = ee.Image(region_params.benthic_map[0]).unmask(0, false)
             .add(ee.Image(region_params.benthic_map[1]).unmask(0,false))
             .selfMask();
} else {
    var benthic_map = ee.Image(region_params.benthic_map);
}

// set the geo map for further processing
if (vars.geomorphic && vars.obia_2nd_pass) {
  // if it's 2nd pass, you want to make sure you're loading the latest geo clean map
  var geo_map = ee.Image(region_params.geo_map_clean1);
} else if (vars.geomorphic) {
  var geo_map = geo_map_raw;
}

var depth = ee.Image(region_params.pixels).select('depth');
var low_tide_image = ee.Image(region_params.image);

var display_pal = (vars.geomorphic) ? map_palettes.geo : map_palettes.benthic;
//Map.centerObject(eg_area, 11)
Map.addLayer(depth, {min:0, max:2500}, 'Depth data', false);
Map.addLayer(low_tide_image, {bands: ['b3','b2','b1'], min:0, max:3000}, sensor_params.sname + ' low tide', false);

// load for display purposes
if (vars.geomorphic) {
  Map.addLayer(geo_map_raw, display_pal, 'Geomorphic map RAW', false);
  if (vars.cleanup_stage == 2) Map.addLayer(ee.Image(region_params.geo_map_clean1), display_pal, 'Geomorphic map - stage 1 clean', false);
}
if (!vars.geomorphic) {
  // Use the manually cleaned geomorphic map as input for the benthic clean
  var geo_map = ee.Image(region_params.geo_map_clean3);
  if (!vars.manual_clean) Map.addLayer(geo_map.updateMask(geo_map.gt(2)), map_palettes.geo, 'Final geo map (manual clean - stage 3)', false);
  Map.addLayer(benthic_map, display_pal, 'Benthic map RAW', false);
}

// 3. Object-based re-classificaiton and cleaning

/*

// if we want to retain the land/waves flags, need to add them in before makign the mask

######## Not that straight forwards - the land and bright masks are a LOT of not land and not breakign waves... =(

// add in land, for geomorphic clean up rules
  geo_map = geo_map.unmask(0).where({
    test: depth.eq(-2).and(globcover.select('landcover').neq(210)),
    value: ee.Image(1)
  })
  
  // change -3 to reef rim, hope that clouds have been handleded by masking
  geo_map = geo_map.unmask(0).where({
    test: depth.eq(-3),
    value: ee.Image(15)
  })
  
  // remask
  geo_map = geo_map.updateMask(geo_map.gt(0))

*/


/* OUTPUT EXTENT
  - to the mapping extent just so it doesn't balloon out
  - to the 'reef boundary' extent for noise/deep removal
*/  
var class_extent_mask = geo_map.gt(0);

/*

########
Initial small object clean
 - this was originally at the end, but we needed to massively reduce the number of objects to 
   iterate through in the OBIA cleaning, so this happens first now
 - future collabs with google might fix this, but need to change the parallel serialisation of vector procesing
 
 - includes a possible special case for:
      - geomorphic to clean up turbid areas over size threshold; fix shallow vs. deep lagoon
      - benthic to allow breaking waves (temporal class) to grow into surrounding class
########

*/

if (vars.geomorphic && !vars.obia_2nd_pass) {
  
  // make a smooth map with masked area as a value
  var smooth_map = geo_map
                      //.unmask(99)
                      .focal_mode({
                        radius: vars.smooth_radius, // relates to smoothness required
                        kernelType: 'circle', units: 'pixels', iterations: 2
                      });
  //smooth_map = smooth_map.updateMask(smooth_map.neq(99)).updateMask(class_extent_mask)
  
  //replace small objects with smooth underneath
  var clean_map = geo_map.where({
    test: geo_map.connectedPixelCount(vars.small_object_geo, false).lt(vars.small_object_geo), 
    value: smooth_map
  //}).updateMask(smooth_map.neq(99)).updateMask(class_extent_mask)
  }).updateMask(class_extent_mask);
  
  // shallow lagoon > 5m == deep lagoon
  clean_map = clean_map.where({
    test: clean_map.eq(11)
                   .and(depth.gt(vars.shallowlag_depth_cutoff)),
    value: ee.Image(12)
  });
  
  /*// deep lagoon == deep (to hard to differentiate deep water vs. deep lagoon effectively over large areas)
  clean_map = clean_map.where({
    test: clean_map.eq(12),
    value: ee.Image(2)
  })*/
  
  // deep water in depth data == deep (s2 + ls8 data should be good enough for this)
  clean_map = clean_map.where({
    test: depth.gt(vars.geo_depth_cutoff),
    value: ee.Image(2)
  });
  
  // deep water in depth data == deep (only for inshore reefs of Timor Sea)
  var inner_extent = ee.Image().byte().paint(ee.Feature(inner, {zone: 1}), "zone").clip(inner);
  clean_map = clean_map.where({
    test: depth.gt(400)
                   .and(inner_extent.eq(1)),
    value: ee.Image(2)
  });
  
  // LAND mask cleaning
  Map.addLayer(land_dist.lte(vars.dist_to_land), {}, "Land mask (dist to land)", false);
  
  // reef crest close to land -> TRF (only for inner reefs of Timor Sea)
  var inner_extent = ee.Image().byte().paint(ee.Feature(inner, {zone: 1}), "zone").clip(inner);
  clean_map = clean_map.where({
    test: land_dist.lte(vars.dist_to_land)
                   .and(inner_extent.eq(1))
                   .and(clean_map.eq(15)),
    value: ee.Image(16)
  });
  
  // TRF far from land -> ORF
  clean_map = clean_map.where({
    test: land_dist.gt(vars.dist_to_land)
                   .and(clean_map.eq(16)),
    value: ee.Image(14)
  });
  
  
  
  /*//CLEAN UP SMALL (but slightly larger) TURBID AREAS
  var smooth_noturbid = clean_map
                          .updateMask(clean_map.neq(3))
                          .focal_mode({
                            radius: vars.smooth_radius.multiply(1.5),
                            kernelType: 'circle', units: 'pixels', iterations: 2
                          })
  
  clean_map = clean_map.where({
    test: clean_map.eq(3).connectedPixelCount(vars.small_object_geo.multiply(10), false).lt(vars.small_object_geo.multiply(10)), 
    value: smooth_noturbid
  }).updateMask(class_extent_mask)*/
}


if (!vars.geomorphic && vars.cleanup_stage == 1) {
  
  // make a smooth map with masked area as a value, and without temporal class (basically breaking waves)
  var smooth_map = benthic_map
                      //.unmask(99)
                      .focal_mode({
                        radius: vars.smooth_radius, // relates to smoothness required
                        kernelType: 'circle', units: 'pixels', iterations: 1
                      });
  //smooth_map = smooth_map.updateMask(smooth_map.neq(99)).updateMask(class_extent_mask)
  
  //replace small objects with smooth underneath
  var clean_map = benthic_map.where({
    test: benthic_map.connectedPixelCount(vars.small_object_benthic, false).lt(vars.small_object_benthic),
    value: smooth_map
  //}).updateMask(smooth_map.neq(99)).updateMask(class_extent_mask)
  }).updateMask(class_extent_mask);
  
  
  /*// CLEAN UP ALL TEMPORAL AREAS
  var smooth_notemp = benthic_map
                          .updateMask(benthic_map.neq(2))
                          .focal_mode({
                            radius: vars.smooth_radius.multiply(2),
                            kernelType: 'circle', units: 'pixels', iterations: 3
                          })
  
  
  clean_map = clean_map1.where({
    test: benthic_map.eq(2), 
    value: smooth_notemp
  }).updateMask(clean_map1.gte(0))
  
  // this catches any left over unmasked temporal, and assigned it back to temporal
  clean_map = clean_map.where({
    test: clean_map.unmask(99).eq(99).and(clean_map1.eq(2)),
    value: ee.Image(2)
  })*/
  
}



if (vars.geomorphic && vars.obia_2nd_pass) {
  var clean_map = geo_map;
}

if (vars.obia_clean) {
  
  if (vars.geomorphic && !vars.fast_clean) { // SHOULD TRY TO PUT THIS OUT TO A MODULE TO KEEP THE RULES THE SAME EVERYWEHRE?
    
    // #########
    // THE PLAN - vectorise one/few class/es at a time, thus only spending resources on what is actually needed to clean up
    // #########
    
    // FUNCTION that maps over feature colleciton and assigns neighbour percentages
    var set_neighbour_properties = function(f) {
      // make the 1px buffer
      var diff = f.buffer(vars.image_data_scale).difference(f, ee.ErrorMargin(0.5));
      // reduce the classes in the buffer zone
      var diff_classes = ee.Dictionary(
        clean_map.unmask(ee.Image(0)).reduceRegion({
          reducer: ee.Reducer.frequencyHistogram(),
          geometry: diff.geometry(),
          scale: vars.image_data_scale,
          maxPixels: 1e11
        }).get('classification')
      );
      // calculate the percentages
      var diff_sum = diff_classes.toArray().reduce(ee.Reducer.sum(), [0]).get([0]);
      var diff_percs = diff_classes.map(function(k,v){return(ee.Number(v).divide(diff_sum).multiply(100).toUint8())});
      
      /* NOW, we can try to do the class logic right here (see /users/mitchest/global_reefs/obia_dev),
         or we can return the neighbour % and do image logic via (painted) rasters */
      
      return(f.set(diff_percs));
    };
    
    // FUNCTION to reduce the map to vectors and map the neighbour properties function
    var reduce_neighbours = function() {
      // reduce map to vectors
      var map_fc = clean_map
            .updateMask(segment_id).updateMask(clean_map.eq(classn)) // only vectorise class/es of interest
            .reduceToVectors({
              scale: vars.image_data_scale, 
              eightConnected: false,
              bestEffort: true, 
              maxPixels: 1e13,
              tileScale: 1,
              geometry: reef_boundary
            });
      // map the function, calculate neighbour properties
      return(map_fc.map(set_neighbour_properties));
    };
    
    // first make a make size threshold, so we're not vecortising huge objects when we don't have to
    var segment_id = clean_map.connectedComponents(ee.Kernel.plus(1),vars.small_object_geo.sqrt()).select('labels');
    //Map.addLayer(segment_id.reproject(ee.Projection('EPSG:4326').atScale(ee.Number(vars.image_data_scale))))
    Map.addLayer(clean_map.updateMask(segment_id).reproject(ee.Projection('EPSG:4326').atScale(ee.Number(vars.image_data_scale))), display_pal, 'Map objects to be iterated through (OBIA)', false);
    
    // This is where we select the single or group of classes to vectorise for cleaning up
    //var classn = ee.Number(15) // one class
    var classn = clean_map.where({
      test: clean_map.neq(16) //TRF
              .and(clean_map.neq(15)) //RR
              .and(clean_map.neq(14)) //ORF
              .and(clean_map.neq(13)) //IRF
              //.and(clean_map.neq(12)) // deep L
              .and(clean_map.neq(11)), // shallow L 
      value: ee.Image(99) // 99 ensures it's ignored in logic
    });
    
    // Minimum size of object to reclass based on neighbourhood
    var max_size = ee.Number(1000).divide(vars.image_data_scale).pow(2); // the first number is the square dimension of the desired min size;
    // calculate neighbours
    var map_fc_neighbours = reduce_neighbours();
    
    // #########
    // REEF RIM
    // #########
    
    var focus_class = ee.Number(15); //RR
    
    // start the object-based neighbourhood rules
    // paint out to rasters (only paint the layers needed)
    var objsize = ee.Image(30000).paint(map_fc_neighbours, 'count').rename('count');
    //var nb24 = ee.Image().byte().paint(map_fc_neighbours, '24').unmask(0).rename('nb24') //OCL
    var nb22 = ee.Image().byte().paint(map_fc_neighbours, '22').unmask(0).rename('nb22'); //SL ex
    var nb21 = ee.Image().byte().paint(map_fc_neighbours, '21').unmask(0).rename('nb21'); //Sl sh
    var nb16 = ee.Image().byte().paint(map_fc_neighbours, '16').unmask(0).rename('nb16'); //TRF
    var nb15 = ee.Image().byte().paint(map_fc_neighbours, '15').unmask(0).rename('nb15'); //RR
    var nb14 = ee.Image().byte().paint(map_fc_neighbours, '14').unmask(0).rename('nb14'); //ORF
    var nb13 = ee.Image().byte().paint(map_fc_neighbours, '13').unmask(0).rename('nb13'); //IRF
    //var nb3 = ee.Image().byte().paint(map_fc_neighbours, '3').unmask(0).rename('nb3') //Turbid
    
    // RR surrounded by ORF --> ORF
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb14.gt(75)),
      value: ee.Image(14)
    });
    
    // RR surrounded by IRF --> IRF
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb13.gt(75)),
      value: ee.Image(13)
    });
    
    // RR surrounded by IRF + ORF --> IRF
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb13.add(nb14).gt(75)),
      value: ee.Image(13)
    });
    
    // RR with decent border to TRF --> TRF (often dark, probably seagrass)
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb16.gt(40)),
      value: ee.Image(16)
    });
    
    /*// RR surrounded by OCL --> OCL
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb24.gt(75)),
      value: ee.Image(24)
    })*/
    
    /* with 2nd/3rd pass method, we don't really need this
    // RR surrounded by IRF + ORF --> IRF
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb13.lte(75).and(nb14.lte(75))) // to ensure we're no re-writing previous rules
              .and(nb13.add(nb14).gt(75))
              .and(nb21.add(nb22).lte(0)), // to not get rid of complex reef rims (if touching slope, it's probably RR)
      value: ee.Image(13) // could try assigning to a place-holder, then deal with at the end?
    })*/
    
    /*// small RR objects touching OCL + stuff --> ORF
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(objsize.lte(max_size))
              .and(nb13.lte(75).and(nb14.lte(75))) // to ensure we're no re-writing previous rules
              .and(nb24.gt(1)),
      value: ee.Image(14)
    })*/
    
    // ####
    // ORF
    // ####
    
    focus_class = ee.Number(14); // ORF
    
    //classn = ee.Number(14)
    //map_fc_neighbours = reduce_neighbours()
    //var nb22 = ee.Image().byte().paint(map_fc_neighbours, '22').unmask(0).rename('nb22') //SL ex
    //var nb21 = ee.Image().byte().paint(map_fc_neighbours, '21').unmask(0).rename('nb21') //Sl sh
    //nb15 = ee.Image().byte().paint(map_fc_neighbours, '15').unmask(0).rename('nb15') //RR
    //nb13 = ee.Image().byte().paint(map_fc_neighbours, '13').unmask(0).rename('nb13') //IRF
    //var nb1 = ee.Image().byte().paint(map_fc_neighbours, '1').unmask(0).rename('nb1') //Land
    
    // ORF surrounded by IRF --> IRF
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb13.gt(75)),
      value: ee.Image(13)
    });
    
    // ORF surrounded by TRF --> TRF
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb16.gt(75)),
      value: ee.Image(16)
    });
    
    // ORF surrounded by RR --> RR
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb15.gt(85)),
      value: ee.Image(15)
    });
    
    // ORF touching slope and RR --> RR
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb21.gt(0).or(nb22.gt(0)))
              .and(nb15.gt(0)),
      value: ee.Image(15)
    });
    
    /*// ORF touching land --> TRF
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb1.gt(10)),
      value: ee.Image(16)
    })*/
    
    // ####
    // IRF
    // ####
    
    focus_class = ee.Number(13); // IRF
    
    //classn = ee.Number(13)
    //map_fc_neighbours = reduce_neighbours()
    //nb15 = ee.Image().byte().paint(map_fc_neighbours, '15').unmask(0).rename('nb15') //RR
    //nb14 = ee.Image().byte().paint(map_fc_neighbours, '14').unmask(0).rename('nb14') //ORF
    
    // IRF surrounded by ORF --> ORF
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb14.gt(75)),
      value: ee.Image(14)
    });
    
    // IRF surrounded by TRF --> TRF
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb16.gt(75)),
      value: ee.Image(16)
    });
    
    // IRF surrounded by RR --> RR
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb15.gt(85)),
      value: ee.Image(15)
    });
    
    /*// IRF touching land --> TRF
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb1.gt(10)),
      value: ee.Image(16)
    })*/
    
    // ####
    // TRF
    // ####
    
    focus_class = ee.Number(16); // TRF
    
    //classn = ee.Number(16)
    //map_fc_neighbours = reduce_neighbours()
    //nb15 = ee.Image().byte().paint(map_fc_neighbours, '15').unmask(0).rename('nb15') //RR
    //nb14 = ee.Image().byte().paint(map_fc_neighbours, '14').unmask(0).rename('nb14') //ORF
    //nb13 = ee.Image().byte().paint(map_fc_neighbours, '13').unmask(0).rename('nb13') //IRF
    
    // TRF surrounded by ORF --> ORF
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb14.gt(75)),
      value: ee.Image(14)
    });
    
    // TRF surrounded by IRF --> IRF
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb13.gt(75)),
      value: ee.Image(13)
    });
    
    // TRF surrounded by IRF + ORF --> IRF
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb13.add(nb14).gt(75)),
      value: ee.Image(13)
    });
    
    /*// TRF not touching land --> IRF
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb1.lt(10)),
      value: ee.Image(13)
    })*/
    
    
    // ####
    // LAGOONS
    // ####
    
    var nb11 = ee.Image().byte().paint(map_fc_neighbours, '11').unmask(0).rename('nb11'); // shallow lag
    //var nb12 = ee.Image().byte().paint(map_fc_neighbours, '12').unmask(0).rename('nb12') //deep lag
    
    // DL touching SL --> SL
    /* 
    This is a stop-gap until we have better depth product - below are the rules we want,
    but too much band-aiding is required to make it work, so for the moment just err on the side
    of shallow lagoon when it's mixed.
    */
    /*clean_map = clean_map.where({
      test: clean_map.eq(12)
              .and(nb11.gt(0)),
      value: ee.Image(11)
    })*/
    
    /*// SL sourrounded by DL --> DL
    clean_map = clean_map.where({
      test: clean_map.eq(11)
              .and(nb12.gt(75)),
      value: ee.Image(12)
    })*/
    
    /*// DL sourrounded by SL --> SL
    clean_map = clean_map.where({
      test: clean_map.eq(12)
              .and(nb11.gt(75)),
      value: ee.Image(11)
    })*/
    
    /*// DL/SL surrounded by IRF --> IRF
    clean_map = clean_map.where({
      test: clean_map.eq(11).or(clean_map.eq(12))
              .and(objsize.lte(max_size))
              .and(nb13.gt(80)),
      value: ee.Image(13)
    })*/
    
    // SL surrounded by IRF --> IRF
    clean_map = clean_map.where({
      test: clean_map.eq(11)
              .and(objsize.lte(max_size))
              .and(nb13.gt(80)),
      value: ee.Image(13)
    });
    
    /*// DL/SL touching OCL --> OCL
    clean_map = clean_map.where({
      test: clean_map.eq(11).or(clean_map.eq(12))
              .and(nb24.gt(0)),
      value: ee.Image(24)
    })*/
    
    
    /*// ####
    // Turbid
    // ####
    
    focus_class = ee.Number(3) // turbid
    
    // Turb surrounded by IRF --> IRF
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb13.gt(75)),
      value: ee.Image(13)
    })
    
    // Turb surrounded by ORF --> ORF
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb14.gt(75)),
      value: ee.Image(14)
    })
    
    // Turb surrounded by TRF --> TRF
    clean_map = clean_map.where({
      test: clean_map.eq(focus_class)
              .and(nb16.gt(75)),
      value: ee.Image(16)
    })*/
  
  } else if (vars.geomorphic && vars.fast_clean) {
    print("Executing the fast version OBIA");
    
    /* fast version of the geo clean up
      - blanket version assigns the underlying most common in neighbourhood
      - mode OBIA version iterates through objects+buffers but take the mode instead of doing the class percs, to see if that speeds things up
    */
    
    
    //############
    //# blanket version
    //############
    // make a very smooth map to capture the broader neighbourhood
    var smooth_map = clean_map
                        .focal_mode({
                          radius: vars.smooth_radius.multiply(3), // relates to smoothness required
                          kernelType: 'circle', units: 'pixels', iterations: 2
                        });
    
    
    // first make a make size threshold, so we're not vectorising huge objects when we don't have t
    // - the unmask(99) captures small no data values/ data gaps
    var segment_id = clean_map.unmask(0).connectedComponents(ee.Kernel.plus(1),vars.small_object_geo.sqrt().multiply(2)).select('labels').pow(2).log().int();
    Map.addLayer(clean_map.unmask(0).updateMask(segment_id.gt(0)).reproject(ee.Projection('EPSG:4326').atScale(ee.Number(vars.image_data_scale))), display_pal, 'Map objects to be iterated through (OBIA)', false);
    
    
    // replace small objects with smooth underneath
    var clean_map = clean_map.unmask(0).where({
      test: segment_id.gt(0), 
      value: smooth_map
    }).selfMask();
    //############
    //############
    
    
    /*    
    //############
    //# mode OBIA version
    //############
    
    // #########
    // THE FASTER PLAN - vectorise one/few class/es at a time, thus only spending resources on what is actually needed to clean up
    //                 - BUT, just assign the mode of the neighbours, so save resouces even further??
    // #########
    
    // FUNCTION that maps over feature colleciton and assigns neighbour percentages
    var set_neighbour_mode = function(f) {
      // make the 1px buffer
      var diff = f.buffer(vars.image_data_scale).difference(f, ee.ErrorMargin(0.5))
      // reduce the classes in the buffer zone
      var diff_mode = ee.Number(ee.Dictionary(
        clean_map.unmask(ee.Image(0)).reduceRegion({
          reducer: ee.Reducer.mode(),
          geometry: diff.geometry(),
          scale: vars.image_data_scale,
          maxPixels: 1e11
        })).get('classification'))
      
      return(f.set('mode',diff_mode))
    }
    
    // FUNCTION to reduce the map to vectors and map the neighbour properties function
    var reduce_neighbours_mode = function() {
      // reduce map to vectors
      var map_fc = clean_map.unmask(0)
            .updateMask(classn.gt(0)) // only vectorise class/es of interest
            .reduceToVectors({
              scale: vars.image_data_scale, 
              eightConnected: false,
              bestEffort: true, 
              maxPixels: 1e13,
              tileScale: 1,
              geometry: reef_boundary
            })
      // map the function, calculate neighbour properties
      return(map_fc.map(set_neighbour_mode))
    }
    
    // first make a make size threshold, so we're not vecortising huge objects when we don't have to
    var segment_id = clean_map.unmask(0).connectedComponents(ee.Kernel.plus(1),vars.small_object_geo.sqrt()).select('labels')
    Map.addLayer(clean_map.unmask(0).updateMask(segment_id.gt(0)).reproject(ee.Projection('EPSG:4326').atScale(ee.Number(vars.image_data_scale))), display_pal, 'Map objects to be iterated through (OBIA)', false)
    
    // This is where we select the single or group of classes to vectorise for cleaning up
    var classn = segment_id.where({
      test: clean_map.neq(16) //TRF
              .and(clean_map.neq(15)) //RR
              .and(clean_map.neq(14)) //ORF
              .and(clean_map.neq(13)) //IRF
              //.and(clean_map.neq(12)) // deep L
              .and(clean_map.neq(11)) // shallow L 
              .and(clean_map.unmask(0).neq(0)), // no data values (want to reclaim the small gaps 
      value: ee.Image(0) // 99 ensures it's ignored in logic
    })
    
    // calculate neighbours
    var map_fc_neighbours = reduce_neighbours_mode()
    
    //print(map_fc_neighbours.limit(10))
    
    var mode_map = ee.Image().byte().paint(map_fc_neighbours, 'mode').unmask(0).rename('mode') // paint out the mode values to an image
    //Map.addLayer(mode_map, display_pal, "mode map", false)
    
    // replace small objects with mode underneath
    var clean_map = clean_map.unmask(0).where({
      test: segment_id.gt(0), 
      value: mode_map
    }).selfMask()
    
    //############
    //############
    */
    
  } else {
    
    if (vars.cleanup_stage == 1) {
      // BENTHIC CLEAN-UP RULES
      
      // reclaim shallow no data to surrounding class
      var smooth_map = clean_map
                          .focal_mode({
                            radius: vars.smooth_radius.multiply(3), // relates to smoothness required
                            kernelType: 'circle', units: 'pixels', iterations: 2
                          });
      
      var clean_map = clean_map.unmask(0).where({
        test: geo_map.gt(2).and(clean_map.eq(0)), 
        value: smooth_map
      }).selfMask();
      
      // cut benthic off to < 10 - 15 m
      clean_map = clean_map.where({
        test: depth.gt(vars.benthic_depth_cutoff),
        value: ee.Image(0)
      });
      
      // Deep (or land or missing) in geo == masked from benthic
      clean_map = clean_map.where({
        test: geo_map.unmask(0).lte(2),
        value: ee.Image(0)
      });
      
      /*// Deep lagoon in geo == masked from benthic
      clean_map = clean_map.where({
        test: geo_map.eq(12),
        value: ee.Image(0)
      })*/
      
      
      /*// turbid in geo == turbid (temporal - class num 2)
      // ############## ---> need to decide here whether to push geo turbid through regardless of benthic class
      clean_map = clean_map.where({
        test: geo_map.eq(3),
        value: ee.Image(2)
      })*/
      
      /*
      // Ignore in benthic + ORF in geo == rock
      clean_map = clean_map.where({
        test: clean_map.eq(0)
                       .and(geo_map.eq(14)),
        value: ee.Image(13)
      })
      
      // Ignore in benthic + IRF in geo == sand
      clean_map = clean_map.where({
        test: clean_map.eq(0)
                       .and(geo_map.eq(13)),
        value: ee.Image(11)
      })
      
      // Ignore in benthic + TRF in geo == sand
      clean_map = clean_map.where({
        test: clean_map.eq(0)
                       .and(geo_map.eq(16)),
        value: ee.Image(11)
      })
      
      // Ignore in benthic + RR in geo == rock
      */
      
      /*// seagrass in benthic + ORF/RR/slope in geo == coral/algae
      clean_map = clean_map.where({
        test: clean_map.eq(14)
                       .and(geo_map.eq(14).or(geo_map.eq(15)).or(geo_map.eq(21)).or(geo_map.eq(22))),
        value: ee.Image(15)
      })*/
      
      // ####--> CR: "Seagrass neighbouring deep water or no data not shallow a rock or coral algae class"
      
      /*// rock in benthic + TRF in geo == sand
      clean_map = clean_map.where({
        test: clean_map.eq(13)
                       .and(geo_map.eq(16)),
        value: ee.Image(11)
      })*/
    }
  }
}

// final smooth
if (!vars.manual_clean) {
  if (vars.smooth_output) {
    // smooth the output lightly to make nice edges, and get rid of noise
    var noise_smooth = clean_map.unmask(99) // unmasking to a value allows us to include masked areas in the smooth, then re-mask after
                          .focal_mode({
                            radius: 2, // relates to smoothness required
                            kernelType: 'circle', units: 'pixels', iterations: 2
                          });
    clean_map = clean_map.updateMask(noise_smooth.neq(99)).updateMask(clean_map.gt(1)); // this ignores 0/land; make it .gt(2) if you want to mask deep too;
  } else {
    // just clip to the classified extent and move on
    if (vars.geomorphic) {
      clean_map = clean_map.updateMask(clean_map.gt(1)); // this ignores 0/land; make it .gt(2) if you want to mask deep too
    } else {
      clean_map = clean_map.updateMask(clean_map.gt(1)); // this ignores 0/land; make it .gt(2) if you want to mask deep too
    }
  }
}

// 4. Export data

var output_name = (vars.geomorphic) ? vars.geomorph_output_name : vars.benthic_output_name;

if (vars.do_export) {
  print("For export, the image data scale must be set to:", vars.image_data_scale);
  
  if (vars.export_small_area) {
    var export_convhull = export_small;
  } else {
    //var export_convhull = clean_map.gt(2).reduceToVectors({scale: 1000, maxPixels: 1e13, bestEffort: true, geometry: region_extent, crs: "EPSG:4326"}).geometry().convexHull({maxError: 100})
    var export_convhull = reef_boundary;
  }
  Map.addLayer(export_convhull, {}, "Export footprint", false);
  
  Export.image.toAsset({
    image: clean_map.set(vars),
    description: output_name,
    assetId: vars.asset_output + 'in_out/' + output_name,
    region: export_convhull,
    scale: vars.image_data_scale,
    crs: 'EPSG:4326',
    maxPixels: 1e13,
    pyramidingPolicy: {'.default': 'mode'}
  });
  /*Export.image.toCloudStorage({
    image: clean_map,//.set(vars),
    description: 'swp_geo_clean',
    bucket: 'mitchest_unet_bucket',
    fileNamePrefix: 'swp_geo_clean',
    region: export_convhull,
    scale: 25,
    crs: 'EPSG:4326',
    maxPixels: 1e13
  })*/
  
} else {
  if (!vars.manual_clean) {
    if (vars.show_eg_area) {
      if (vars.reproject_display) {
        Map.addLayer(clean_map.clip(eg_area).reproject(ee.Projection('EPSG:4326').atScale(vars.image_data_scale)), display_pal, output_name, false);
      } else {
        Map.addLayer(clean_map.clip(eg_area), display_pal, output_name, false);
      }
    } else {
      if (vars.reproject_display) {
        Map.addLayer(clean_map.reproject(ee.Projection('EPSG:4326').atScale(vars.image_data_scale)), display_pal, output_name, true);
      } else {
        Map.addLayer(clean_map, display_pal, output_name, false);
      }
    }
  }
}

//Generate title
var title = ui.Label({
  value: 'Classes',
  style: {fontWeight: 'bold', fontSize: '12px'}
});

// generate the legend
var geo_legend = pkg_vis.discrete_legend(map_palettes.geo_atlas_names, map_palettes.geo_atlas_cols, 'Geomorphic Zone', false);
var benthic_legend = pkg_vis.discrete_legend(map_palettes.benthic_atlas_names, map_palettes.benthic_atlas_cols, 'Benthic Habitat', false);
//var mask_legend = pkg_vis.discrete_legend(["Low confidence depth","Water conditions"], ["#f7f7f7","#bababa"], 'Confidence Mask reason', false)
var legend = (vars.geomorphic) ? geo_legend : benthic_legend;
pkg_vis.add_lgds([title, legend]);//, mask_legend])
// generate the legend
