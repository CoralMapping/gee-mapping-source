/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var pixels = ee.Image("projects/coral_atlas/Indonesia/in_out/indo_pixels"),
    geo = ee.Image("projects/coral_atlas/Indonesia/in_out/indo_geo_clean3"),
    benthic = ee.Image("projects/coral_atlas/Indonesia/in_out/indo_benthic_clean2"),
    FinalMask = /* color: #d63000 */ee.Geometry.MultiPolygon(
        [[[[119.7380070353372, -8.76779336461645],
           [119.73440214642119, -8.767963019957664],
           [119.73028227337431, -8.768641640547655],
           [119.72822233685088, -8.776784990897136],
           [119.71414610394072, -8.801213969157605],
           [119.7017864848001, -8.8079995104589],
           [119.68882639129548, -8.81325856288152],
           [119.67311940372834, -8.810629216611046],
           [119.66608091839385, -8.823266522975322],
           [119.65037340856806, -8.814361252906682],
           [119.62762876995635, -8.80833878425614],
           [119.61732908733916, -8.798839000301887],
           [119.60187956341338, -8.777802897129911],
           [119.60973557295435, -8.767079316777245],
           [119.60218247236841, -8.75452458250573],
           [119.59462937178247, -8.744344757191744],
           [119.59909256758326, -8.738236728444894],
           [119.6067568385441, -8.728426501418735],
           [119.6125933253605, -8.714852389217942],
           [119.61618090745318, -8.70411110635635],
           [119.62991381760943, -8.694269284224738],
           [119.6172108757149, -8.685105976045799],
           [119.59935809251178, -8.682390878768027],
           [119.5787587272774, -8.686463517314971],
           [119.57360888596881, -8.710898419120628],
           [119.53378344651568, -8.808282744210636],
           [119.54006053171211, -8.86804096243032],
           [119.55825663766915, -8.909084124981089],
           [119.62005473337227, -8.929434398582309],
           [119.66125346384102, -8.92977356019477],
           [119.71446849069649, -8.92977356019477],
           [119.74090434274727, -8.908405762999124],
           [119.75669718942696, -8.882966280707645],
           [119.76940013132149, -8.86871939915654],
           [119.77866984567696, -8.854471964815504],
           [119.78484965524727, -8.839545489255013],
           [119.78244639596993, -8.828350235658007],
           [119.77249003610665, -8.826314698488703],
           [119.76871348581368, -8.817154642301599],
           [119.76837016305977, -8.804940880726955],
           [119.7865662690168, -8.747938002897923],
           [119.79858280899155, -8.719857153529533],
           [119.7975525971418, -8.714851969525595],
           [119.79480595263932, -8.705773905396908],
           [119.79240275583321, -8.696695823954766],
           [119.8039040466883, -8.6622476545529],
           [119.79009623010691, -8.662788650396541],
           [119.78508045616213, -8.66662283845931],
           [119.79036437011395, -8.677584448081705],
           [119.78283279830774, -8.681551106376114],
           [119.77137438956582, -8.684223502942588],
           [119.77154057459859, -8.673389480039017],
           [119.76312383192409, -8.671379670668873],
           [119.75590333831323, -8.679578084969108],
           [119.75348917526776, -8.688455147048675],
           [119.76652474913158, -8.694617067514466],
           [119.78210307321602, -8.701107678658],
           [119.76545191965157, -8.723166171807092],
           [119.7445952449264, -8.703483042931941],
           [119.71837352598018, -8.703652125825853],
           [119.69736541295907, -8.723589650397198],
           [119.7282318594963, -8.738649265537353],
           [119.73609782419258, -8.75981432403069],
           [119.73747111520821, -8.765073716516921],
           [119.73884440622383, -8.767109590401132]]],
         [[[123.0439746297099, -3.4531991027941578],
           [123.1098925984599, -3.4511429042062143],
           [123.1813037312724, -3.5011758001736295],
           [123.22936891681927, -3.4634800288892786],
           [123.2534015095927, -3.3346177931843424],
           [123.12980531818646, -3.3023995699966378],
           [123.05358766681927, -3.347641882246474],
           [123.0329883015849, -3.416872274608698]]],
         [[[123.67767881603902, -1.3449348529351492],
           [123.6598260328359, -1.695000299646923],
           [123.51013731213277, -1.818538373879479],
           [123.56781553478902, -1.8981473545775842],
           [123.70514463635152, -1.8281465437102866],
           [123.8465936109609, -1.8308917256565143],
           [124.02512144299214, -1.6853914449716643],
           [124.07318662853902, -1.3106117964629704],
           [123.8081414625234, -1.3202223002226139]]],
         [[[123.33435606213277, -1.590673097157859],
           [123.35907530041402, -1.6551918799877687],
           [123.39890073986714, -1.681273349865664],
           [123.4400994703359, -1.656564597529154],
           [123.4675652906484, -1.6044006694975328],
           [123.44833921642964, -1.5893003348874681],
           [123.4236199781484, -1.5439986727285482],
           [123.34946226330464, -1.545371464697763]]],
         [[[126.99090910184441, 4.672388992331334],
           [126.99777555692253, 4.640907560629837],
           [127.06575346219597, 4.530027053209576],
           [127.1275515578991, 4.543032445296702],
           [127.09665251004753, 4.604633735856597],
           [127.07124662625847, 4.646382693366223],
           [127.00944853055535, 4.6983943265816945]]],
         [[[128.03373292587654, 1.9702977972222604],
           [128.01450685165779, 1.8522604950907313],
           [128.19578126572029, 1.7534324984693421],
           [128.30564454697029, 1.8659861764239347],
           [128.10789064072029, 1.9757877045854408]]],
         [[[128.90729896864443, 0.654880474796044],
           [128.97253034994688, 0.4633155082018015],
           [129.14350514669607, 0.43379065320305643],
           [129.2080498486607, 0.4447766590084619],
           [129.26092159201698, 0.6026985414572167],
           [129.2657281341489, 0.7674817198090691],
           [129.25268186767272, 0.8230946845263083],
           [129.1297722376071, 0.8457516071439484],
           [129.05080795071933, 0.8011242273128305],
           [129.084110424006, 0.7520337048841615],
           [129.12427906889076, 0.7688548980744445],
           [129.15105838151376, 0.736928526847021],
           [129.15861136374357, 0.7022557343222205],
           [129.12702565186294, 0.7022557351296412],
           [129.0329551599447, 0.735212143130636],
           [128.93751138198496, 0.6926433919570274]]],
         [[[129.0472511524015, 0.1558354095055594],
           [129.05068437994055, 0.048032251286301404],
           [129.250498222714, -0.11126943095921629],
           [129.30199663579992, -0.12980881856159424],
           [129.32396929204992, 0.015073272363474745],
           [129.31435625494055, 0.02211138844356035],
           [129.29856340826086, 0.021939727079297918],
           [129.283457207089, 0.0281195360569485],
           [129.2731575244718, 0.04597231545611369],
           [129.2738441699796, 0.05764528429660001],
           [129.37478105962805, 0.02605959976386285],
           [129.4001869434171, 0.2066469212028885],
           [129.0589241260343, 0.20939348513182893]]],
         [[[130.53819529513206, -1.2856080985464549],
           [130.54883833791774, -1.3158125346935425],
           [130.53201548556174, -1.346016967015199],
           [130.51141612032737, -1.3995599423905674],
           [130.79088084200706, -1.6494102423682735],
           [130.849315994329, -1.7654720429973854],
           [130.8441661530204, -1.8052781482090718],
           [130.68228121925065, -1.8063316192601775],
           [130.65344210792253, -1.9545671353642147],
           [130.7015072934694, -1.9902515462484893],
           [130.77566500831315, -1.9353521375389136],
           [130.81720500067252, -1.9597136556704597],
           [130.80982356465762, -2.0089506353513413],
           [130.77935410558717, -2.027393300686597],
           [130.80531815620444, -2.06200473418681],
           [130.8265723779069, -2.085410634382715],
           [130.84645320431434, -2.0539205339578337],
           [130.88346835303972, -2.0609318360966484],
           [130.89720126319597, -2.0966139041299954],
           [130.93703115610853, -2.1199416254709416],
           [130.9473255266979, -2.1768977692264744],
           [130.9035578969361, -2.187016994847733],
           [130.74910608202842, -2.0900549184309076],
           [130.71275793122413, -2.1769799086462096],
           [130.70047706846813, -2.3123959999117507],
           [130.84638061335752, -2.436915039309051],
           [131.08328219581315, -2.524045337309565],
           [131.3826596372194, -2.0424042921845333],
           [131.45819064307878, -2.0561284194098546],
           [131.4760434262819, -2.02181788177853],
           [131.44583102393815, -1.9408421592317375],
           [131.46368380714128, -1.8255480377299582],
           [131.4595639340944, -1.7720160821350883],
           [131.2837826840944, -1.725345933610973],
           [131.19451876807878, -1.7143645546285342],
           [131.09838839698503, -1.6457295247455892],
           [131.0750424497194, -1.6635748637468564],
           [131.07195249501453, -1.6755860048330684],
           [131.08740206886003, -1.6951469900707714],
           [131.08740206886003, -1.725345933610973],
           [131.09976168800065, -1.7390725681387942],
           [131.13958712745378, -1.7445631940371127],
           [131.14679688719173, -1.7479948292237841],
           [131.1519467465944, -1.7555443977061436],
           [131.14233370948503, -1.7761339804050704],
           [131.09838839698503, -1.7692708115337106],
           [131.07092257667253, -1.6924016080826665],
           [131.0475766294069, -1.6525931356622194],
           [130.65893527198503, -1.3395899105571285],
           [130.57241793800065, -1.25858657301254],
           [130.4251582896574, -1.1115676741287754],
           [130.3877652022605, -1.1622589176610552]]],
         [[[130.85077459059417, -3.388888123731857],
           [130.91394597731292, -3.577366737899727],
           [131.0938471003598, -3.5321353283073917],
           [130.92767888746917, -3.2846949651906376],
           [130.86519414625823, -3.3566716845148177]]],
         [[[132.06630744922143, -5.29636600460007],
           [131.95781745898705, -5.465903550415063],
           [132.0216754912136, -5.557488638308625],
           [132.02510871875268, -5.599859022923934],
           [131.99077644336205, -5.638126407986059],
           [132.02957191455346, -5.6934729786565255],
           [132.0875934599636, -5.731734161392755],
           [132.1905902861355, -5.650084449192823],
           [132.1967700957058, -5.614892938301912],
           [132.16072120654565, -5.582091169797444],
           [132.14196156115855, -5.55118597812508],
           [132.2435850963148, -5.414485208524614],
           [132.1392149791273, -5.295530359443757]]],
         [[[133.0950255260023, -5.633073881931053],
           [133.05520008654918, -5.646740313660453],
           [133.01400135608043, -5.6836380672565046],
           [132.98790882678355, -5.732831390969352],
           [132.96730946154918, -5.765624586849243],
           [132.9576964244398, -5.81344459771416],
           [132.97142933459605, -5.836669996116141],
           [132.97280262561168, -5.866724964954733],
           [132.9137511119398, -5.941855282209325],
           [132.8862852916273, -5.963709455167025],
           [132.86293934436168, -5.984196951553717],
           [132.84371327014293, -6.01970679138483],
           [132.8313536510023, -6.010146677614885],
           [132.82998035998668, -5.958245993437863],
           [132.80800770373668, -5.944587101340863],
           [132.74758289904918, -5.982831142322871],
           [132.72286366076793, -5.99785485602634],
           [132.67342518420543, -5.955514242180355],
           [132.61574696154918, -5.9268300348303535],
           [132.5512022838148, -5.9268300348303535],
           [132.51687000842418, -5.932293808532796],
           [132.4907774791273, -5.993757520565613],
           [132.48253773303355, -6.033363804913173],
           [132.43721912951793, -6.05248304567353],
           [132.38228748889293, -6.0319981190300265],
           [132.33353565783824, -6.087988410834487],
           [132.29096363635387, -6.232716625873681],
           [132.78534840197887, -6.392417426884023],
           [133.10807179065074, -5.836669996116141],
           [133.14652393908824, -5.64947356135483]]],
         [[[132.8306670054945, -5.701402809868326],
           [132.86637257190074, -5.706868773967393],
           [132.98172901721324, -5.51142856383428],
           [133.000955091432, -5.460849548539021],
           [133.03116749377574, -5.452647142780444],
           [133.05314015002574, -5.406164731133115],
           [133.11219166369762, -5.255756161045139],
           [133.0613798961195, -5.220199697916878],
           [132.88147877307262, -5.216096899103803],
           [132.81830738635387, -5.263961210949085],
           [132.80594776721324, -5.403430360182965],
           [132.825173841432, -5.467684800927172],
           [132.836160169557, -5.520997083316206],
           [132.82654713244762, -5.56883735861491],
           [132.82105396838512, -5.598906397593031],
           [132.82654713244762, -5.64947356135483]]],
         [[[132.1608216333467, -7.154690815759334],
           [132.02623911381545, -7.5306102487110405],
           [132.24596567631545, -7.5891484785621355],
           [132.36681528569045, -7.194204441042409],
           [132.22536631108107, -7.168316591154095]]],
         [[[124.09245344727161, -10.214661570011957],
           [124.0697941455138, -10.233582352666737],
           [124.05056807129505, -10.241015208789552],
           [124.03271528809192, -10.252502007377329],
           [124.02928206055286, -10.263988389443913],
           [124.01348921387317, -10.281554990635748],
           [123.99220320313098, -10.284933071222223],
           [123.97366377442005, -10.284933071222223],
           [123.9544377002013, -10.29371591158219],
           [123.94276472656848, -10.305200795397628],
           [123.92010542481067, -10.302498507434219],
           [123.89985015921576, -10.313645636567085],
           [123.88096663086536, -10.327493786350445],
           [123.85350081055286, -10.343030391035892],
           [123.83564802734973, -10.357215315165881],
           [123.82122847168567, -10.40922120630678],
           [123.92834517090442, -10.399090867233248],
           [124.13296553223255, -10.296418274818961],
           [124.11579939453723, -10.236285229586906]]],
         [[[121.68257075851652, -10.565801707395249],
           [121.74608546798918, -10.536437656802928],
           [121.79998714035246, -10.50166970271617],
           [121.82642299240324, -10.486478591435468],
           [121.83088618820402, -10.45845747567627],
           [121.8350060612509, -10.441913701229147],
           [121.85285884445402, -10.43313501433834],
           [121.8408425480673, -10.41861587335863],
           [121.80582362716886, -10.413213229546848],
           [121.71690303390714, -10.420304180342622],
           [121.69699031418058, -10.430771479388719],
           [121.67707759445402, -10.45778223682711],
           [121.6592248112509, -10.487828942643214],
           [121.65510493820402, -10.53204968452565],
           [121.67295772140714, -10.558039070092223]]],
         [[[121.67305835906176, -10.616325217306692],
           [121.6256798190227, -10.673010889933746],
           [121.63323291960863, -10.704723266308946],
           [121.67786487761644, -10.722939514640808],
           [121.72318348113207, -10.702699171098468],
           [121.75888904753832, -10.630497623239023],
           [121.74515613738207, -10.62172430661972],
           [121.73210987273363, -10.61497543007588],
           [121.7190636080852, -10.608226404542647],
           [121.71013721648363, -10.600127377364018],
           [121.69640430632738, -10.593378024372223]]],
         [[[104.57611478955303, -6.0123757430488025],
           [104.29321684033428, -6.25269164449728],
           [104.42505277783428, -6.6020438652340845],
           [105.19409574658428, -6.386456329959258],
           [105.31769193799053, -5.864856317713833],
           [105.25726713330303, -5.851195122839979],
           [105.22876949471183, -5.838047636802865],
           [105.19752711145507, -5.816701536471349],
           [105.1460305610374, -5.81362511803526],
           [105.04852689892803, -5.8102095384263],
           [104.94690336377178, -5.834801248428363],
           [104.66949857861553, -6.001449737827849]]],
         [[[105.44111207936655, -5.926688980017414],
           [105.53586915944467, -5.811254167749939],
           [105.49741701100717, -5.73132386291759],
           [105.46401069576677, -5.6933319309963615],
           [105.44753120357927, -5.663236558668476],
           [105.40015266354021, -5.629754181769183],
           [105.35964057857927, -5.594903128836185],
           [105.35689399654802, -5.570984537127286],
           [105.31500862057146, -5.566884109210634],
           [105.2566437524074, -5.610620528220813],
           [105.24977729732927, -5.6625532642095395],
           [105.23947761471209, -5.706965719039419],
           [105.24359748775896, -5.742493207274048],
           [105.25321052486834, -5.77870163682805],
           [105.2731232445949, -5.788265741629075],
           [105.29715583736834, -5.775969005768915],
           [105.31638191158709, -5.775285845944029],
           [105.34728095943865, -5.801928467692651],
           [105.38023994381365, -5.836083832873764],
           [105.40152595455584, -5.91053529941582]]],
         [[[104.50200164962628, -5.980959211180814],
           [104.52260101486065, -5.871683112233485],
           [104.46080291915753, -5.796543334929102],
           [104.41823089767315, -5.758286506200252],
           [104.37977874923565, -5.707728891233264],
           [104.31935394454815, -5.672199248463338],
           [104.27678192306378, -5.666732954995823],
           [104.26991546798565, -5.597033194132132],
           [104.20537079025128, -5.553295761404027],
           [104.1627987687669, -5.502720309499019],
           [104.12604722685896, -5.484005734103864],
           [104.07798204131208, -5.441627067620642],
           [103.99283799834333, -5.37600260396184],
           [103.9108202381715, -5.279957812600842],
           [103.78035759168712, -5.1295186885832065],
           [103.74327873426525, -5.051549854128924],
           [103.72267936903087, -5.020086081354571],
           [103.70070671278087, -4.980412205620592],
           [103.64852165418712, -5.00914180412466],
           [103.3677159994642, -4.880367226413767],
           [103.2798253744642, -4.874893955469565],
           [103.1315099447767, -4.694251294417614],
           [103.0271398275892, -4.628551362192547],
           [102.8348790854017, -4.820158801592265],
           [104.3509923666517, -5.968594775529594]]],
         [[[101.10208987246885, -3.9331733502456574],
           [101.00321291934385, -4.163310447443249],
           [100.92081545840635, -4.2920485207668175],
           [101.06913088809385, -4.464578159045024],
           [101.3685083295001, -4.253703250142154],
           [101.2970971966876, -3.922212825857222],
           [101.15152834903135, -3.872888692862587]]],
         [[[100.9125757123126, -3.9961935556549792],
           [101.0718774701251, -3.842744749641052],
           [100.95377444278135, -3.52754130847614],
           [100.63406989816805, -2.9851418122797],
           [100.39786384348055, -2.716310113446834],
           [100.33743903879305, -2.7903822141656405],
           [100.4390625739493, -2.9686845585319213],
           [100.4939942145743, -3.0345120890928006],
           [100.50772712473055, -3.105820720413506],
           [100.5489258551993, -3.177124536564481],
           [100.60111091379305, -3.2566499006177283],
           [100.60111091379305, -3.2977812549790033],
           [100.55716560129305, -3.306007322369532],
           [100.5489258551993, -3.267618426937988],
           [100.5104737067618, -3.2731026451678975],
           [100.49124763254305, -3.3142333215384734],
           [100.46927497629305, -3.36907156008209],
           [100.3566651130118, -3.4321317117413024],
           [100.2962403083243, -3.484221744499734],
           [100.34293220285555, -3.541791582382746],
           [100.3841309333243, -3.582910706637865],
           [100.4665283942618, -3.596616671836831],
           [100.52969978098055, -3.5911343104429108],
           [100.6038574958243, -3.5664632774755125],
           [100.62308357004305, -3.5116363958447656],
           [100.61209724191805, -3.4540647057821343],
           [100.6313233161368, -3.4211650256887083],
           [100.67252204660555, -3.4101982141484117],
           [100.71097419504305, -3.4321317117413024],
           [100.7137207770743, -3.51437781681096],
           [100.6697754645743, -3.5856519161264333],
           [100.5763916755118, -3.67610718147866],
           [100.5489258551993, -3.7720345542237483],
           [100.68350837473055, -3.817253802722888],
           [100.7192139411368, -3.822734762511892],
           [100.7961182380118, -3.9254962171781966],
           [100.84967658762118, -3.9830371293020463]]],
         [[[100.2522949958243, -3.179866893376753],
           [100.1973633551993, -3.103078169080392],
           [100.1259522223868, -3.0482256562294],
           [100.11771247629305, -2.9714274512173025],
           [100.03531501535555, -2.89188082152276],
           [99.9776367926993, -2.8370178169767404],
           [99.8732666755118, -2.809585335267972],
           [99.76614997629305, -2.935769316945692],
           [99.9117188239493, -3.1661550365189064],
           [100.0765137458243, -3.237454692299632],
           [100.20560310129305, -3.2072900593970246]]],
         [[[99.56811953433628, -2.3474162219874937],
           [99.48022890933628, -2.42150972211016],
           [99.63129092105503, -2.550477558422641],
           [99.70544863589878, -2.479135205149263],
           [99.62030459293003, -2.366626030105156]]],
         [[[98.60356252355179, -1.6594676462938285],
           [98.64750783605179, -1.7610458982345205],
           [98.80131642980179, -1.8983049507104341],
           [98.90843312902054, -1.8022247113988437],
           [98.72990529698929, -1.5414107117411386],
           [98.62004201573929, -1.607303793563913]]],
         [[[98.55155131194527, -1.2275516901928827],
           [98.6202166758746, -1.1463729393501825],
           [98.62914225432809, -1.1098165026435567],
           [98.64527841913917, -1.0619313023994543],
           [98.640471905207, -1.0195382162936775],
           [98.61472269866402, -0.911750197674825],
           [98.55429789397652, -0.843093702299681],
           [98.41696879241402, -0.8733027152502992],
           [98.41971537444527, -1.1232035478521214]]],
         [[[98.6902537045234, -0.5313794506736572],
           [98.81281992766793, -0.7092101438491603],
           [98.81299221125005, -0.7902270235677153],
           [98.84337565276559, -0.7837048536651686],
           [98.85779520842965, -0.806361973876557],
           [98.9429392513984, -0.7922871107805888],
           [98.93881937835152, -0.5835620373799678],
           [98.89762064788277, -0.20326319684107066],
           [98.90826365325387, -0.062157959157637346],
           [98.88388773772652, 0.012343066152027874],
           [98.8385691342109, 0.03843559266162573],
           [98.7887873348945, -0.026109081286409874],
           [98.74346873137887, -0.025079113127462888],
           [98.73179575774606, -0.07417424701815994],
           [98.71050974700387, -0.09271365598698261],
           [98.68338724944527, -0.22798225988613427],
           [98.6792673763984, -0.4490781169298137]]],
         [[[97.76306356546667, -0.008153327366439086],
           [97.94845785257604, -0.01501978230005392],
           [98.02810873148229, -0.32400853405145424],
           [98.15170492288854, -0.30203620584784385],
           [98.08716024515417, -0.038365726870655065],
           [98.03360189554479, 0.09759003362241317],
           [97.75482381937292, 0.11544278590271881],
           [97.72461141702917, 0.04265843624307226]]],
         [[[98.47809995264642, 0.36886442659956975],
           [99.04389585108392, 0.4540062665021352],
           [98.90212178629717, 0.9716648566982606],
           [98.89851941813392, 1.050613557530516],
           [98.87294365641266, 1.129562190261447],
           [98.7898537983558, 1.2915818252139453],
           [98.78297055811517, 1.3767300811258478],
           [98.53852475733392, 1.5222523094357385],
           [98.40668881983392, 1.5579449769901714],
           [98.41767514795892, 1.4316452237518345],
           [98.42866147608392, 1.2778796705499385],
           [98.34901059717767, 1.0774216350249572],
           [98.43140805811517, 0.4292877627713524]]],
         [[[98.39786063965067, 1.9469222346075583],
           [98.3333159619163, 1.9208445669546337],
           [98.29898368652567, 1.8714331620641744],
           [98.3168364697288, 1.801431297089111],
           [98.40335380371317, 1.7410353658796263],
           [98.46652519043192, 1.7204453981929262],
           [98.53244315918192, 1.6916190706462506],
           [98.56677543457255, 1.690246377640669],
           [98.59561454590067, 1.6765193943394299],
           [98.61621391113505, 1.638083331511952],
           [98.65054618652567, 1.6133740435082546],
           [98.69998466308817, 1.6078830496965126],
           [98.7288237744163, 1.5763095501668671],
           [98.74804984863505, 1.5680729059392353],
           [98.7562895947288, 1.5845461618104542],
           [98.76590263183817, 1.6120012964428998],
           [98.80710136230692, 1.6298469358102297],
           [98.8112212353538, 1.642201516676096],
           [98.79336845215067, 1.6627923147793393],
           [98.76452934082255, 1.6806374994728028],
           [98.7343169384788, 1.6929917626805924],
           [98.70547782715067, 1.7039732638958696],
           [98.66427909668192, 1.7273087455808178],
           [98.63132011230692, 1.7588798227123363],
           [98.59973441894755, 1.7973134555344492],
           [98.5255767041038, 1.885158693545226],
           [98.45553886230692, 1.9524122186733261]]],
         [[[96.50843986600525, 2.493073209472106],
           [96.5441454324115, 2.4107511922438394],
           [96.51393303006775, 2.3256798780803187],
           [96.38759025663025, 2.1802235925276636],
           [96.4342821511615, 2.0567118992968836],
           [96.53590568631775, 2.0182840620851117],
           [96.5990770730365, 2.0182840620851117],
           [96.60182365506775, 2.0869045515321702],
           [96.59083732694275, 2.1692451773546595],
           [96.5880907449115, 2.19943562613801],
           [96.637529221474, 2.2186474123365314],
           [96.7199266824115, 2.163755939862731],
           [96.79957756131775, 1.8069151849426437],
           [97.09620842069275, 1.8398574802863714],
           [97.252763596474, 1.8480929594850164],
           [97.230790940224, 1.9935799717371194],
           [97.10170158475525, 1.968875510616283],
           [97.01381095975525, 2.0978835544992744],
           [97.04127678006775, 2.281770083967114],
           [97.0605028542865, 2.4327042241001338],
           [96.59083732694275, 2.6412397496749334],
           [96.45900138944275, 2.6000841079478527],
           [96.483720627724, 2.52325666784671]]],
         [[[96.94925614900137, 3.5346053875156778],
           [96.89707109040762, 3.578466063508346],
           [96.86685868806387, 3.616842433508685],
           [96.84213944978262, 3.6744039368532646],
           [96.77347489900137, 3.679885792030483],
           [96.71030351228262, 3.6141013178999506],
           [96.71305009431387, 3.4934841196335586],
           [96.78171464509512, 3.301561386984106],
           [97.06461259431387, 2.799650748391253],
           [97.24314042634512, 2.7036312257546427],
           [97.42716142243887, 2.7365530746066815],
           [97.52603837556387, 2.82159697277166],
           [97.46836015290762, 2.9011485396141743],
           [97.39420243806387, 2.9285788243506365],
           [97.31455155915762, 3.005380027622881],
           [97.23490068025137, 3.150738824738757],
           [97.16348954743887, 3.2330084530272813],
           [97.05087968415762, 3.422202999285838],
           [96.98496171540762, 3.5071914101686295]]],
         [[[96.17278410889867, 3.9952393344133634],
           [95.81023528077367, 4.252749338106163],
           [95.56578947999242, 3.910297838702336],
           [96.33208586671117, 3.323702669669075],
           [96.57103850342992, 3.5951185566532393]]],
         [[[95.00675933164649, 5.303389652915694],
           [95.04109160703712, 5.2035605351973695],
           [95.17018096250587, 5.1461174054675425],
           [95.21236301117305, 5.23972551193133],
           [95.19382358246212, 5.269127196948265],
           [95.21030307464962, 5.308783078225868],
           [95.21442294769649, 5.334763136083356],
           [95.2151095932043, 5.345701779035212],
           [95.23227573089962, 5.379883776992986],
           [95.21167636566524, 5.472849061111632],
           [94.99469638519649, 5.5616994312188]]],
         [[[95.28652980331043, 5.603691812107753],
           [95.36824061874012, 5.6617748622711295],
           [95.32635524276355, 5.751962830624968],
           [95.28034999374012, 5.760161031192614],
           [95.25837733749012, 5.660408269088871],
           [95.28034999374012, 5.6173589341340175]]],
         [[[104.7844128597972, 0.39665927385853983],
           [105.0041394222972, -0.018071444003555457],
           [105.2238659847972, -0.3641383288809225],
           [105.51500399060996, -0.9134188778035365],
           [106.07255702525437, -0.6964517673288616],
           [105.80750327883432, -0.4012175086213825],
           [105.57817506682845, -0.11694831622261456],
           [105.2842907894847, 1.1683710107387866],
           [104.8397018826955, 1.9220628751122226],
           [104.3950702527233, 1.4127522160454287],
           [105.03295762491855, 0.9651526936702298],
           [104.79265260589095, 0.49827969653600057]]],
         [[[107.22836464709722, 1.3680683324644094],
           [107.70764321155035, 1.273336435731699],
           [107.71450966662847, 1.0673858681071853],
           [107.87106484240972, 0.9822554525371194],
           [107.86145180530035, 1.6549859833100973],
           [107.31900185412847, 1.7002851604446236],
           [107.1391007310816, 1.5424199719041198],
           [107.19128578967535, 1.4010176938314167]]],
         [[[106.67344929122477, 0.895795780716047],
           [106.78605915450602, 1.009763156796033],
           [106.7022884025529, 1.1223535102106872],
           [106.57182575606852, 0.9864207518371932],
           [106.62263752364665, 0.9246312527230685]]],
         [[[107.02607976325602, 0.3959468532169866],
           [106.6676508081779, 0.3231638674383458],
           [106.82557927497477, 0.18446286966269096],
           [107.22658025153727, 0.2242880549515706],
           [107.48338567145915, 0.07734646561456425],
           [108.10548650153727, 0.14326430857113998],
           [107.9915033472404, 0.26411313187832886],
           [107.78550969489665, 0.5882004147644785],
           [107.53694402106852, 0.6925639986121269],
           [107.3707758081779, 0.649994899908889],
           [107.13044988044352, 0.4261584777059144]]],
         [[[108.69993020490706, -1.5569120651351218],
           [108.95810891584456, -1.5225921868647647],
           [109.02677346662581, -1.4388494153942861],
           [109.08445168928206, -1.4704249294455634],
           [109.05217976555846, -1.5720113247540641],
           [109.06110574201644, -1.6214319138904913],
           [109.05286599592269, -1.666731860232244],
           [108.99587783622688, -1.6547232478559677],
           [108.81906723992397, -1.7242163215273987],
           [108.94163169436723, -1.8211622913918764],
           [109.31328790977771, -1.8977810605403196],
           [109.27569420585941, -1.7190835596507528],
           [109.29114228117244, -1.7048384855214596],
           [109.33301736311019, -1.6351592787197473],
           [109.3735285367465, -1.6543795670473276],
           [109.52115823225081, -1.6735953982512735],
           [109.26709939436019, -1.1450401688931637],
           [108.61753274396956, -1.1903493600296127],
           [108.64499856428206, -1.437476556972941]]],
         [[[115.60865333189184, -3.7109156342094],
           [115.7377426873606, -3.9493343930347127],
           [115.9684555779856, -3.746545616118337],
           [115.81739356626684, -3.5382271518465838],
           [115.6443588982981, -3.675284215182606]]],
         [[[116.5617172967356, -3.302442014577523],
           [116.2980454217356, -4.297246908694053],
           [116.6935532342356, -4.332851263719049],
           [116.94898536314184, -3.6451334406152105],
           [116.9517319451731, -3.275021427484138],
           [116.67982032407934, -3.2722793273695867]]]]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/

///////////////////////////////
// Global coral atlas project - indonesia
// Contact: mitchell.lyons@gmail.com
// Region coordinator: Mitchell Lyons, v2 Chris Roelfsema
// Description:
// - export geomorphic and benthic to Vulcan bucket
///////////////////////////////

// so we can visualise maps before export
var map_palettes = require('users/mitchest/global_reefs_modules:colour_pals');
var param_module = require('users/mitchest/global_reefs_modules:reef_params');

// ###########################################
// SENSOR GENERICS
var sensor_params = param_module.dove;         //<------------ THIS IS WHERE YOU CHOOSE THE SENSOR
// REGION AND SENSOR SPECIFIC LOAD PATHS
var region_params = param_module.indonesia;          //<------------ THIS IS WHERE YOU CHOOSE THE REGION
//  ^^ all the data paths are in this module ^^
// ###########################################


// will need to import depth mosaic from pixels now
var pixel = ee.Image(region_params.pixels)
var depth = pixel.select('depth'); //.multiply(100).uint16()

// finalise layers (include 'mapped area' as zeros)
var geo = ee.Image(region_params.geo_map_clean3)
var benthic = ee.Image(region_params.benthic_map_clean2)
var geo = geo.where(geo.lte(2), 0).selfMask();
var benthic = benthic.updateMask(geo.gt(0)).selfMask();

// make reef/non-reef layer 
var reef_top = geo.eq([11,13,14,15,16,25,26]).reduce(ee.Reducer.sum());
var reef_all = geo.eq([11,12,13,14,15,16,21,22,23,24,25,26]).reduce(ee.Reducer.sum());
var reef_layer = reef_top.addBands(reef_all).reduce(ee.Reducer.sum());

// check before export 
//Map.addLayer(lowtide_sr, {"opacity":1,"bands":["b3","b2","b1"],"min":1,"max":1514,"gamma":1}, 'lowtide_sr', false);
Map.addLayer(reef_layer.selfMask(), {min:0, max:2}, "reef layer", false);
Map.addLayer(geo, map_palettes.geo, "geomorphic map", false);
Map.addLayer(benthic, map_palettes.benthic, "benthic map", false);
Map.addLayer(depth, {min: -3, max: 1200, palette:['#d0d1e6','#a6bddb','#74a9cf','#3690c0','#0570b0','#045a8d','#023858']}, "depth layer", false);
//Map.addLayer(waves, {}, "waves", false);
// combine into single stack
var export_stack = depth.updateMask(geo.gt(2)).rename('depth')
                    .addBands(reef_layer.rename('reef'))
                    .addBands(geo.rename('geomorphic'))
                    .addBands(benthic.rename('benthic'))
                    .toInt16();

Map.addLayer(export_stack, {}, "export raster stack", false);

// run the export
var reef_boundary= ee.FeatureCollection(region_params.extent_mask);
Map.addLayer(reef_boundary, {}, "Reef Boundary", false)
Export.image.toCloudStorage({
  image: export_stack,
  description: 'SouthEastAsiaArchipelago_stack',
  bucket: 'coral-atlas-data-pipeline',
  fileNamePrefix: 'coral-gee-export-bucket/indonesia/v2/indonesia_stack_',
  region: reef_boundary, 
  scale: 5,
  crs: 'EPSG:4326',
  maxPixels: 1e13, 
  skipEmptyTiles: true
});


