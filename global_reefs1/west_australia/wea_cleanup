/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var imageVisParam = {"opacity":1,"bands":["depth"],"min":1500,"max":2500,"gamma":1},
    imageVisParam2 = {"opacity":1,"bands":["b3","b2","b1"],"min":44.94,"max":2202.06,"gamma":1},
    waves = ee.Image("projects/coral_atlas/coral_sea/in_out/cosea_waves"),
    wavespng = ee.Image("projects/coral_atlas/png_solomons/in_out/pns_waves"),
    wcmc = ee.FeatureCollection("projects/coral_atlas/global_datasets/wcmc_reefs_2018v4_dissolved"),
    sand_rock = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.86664987052319,
                -28.949387941230466
              ],
              [
                113.86939645255444,
                -28.952992963600124
              ],
              [
                113.8812410875642,
                -28.965158987612742
              ],
              [
                113.90081048453686,
                -28.97687306687122
              ],
              [
                113.91711831534741,
                -28.985432516945508
              ],
              [
                113.92896295035717,
                -28.995492719307173
              ],
              [
                113.94612908805249,
                -28.9960932974414
              ],
              [
                113.95951867545483,
                -28.99489213768402
              ],
              [
                113.9581453844392,
                -28.98888612957231
              ],
              [
                113.95660043204663,
                -28.98993720617513
              ],
              [
                113.94218087638257,
                -28.99023751181366
              ],
              [
                113.92707467521069,
                -28.983780748399212
              ],
              [
                113.91196847403882,
                -28.975221161648346
              ],
              [
                113.8889658495271,
                -28.960953610119823
              ],
              [
                113.8728296800935,
                -28.948486666032284
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.00590461165073,
                -28.89775925997146
              ],
              [
                114.00178473860386,
                -28.905273322494054
              ],
              [
                113.99594825178745,
                -28.90827879516935
              ],
              [
                113.9899401035941,
                -28.912937105768627
              ],
              [
                113.98530524641636,
                -28.91909777593159
              ],
              [
                113.97946875959995,
                -28.925558573436085
              ],
              [
                113.97208732039097,
                -28.932319442056116
              ],
              [
                113.96659415632847,
                -28.936676212629752
              ],
              [
                113.96436255842808,
                -28.950045847665322
              ],
              [
                113.96522086531284,
                -28.95365084713551
              ],
              [
                113.9598993626273,
                -28.960409882910053
              ],
              [
                113.95526450544956,
                -28.968970694809716
              ],
              [
                113.95629447371128,
                -28.977981310816894
              ],
              [
                113.96161597639683,
                -28.983237141116227
              ],
              [
                113.96607917219761,
                -28.984588597173506
              ],
              [
                113.96470588118198,
                -28.96281298930291
              ],
              [
                113.97019904524448,
                -28.945539421877832
              ],
              [
                113.98822348982456,
                -28.923304852583822
              ],
              [
                114.0038446751273,
                -28.90978149886118
              ],
              [
                114.01071113020542,
                -28.89911183137364
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.81191574909559,
                -28.861560193894626
              ],
              [
                113.81054245807996,
                -28.86486760083878
              ],
              [
                113.81088578083387,
                -28.876743330996845
              ],
              [
                113.81689392902723,
                -28.88906860259145
              ],
              [
                113.8261636433827,
                -28.9025946558612
              ],
              [
                113.83474671223036,
                -28.91521738193369
              ],
              [
                113.84350144245496,
                -28.92438292275065
              ],
              [
                113.85671936848036,
                -28.935500688027336
              ],
              [
                113.85277115681043,
                -28.926937109457842
              ],
              [
                113.84590470173231,
                -28.921978924842687
              ],
              [
                113.8400682149159,
                -28.916419466224085
              ],
              [
                113.83217179157606,
                -28.906802401849095
              ],
              [
                113.83045517780653,
                -28.899739302489497
              ],
              [
                113.81964051105848,
                -28.886062573653287
              ],
              [
                113.8206704793202,
                -28.88005025474082
              ],
              [
                113.8148339925038,
                -28.87027949428892
              ],
              [
                113.81466233112684,
                -28.864566931828787
              ],
              [
                113.81929718830457,
                -28.862762899504645
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.6958217270271,
                -28.72093032663641
              ],
              [
                113.69547840427319,
                -28.729962456125214
              ],
              [
                113.70097156833569,
                -28.745014270920343
              ],
              [
                113.70955463718334,
                -28.76156876246793
              ],
              [
                113.71607776950756,
                -28.771500197488802
              ],
              [
                113.73015400241772,
                -28.773004877921704
              ],
              [
                113.7232875473396,
                -28.765782213959913
              ],
              [
                113.7232875473396,
                -28.756151217783458
              ],
              [
                113.71401783298413,
                -28.7504323934184
              ],
              [
                113.71504780124584,
                -28.745917310854736
              ],
              [
                113.71127125095288,
                -28.74110100766077
              ],
              [
                113.70097156833569,
                -28.731467735169712
              ],
              [
                113.7013148910896,
                -28.723037893313432
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.79126545261303,
                -28.76909266366365
              ],
              [
                113.78714557956616,
                -28.773907675765845
              ],
              [
                113.7782191879646,
                -28.779324298776096
              ],
              [
                113.77684589694897,
                -28.78323612936536
              ],
              [
                113.77959247898022,
                -28.78413883866585
              ],
              [
                113.78817554782788,
                -28.782333412251404
              ],
              [
                113.795042002906,
                -28.77481046579814
              ],
              [
                113.795042002906,
                -28.768490771528334
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.5769350595939,
                -28.291571418326196
              ],
              [
                113.57504678444741,
                -28.292629504543523
              ],
              [
                113.58225656227944,
                -28.313486770665893
              ],
              [
                113.58620477394936,
                -28.312277765440726
              ],
              [
                113.58071160988686,
                -28.30381434406331
              ],
              [
                113.5798533030021,
                -28.29383873305588
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.17548740606219,
                -26.11169458985712
              ],
              [
                113.17686069707781,
                -26.11431496143938
              ],
              [
                113.1787489722243,
                -26.119093134853642
              ],
              [
                113.18149555425555,
                -26.12494998412788
              ],
              [
                113.18115223150164,
                -26.127261817494634
              ],
              [
                113.18304050664813,
                -26.130035957142184
              ],
              [
                113.18235386114031,
                -26.12633708963798
              ],
              [
                113.1842421362868,
                -26.126953575689104
              ],
              [
                113.18441379766375,
                -26.125412354461233
              ],
              [
                113.18183887700945,
                -26.122946358204157
              ],
              [
                113.18012226323992,
                -26.118322474935905
              ],
              [
                113.17806232671649,
                -26.114777373855922
              ],
              [
                113.17617405157,
                -26.10953659268274
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.1311816288686,
                -26.020025345320946
              ],
              [
                113.13294115798237,
                -26.018521282030573
              ],
              [
                113.12122526900532,
                -26.00471385197375
              ],
              [
                113.11358633773091,
                -25.99622803370741
              ],
              [
                113.11221304671528,
                -25.99453079649893
              ],
              [
                113.10963812606099,
                -25.995417991734296
              ],
              [
                113.11950865523579,
                -26.00729804757824
              ],
              [
                113.12521639601948,
                -26.014548919651247
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                112.97824463712641,
                -25.797327077508378
              ],
              [
                112.97446808683344,
                -25.793385899139256
              ],
              [
                112.97223648893305,
                -25.787821659569097
              ],
              [
                112.97017655240961,
                -25.784653017584247
              ],
              [
                112.96854576932856,
                -25.78303002183093
              ],
              [
                112.96742997037836,
                -25.779397522292214
              ],
              [
                112.96768746244379,
                -25.778624635698765
              ],
              [
                112.97034821378656,
                -25.77839276873885
              ],
              [
                112.97189316617914,
                -25.776846977425187
              ],
              [
                112.97558388578364,
                -25.774219085971044
              ],
              [
                112.97721466886469,
                -25.772905118418535
              ],
              [
                112.97833046781489,
                -25.76896312846558
              ],
              [
                112.97575554716059,
                -25.769117718773572
              ],
              [
                112.97558388578364,
                -25.772286775712267
              ],
              [
                112.97215065824457,
                -25.773987210401394
              ],
              [
                112.97086319791742,
                -25.775610329873402
              ],
              [
                112.96931824552485,
                -25.777001557462878
              ],
              [
                112.96622834073969,
                -25.776846977425187
              ],
              [
                112.96571335660883,
                -25.77777445463024
              ],
              [
                112.96571335660883,
                -25.780788705471227
              ],
              [
                112.96571335660883,
                -25.782875449648532
              ],
              [
                112.96768746244379,
                -25.785812286667788
              ],
              [
                112.96991906034418,
                -25.78851720379478
              ],
              [
                112.97000489103266,
                -25.79091293601118
              ],
              [
                112.97549805509516,
                -25.797095247113784
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                112.97530204477118,
                -25.768697802454493
              ],
              [
                112.97650367440986,
                -25.769238873794283
              ],
              [
                112.977791134737,
                -25.76923886886113
              ],
              [
                112.97950774850653,
                -25.763441600431822
              ],
              [
                112.98062354745673,
                -25.75764404888843
              ],
              [
                112.98165351571845,
                -25.75215543926763
              ],
              [
                112.97882110299872,
                -25.744965750007022
              ],
              [
                112.97538787545966,
                -25.739089981953462
              ],
              [
                112.97281295480536,
                -25.7339097875867
              ],
              [
                112.97178298654364,
                -25.73097166657017
              ],
              [
                112.96929389657782,
                -25.721924890655476
              ],
              [
                112.96843558969306,
                -25.716357301867667
              ],
              [
                112.96586066903876,
                -25.71187211028542
              ],
              [
                112.96199828805732,
                -25.707773425311622
              ],
              [
                112.96019584359931,
                -25.710016119484678
              ],
              [
                112.96654731454657,
                -25.719450438922337
              ],
              [
                112.96637565316962,
                -25.72664167166837
              ],
              [
                112.96980888070868,
                -25.735146869447615
              ],
              [
                112.97264129342841,
                -25.741641337981292
              ],
              [
                112.97693282785224,
                -25.749140461264734
              ],
              [
                112.97899276437568,
                -25.757412140938566
              ],
              [
                112.97736198129462,
                -25.762127513560387
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                112.94703934070799,
                -25.68118486645437
              ],
              [
                112.95081589100096,
                -25.680720751871196
              ],
              [
                112.94832680103514,
                -25.67522859204541
              ],
              [
                112.94618103382322,
                -25.668730498639995
              ],
              [
                112.94377777454588,
                -25.661767862650024
              ],
              [
                112.94197533008787,
                -25.656274829620305
              ],
              [
                112.93914291736814,
                -25.651632632662334
              ],
              [
                112.9381987797949,
                -25.646139132925526
              ],
              [
                112.93176147815916,
                -25.642115564230682
              ],
              [
                112.92952988025877,
                -25.643663106704302
              ],
              [
                112.93304893848631,
                -25.64637125775005
              ],
              [
                112.93459389087889,
                -25.648769854497896
              ],
              [
                112.93485138294432,
                -25.651400518072712
              ],
              [
                112.93802711841795,
                -25.65341216284693
              ],
              [
                112.9393145787451,
                -25.657183951642203
              ],
              [
                112.94283363697264,
                -25.66499784894627
              ],
              [
                112.94566604969236,
                -25.67366216605397
              ],
              [
                112.94721100208494,
                -25.681088222325943
              ],
              [
                112.95270416614744,
                -25.69361864281678
              ],
              [
                112.95442077991697,
                -25.6954748892974
              ],
              [
                112.95699570057127,
                -25.703750302754262
              ],
              [
                112.95974228260252,
                -25.709395815459022
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                112.92935821888182,
                -25.64358573005718
              ],
              [
                112.93064567920896,
                -25.642347696880865
              ],
              [
                112.92935821888182,
                -25.63290727168114
              ],
              [
                112.92652580616209,
                -25.62168612345381
              ],
              [
                112.92309257862303,
                -25.62323393071046
              ],
              [
                112.92592499134275,
                -25.63615733838662
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                112.92206261036131,
                -25.622924370863423
              ],
              [
                112.92583916065428,
                -25.62269220045173
              ],
              [
                112.92592499134275,
                -25.621376559596083
              ],
              [
                112.9254100072119,
                -25.61456595180223
              ],
              [
                112.92403671619627,
                -25.611160502343882
              ],
              [
                112.92403671619627,
                -25.6000147166765
              ],
              [
                112.92266342518064,
                -25.59537033266972
              ],
              [
                112.92326423999998,
                -25.590725768317792
              ],
              [
                112.92154762623045,
                -25.587087400291285
              ],
              [
                112.92369339344236,
                -25.582132848911403
              ],
              [
                112.92480919239256,
                -25.57655873343226
              ],
              [
                112.92446586963865,
                -25.575165164004666
              ],
              [
                112.92781326648924,
                -25.570364967368533
              ],
              [
                112.92918655750486,
                -25.565177441763982
              ],
              [
                112.92918655750486,
                -25.55635038927761
              ],
              [
                112.92849991199705,
                -25.555576055400202
              ],
              [
                112.92635414478514,
                -25.55565348901313
              ],
              [
                112.926869128916,
                -25.562157733845165
              ],
              [
                112.9257533299658,
                -25.56726796418754
              ],
              [
                112.92377922413084,
                -25.571913438923055
              ],
              [
                112.9206034886572,
                -25.57578453019743
              ],
              [
                112.91948768970701,
                -25.58360375276162
              ],
              [
                112.9176542986745,
                -25.59464574963974
              ],
              [
                112.92031505001728,
                -25.60153489633203
              ],
              [
                112.92117335690205,
                -25.60896544109202
              ],
              [
                112.92186000240986,
                -25.615853762727035
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                112.9260507075411,
                -25.55537302105951
              ],
              [
                112.92922644301473,
                -25.555063285582598
              ],
              [
                112.93017058058797,
                -25.549642785141522
              ],
              [
                112.93085722609578,
                -25.543989716399878
              ],
              [
                112.92974142714559,
                -25.538878493283935
              ],
              [
                112.93008474989949,
                -25.530901452206724
              ],
              [
                112.92991308852254,
                -25.526486745133212
              ],
              [
                112.93514876051961,
                -25.523620971136246
              ],
              [
                112.93780951186238,
                -25.516417507261878
              ],
              [
                112.9417577235323,
                -25.512312114023292
              ],
              [
                112.94853834792195,
                -25.50665728593963
              ],
              [
                112.95282988234578,
                -25.499375334274134
              ],
              [
                112.95755057021199,
                -25.494184737555504
              ],
              [
                112.96149878188191,
                -25.489071393184684
              ],
              [
                112.96441702529012,
                -25.484577668524594
              ],
              [
                112.96570448561727,
                -25.482098300245905
              ],
              [
                112.96467451735555,
                -25.481323487172055
              ],
              [
                112.96072630568563,
                -25.484810106678935
              ],
              [
                112.95334486647664,
                -25.492867684809713
              ],
              [
                112.9480233637911,
                -25.499762683245716
              ],
              [
                112.94210104628621,
                -25.506734751137085
              ],
              [
                112.93780951186238,
                -25.51223465242402
              ],
              [
                112.93231634779988,
                -25.520910040848246
              ],
              [
                112.92562155409871,
                -25.526331840180593
              ],
              [
                112.92544989272176,
                -25.53477386850831
              ],
              [
                112.9260507075411,
                -25.540427371782567
              ],
              [
                112.92613653822957,
                -25.545073887230537
              ],
              [
                112.92613653822957,
                -25.55064946804695
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.0742258993576,
                -25.26488653921979
              ],
              [
                113.0756850210617,
                -25.26418795277707
              ],
              [
                113.07688665070037,
                -25.249982490045333
              ],
              [
                113.0716509787033,
                -25.23103928898724
              ],
              [
                113.07800244965057,
                -25.21550987360645
              ],
              [
                113.08212232269744,
                -25.20541469055069
              ],
              [
                113.08452558197479,
                -25.197104950154504
              ],
              [
                113.08864545502166,
                -25.194775014606673
              ],
              [
                113.09242200531463,
                -25.17178392807008
              ],
              [
                113.0932803121994,
                -25.16362726402113
              ],
              [
                113.09422444977264,
                -25.156402334555228
              ],
              [
                113.09542607941131,
                -25.139931003561976
              ],
              [
                113.09525441803436,
                -25.124700814695508
              ],
              [
                113.09538288549629,
                -25.106241940277098
              ],
              [
                113.09156369842987,
                -25.08778304302323
              ],
              [
                113.09061956085662,
                -25.0697475761071
              ],
              [
                113.08564138092498,
                -25.068348161588016
              ],
              [
                113.08572721161346,
                -25.0909700690835
              ],
              [
                113.09130620636444,
                -25.11102310866144
              ],
              [
                113.09027623810272,
                -25.1280422942606
              ],
              [
                113.08873128571014,
                -25.14218428856665
              ],
              [
                113.08950376190643,
                -25.150653160252173
              ],
              [
                113.08941793121795,
                -25.163938004076517
              ],
              [
                113.08804464020233,
                -25.17458037299018
              ],
              [
                113.08564138092498,
                -25.18320234096947
              ],
              [
                113.08383893646698,
                -25.19205670013012
              ],
              [
                113.0808348623703,
                -25.19500801016737
              ],
              [
                113.0745692221115,
                -25.209996454334963
              ],
              [
                113.07199430145721,
                -25.217218206347493
              ],
              [
                113.06658696808319,
                -25.22506069880051
              ],
              [
                113.06607198395233,
                -25.234921332995693
              ],
              [
                113.06916188873748,
                -25.24579039669494
              ],
              [
                113.07173680939178,
                -25.25805574373077
              ],
              [
                113.07259511627655,
                -25.26488653921979
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.08850887970368,
                -25.069139088842842
              ],
              [
                113.08960322098176,
                -25.068808671326227
              ],
              [
                113.09239271835725,
                -25.06645685031164
              ],
              [
                113.09187773422639,
                -25.062627755863666
              ],
              [
                113.0912125463907,
                -25.058332030323132
              ],
              [
                113.09842232422272,
                -25.049623491187404
              ],
              [
                113.1028855200235,
                -25.038892476154444
              ],
              [
                113.1051171179239,
                -25.03049363550967
              ],
              [
                113.11541680054108,
                -25.022405319643294
              ],
              [
                113.12105052584462,
                -25.011827486971452
              ],
              [
                113.12345378512197,
                -24.984289738721113
              ],
              [
                113.1255137216454,
                -24.960169695023733
              ],
              [
                113.13255183810048,
                -24.92250185366218
              ],
              [
                113.13529842013173,
                -24.912382496715324
              ],
              [
                113.1280886422997,
                -24.887625494304686
              ],
              [
                113.13135020846181,
                -24.873298420690727
              ],
              [
                113.130663562954,
                -24.858346659810653
              ],
              [
                113.13272349947744,
                -24.844171967339854
              ],
              [
                113.13941829317861,
                -24.82345218835968
              ],
              [
                113.14319484347158,
                -24.809740955182846
              ],
              [
                113.14611308687978,
                -24.78527510168637
              ],
              [
                113.15727107638173,
                -24.758777972519923
              ],
              [
                113.15538280123525,
                -24.752386642223563
              ],
              [
                113.13718669527822,
                -24.780911257672358
              ],
              [
                113.130663562954,
                -24.828749303863717
              ],
              [
                113.12276713961415,
                -24.852116225812043
              ],
              [
                113.12139384859853,
                -24.87797047507554
              ],
              [
                113.12465541476064,
                -24.907400354489692
              ],
              [
                113.12242381686025,
                -24.92981840985941
              ],
              [
                113.11933391207509,
                -24.955033849447737
              ],
              [
                113.1145273935204,
                -24.981800146655075
              ],
              [
                113.11229579562001,
                -25.007782780716312
              ],
              [
                113.10422771090322,
                -25.02147201812663
              ],
              [
                113.09392802828603,
                -25.039825645174375
              ],
              [
                113.09358470553212,
                -25.045735550749377
              ],
              [
                113.08688991183095,
                -25.054288856958188
              ],
              [
                113.08448665255361,
                -25.059731559255834
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.45449373909747,
                -24.01118261158826
              ],
              [
                113.46410677620685,
                -24.01180983742283
              ],
              [
                113.4778396863631,
                -23.950013414477798
              ],
              [
                113.47577974983966,
                -23.898232193586683
              ],
              [
                113.48127291390216,
                -23.886617798434628
              ],
              [
                113.45312044808185,
                -23.923340832842555
              ],
              [
                113.45346377083575,
                -23.970720086806708
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.47063708784685,
                -23.899747124415786
              ],
              [
                113.47578692915545,
                -23.89252757249303
              ],
              [
                113.48231006147967,
                -23.88420889344959
              ],
              [
                113.49260974409685,
                -23.877930290953422
              ],
              [
                113.4869449186574,
                -23.878401196706776
              ],
              [
                113.48059344771013,
                -23.882639271383972
              ],
              [
                113.47664523604021,
                -23.88373800882912
              ],
              [
                113.47149563531971,
                -23.89197802588292
              ],
              [
                113.46857730990395,
                -23.895941046063918
              ],
              [
                113.46909213545428,
                -23.9002179507579
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.49363971235857,
                -23.877930290953422
              ],
              [
                113.50102115156756,
                -23.869610673495625
              ],
              [
                113.51853061201678,
                -23.846061689238134
              ],
              [
                113.53003192427263,
                -23.78340057073479
              ],
              [
                113.51629901411638,
                -23.78277223601926
              ],
              [
                113.51029086592303,
                -23.786070959396525
              ],
              [
                113.51372409346209,
                -23.80539037220104
              ],
              [
                113.50119281294451,
                -23.85328383279053
              ],
              [
                113.4953563261281,
                -23.86537217225813
              ],
              [
                113.49123645308123,
                -23.874947848063087
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.52368045332537,
                -23.78076867455596
              ],
              [
                113.52883029463396,
                -23.772599921081582
              ],
              [
                113.53260684492693,
                -23.770871849792808
              ],
              [
                113.53861499312029,
                -23.771657339588128
              ],
              [
                113.53792834761248,
                -23.768201149011784
              ],
              [
                113.5308902311574,
                -23.767886945315425
              ],
              [
                113.5253970670949,
                -23.771186046280103
              ],
              [
                113.5199039030324,
                -23.779511976650134
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.61569095137224,
                -23.61537618960432
              ],
              [
                113.6132876920949,
                -23.619622833046506
              ],
              [
                113.60796618940935,
                -23.62890205636934
              ],
              [
                113.601958041216,
                -23.638023363928443
              ],
              [
                113.6074512052785,
                -23.638809653794482
              ],
              [
                113.61534762861834,
                -23.6216674641353
              ],
              [
                113.61860919478045,
                -23.618364582670914
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.63766360762224,
                -23.58485922443149
              ],
              [
                113.6352603483449,
                -23.591781220570414
              ],
              [
                113.63663363936053,
                -23.595871319367056
              ],
              [
                113.63800693037615,
                -23.5976017073905
              ],
              [
                113.64006686689959,
                -23.59571401023297
              ],
              [
                113.6381785917531,
                -23.59193853442059
              ],
              [
                113.64006686689959,
                -23.588162949956132
              ],
              [
                113.64281344893084,
                -23.584544579567645
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.76555133345232,
                -23.486497939955058
              ],
              [
                113.7619464445363,
                -23.490276443923985
              ],
              [
                113.76177478315935,
                -23.49484199173233
              ],
              [
                113.7616031217824,
                -23.50050934831416
              ],
              [
                113.76022983076678,
                -23.50491712381087
              ],
              [
                113.7586848783742,
                -23.5097969889493
              ],
              [
                113.7616031217824,
                -23.511213690127327
              ],
              [
                113.76349139692888,
                -23.504759705796637
              ],
              [
                113.76469302656756,
                -23.500194501564817
              ],
              [
                113.76383471968279,
                -23.492008222051815
              ],
              [
                113.76555133345232,
                -23.488702080430247
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.77236860422579,
                -23.39046979177053
              ],
              [
                113.7730552497336,
                -23.378810256073464
              ],
              [
                113.77528684763399,
                -23.359585538810897
              ],
              [
                113.77837675241915,
                -23.339254733227495
              ],
              [
                113.7778617682883,
                -23.311984502503424
              ],
              [
                113.77511518625705,
                -23.31371861440409
              ],
              [
                113.77391355661837,
                -23.329955110039116
              ],
              [
                113.77494352488009,
                -23.334683813368116
              ],
              [
                113.77494352488009,
                -23.34382549574991
              ],
              [
                113.77339857248751,
                -23.353912138922322
              ],
              [
                113.77168195871798,
                -23.363367670616064
              ],
              [
                113.77030866770235,
                -23.374870991907088
              ],
              [
                113.77065199045626,
                -23.38542795629668
              ],
              [
                113.76945036081759,
                -23.389839572829963
              ],
              [
                113.76704710154024,
                -23.392360430601787
              ],
              [
                113.7701370063254,
                -23.392675534449968
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.77146242827553,
                -23.30013464330521
              ],
              [
                113.77644060820717,
                -23.300922949024244
              ],
              [
                113.77644060820717,
                -23.28689040890541
              ],
              [
                113.77575396269935,
                -23.281371588943873
              ],
              [
                113.77506731719154,
                -23.271910222577176
              ],
              [
                113.77420901030678,
                -23.26575997406322
              ],
              [
                113.77214907378334,
                -23.265129163292684
              ],
              [
                113.77146242827553,
                -23.271752527443784
              ],
              [
                113.77180575102943,
                -23.2827907359255
              ],
              [
                113.77129076689857,
                -23.288624847930617
              ],
              [
                113.7726640579142,
                -23.292882011539913
              ],
              [
                113.77180575102943,
                -23.29776969812227
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.75515459746498,
                -23.201452050887934
              ],
              [
                113.75223635405678,
                -23.200505377591327
              ],
              [
                113.75206469267982,
                -23.205238677028614
              ],
              [
                113.75549792021889,
                -23.212969372266105
              ],
              [
                113.75790117949623,
                -23.220226352560577
              ],
              [
                113.75927447051185,
                -23.225747703858055
              ],
              [
                113.76150606841225,
                -23.226378700897854
              ],
              [
                113.76219271392006,
                -23.219595326447763
              ],
              [
                113.75961779326576,
                -23.214547010215888
              ],
              [
                113.75807284087318,
                -23.21044511279571
              ],
              [
                113.75704287261146,
                -23.205396450789703
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.741198932582,
                -23.132058560423424
              ],
              [
                113.74514714425192,
                -23.131427118471493
              ],
              [
                113.74343053048239,
                -23.124954667076356
              ],
              [
                113.74394551461324,
                -23.1150085844611
              ],
              [
                113.73759404366598,
                -23.10632489387022
              ],
              [
                113.73398915474996,
                -23.10648278416653
              ],
              [
                113.73776570504293,
                -23.113745537100396
              ],
              [
                113.74034062569723,
                -23.12353384326484
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.7782194247286,
                -23.046260784138887
              ],
              [
                113.780451022629,
                -23.041521873057146
              ],
              [
                113.77581616545126,
                -23.024618399337633
              ],
              [
                113.7723829379122,
                -23.014032901990277
              ],
              [
                113.77118130827353,
                -23.003130551310214
              ],
              [
                113.77289792204306,
                -22.994281619184264
              ],
              [
                113.77203961515829,
                -22.98369374191062
              ],
              [
                113.77409955168173,
                -22.97136651095708
              ],
              [
                113.77375622892782,
                -22.962673556779052
              ],
              [
                113.77135296965048,
                -22.957773645417422
              ],
              [
                113.77015134001181,
                -22.970102115997367
              ],
              [
                113.76997967863485,
                -22.980374982669172
              ],
              [
                113.76826306486532,
                -22.99443964091588
              ],
              [
                113.76894971037314,
                -23.000760358514057
              ],
              [
                113.76757641935751,
                -23.008660839286918
              ],
              [
                113.77066632414267,
                -23.023670478226485
              ],
              [
                113.77358456755087,
                -23.036466850812992
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.76568814421103,
                -22.915721951239558
              ],
              [
                113.76860638761923,
                -22.92046527682937
              ],
              [
                113.76894971037314,
                -22.928054252407634
              ],
              [
                113.77203961515829,
                -22.941017768740775
              ],
              [
                113.77409955168173,
                -22.940859684553875
              ],
              [
                113.77306958342001,
                -22.932797146249044
              ],
              [
                113.77306958342001,
                -22.92757995388875
              ],
              [
                113.77221127653524,
                -22.9248922309126
              ],
              [
                113.77203961515829,
                -22.91856796651624
              ],
              [
                113.76912137175009,
                -22.914457036377417
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.74346608070414,
                -22.8608454270144
              ],
              [
                113.74621266273539,
                -22.86495798150009
              ],
              [
                113.75153416542094,
                -22.864799808629154
              ],
              [
                113.75565403846781,
                -22.869544914653552
              ],
              [
                113.75668400672953,
                -22.86748872239169
              ],
              [
                113.75393742469828,
                -22.862269017652515
              ],
              [
                113.74792927650492,
                -22.861794489096855
              ],
              [
                113.74552601722758,
                -22.858947282965744
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.67312003599221,
                -22.73745959964902
              ],
              [
                113.67071677671487,
                -22.738726160296086
              ],
              [
                113.6779265545469,
                -22.746483588200533
              ],
              [
                113.67878486143167,
                -22.743950598927448
              ],
              [
                113.67603827940042,
                -22.740784296320896
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.75782703017512,
                -22.356293932424496
              ],
              [
                113.75233386611262,
                -22.360897858602232
              ],
              [
                113.74684070205012,
                -22.3708989669069
              ],
              [
                113.73654101943293,
                -22.391216466037882
              ],
              [
                113.7370560035638,
                -22.396136664011724
              ],
              [
                113.739974246972,
                -22.394232091899912
              ],
              [
                113.74443744277278,
                -22.38439138710749
              ],
              [
                113.74735568618098,
                -22.375502410225025
              ],
              [
                113.75267718886653,
                -22.366136623967154
              ],
              [
                113.75611041640559,
                -22.360897858602232
              ],
              [
                113.76057361220637,
                -22.358675292549133
              ],
              [
                113.76126025771418,
                -22.355817655514603
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.80537723159114,
                -22.282768643670067
              ],
              [
                113.79851077651301,
                -22.29626959202269
              ],
              [
                113.79765246962825,
                -22.30278134787984
              ],
              [
                113.79954074477473,
                -22.30214606798719
              ],
              [
                113.80537723159114,
                -22.29102820223489
              ],
              [
                113.80812381362239,
                -22.283721694563255
              ],
              [
                113.80692218398372,
                -22.281656742750823
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.84260352799605,
                -22.183467540167726
              ],
              [
                113.84311851212692,
                -22.18362649500595
              ],
              [
                113.8311022157402,
                -22.211917590604163
              ],
              [
                113.81359275529098,
                -22.261174981405464
              ],
              [
                113.81221946427536,
                -22.26975352983187
              ],
              [
                113.81668266007614,
                -22.270388956942757
              ],
              [
                113.8252657289238,
                -22.250689374861516
              ],
              [
                113.83213218400192,
                -22.226219906735228
              ],
              [
                113.84105857560348,
                -22.212871123713764
              ],
              [
                113.84449180314255,
                -22.19697805937316
              ],
              [
                113.84861167618942,
                -22.18585184385992
              ],
              [
                113.84346183488083,
                -22.18585184385992
              ],
              [
                113.8420885438652,
                -22.18299067457417
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.86239604507136,
                -22.14318913063912
              ],
              [
                113.85621623550105,
                -22.155749606042157
              ],
              [
                113.85192470107722,
                -22.16656025668376
              ],
              [
                113.8476331666534,
                -22.17975448351103
              ],
              [
                113.84986476455379,
                -22.180708235043483
              ],
              [
                113.85432796035457,
                -22.169580731143633
              ],
              [
                113.8589628175323,
                -22.161155035213152
              ],
              [
                113.86325435195613,
                -22.148436047815803
              ],
              [
                113.86565761123347,
                -22.144143130125464
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.87235240493465,
                -22.129673443586288
              ],
              [
                113.87492732558894,
                -22.129673443586288
              ],
              [
                113.87578563247371,
                -22.11806481850584
              ],
              [
                113.87527064834285,
                -22.111703522593317
              ],
              [
                113.87218074355769,
                -22.10915892387416
              ],
              [
                113.87046412978816,
                -22.114725173936858
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.8725240663116,
                -22.10327436350275
              ],
              [
                113.87664393935847,
                -22.10470576564627
              ],
              [
                113.88162211929011,
                -22.09150450642847
              ],
              [
                113.88677196059871,
                -22.081165308800372
              ],
              [
                113.89175014053035,
                -22.066689160525915
              ],
              [
                113.89398173843074,
                -22.054279853193385
              ],
              [
                113.900333209378,
                -22.04489260246187
              ],
              [
                113.89878825698543,
                -22.03375437851696
              ],
              [
                113.89278010879207,
                -22.03454999500917
              ],
              [
                113.89072017226863,
                -22.048870327131638
              ],
              [
                113.88660029922175,
                -22.061757386750667
              ],
              [
                113.8835103944366,
                -22.07559773499598
              ],
              [
                113.87973384414363,
                -22.08657359891645
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.91234950576472,
                -21.96611064724244
              ],
              [
                113.91252116714168,
                -21.975980683504318
              ],
              [
                113.91149119887996,
                -21.978846049409118
              ],
              [
                113.91286448989558,
                -21.985372500290314
              ],
              [
                113.90925960097957,
                -21.98823767660865
              ],
              [
                113.90599803481746,
                -21.996037030132765
              ],
              [
                113.90084819350886,
                -22.007178219805148
              ],
              [
                113.89569835220027,
                -22.020387353001222
              ],
              [
                113.89415339980769,
                -22.03470911777104
              ],
              [
                113.89827327285457,
                -22.03375437851696
              ],
              [
                113.89981822524715,
                -22.028025807788328
              ],
              [
                113.90153483901668,
                -22.02070563017468
              ],
              [
                113.90531138930965,
                -22.016886256900865
              ],
              [
                113.9029081300323,
                -22.014021659379914
              ],
              [
                113.91337947402644,
                -21.98935189622008
              ],
              [
                113.91543941054988,
                -21.982507266125225
              ],
              [
                113.91629771743465,
                -21.97486635892413
              ],
              [
                113.91664104018855,
                -21.96595144748846
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.95354823623347,
                -21.88919641737642
              ],
              [
                113.94513682876277,
                -21.89301922339041
              ],
              [
                113.9358671144073,
                -21.900027434871454
              ],
              [
                113.93243388686824,
                -21.906238970614584
              ],
              [
                113.92556743179011,
                -21.91722794740659
              ],
              [
                113.92951564346004,
                -21.917387201707186
              ],
              [
                113.93449382339168,
                -21.90862795072568
              ],
              [
                113.93758372817683,
                -21.90448702640832
              ],
              [
                113.94324855361629,
                -21.898753240229752
              ],
              [
                113.9439351991241,
                -21.896841926909904
              ],
              [
                113.94633845840144,
                -21.898275414302447
              ],
              [
                113.9494283631866,
                -21.894930587962875
              ],
              [
                113.9549215272491,
                -21.89301922339041
              ],
              [
                113.95989970718074,
                -21.89238209617204
              ],
              [
                113.95680980239558,
                -21.88919641737642
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.96762446914363,
                -21.882174470280194
              ],
              [
                113.97157268081355,
                -21.88185588280223
              ],
              [
                113.97277431045222,
                -21.875006079950698
              ],
              [
                113.98135737929988,
                -21.861942753925813
              ],
              [
                113.98358897720027,
                -21.858278435638663
              ],
              [
                113.98685054336238,
                -21.85732251105843
              ],
              [
                113.99182872329402,
                -21.8541360495875
              ],
              [
                113.99526195083308,
                -21.853498748763947
              ],
              [
                113.99509028945613,
                -21.850949517040704
              ],
              [
                113.98873881850886,
                -21.853817399531092
              ],
              [
                113.9823873475616,
                -21.85668522445071
              ],
              [
                113.97826747451472,
                -21.862261385855273
              ],
              [
                113.97311763320613,
                -21.86815594830058
              ],
              [
                113.96951274429011,
                -21.874368872270935
              ],
              [
                113.96745280776668,
                -21.878669968892556
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.16005687270808,
                -21.78034961533116
              ],
              [
                114.15422038589168,
                -21.785769351234485
              ],
              [
                114.1497571900909,
                -21.79102948719603
              ],
              [
                114.1471822694366,
                -21.79437674592897
              ],
              [
                114.14958552871394,
                -21.79373917886495
              ],
              [
                114.15370540176082,
                -21.789913716911155
              ],
              [
                114.15748195205379,
                -21.785769351234485
              ],
              [
                114.16177348647761,
                -21.7819436765698
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.30013575627049,
                -21.72347168068362
              ],
              [
                114.30030741764745,
                -21.71677377793165
              ],
              [
                114.30374064518651,
                -21.709118650053735
              ],
              [
                114.30494227482518,
                -21.701941597824018
              ],
              [
                114.30906214787205,
                -21.69635919870541
              ],
              [
                114.31335368229588,
                -21.689022002175843
              ],
              [
                114.31919016911229,
                -21.682162980507886
              ],
              [
                114.32262339665135,
                -21.68040829461315
              ],
              [
                114.3195334918662,
                -21.676898858734113
              ],
              [
                114.30614390446385,
                -21.68694837889848
              ],
              [
                114.29824748112401,
                -21.70242007910579
              ],
              [
                114.29670252873143,
                -21.71374367184765
              ],
              [
                114.29292597843846,
                -21.719484871381038
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.344993036539,
                -21.65866223526511
              ],
              [
                114.33958570316497,
                -21.66456516584659
              ],
              [
                114.33392087772552,
                -21.66927138336685
              ],
              [
                114.32748357608978,
                -21.674376259216796
              ],
              [
                114.32130376651946,
                -21.678125037308035
              ],
              [
                114.32250539615814,
                -21.679799991751345
              ],
              [
                114.32533780887786,
                -21.67772623576217
              ],
              [
                114.32859937503997,
                -21.67557268834839
              ],
              [
                114.33065931156341,
                -21.67445602146782
              ],
              [
                114.3325475867099,
                -21.673738159619962
              ],
              [
                114.33512250736419,
                -21.670786912248342
              ],
              [
                114.33941404178802,
                -21.667277242150792
              ],
              [
                114.34379140690032,
                -21.662491190734254
              ],
              [
                114.34756795719329,
                -21.65945994270147
              ],
              [
                114.3493704016513,
                -21.65961948365949
              ],
              [
                114.34928457096282,
                -21.661055344342397
              ],
              [
                114.34928457096282,
                -21.662650728340033
              ],
              [
                114.3504862006015,
                -21.662650728340033
              ],
              [
                114.35220281437103,
                -21.659539713202527
              ],
              [
                114.35091535404388,
                -21.65826337989301
              ],
              [
                114.34868375614349,
                -21.6575454374447
              ],
              [
                114.34653798893157,
                -21.65762520900426
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.75900370251856,
                -21.52005146949676
              ],
              [
                114.75385386120996,
                -21.526439118413602
              ],
              [
                114.75393969189844,
                -21.528674729179354
              ],
              [
                114.75522715222559,
                -21.52795614375725
              ],
              [
                114.75797373425684,
                -21.52396393778755
              ],
              [
                114.76003367078027,
                -21.520610399988648
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.3195490996199,
                -20.960014883500726
              ],
              [
                115.31165267628006,
                -20.95616757176519
              ],
              [
                115.30444289844803,
                -20.948472651478724
              ],
              [
                115.29826308887772,
                -20.947190126294636
              ],
              [
                115.30100967090897,
                -20.951678916354634
              ],
              [
                115.30753280323319,
                -20.96097669597296
              ],
              [
                115.31817580860428,
                -20.964503288785636
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.3030696074324,
                -20.93789149007839
              ],
              [
                115.30753280323319,
                -20.940136041352957
              ],
              [
                115.3188624541121,
                -20.938853444744506
              ],
              [
                115.31817580860428,
                -20.932440296918674
              ],
              [
                115.31199599903397,
                -20.927950930056
              ],
              [
                115.30993606251053,
                -20.921858002718167
              ],
              [
                115.31611587208084,
                -20.920575249606653
              ],
              [
                115.3188624541121,
                -20.911274961257103
              ],
              [
                115.3195490996199,
                -20.90069117284383
              ],
              [
                115.32057906788162,
                -20.891068899091433
              ],
              [
                115.32057906788162,
                -20.884653707226004
              ],
              [
                115.31233932178787,
                -20.88850285523897
              ],
              [
                115.31268264454178,
                -20.894597137766954
              ],
              [
                115.31542922657303,
                -20.900049707121884
              ],
              [
                115.31474258106522,
                -20.90678496041068
              ],
              [
                115.31130935352616,
                -20.917368318798214
              ],
              [
                115.30615951221756,
                -20.91640622617694
              ],
              [
                115.30478622120194,
                -20.922820060346826
              ],
              [
                115.30409957569412,
                -20.933722948453156
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.3085627714949,
                -20.87150170714204
              ],
              [
                115.30478622120194,
                -20.860594297288362
              ],
              [
                115.30169631641678,
                -20.855781953113944
              ],
              [
                115.30100967090897,
                -20.850648616259
              ],
              [
                115.30684615772537,
                -20.841343996739205
              ],
              [
                115.30924941700272,
                -20.833964061850924
              ],
              [
                115.31577254932694,
                -20.82497930504304
              ],
              [
                115.32023574512772,
                -20.816956747863262
              ],
              [
                115.3243556181746,
                -20.809896544233617
              ],
              [
                115.32023574512772,
                -20.80925469114207
              ],
              [
                115.31577254932694,
                -20.818240385717445
              ],
              [
                115.31199599903397,
                -20.824658410958083
              ],
              [
                115.30478622120194,
                -20.831397043175805
              ],
              [
                115.29517318409256,
                -20.841343996739205
              ],
              [
                115.29276992481522,
                -20.855461124693296
              ],
              [
                115.297233120616,
                -20.865406487439166
              ],
              [
                115.30135299366287,
                -20.86797292586435
              ],
              [
                115.29929305713944,
                -20.87663433198067
              ],
              [
                115.30650283497147,
                -20.87663433198067
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.34735824268631,
                -20.750513577667927
              ],
              [
                115.3408351103621,
                -20.75532928256097
              ],
              [
                115.3408351103621,
                -20.761749983810027
              ],
              [
                115.3408351103621,
                -20.768491426563923
              ],
              [
                115.34220840137772,
                -20.775874566350698
              ],
              [
                115.34461166065506,
                -20.783899308923818
              ],
              [
                115.34873153370194,
                -20.78261537877325
              ],
              [
                115.34735824268631,
                -20.777158553821476
              ],
              [
                115.34529830616287,
                -20.76817041230054
              ],
              [
                115.3466715971785,
                -20.761428955225025
              ],
              [
                115.35010482471756,
                -20.753724064638284
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.40846969288162,
                -20.698815360944277
              ],
              [
                115.41396285694412,
                -20.703632710364467
              ],
              [
                115.42151595753006,
                -20.67986563528557
              ],
              [
                115.43078567188553,
                -20.670550495953737
              ],
              [
                115.43730880420975,
                -20.66701701775314
              ],
              [
                115.44451858204178,
                -20.670871717168232
              ],
              [
                115.4506983916121,
                -20.673120246644544
              ],
              [
                115.4568782011824,
                -20.673441462423202
              ],
              [
                115.4561915556746,
                -20.66958682823366
              ],
              [
                115.44314529102616,
                -20.665410864123803
              ],
              [
                115.43833877247147,
                -20.662519744795627
              ],
              [
                115.43112899463944,
                -20.666053327613493
              ],
              [
                115.42426253956131,
                -20.671192937703264
              ],
              [
                115.41636611622147,
                -20.681471636023105
              ],
              [
                115.41396285694412,
                -20.687895469028454
              ],
              [
                115.41121627491287,
                -20.693034339622347
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.44486190479569,
                -20.574474918492054
              ],
              [
                115.45172835987381,
                -20.54425804333856
              ],
              [
                115.440055386241,
                -20.540400139808316
              ],
              [
                115.43662215870194,
                -20.567403419678698
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.46031142872147,
                -20.514035194782995
              ],
              [
                115.45378829639725,
                -20.50503149056027
              ],
              [
                115.45756484669022,
                -20.496992021760757
              ],
              [
                115.4565348784285,
                -20.489273734958424
              ],
              [
                115.45962478321366,
                -20.48734410254446
              ],
              [
                115.46511794727616,
                -20.489273734958424
              ],
              [
                115.4678645293074,
                -20.486057667445245
              ],
              [
                115.46614791553787,
                -20.48026857596501
              ],
              [
                115.45378829639725,
                -20.481555059620504
              ],
              [
                115.45001174610428,
                -20.48637927723176
              ],
              [
                115.44623519581131,
                -20.49216813804729
              ],
              [
                115.44623519581131,
                -20.49902662377098
              ],
              [
                115.44726516407303,
                -20.509638492584145
              ],
              [
                115.45550491016678,
                -20.517355753611763
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                115.4780367667712,
                -20.44496355693144
              ],
              [
                115.48455989909542,
                -20.432416892358432
              ],
              [
                115.48558986735713,
                -20.428877904433154
              ],
              [
                115.4945162589587,
                -20.420834447269833
              ],
              [
                115.49623287272823,
                -20.404746271797524
              ],
              [
                115.49932277751338,
                -20.394127155276013
              ],
              [
                115.50103939128292,
                -20.383185481987812
              ],
              [
                115.50103939128292,
                -20.37320857375344
              ],
              [
                115.50515926432979,
                -20.363231020313997
              ],
              [
                115.50859249186885,
                -20.36387475290432
              ],
              [
                115.50859249186885,
                -20.360012317096647
              ],
              [
                115.50309932780635,
                -20.35840294032379
              ],
              [
                115.49897945475948,
                -20.366127795829293
              ],
              [
                115.49554622722042,
                -20.37546148040592
              ],
              [
                115.49554622722042,
                -20.381898175253983
              ],
              [
                115.49554622722042,
                -20.38897822929313
              ],
              [
                115.4890230948962,
                -20.38930004220607
              ],
              [
                115.49211299968135,
                -20.399597700647774
              ],
              [
                115.49176967692745,
                -20.40603338769648
              ],
              [
                115.49176967692745,
                -20.414077618340695
              ],
              [
                115.49108303141963,
                -20.4192257053815
              ],
              [
                115.48146999431026,
                -20.42694751306425
              ],
              [
                115.48009670329463,
                -20.432416892358432
              ],
              [
                115.47735012126338,
                -20.439816331227963
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    benthic_mask = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.89529550071427,
                -28.859253617996973
              ],
              [
                113.91005837913224,
                -28.867071129186403
              ],
              [
                113.92585122581193,
                -28.858201215824806
              ],
              [
                113.9435323476381,
                -28.85143551894046
              ],
              [
                113.95606362815568,
                -28.844067926178948
              ],
              [
                113.943875670392,
                -28.831286170457524
              ],
              [
                113.90405023093888,
                -28.82542107479418
              ],
              [
                113.8970121144838,
                -28.840158379338586
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.0927877645014,
                -25.9758523150344
              ],
              [
                113.09471895499212,
                -25.977279765677796
              ],
              [
                113.09596349997503,
                -25.978977251995957
              ],
              [
                113.09669306082708,
                -25.978244249546524
              ],
              [
                113.09386064810735,
                -25.975235033714043
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.07853987021429,
                -25.96107525403803
              ],
              [
                113.07961275382024,
                -25.96176977888858
              ],
              [
                113.08059980673772,
                -25.962657221343424
              ],
              [
                113.08193018240911,
                -25.964007664411046
              ],
              [
                113.08330347342473,
                -25.966168341080344
              ],
              [
                113.08446218771917,
                -25.967017167486876
              ],
              [
                113.08441927237493,
                -25.96651558898687
              ],
              [
                113.08317472739202,
                -25.965165174704246
              ],
              [
                113.08193018240911,
                -25.9634674890439
              ],
              [
                113.0806856374262,
                -25.962309962049467
              ],
              [
                113.079569838476,
                -25.96122959324795
              ],
              [
                113.07858278555852,
                -25.960535065209186
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.0618458013056,
                -25.945003642620577
              ],
              [
                113.06291868491155,
                -25.94585262167151
              ],
              [
                113.06429197592718,
                -25.94728043627185
              ],
              [
                113.0647640447138,
                -25.947627739908143
              ],
              [
                113.06519319815618,
                -25.94755056141082
              ],
              [
                113.06407739920598,
                -25.946392877880697
              ],
              [
                113.06339075369817,
                -25.946006980841343
              ],
              [
                113.06313326163274,
                -25.944849282135557
              ],
              [
                113.06283285422307,
                -25.944270428514635
              ],
              [
                113.06201746268255,
                -25.943961705420072
              ],
              [
                113.06158830924016,
                -25.943923114976343
              ],
              [
                113.0616312245844,
                -25.944424789758422
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.05021574301702,
                -25.931496334562283
              ],
              [
                113.05111696524602,
                -25.93246119364275
              ],
              [
                113.05201818747503,
                -25.932962917242136
              ],
              [
                113.0523185948847,
                -25.933619014109972
              ],
              [
                113.05141737265569,
                -25.93365760792959
              ],
              [
                113.05201818747503,
                -25.93466104280243
              ],
              [
                113.05249025626165,
                -25.935162757034014
              ],
              [
                113.05244734091741,
                -25.93400495173732
              ],
              [
                113.05309107108098,
                -25.933927764312987
              ],
              [
                113.05369188590032,
                -25.935239943649243
              ],
              [
                113.05455019278509,
                -25.93632055095243
              ],
              [
                113.05515100760442,
                -25.93693803638965
              ],
              [
                113.05622389121038,
                -25.937825666035188
              ],
              [
                113.05665304465276,
                -25.93844314358298
              ],
              [
                113.05652429862005,
                -25.93759411112029
              ],
              [
                113.055794737768,
                -25.93662929407561
              ],
              [
                113.05476476950628,
                -25.935780248539825
              ],
              [
                113.05364897055608,
                -25.934583855807922
              ],
              [
                113.05257608695013,
                -25.93246119364275
              ],
              [
                113.0515461186884,
                -25.9315349290772
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.04395010275823,
                -25.920823652276997
              ],
              [
                113.0442505101679,
                -25.92217457510717
              ],
              [
                113.04575254721624,
                -25.92375706501808
              ],
              [
                113.04691126151067,
                -25.924104438008534
              ],
              [
                113.0460529546259,
                -25.922946524059217
              ],
              [
                113.04562380118352,
                -25.921981587079262
              ],
              [
                113.04489424033147,
                -25.92101664220057
              ],
              [
                113.04463674826604,
                -25.920090287686072
              ],
              [
                113.04395010275823,
                -25.919897296246017
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.04446508688909,
                -25.920167484173643
              ],
              [
                113.04352094931585,
                -25.91889373566488
              ],
              [
                113.04304888052923,
                -25.918160359068686
              ],
              [
                113.04176142020208,
                -25.91584440302696
              ],
              [
                113.04068853659612,
                -25.913605602280025
              ],
              [
                113.04073145194036,
                -25.91190717336009
              ],
              [
                113.04025938315374,
                -25.912022976108933
              ],
              [
                113.0405597905634,
                -25.914879407917137
              ],
              [
                113.0413322667597,
                -25.91599880151167
              ],
              [
                113.04180433554632,
                -25.917735770533206
              ],
              [
                113.04266264243108,
                -25.918430550976982
              ],
              [
                113.04347803397161,
                -25.920128885936176
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.02156188927563,
                -25.85703288197453
              ],
              [
                113.01993110619458,
                -25.85459986759608
              ],
              [
                113.01752784691723,
                -25.851201287510744
              ],
              [
                113.01666954003247,
                -25.85004265833726
              ],
              [
                113.01396587334546,
                -25.84656670270795
              ],
              [
                113.01190593682202,
                -25.845292160047677
              ],
              [
                113.01315048180493,
                -25.846798436261512
              ],
              [
                113.01418045006665,
                -25.848111584488922
              ],
              [
                113.01551082573803,
                -25.849579203489352
              ],
              [
                113.01658370934399,
                -25.851201287510744
              ],
              [
                113.01787116967114,
                -25.85286196952922
              ],
              [
                113.01907279930981,
                -25.85502468323827
              ],
              [
                113.02091815911206,
                -25.85722597620919
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.01091888390454,
                -25.84359274847043
              ],
              [
                113.00958850823315,
                -25.841622945410894
              ],
              [
                113.00838687859448,
                -25.84000073002841
              ],
              [
                113.00692775689038,
                -25.838146742354763
              ],
              [
                113.00555446587475,
                -25.836254099972944
              ],
              [
                113.00435283623608,
                -25.83552021008803
              ],
              [
                113.00366619072827,
                -25.834554558568286
              ],
              [
                113.00293662987622,
                -25.83358889916876
              ],
              [
                113.00194957695874,
                -25.833086753166988
              ],
              [
                113.00057628594311,
                -25.83154167518276
              ],
              [
                112.9989884182063,
                -25.829417160019897
              ],
              [
                112.99782970391186,
                -25.828103804300998
              ],
              [
                112.99607017479809,
                -25.825361161549086
              ],
              [
                112.99564102135571,
                -25.825477049148244
              ],
              [
                112.99705722771557,
                -25.82767889197796
              ],
              [
                112.9987738414851,
                -25.830344225871386
              ],
              [
                112.99993255577954,
                -25.83150304797472
              ],
              [
                113.00194957695874,
                -25.83420692209219
              ],
              [
                113.00315120659741,
                -25.834631810979843
              ],
              [
                113.0028078838435,
                -25.834940820121776
              ],
              [
                113.00508239708813,
                -25.83660173043505
              ],
              [
                113.0062840267268,
                -25.838069492237917
              ],
              [
                113.00817230187329,
                -25.84007797888435
              ],
              [
                113.00877311669262,
                -25.84166156931556
              ],
              [
                113.00984600029858,
                -25.842472668400486
              ],
              [
                113.01182010613354,
                -25.84533078275432
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                112.98954704247387,
                -25.81655337211541
              ],
              [
                112.99040534935864,
                -25.817403275091674
              ],
              [
                112.99122074089917,
                -25.81829180350005
              ],
              [
                112.99169280968579,
                -25.818755380892807
              ],
              [
                112.99250820122631,
                -25.819180325241984
              ],
              [
                112.99195030175122,
                -25.81825317196875
              ],
              [
                112.99117782555493,
                -25.81751917047952
              ],
              [
                112.9898045345393,
                -25.816282947162087
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                112.97360090895711,
                -25.47880557857815
              ],
              [
                112.97197012587606,
                -25.482059828085518
              ],
              [
                112.97669081374227,
                -25.48663112503556
              ],
              [
                112.98304228468953,
                -25.481982346978064
              ],
              [
                112.98055319472371,
                -25.478883061732915
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                112.93838282755542,
                -25.46299996592608
              ],
              [
                112.94095774820971,
                -25.46749449698216
              ],
              [
                112.97014018229174,
                -25.4750883230632
              ],
              [
                112.98198481730151,
                -25.476483055325474
              ],
              [
                112.99073954752612,
                -25.47679299363138
              ],
              [
                113.00927897623706,
                -25.46098512164022
              ],
              [
                113.00464411905932,
                -25.459125235432527
              ],
              [
                112.98696299723315,
                -25.472608759100797
              ],
              [
                112.9787232511394,
                -25.471059005664245
              ],
              [
                112.9625870817058,
                -25.469664210498475
              ],
              [
                112.95022746256518,
                -25.464084868105555
              ],
              [
                112.94353266886401,
                -25.46222502980877
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                113.1606891225839,
                -24.744650220440597
              ],
              [
                113.1629207204843,
                -24.7474563854801
              ],
              [
                113.1632640432382,
                -24.749638914491
              ],
              [
                113.16274905910734,
                -24.7527567465941
              ],
              [
                113.16223407497648,
                -24.755562728606552
              ],
              [
                113.16206241359953,
                -24.758524529764387
              ],
              [
                113.1632640432382,
                -24.759615701866196
              ],
              [
                113.1658389638925,
                -24.753224414663023
              ],
              [
                113.16721225490812,
                -24.750106594292873
              ],
              [
                113.16652560940031,
                -24.744806120160234
              ],
              [
                113.16446567287687,
                -24.744650220440597
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.10461024795222,
                -21.73554925302313
              ],
              [
                114.10701350722957,
                -21.744478554428596
              ],
              [
                114.1585119203155,
                -21.777639670556262
              ],
              [
                114.16503505263972,
                -21.78034961533116
              ],
              [
                114.17258815322566,
                -21.78274070054339
              ],
              [
                114.18357448135066,
                -21.78545054891163
              ],
              [
                114.1856344178741,
                -21.764886301839372
              ],
              [
                114.16984157119441,
                -21.741608482351314
              ],
              [
                114.12967280898738,
                -21.734592509248163
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.37381697631531,
                -22.193734685504555
              ],
              [
                114.35625081530509,
                -22.217257486494486
              ],
              [
                114.37101369372306,
                -22.229652439503717
              ],
              [
                114.39412311256098,
                -22.227109974359525
              ],
              [
                114.39137653052973,
                -22.216303983196582
              ],
              [
                114.3896599167602,
                -22.2099471289311
              ],
              [
                114.37798694312737,
                -22.202159590005877
              ],
              [
                114.37532619727588,
                -22.197470852926486
              ],
              [
                114.37781529943554,
                -22.191192720480696
              ],
              [
                114.38459567105315,
                -22.18896759054536
              ],
              [
                114.39086154639885,
                -22.19246429502333
              ],
              [
                114.39274982154535,
                -22.193735847257354
              ],
              [
                114.3951530808227,
                -22.18960326040738
              ],
              [
                114.4009895676391,
                -22.18292728636407
              ],
              [
                114.39789966285394,
                -22.175297213354952
              ],
              [
                114.39343646705316,
                -22.16734878022082
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.46834338125723,
                -22.35619764760056
              ],
              [
                114.4230247777416,
                -22.38604110522361
              ],
              [
                114.42371142324942,
                -22.443804917901165
              ],
              [
                114.43195116934317,
                -22.460939008237613
              ],
              [
                114.53082812246817,
                -22.39429454876684
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.5144168356727,
                -21.957067443514255
              ],
              [
                114.40730013645396,
                -22.076742707713283
              ],
              [
                114.42789950168833,
                -22.17597083092835
              ],
              [
                114.48557772434458,
                -22.170883909860223
              ],
              [
                114.51579012668833,
                -22.20648849046299
              ],
              [
                114.6297732809852,
                -22.00800544124576
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.77396883762583,
                -21.819443718099265
              ],
              [
                114.70942415989146,
                -21.871705397947643
              ],
              [
                114.73551668918833,
                -21.89464350975055
              ],
              [
                114.82478060520396,
                -21.871705397947643
              ],
              [
                114.80280794895396,
                -21.83729131820072
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.35323278263274,
                -21.666320044572664
              ],
              [
                114.35280362919036,
                -21.668234433375854
              ],
              [
                114.35185949161712,
                -21.670786912248342
              ],
              [
                114.35065786197845,
                -21.673419108762445
              ],
              [
                114.34705297306243,
                -21.67748695430502
              ],
              [
                114.34430639103118,
                -21.680039269368567
              ],
              [
                114.34267560795013,
                -21.680358305573577
              ],
              [
                114.34078733280364,
                -21.680996375864883
              ],
              [
                114.33967153385345,
                -21.682352265853904
              ],
              [
                114.33718244388763,
                -21.685143763895784
              ],
              [
                114.335809152872,
                -21.68697814744869
              ],
              [
                114.33460752323333,
                -21.690567091196097
              ],
              [
                114.33263341739837,
                -21.692879918676514
              ],
              [
                114.33040181949798,
                -21.693438181814606
              ],
              [
                114.32688276127044,
                -21.694474950472983
              ],
              [
                114.31941549137298,
                -21.702290350907234
              ],
              [
                114.31649724796478,
                -21.70356629436679
              ],
              [
                114.31005994632903,
                -21.712976028078305
              ],
              [
                114.30594007328216,
                -21.71903620875988
              ],
              [
                114.3050817663974,
                -21.72382038158505
              ],
              [
                114.35683767154876,
                -21.70213085717961
              ],
              [
                114.35692350223724,
                -21.67254171526372
              ],
              [
                114.35572187259856,
                -21.66544260787862
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.75067812573633,
                -21.515579948165545
              ],
              [
                114.75599962842188,
                -21.51438219587573
              ],
              [
                114.77084833752832,
                -21.50927167521254
              ],
              [
                114.77582651745996,
                -21.517097086895852
              ],
              [
                114.77436739575586,
                -21.524363163321723
              ],
              [
                114.7764273322793,
                -21.528754571784578
              ],
              [
                114.77539736401758,
                -21.530670781142092
              ],
              [
                114.77479654919824,
                -21.536499095853756
              ],
              [
                114.77376658093652,
                -21.538095853575925
              ],
              [
                114.77119166028223,
                -21.5424868467504
              ],
              [
                114.77410990369043,
                -21.544003704430967
              ],
              [
                114.78209215771875,
                -21.530191731172973
              ],
              [
                114.77737146985254,
                -21.51430234537213
              ],
              [
                114.7698183692666,
                -21.502164558803326
              ],
              [
                114.75127894055566,
                -21.511347845900634
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                118.9138662814334,
                -19.85608836988047
              ],
              [
                118.90013337127715,
                -19.850921697343246
              ],
              [
                118.86614441864043,
                -19.85608836988047
              ],
              [
                118.84657502166777,
                -19.875139020493027
              ],
              [
                118.85035157196074,
                -19.910973867802195
              ],
              [
                118.85962128631621,
                -19.912910655471318
              ],
              [
                118.87850403778106,
                -19.921625906467128
              ],
              [
                118.89464020721465,
                -19.912910655471318
              ],
              [
                118.89052033416777,
                -19.910328266642573
              ],
              [
                118.886057138367,
                -19.909682662848102
              ],
              [
                118.88228058807402,
                -19.910651067551736
              ],
              [
                118.87644410125762,
                -19.908714252216228
              ],
              [
                118.87163758270293,
                -19.906777413168722
              ],
              [
                118.8702642916873,
                -19.901935211822604
              ],
              [
                118.86339783660918,
                -19.90096675377348
              ],
              [
                118.86236786834746,
                -19.89547871289855
              ],
              [
                118.864084482117,
                -19.891281847387845
              ],
              [
                118.86820435516387,
                -19.88837625994966
              ],
              [
                118.8702642916873,
                -19.884179206209375
              ],
              [
                118.87198090545684,
                -19.880950627662415
              ],
              [
                118.87232422821074,
                -19.877399115273636
              ],
              [
                118.87266755096465,
                -19.874493273207335
              ],
              [
                118.87816071502715,
                -19.869972968546673
              ],
              [
                118.88468384735137,
                -19.869327200215864
              ],
              [
                118.88846039764434,
                -19.864483853898452
              ],
              [
                118.89807343475371,
                -19.86383806321225
              ],
              [
                118.9142096041873,
                -19.861254874170946
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                122.15736613482477,
                -17.9386457052914
              ],
              [
                122.14397654742243,
                -17.977184171843806
              ],
              [
                122.16320262164118,
                -17.982735631148838
              ],
              [
                122.17247233599664,
                -17.944524997352744
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                122.18425434114641,
                -17.998055520593184
              ],
              [
                122.17713039400286,
                -18.002218638970042
              ],
              [
                122.19077747347063,
                -18.01789067344285
              ],
              [
                122.21378009798235,
                -18.01666634594248
              ],
              [
                122.1989313888759,
                -18.005891897084695
              ],
              [
                122.19129245760149,
                -18.000096277176663
              ],
              [
                122.18588512422747,
                -17.99707594904487
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    rock_sand = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.14905322012442,
                -22.383184029890423
              ],
              [
                114.10510790762442,
                -22.39715139586797
              ],
              [
                114.12776720938223,
                -22.51835448580375
              ],
              [
                114.16347277578848,
                -22.5297712975103
              ],
              [
                114.23557055410879,
                -22.512645726213304
              ],
              [
                114.27882922110098,
                -22.44792998500427
              ],
              [
                114.31934130606192,
                -22.522160194528542
              ],
              [
                114.36328661856192,
                -22.525331538397168
              ],
              [
                114.42233813223379,
                -22.494249230671134
              ],
              [
                114.42920458731192,
                -22.42063880142217
              ],
              [
                114.44019091543692,
                -22.386993450628363
              ],
              [
                114.47040331778067,
                -22.343813910273806
              ],
              [
                114.50061572012442,
                -22.269488398188578
              ],
              [
                114.51297533926504,
                -22.190037153878404
              ],
              [
                114.45323718008535,
                -22.168418631623553
              ],
              [
                114.4175316136791,
                -22.20020942518774
              ],
              [
                114.37633288321035,
                -22.334287209777152
              ],
              [
                114.30423510489004,
                -22.41048257273162
              ],
              [
                114.21291125235098,
                -22.41809981387015
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.48496269003488,
                -21.641894572067628
              ],
              [
                114.42453788534738,
                -21.64364972649074
              ],
              [
                114.42814277426339,
                -21.652106080558294
              ],
              [
                114.45749686972238,
                -21.65130833246914
              ],
              [
                114.47620795981027,
                -21.65306337244491
              ],
              [
                114.48873924032785,
                -21.647957742347458
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.32463096396066,
                -21.662795479485865
              ],
              [
                114.3241159798298,
                -21.671091183497538
              ],
              [
                114.32840751425363,
                -21.6704530693617
              ],
              [
                114.33149741903878,
                -21.663752700454676
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                116.83371771501203,
                -20.620487857960704
              ],
              [
                116.79869879411359,
                -20.62948475716287
              ],
              [
                116.78565252946515,
                -20.669964219632742
              ],
              [
                116.80899847673078,
                -20.711717438573256
              ],
              [
                116.91542853044172,
                -20.736763850529677
              ],
              [
                116.98546637223859,
                -20.687951630519457
              ],
              [
                117.00949896501203,
                -20.64876203583699
              ],
              [
                116.99645270036359,
                -20.637838544521625
              ],
              [
                116.89620245622297,
                -20.68281258777093
              ],
              [
                116.83303106950422,
                -20.673176413602768
              ],
              [
                116.8268512599339,
                -20.63655337631922
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                117.01018561051984,
                -20.658399758838534
              ],
              [
                117.04520453141828,
                -20.672533980244577
              ],
              [
                117.11936224626203,
                -20.67510369736875
              ],
              [
                117.18596686051984,
                -20.671249105374347
              ],
              [
                117.22991217301984,
                -20.62434373701229
              ],
              [
                117.18802679704328,
                -20.581280880823847
              ],
              [
                117.10013617204328,
                -20.598636032702178
              ],
              [
                117.00743902848859,
                -20.635268197260427
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                118.89429688446074,
                -19.881273488477813
              ],
              [
                118.89601349823027,
                -19.88450206044527
              ],
              [
                118.89944672576934,
                -19.887730566612905
              ],
              [
                118.90356659881621,
                -19.890636165897533
              ],
              [
                118.90356659881621,
                -19.893864547020925
              ],
              [
                118.90013337127715,
                -19.895801544099214
              ],
              [
                118.89464020721465,
                -19.892896039595193
              ],
              [
                118.89258027069121,
                -19.898706995280094
              ],
              [
                118.90082001678496,
                -19.902258029855364
              ],
              [
                118.90665650360137,
                -19.898706995280094
              ],
              [
                118.91077637664824,
                -19.894510215346816
              ],
              [
                118.9138662814334,
                -19.88547061920495
              ],
              [
                118.908029794617,
                -19.879336313717133
              ],
              [
                118.9028799533084,
                -19.87707624656403
              ],
              [
                118.89464020721465,
                -19.876753377196618
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                122.19506900789446,
                -17.956663884634608
              ],
              [
                122.19112079622454,
                -17.960011497740062
              ],
              [
                122.17824619295305,
                -17.967522984195675
              ],
              [
                122.17240970613665,
                -17.97511579268094
              ],
              [
                122.18579929353899,
                -17.99528005374251
              ],
              [
                122.19687145235247,
                -18.003932835614563
              ],
              [
                122.20897357942766,
                -18.011115954558992
              ],
              [
                122.21824329378313,
                -18.005973524173484
              ],
              [
                122.22390811922259,
                -17.99021879588213
              ],
              [
                122.21695583345598,
                -17.980912233191418
              ],
              [
                122.20313709261126,
                -17.995769845183897
              ],
              [
                122.18974750520891,
                -17.977156814565387
              ],
              [
                122.19292324068255,
                -17.971360250781608
              ],
              [
                122.2015063095302,
                -17.962542577754657
              ],
              [
                122.20056217195696,
                -17.957643680398043
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                121.75220583886971,
                -18.41705746096502
              ],
              [
                121.65058230371346,
                -18.595469282414005
              ],
              [
                121.67255495996346,
                -18.622800613875654
              ],
              [
                121.53934573144784,
                -18.67354714254273
              ],
              [
                121.57917117090096,
                -18.845191737089568
              ],
              [
                121.50776003808846,
                -18.972511519728048
              ],
              [
                121.57505129785409,
                -19.010169170902625
              ],
              [
                121.68491457910409,
                -18.810096834223334
              ],
              [
                121.66568850488534,
                -18.743786489553074
              ],
              [
                121.80576418847909,
                -18.706068983623155
              ],
              [
                121.80851077051034,
                -18.624101996324676
              ],
              [
                121.79615115136971,
                -18.55771880378165
              ],
              [
                121.84146975488534,
                -18.5082400194465
              ],
              [
                121.84009646386971,
                -18.436600657556234
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                114.13442414442454,
                -22.257368638498885
              ],
              [
                114.12824433485423,
                -22.264994248227524
              ],
              [
                114.11863129774486,
                -22.285327175879377
              ],
              [
                114.10283845106517,
                -22.346943288513938
              ],
              [
                114.16051667372142,
                -22.38440781685008
              ],
              [
                114.20446198622142,
                -22.37297902934772
              ],
              [
                114.21064179579173,
                -22.33995726194854
              ],
              [
                114.19690888563548,
                -22.309468686947834
              ],
              [
                114.18454926649486,
                -22.289774609736465
              ],
              [
                114.14678376356517,
                -22.286597885705493
              ],
              [
                114.14472382704173,
                -22.275796484066102
              ],
              [
                114.14472382704173,
                -22.260546026373067
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    sg_corals = 
    /* color: #98ff00 */
    /* shown: false */
    ee.Geometry.MultiPolygon(
        [[[[114.33842671911611, -21.660236919708524],
           [114.32709706823721, -21.671723355808812],
           [114.31096089880361, -21.677944793348285],
           [114.29808629553213, -21.702189884079363],
           [114.2934514383544, -21.717340992870408],
           [114.302206168579, -21.714948818592152],
           [114.30495275061025, -21.703465828429394],
           [114.31267751257315, -21.691822417058404],
           [114.32314885656729, -21.681294686959003],
           [114.3373967508544, -21.671085244470667],
           [114.34220326940908, -21.66326815141548]]],
         [[[114.36348928015127, -21.63343167936847],
           [114.35267461340322, -21.6439629030413],
           [114.35765279333486, -21.648430462881187],
           [114.37121404211416, -21.635027368676955],
           [114.368124137329, -21.629921100850435]]],
         [[[114.35716079489328, -21.67077212678261],
           [114.35750411764718, -21.67276621966802],
           [114.36222480551339, -21.676036472294893],
           [114.36926292196847, -21.67252692997793],
           [114.35844825522042, -21.66957565781401]]],
         [[[114.3790476204548, -21.6242620647907],
           [114.38145087973214, -21.628490871288314],
           [114.39389632956124, -21.62330458198913],
           [114.39269469992257, -21.630565334892914],
           [114.37999175802804, -21.641256328806286],
           [114.37192367331124, -21.654738617967354],
           [114.38479827658273, -21.646681306606194],
           [114.39655708090402, -21.632320626987887],
           [114.40162109152413, -21.622187510704183],
           [114.3969862343464, -21.6170807891857]]],
         [[[114.76046282422266, -21.512944880099145],
           [114.73994928967676, -21.521169328330494],
           [114.73823267590723, -21.55877227931714],
           [114.75097831108177, -21.5716239927305],
           [114.75891787183008, -21.56499857915528],
           [114.77299416901089, -21.567832816242973],
           [114.78638369214258, -21.563641587874507],
           [114.7793455756875, -21.529872363649012],
           [114.7741957343789, -21.513184433715583],
           [114.77204996716698, -21.507674600661463]]],
         [[[114.94727458951388, -21.403767928866113],
           [114.9095090865842, -21.470558331195047],
           [115.02143230435763, -21.498352016232896],
           [115.0743040084592, -21.45649973497534],
           [114.97233715054904, -21.39020955887869]]]]),
    coral_sg = 
    /* color: #0b4a8b */
    /* shown: false */
    ee.Geometry.MultiPolygon(
        [[[[115.3523840713118, -20.74460275289392],
           [115.34491680141434, -20.746850188763194],
           [115.34311435695633, -20.75150548540378],
           [115.34191272731766, -20.753030465210678],
           [115.34423015590653, -20.757284274959847],
           [115.34706256862626, -20.753592295999454],
           [115.34860752101883, -20.755277775839836],
           [115.35066745754227, -20.756561938344543],
           [115.35427234645829, -20.75824738507793],
           [115.35907886501298, -20.754394907790612],
           [115.36113880153641, -20.751987059635873],
           [115.3648295211409, -20.751585747882295],
           [115.36800525661454, -20.748937063598397],
           [115.36723278041825, -20.747813365342054],
           [115.36731861110673, -20.74564620941448],
           [115.36431453701005, -20.74291715407939],
           [115.36122463222489, -20.743157955059907],
           [115.35839221950516, -20.7437198225239],
           [115.35555980678544, -20.744361954213158]]],
         [[[113.97628650968738, -21.895470429601453],
           [113.97362575834461, -21.896903930785772],
           [113.97285328214832, -21.89881524327425],
           [113.97173748319813, -21.901602528045164],
           [113.97070751493641, -21.90295633240838],
           [113.97156582182117, -21.908530685448593],
           [113.97379741972156, -21.910601103888105],
           [113.97740230863758, -21.90940663538371],
           [113.98040638273426, -21.90542500137287],
           [113.98092136686512, -21.89889488073843],
           [113.98186550443836, -21.896505737458302],
           [113.97963390653797, -21.895072232269833],
           [113.97783146207996, -21.894275834269994]]]]),
    rb_sand = 
    /* color: #ffc82d */
    /* shown: false */
    ee.Geometry.MultiPolygon(
        [[[[116.85843695329328, -20.585780554268112],
           [116.82204474137922, -20.56585242173855],
           [116.7774127833714, -20.664824567963826],
           [116.81449164079328, -20.72841550684944],
           [116.93877447770734, -20.740616776918277],
           [117.03902472184797, -20.683454977632035],
           [117.14682806657453, -20.66418209927732],
           [117.16399420426984, -20.621773161828088],
           [117.16948736833234, -20.621773161828088],
           [117.16880072282453, -20.665467033933187],
           [117.1839069239964, -20.668679323020342],
           [117.2333454005589, -20.59799328452089],
           [117.14408148454328, -20.5549229866295],
           [116.89894903825422, -20.638481124551525],
           [116.83577765153547, -20.673818844242906],
           [116.8488239161839, -20.615346534002175]]],
         [[[122.17841785433001, -17.97985092732931],
           [122.18442600252337, -17.98638193914143],
           [122.18966167452044, -17.999035086700573],
           [122.1997038650722, -18.005973524173484],
           [122.20588367464251, -18.011524077527795],
           [122.21206348421282, -18.010871080324],
           [122.21781414034075, -18.004259347371438],
           [122.22613971712298, -17.98736157006991],
           [122.21747081758684, -17.989157545981232],
           [122.21206348421282, -17.997973889838644],
           [122.20837276460833, -18.007116299447603],
           [122.20142047884173, -18.000667684787892],
           [122.19481151582903, -17.988994276199183],
           [122.18803089143938, -17.981075510450076],
           [122.1817652511806, -17.978299776516096]]]]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/

///////////////////////////////
// Global coral atlas project - WEA 
// Contact: mitchell.lyons@gmail.com
// Region coordinator: Rodney Borrego (rodbio2008@gmail.com)
// Description:
// - Developing a process to combine OBIA and supervised classification
// - This script loads the raw classification data (from *_classification script)
// - Then applied some cleanup and object-based relational rules
///////////////////////////////

// Table of contents
// 1. Setting constants
// 2. Data loads & vis
// 3. OBIA clean up rules
// 4. Export

// Load and libraries needed
var map_palettes = require('users/mitchest/global_reefs_modules:colour_pals');
var pkg_vis = require('users/mitchest/global_reefs_modules:pkg_vis');
var param_module = require('users/mitchest/global_reefs_modules:reef_params');

// ###########################################
// SENSOR GENERICS
var sensor_params = param_module.dove;         //<------------ THIS IS WHERE YOU CHOOSE THE SENSOR
// REGION AND SENSOR SPECIFIC LOAD PATHS
var region_params = param_module.west_australia;  //<------------ THIS IS WHERE YOU CHOOSE THE REGION
//  ^^ all the data paths are in this module ^^
// ###########################################

// 1. Setting constants

// These will get written to the asset metadata 

//Map.centerObject(geometry, 7)

var vars = {
  
  // analysis type
  geomorphic: false, // map geomorphic zonation (when set to true) or benthic habitat (when set to false)

  // analysis parameters
  image_data_scale: sensor_params.pixel,
  small_object_geo: ee.Number(400).int(), // smallest object szie in pixels (geomorphic)
  small_object_benthic: ee.Number(130).int(), // smallest object szie in pixels (benthic)
  smooth_radius: ee.Number(3), // radius in pixels for initial smooth 
  dist_to_land_ORF: 1000, //distance to land in meters to convert terrestrial reef flat to ORF
  dist_to_land_RC: 500, //distance to land in meters to convert reef crest to TRF - not used for Indo
  wave_height: 0.4, //cut off height for waves in metres, Hs95 threshold
  geo_depth_cutoff: 1200, //depth in centimetres
  shallowlag_depth_cutoff: 500, //depth in centimetres
  benthic_depth_cutoff: 750, //depth in centimetres
  
  //############
  // Clean-up stage selection
  cleanup_stage: 2, // set to 1, 2 or 3
  geo_refinement: false, // set to true to apply the refinement_mask (the other stage 3 masks will still run)
  
  /*
  - GEOMORPHIC 1: The first pass does a small object filter, just to generally clean noise and reduce the amount of cleaning needed
  -            2: The second pass runs the OBIA cleanup rules
  -            3: The third pass is the MANUAL cleanup stage, which includes AT LEAST the no_reef masking
                        - see below where it starts/ends (only that section is run)
                        - please put region specific stuff in here ONLY

  - BENTHIC 1: This is the main benthic stge - it does noise removal, no data reclaim and OBIA rules - review those if needed
            2: The second mas is the MANUAL stage - it's optional, but shuold include ALL region specific stuff
                        - see below where it starts/ends (only that section is run)
                        - please put region specific stuff in here ONLY
  */
  
  // DON'T TOUCH --->
  obia_2nd_pass: null,
  obia_clean: null, // run object-based relationship rules + small object clean up
  fast_clean: null, // run a faster (but less precise) version of the OBIA clean; only applies to geomorphic (`obia_clean: true` also)
  manual_clean: false, // apply manual touch ups
  // --------------<
  //############
  
  reproject_display: false,
  
  // export options
  do_export: false, // export the results?
  geomorph_output_name: region_params.sname + '_geo_clean', // DO NOT CHANGE - change in the pop up dialouge if you must
  benthic_output_name: region_params.sname + '_benthic_clean', // DO NOT CHANGE - change in the pop up dialouge if you must
  asset_output: region_params.asset // asset path

};


// Clean up stage auto-parameterisation (DON'T TOUCH) --->

if (vars.geomorphic) {
  var temp_outname = vars.geomorph_output_name;
  if (vars.cleanup_stage == 1) {
    vars.obia_2nd_pass = false;
    vars.obia_clean = false;
    vars.fast_clean = true;
    vars.manual_clean = false;
    vars.geomorph_output_name = temp_outname + '1';
  } else if (vars.cleanup_stage == 2) {
    vars.obia_2nd_pass = true;
    vars.obia_clean = true;
    vars.fast_clean = true;
    vars.manual_clean = false;
    vars.geomorph_output_name = temp_outname + '2';
  } else if (vars.cleanup_stage == 3) {
    vars.manual_clean = true;
    vars.obia_2nd_pass = false;
    vars.obia_clean = false;
    vars.fast_clean = false;
    vars.do_export = false;
    vars.geomorph_output_name = temp_outname + '3';
  }
}

if (!vars.geomorphic) {
  var temp_outname = vars.benthic_output_name;
  if (vars.cleanup_stage == 1) {
    vars.obia_2nd_pass = true,
    vars.obia_clean = true, 
    vars.fast_clean = false, 
    vars.manual_clean = false;
    vars.benthic_output_name = temp_outname + '1';
  } else if (vars.cleanup_stage == 2) {
    vars.manual_clean = true;
    vars.obia_2nd_pass = false,
    vars.obia_clean = false, 
    vars.fast_clean = false,
    vars.do_export = false;
    vars.benthic_output_name = temp_outname + '2';
  }
}

//Region extent is created in map viewer and exported to GEE asset
var region_extent = ee.FeatureCollection(region_params.extent_mask).geometry();
Map.addLayer(region_extent, {}, "Manual reef outline", false);
// -----------------------------------------<

//################################################################################################
//START OF CLEAN 3 - Manual Cleanup
//Review everything in this section
//This is the section to add/remove manual cleanups
//You MUST review it for each region

//###############################################################################################

if (vars.manual_clean && vars.geomorphic) {
  
  print("Doing GEOMORPHIC manual clean ups - make sure this is what you want to do");
  print("Export the manual map, check 'manual' layer in the viewer for effects");
  
  var depth = ee.Image(region_params.pixels).select('depth');
  
  // define the manually edited map - uses the output from the second pass of cleaning
  //var man_geo = ee.Image(region_params.geo_map_clean2);
  var man_geo = ee.Image(region_params.geo_map_clean2); // use this when testing for a small area
  
  // import the mid mask from asset ****only use ee.FC if mid_mask created in map viewer****
  //var mid_mask = ee.FeatureCollection(region_params.mid_mask).geometry();
  //Map.addLayer(mid_mask, {color: 'red'}, "mid mask import", true, 0.4);
  //var midmask = ee.Image().byte().paint(ee.Feature(mid_mask.dissolve(),{zone: 1}), "zone").clip(mid_mask.dissolve());
  
  // the "MID MASK" CLEAN
 // man_geo = man_geo.where({
  //  test: midmask.eq(1),
  //  value: ee.Image(0)
  //});
  
  /*
  // the "REEF MASK" CLEAN
  
  // Define a kernel for reef mask Morphological Operations
  var kernel_rm = ee.Kernel.circle({radius: vars.smooth_radius.multiply(5)});

  // Create reef mask to clean areas inside the reef - Perform an dilation of deepwater
  var reef_mask = man_geo.eq(2)
            .focal_max({kernel: kernel_rm, iterations: 2});
  var global_reef_mask = ee.Image(region_params.global_reef_mask);
  

  // Reef crest, slope, sheltered slope (within reef mask) -> Inner reef flat
  man_geo = man_geo.where({
    test: reef_mask.eq(0)
                    .and(man_geo.eq(15).or(man_geo.eq(21)).or(man_geo.eq(22))),
    value: ee.Image(13)
  });
  
  // the "DEEP WATER" CLEAN
  
  // Define a kernel for deep water Morphological Operations
  var kernel_dw = ee.Kernel.circle({radius: vars.smooth_radius.multiply(5)});

  // Create mask to clean deepwater areas - Perform an dilation of deepwater followed by a erosion
  var deepwater = man_geo.eq(2)
            .focal_max({kernel: kernel_dw, iterations: 2})
            .focal_min({kernel: kernel_dw, iterations: 2});
    
  
    // Deep lagoon (outside reef mask and global mask) -> deepwater 
  man_geo = man_geo.where({
    test: deepwater.eq(1)
                    .and(man_geo.eq(12)),
                    //.and(global_reef_mask.eq(2)),
    value: ee.Image(2)
  });
  
 
  // Reef classes in deepwater -> deepwater
  man_geo = man_geo.where({
    test: deepwater.eq(1)
                    .and(man_geo.eq(15).or(man_geo.eq(21)).or(man_geo.eq(22)).or(man_geo.eq(24))),
    value: ee.Image(2)
  });
  
  */
  
/*
  // WAVE clean (un-comment this sectio nbased on whether you have waves or not)
  
  var waves = ee.Image(region_params.waves)
  Map.addLayer(waves.lt(vars.wave_height), {}, vars.wave_height + "m Hs95 threshold", false)
  
  man_geo = man_geo.where({
    test: waves.lte(vars.wave_height)
               .and(man_geo.eq(22)),
    value: ee.Image(21)
  })
 
*/ 
  
  
/*
  ##############
  
  The rest of the manual geometry paintings and rules should go here
      - make the geom, paint the layer, use it in a rule
      - consult previous regions *_cleanup script for ideas/hints/existing rules etc.
  e.g. 
  var notreefcrest = ee.Image().byte().paint(ee.Feature(not_reef_crest, {zone: 1}), "zone").clip(not_reef_crest);
  var notdeepwater = ee.Image().byte().paint(ee.Feature(not_deep_water, {zone: 1}), "zone").clip(not_deep_water);
  
*/
/*
var mid_Mask = ee.Image().byte().paint(ee.Feature(midMask, {zone: 1}), "zone").clip(midMask);

man_geo = man_geo.where({
  test: mid_Mask.eq(1),
  value: ee.Image (0),
})

*/

/*
var Brs_Sl = ee.Image().byte().paint(ee.Feature(brs_sl, {zone: 1}), "zone").clip(brs_sl);

var Dl_SRS_Pr_toRs = ee.Image().byte().paint(ee.Feature(Dl_SRS_Pr_to_rs, {zone: 1}), "zone").clip(Dl_SRS_Pr_to_rs);
var Rs_Sl = ee.Image().byte().paint(ee.Feature(rs_sl, {zone:1}), "zone").clip(rs_sl)
*/
var Sl_Brs = ee.Image().byte().paint(ee.Feature(sl_brs, {zone: 1}), "zone").clip(sl_brs);
var Rs_Brs = ee.Image().byte().paint(ee.Feature(rs_brs, {zone: 1}), "zone").clip(rs_brs);
var Rs_Dl_Sl_SRS_toBrs= ee.Image().byte().paint(ee.Feature(rs_dl_sl_srs_tobrs, {zone:1}), "zone").clip(rs_dl_sl_srs_tobrs);
var SRS_toBrs = ee.Image().byte().paint(ee.Feature(srs_brs, {zone: 1}), "zone").clip(srs_brs);
var Rs_mask = ee.Image().byte().paint(ee.Feature(rs_mask, {zone: 1}), "zone").clip(rs_mask);
var Sl_mask = ee.Image().byte().paint(ee.Feature(sl_mask, {zone: 1}), "zone").clip(sl_mask);
var Srs_rs = ee.Image().byte().paint(ee.Feature(srs_rs, {zone:1}), "zone").clip(srs_rs)
var Srs_tomask = ee.Image().byte().paint(ee.Feature(srs_tomask, {zone:1}), "zone").clip(srs_tomask)
var Dl_SRS_Pr_toRs = ee.Image().byte().paint(ee.Feature(Dl_SRS_Pr_to_rs, {zone: 1}), "zone").clip(Dl_SRS_Pr_to_rs);

var Orf_irf_rs_brs_totrf= ee.Image().byte().paint(ee.Feature(orf_irf_rs_brs_totrf, {zone:1}), "zone").clip(orf_irf_rs_brs_totrf);
/*

var Brs_rs = ee.Image().byte().paint(ee.Feature(brs_rs, {zone: 1}), "zone").clip(brs_rs)
var BrsDl_srs = ee.Image().byte().paint(ee.Feature(brsdl_srs, {zone: 1}), "zone").clip(brsdl_srs)
var Sl_srs = ee.Image().byte().paint(ee.Feature(sl_srs, {zone:1}),"zone").clip(sl_srs) 
var Sl_rs = ee.Image().byte().paint(ee.Feature(sl_rs, {zone:1}),"zone").clip(sl_rs)  
*/

var Brs_mask = ee.Image().byte().paint(ee.Feature(brsdl_mask, {zone:1}),"zone").clip(brsdl_mask)  
 
 //var Srs_Brs = ee.Image().byte().paint(ee.Feature(srs_brs, {zone: 1}), "zone").clip(srs_brs)
 //var All_Brs = ee.Image().byte().paint(ee.Feature(all_brs, {zone:1}), "zone").clip(all_brs)
 // var Srs_Orf = ee.Image().byte().paint(ee.Feature(srs_orf, {zone: 1}), "zone").clip(srs_orf)  
  
  // Back reef slope -> shallow lagoon (inside the reef)

/*
  man_geo = man_geo.where({
   test: Brs_Sl.eq(1)
                   .and(man_geo.eq(24)).or(man_geo.eq(12)),
    value: ee.Image(11)
  });
  



  

  // deep laggon, sheltered r s and patch reefs into reef slope
  
  man_geo = man_geo.where({
    test: Dl_SRS_Pr_toRs.eq(1)
                            .and(man_geo.eq(12)).or(man_geo.eq(25)).or(man_geo.eq(21)),
    value: ee.Image(22)
  });
  
  //reef slope to shallow lagoon
  
  man_geo = man_geo.where({
   test: Rs_Sl.eq(1)
                   .and(man_geo.eq(22)),
  value: ee.Image(11)
  })
  
  */
   // Shallow lagoon and deep lagoon > back reef slope (inside the reef)
  man_geo = man_geo.where({
    test:  Sl_Brs.eq(1)
                     .and(man_geo.eq(11).or(man_geo.eq(12))),
    value: ee.Image(24)
  });
  
  // reef slope > back reef slope (outside the reef)
  man_geo = man_geo.where({
    test: Rs_Brs.eq(1)
                     .and(man_geo.eq(22)),
    value: ee.Image(24)
  });
  
   // deep laggon, sheltered r s and patch reefs into reef slope
  
  
  man_geo = man_geo.where({
    test: Dl_SRS_Pr_toRs.eq(1)
                            .and(man_geo.eq(12)).or(man_geo.eq(25)).or(man_geo.eq(21)),
    value: ee.Image(22)
  });
  
  

  man_geo = man_geo.where({
    test: Rs_Dl_Sl_SRS_toBrs.eq(1)
                      .and(man_geo.eq(22)).or(man_geo.eq(12)).or(man_geo.eq(11)).or(man_geo.eq(21)),
    value: ee.Image(24)
  })
  
   //sheltered reef slope > back reef slope (inside the reef)
  man_geo = man_geo.where({
    test:  SRS_toBrs.eq(1)
                     .and(man_geo.eq(21)),
    value: ee.Image(24)
  });
  
  //mask out rs
  man_geo = man_geo.where({
  test: Rs_mask.eq(1)
        .and(man_geo.eq(22)),
  value: ee.Image (0),
})

//mask out shallow lagoon
  man_geo = man_geo.where({
  test: Sl_mask.eq(1)
        .and(man_geo.eq(11)),
  value: ee.Image (0),
})


//srs to rs
  man_geo = man_geo.where({
  test: Srs_rs.eq(1)
        .and(man_geo.eq(21)),
  value: ee.Image (22),
})


//srs to mask
  man_geo = man_geo.where({
  test: Srs_tomask.eq(1)
        .and(man_geo.eq(21)),
  value: ee.Image (0),
})

  man_geo = man_geo.where({
    test: Orf_irf_rs_brs_totrf.eq(1)
                      .and(man_geo.eq(14)).or(man_geo.eq(13)).or(man_geo.eq(22)).or(man_geo.eq(24)),
    value: ee.Image(16)
  })
  
  
  /*
  
  man_geo = man_geo.where({
    test: Brs_rs.eq(1)
          .and(man_geo.eq(24)),
    value: ee.Image(22)
  })
  
  
  man_geo = man_geo.where({
    test: BrsDl_srs.eq(1)
          .and(man_geo.eq(24)).or(man_geo.eq(12)),
    value: ee.Image(21)
  })
  
  
   man_geo = man_geo.where({
    test: Sl_srs.eq(1)
          .and(man_geo.eq(11)),
    value: ee.Image(21)
  })
  
  man_geo = man_geo.where({
    test: Sl_rs.eq(1)
          .and(man_geo.eq(11)),
    value: ee.Image(22)
  })
  
 */ 
  man_geo = man_geo.where({
    test: Brs_mask.eq(1)
         .and(man_geo.eq(24)).or(man_geo.eq(12)),
    value: ee.Image(0)
  }) 
  
  
  var refine = ee.Image().byte().paint(ee.Feature(refinement_mask, {zone: 1}), "zone").clip(refinement_mask);
    // apply
    man_geo = man_geo.where({
      test: refine.eq(1),
      value: ee.Image(0)
    });

/*
 //Back reef slope > reef slope (outside the reef)
  man_geo = man_geo.where({rock
    test:  Brs_Rs.eq(1)
                     .and(man_geo.eq(24)),
    value: ee.Image(22)
  });
  
  //reef crest > Back reef slope (outside the reef)
 // man_geo = man_geo.where({
   // test:  Rc_Brs.eq(1)
   //                  .and(man_geo.eq(15)),
  //  value: ee.Image(24)
  //});
   
  //sheltered reef slope > Back reef slope (outside the reef)
  man_geo = man_geo.where({
    test:  Srs_Brs.eq(1)
                     .and(man_geo.eq(21)),
    value: ee.Image(24)
  });
    
  //sheltered reef slope > outer reef falt (inside the reef)
 // man_geo = man_geo.where({
   // test:  Srs_Orf.eq(1)
     //                .and(man_geo.eq(21)),
   // value: ee.Image(14)
  //}); 
  
  man_geo = man_geo.where({
    test: All_Brs.eq(1)
            .and(man_geo.eq(11)).or(man_geo.eq(12))
            .or(man_geo.eq(13)).or(man_geo.eq(15))
            .or(man_geo.eq(16)).or(man_geo.eq(21)).or(man_geo.eq(22))
            .or(man_geo.eq(23)),
    
    value: ee.Image(24)
  });
*/
  
  if (vars.geo_refinement) {
    // make the mask image layer
    var refine = ee.Image().byte().paint(ee.Feature(refinement_mask, {zone: 1}), "zone").clip(refinement_mask);
    // apply
    man_geo = man_geo.where({
      test: refine.eq(1),
      value: ee.Image(0)
    });
  }
  
  // Add data + the manual layer to the map
  var lowtide_image = ee.ImageCollection(region_params.pixels);
  Map.addLayer(lowtide_image, {}, sensor_params.sname + ' low tide', false);
  var notreef_mask = ee.FeatureCollection(region_params.notreef_mask).geometry();
  Map.addLayer(notreef_mask, {}, "noReefmask", false);
  var geo_clean1 = ee.Image(region_params.geo_map_clean1);
  Map.addLayer(geo_clean1, map_palettes.geo, 'Geo clean stage 1', false);
  var geo_clean2 = ee.Image(region_params.geo_map_clean2);
  Map.addLayer(geo_clean2.updateMask(geo_clean2.gt(2)), map_palettes.geo, 'Geo clean stage 2', false);
  Map.addLayer(man_geo.updateMask(man_geo.gt(2)), map_palettes.geo, 'Geo clean stage 3', false);
  var unepClipped= wcmc.filterBounds(region_extent)
  Map.addLayer(unepClipped, {color:'#FFFF33'}, 'UNEP_layer', false)
  
 // Map.addLayer(waves, {}, 'waves', false);
 // Map.addLayer(wavespng, {}, 'wavespng', false);
  
  //Map.addLayer(man_geo.updateMask(man_geo.gt(2)), map_palettes.geo, 'Geo clean stage 3 - no DW', false);
 // Map.addLayer(global_reef_mask.updateMask(global_reef_mask.eq(1)), {palette: ['F8FF23'], opacity: 0.4}, 'global_reef_mask - land', false);
  //Map.addLayer(global_reef_mask.updateMask(global_reef_mask.eq(3)), {palette: ['0000ff'], opacity: 0.4}, 'global_reef_mask - reef', false);
  //Map.addLayer(global_reef_mask.updateMask(global_reef_mask.eq(2)), {palette: ['FF0000'], opacity: 0.4}, 'global_reef_mask - water', false);

  // display distance to land mask for assessing cut-off distances
  var distToLand = ee.Image(region_params.distToLand);
    
  //Map.addLayer(distToLand.lte(vars.dist_to_land_RC), {}, 'RC to TRF ' + vars.dist_to_land_RC + 'm', false);
 // Map.addLayer(distToLand.unmask(100000, false).lte(vars.dist_to_land_ORF), {}, 'TRF to ORF ' + vars.dist_to_land_ORF + 'm', false);
  
  // display distance to water mask
  var distToWater = ee.Image(region_params.distToWater);
    
  //Map.addLayer(distToWater.unmask(100000, false).lte(vars.dist_to_land_ORF), {}, 'distToWater ' + vars.dist_to_land_ORF + 'm', false);
  
  
  // Export
  var output_name = (vars.geomorphic) ? vars.geomorph_output_name : vars.benthic_output_name;
  Export.image.toAsset({
    image: man_geo,
    description: output_name,
    assetId: vars.asset_output + 'in_out/' + output_name,
    region: region_extent,
    scale: vars.image_data_scale,
    crs: 'EPSG:4326',
    maxPixels: 1e13,
    pyramidingPolicy: {'.default': 'mode'}
  });
  
} 

if (vars.manual_clean && !vars.geomorphic) {
  
  print("Doing BENTHIC manual clean ups - make sure this is what you want to do");
  print("Export the manual map, check 'manual' layer in the viewer for effects");
  
  var depth = ee.Image(region_params.pixels).select('depth');
  
  // define the final geomorphic map (the manually edited geo map - stage 3)
  var geo_map = ee.Image(region_params.geo_map_clean3);
  
  // define the clean benthic map to apply 2nd stage rules to
  var man_benthic = ee.Image(region_params.benthic_map_clean1);
  
  
  /*
  **Generic benthic rules**
    - should be generally applicable, but still review
  */
  
  // BMA on inner RF, outer RF,reef crest, reef slope -> rubble 
  man_benthic = man_benthic.where({
    test: man_benthic.eq(18)
                     .and(geo_map.eq(13).or(geo_map.eq(14)).or(geo_map.eq(15)).or(geo_map.eq(22))),
    value: ee.Image(12)
  });
  
  // Rubble on Outer reef flat and Reef crest -> rock 
  man_benthic = man_benthic.where({
    test: man_benthic.eq(12)
                     .and(geo_map.eq(14).or(geo_map.eq(15))),
    value: ee.Image(13)
  });
    
  // Seagrass on Back reef slope -> Sand 
  man_benthic = man_benthic.where({
    test: man_benthic.eq(14)
                     .and(geo_map.eq(24)),
    value: ee.Image(11)
  });  
  
    
  /*
  
  **Manual polygon guided rules**
   - same as per geomorphic clean section
   - add a geometry, paint the layer, create a rule
   
   */
  //manually turning sand in reef crest to 
  var Sand_rock = ee.Image().byte().paint(ee.Feature(sand_rock, {zone: 1}), "zone").clip(sand_rock);
  var Rock_sand = ee.Image().byte().paint(ee.Feature(rock_sand, {zone: 1}), "zone").clip(rock_sand);
  var SG_corals = ee.Image().byte().paint(ee.Feature(sg_corals, {zone: 1}), "zone").clip(sg_corals);
  var Coral_sg = ee.Image().byte().paint(ee.Feature(coral_sg, {zone: 1}), "zone").clip(coral_sg);
  var Rb_sand = ee.Image().byte().paint(ee.Feature(rb_sand, {zone: 1}), "zone").clip(rb_sand);
  
  man_benthic = man_benthic.where({
    test: Sand_rock.eq(1)
                   .and(man_benthic.eq(11)),
    value: ee.Image(13)
  });
  
  // make rock out of reef crest
  man_benthic = man_benthic.where({
       test:  man_benthic.eq(11)
              .and(geo_map.eq(15)),
       value: ee.Image(13)
  })
  

  // make general mask to clean
  var benthic_Mask = ee.Image().byte().paint(ee.Feature(benthic_mask.dissolve(), {zone: 1}), "zone").clip(benthic_mask);

  man_benthic = man_benthic.where({
  test: benthic_Mask.eq(1),
  value: ee.Image (0),
})   
  
  
  man_benthic= man_benthic.where({
    test: Rock_sand.eq(1)
                  .and(man_benthic.eq(13)),
    value: ee.Image(11)
  })
  
  
  man_benthic = man_benthic.where({
       test: SG_corals.eq(1)
             .and(man_benthic.eq(14)),
       value: ee.Image(15)
  })
     
     
  man_benthic = man_benthic.where({
     test: Coral_sg.eq(1)
            .and(man_benthic.eq(15)),
      value: ee.Image(14)
  })
   man_benthic = man_benthic.where({
     test: Rb_sand.eq(1)
            .and(man_benthic.eq(12)),
      value: ee.Image(11)
  })
  
  
  // code added by Mitch to regain missing data and to cleAN A ;LITTLE BIT benthic 2
  
  var ben_mask = man_benthic.gt(0),
  
  
  man_benthic2 = man_benthic.focal_mode(1, 'plus')
                    .updateMask(ben_mask)
                    .selfMask()                  
                    
                    
  var man_benthic10 = man_benthic.focal_mode(4, 'diamond')
                    .updateMask(ben_mask)
                    .selfMask()                  
  
     
  // Add the manual layer to the map

  var dove_image = ee.Image(region_params.pixels);
  Map.addLayer(dove_image, {bands: ['b3','b2','b1'], min:0, max:4000, gamma:1.5}, sensor_params.sname + ' low tide', true);
  
  var benthic_clean1 = ee.Image(region_params.benthic_map_clean1);
  var geo_clean1 = ee.Image(region_params.geo_map_clean1);
  var geo_clean2 = ee.Image(region_params.geo_map_clean2);
  Map.addLayer(geo_clean1, map_palettes.geo, 'Geo clean stage 1', false);
   Map.addLayer(geo_clean2.updateMask(geo_clean2.gt(2)), map_palettes.geo, 'Geo clean stage 2', false);
  // Map.addLayer(geo_clean2, map_palettes.geo, 'Geo clean stage 2', false);
  //Map.addLayer(geo_map.updateMask(geo_map.gt(2)), map_palettes.geo, 'Geo clean stage 3 - MANUAL', true);
  Map.addLayer(geo_map.updateMask(geo_map.gt(2)), map_palettes.geo, 'Geo clean stage 3 - MANUAL', false);
  Map.addLayer(benthic_clean1.updateMask(geo_map.gt(0)), map_palettes.benthic, 'Benthic clean stage 1', false);
  Map.addLayer(man_benthic.updateMask(man_benthic.gt(0)), map_palettes.benthic, 'Benthic clean stage 2 - MANUAL', true);
  Map.addLayer(man_benthic2.updateMask(man_benthic.gt(0)), map_palettes.benthic, 'Benthic clean stage 2 - MANUAL2_radius', true);
  Map.addLayer(man_benthic10.updateMask(man_benthic.gt(0)), map_palettes.benthic, 'Benthic clean stage 2 - MANUAL10_radius', true);
  // Export
  var output_name = (vars.geomorphic) ? vars.geomorph_output_name : vars.benthic_output_name;
  Export.image.toAsset({
    image: man_benthic,
    description: output_name,
    assetId: vars.asset_output + 'in_out/' + output_name,
    region: region_extent,
    scale: vars.image_data_scale,
    crs: 'EPSG:4326',
    maxPixels: 1e13,
    pyramidingPolicy: {'.default': 'mode'}
  });
  
}

// #################################################################################################
// END OF MANUAL SECTION
// #################################################################################################


// 2. Data loads & vis

if (!vars.manual_clean) {

  // load input data
  
  // define raw geo/benthic outputs
  // Run check to see if the region has been split into multiple areas
  
  // geo
  if (ee.List(region_params.geo_map).length().getInfo() > 1) {
    var geo_map_raw = ee.Image(region_params.geo_map[0]).unmask(0, false)
                 .add(ee.Image(region_params.geo_map[1]).unmask(0,false))
                 .selfMask();
  } else {
    var geo_map_raw = ee.Image(region_params.geo_map);
  }
  
  // benthic
  if (ee.List(region_params.benthic_map).length().getInfo() > 1) {
      var benthic_map = ee.Image(region_params.benthic_map[0]).unmask(0, false)
               .add(ee.Image(region_params.benthic_map[1]).unmask(0,false))
               .selfMask();
  } else {
      var benthic_map = ee.Image(region_params.benthic_map);
  }
  
  // set the geo map for further processing
  if (vars.geomorphic && vars.obia_2nd_pass) {
    // if it's 2nd pass, you want to make sure you're loading the latest geo clean map
    var geo_map = ee.Image(region_params.geo_map_clean1);
  } else if (vars.geomorphic) {
    var geo_map = geo_map_raw;
  }
  
  var depth = ee.Image(region_params.pixels).select('depth');
  var low_tide_image = ee.Image(region_params.image);
  
  var display_pal = (vars.geomorphic) ? map_palettes.geo : map_palettes.benthic;
  Map.addLayer(depth, {min:0, max:2500}, 'Depth data', false);
  Map.addLayer(low_tide_image, {bands: ['b3','b2','b1'], min:0, max:3000}, sensor_params.sname + ' low tide', false);
  
  // load for display purposes
  if (vars.geomorphic) {
    Map.addLayer(geo_map_raw, display_pal, 'Geomorphic map RAW', false);
    if (vars.cleanup_stage == 2) Map.addLayer(ee.Image(region_params.geo_map_clean1), display_pal, 'Geo clean stage 1', false);
  }
  if (!vars.geomorphic) {
    // Use the manually cleaned geomorphic map as input for the benthic clean
    var geo_map = ee.Image(region_params.geo_map_clean3);
    Map.addLayer(geo_map.updateMask(geo_map.gt(2)), map_palettes.geo, 'Geo clean stage 3', false);
    Map.addLayer(benthic_map, display_pal, 'Benthic map RAW', false);
  }
  
  // 3. Object-based re-classificaiton and cleaning
  
  /* OUTPUT EXTENT
    - to the mapping extent just so it doesn't balloon out
    - to the 'reef boundary' extent for noise/deep removal
  */  
  var class_extent_mask = geo_map.gt(0);
  
  /*
  
  ########
  Initial small object clean
   - this was originally at the end, but we needed to massively reduce the number of objects to 
     iterate through in the OBIA cleaning, so this happens first now
   - future collabs with google might fix this, but need to change the parallel serialisation of vector procesing
   
   - includes a possible special case for:
        - geomorphic to clean up turbid areas over size threshold; fix shallow vs. deep lagoon
        - benthic to allow breaking waves (temporal class) to grow into surrounding class
  ########
  
  */
  
  // ##############################################################################################
  // START OF CLEAN 1
  // ##############################################################################################
  
  if (vars.geomorphic && !vars.obia_2nd_pass) {
    
    // shallow lagoon > 5m == deep lagoon//this rule is making mini deep laggoons witin BRS 
    //so I will generate another clean up1 with shallow lagoons instead (comenting this up)
    
    // = geo_map.where({
     // test: geo_map.eq(11)
                    //.and(depth.gt(vars.shallowlag_depth_cutoff)),
      //value: ee.Image(12)
    //});
    
    // deep water in depth data == deep (s2 + ls8 data should be good enough for this)
    geo_map = geo_map.where({
      test: depth.gt(vars.geo_depth_cutoff),
      value: ee.Image(2)
    });
    
    // make a smooth map with masked area as a value - *** Change to ee.kernal*** see reef mask in clean 3
    var smooth_map = geo_map
                        .focal_mode({
                          radius: vars.smooth_radius, // relates to smoothness required
                          kernelType: 'circle', units: 'pixels', iterations: 2
                        });
    
    // replace small objects with smooth underneath
    var clean_map = geo_map.where({
      test: geo_map.connectedPixelCount(vars.small_object_geo, false).lt(vars.small_object_geo), 
      value: smooth_map
    }).updateMask(class_extent_mask);
    
    // display distance to land mask for assessing cut-off distances
    var distToLand = ee.Image(region_params.distToLand);
    
    Map.addLayer(distToLand.lte(vars.dist_to_land_RC), {}, 'RC to TRF ' + vars.dist_to_land_RC + 'm', false);
    Map.addLayer(distToLand.unmask(100000, false).lte(vars.dist_to_land_ORF), {}, 'TRF to ORF ' + vars.dist_to_land_ORF + 'm', false);

    // // reef crest close to land -> TRF - Not need when using .focal masks (reef mask) as this will take care of RC inside the reef
    // clean_map = clean_map.where({
    //   test: distToLand.lte(vars.dist_to_land_RC)
    //                 .and(clean_map.eq(15)),
    //   value: ee.Image(16)
    // });
    
    // TRF outside of specified distance from land -> ORF
    clean_map = clean_map.where({
      test: distToLand.unmask(100000, false).gt(vars.dist_to_land_ORF)
                       .and(clean_map.eq(16)),
      value: ee.Image(14)
    });
  }
  
  if (!vars.geomorphic && vars.cleanup_stage == 1) {
    
    // make a smooth map with masked area as a value, and without temporal class (basically breaking waves)
    var smooth_map = benthic_map
                        .focal_mode({
                          radius: vars.smooth_radius, // relates to smoothness required
                          kernelType: 'circle', units: 'pixels', iterations: 1
                        });
    
    //replace small objects with smooth underneath
    var clean_map = benthic_map.where({
      test: benthic_map.connectedPixelCount(vars.small_object_benthic, false).lt(vars.small_object_benthic),
      value: smooth_map
    }).updateMask(class_extent_mask);
    
  }
  
  // ##############################################################################################
  // START OF CLEAN 2
  // ##############################################################################################
  
  if (vars.geomorphic && vars.obia_2nd_pass) {
    var clean_map = geo_map;
  }
  
  if (vars.obia_clean) {
    
    if (vars.geomorphic && !vars.fast_clean) { 
      
      // FUNCTION that maps over feature colleciton and assigns neighbour percentages
      var set_neighbour_properties = function(f) {
        // make the 1px buffer
        var diff = f.buffer(vars.image_data_scale).difference(f, ee.ErrorMargin(0.5));
        // reduce the classes in the buffer zone
        var diff_classes = ee.Dictionary(
          clean_map.unmask(ee.Image(0)).reduceRegion({
            reducer: ee.Reducer.frequencyHistogram(),
            geometry: diff.geometry(),
            scale: vars.image_data_scale,
            maxPixels: 1e11
          }).get('classification')
        );
        // calculate the percentages
        var diff_sum = diff_classes.toArray().reduce(ee.Reducer.sum(), [0]).get([0]);
        var diff_percs = diff_classes.map(function(k,v){return(ee.Number(v).divide(diff_sum).multiply(100).toUint8())});
        
        /* NOW, we can try to do the class logic right here (see /users/mitchest/global_reefs/obia_dev),
           or we can return the neighbour % and do image logic via (painted) rasters */
        
        return(f.set(diff_percs));
      };
      
      // FUNCTION to reduce the map to vectors and map the neighbour properties function
      var reduce_neighbours = function() {
        // reduce map to vectors
        var map_fc = clean_map
              .updateMask(segment_id).updateMask(clean_map.eq(classn)) // only vectorise class/es of interest
              .reduceToVectors({
                scale: vars.image_data_scale, 
                eightConnected: false,
                bestEffort: true, 
                maxPixels: 1e13,
                tileScale: 1,
                geometry: region_extent
              });
        // map the function, calculate neighbour properties
        return(map_fc.map(set_neighbour_properties));
      };
      
      // first make a make size threshold, so we're not vecortising huge objects when we don't have to
      var segment_id = clean_map.connectedComponents(ee.Kernel.plus(1),vars.small_object_geo.sqrt()).select('labels');
      //Map.addLayer(segment_id.reproject(ee.Projection('EPSG:4326').atScale(ee.Number(vars.image_data_scale))))
      Map.addLayer(clean_map.updateMask(segment_id).reproject(ee.Projection('EPSG:4326').atScale(ee.Number(vars.image_data_scale))), display_pal, 'Map objects to be iterated through (OBIA)', false);
      
      // This is where we select the single or group of classes to vectorise for cleaning up
      //var classn = ee.Number(15) // one class
      var classn = clean_map.where({
        test: clean_map.neq(16) //TRF
                .and(clean_map.neq(15)) //RR
                .and(clean_map.neq(14)) //ORF
                .and(clean_map.neq(13)) //IRF
                //.and(clean_map.neq(12)) // deep L
                .and(clean_map.neq(11)), // shallow L 
        value: ee.Image(99) // 99 ensures it's ignored in logic
      });
      
      // Minimum size of object to reclass based on neighbourhood
      var max_size = ee.Number(1000).divide(vars.image_data_scale).pow(2); // the first number is the square dimension of the desired min size;
      // calculate neighbours
      var map_fc_neighbours = reduce_neighbours();
      
      // #########
      // REEF RIM
      // #########
      
      var focus_class = ee.Number(15); //RR
      
      // start the object-based neighbourhood rules
      // paint out to rasters (only paint the layers needed)
      var objsize = ee.Image(30000).paint(map_fc_neighbours, 'count').rename('count');
      //var nb24 = ee.Image().byte().paint(map_fc_neighbours, '24').unmask(0).rename('nb24') //OCL
      var nb22 = ee.Image().byte().paint(map_fc_neighbours, '22').unmask(0).rename('nb22'); //SL ex
      var nb21 = ee.Image().byte().paint(map_fc_neighbours, '21').unmask(0).rename('nb21'); //Sl sh
      var nb16 = ee.Image().byte().paint(map_fc_neighbours, '16').unmask(0).rename('nb16'); //TRF
      var nb15 = ee.Image().byte().paint(map_fc_neighbours, '15').unmask(0).rename('nb15'); //RR
      var nb14 = ee.Image().byte().paint(map_fc_neighbours, '14').unmask(0).rename('nb14'); //ORF
      var nb13 = ee.Image().byte().paint(map_fc_neighbours, '13').unmask(0).rename('nb13'); //IRF
      //var nb3 = ee.Image().byte().paint(map_fc_neighbours, '3').unmask(0).rename('nb3') //Turbid
      
      // RR surrounded by ORF --> ORF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb14.gt(75)),
        value: ee.Image(14)
      });
      
      // RR surrounded by IRF --> IRF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb13.gt(75)),
        value: ee.Image(13)
      });
      
      // RR surrounded by IRF + ORF --> IRF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb13.add(nb14).gt(75)),
        value: ee.Image(13)
      });
      
      // RR with decent border to TRF --> TRF (often dark, probably seagrass)
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb16.gt(40)),
        value: ee.Image(16)
      });
      
      // RR surrounded by OCL --> OCL
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb24.gt(75)),
        value: ee.Image(24)
      })
      
      // small RR objects touching OCL + stuff --> ORF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(objsize.lte(max_size))
                .and(nb13.lte(75).and(nb14.lte(75))) // to ensure we're no re-writing previous rules
                .and(nb24.gt(1)),
        value: ee.Image(14)
      })
      
      // ####
      // ORF
      // ####
      
      focus_class = ee.Number(14); // ORF
      
      // ORF surrounded by IRF --> IRF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb13.gt(75)),
        value: ee.Image(13)
      });
      
      // ORF surrounded by TRF --> TRF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb16.gt(75)),
        value: ee.Image(16)
      });
      
      // ORF surrounded by RR --> RR
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb15.gt(85)),
        value: ee.Image(15)
      });
      
      // ORF touching slope and RR --> RR
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb21.gt(0).or(nb22.gt(0)))
                .and(nb15.gt(0)),
        value: ee.Image(15)
      });
      
      // ####
      // IRF
      // ####
      
      focus_class = ee.Number(13); // IRF
      
      // IRF surrounded by ORF --> ORF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb14.gt(75)),
        value: ee.Image(14)
      });
      
      // IRF surrounded by TRF --> TRF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb16.gt(75)),
        value: ee.Image(16)
      });
      
      // IRF surrounded by RR --> RR
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb15.gt(85)),
        value: ee.Image(15)
      });
      
      // ####
      // TRF
      // ####
      
      focus_class = ee.Number(16); // TRF
      
      // TRF surrounded by ORF --> ORF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb14.gt(75)),
        value: ee.Image(14)
      });
      
      // TRF surrounded by IRF --> IRF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb13.gt(75)),
        value: ee.Image(13)
      });
      
      // TRF surrounded by IRF + ORF --> IRF
      clean_map = clean_map.where({
        test: clean_map.eq(focus_class)
                .and(nb13.add(nb14).gt(75)),
        value: ee.Image(13)
      });
      
      // ####
      // LAGOONS
      // ####
      
      var nb11 = ee.Image().byte().paint(map_fc_neighbours, '11').unmask(0).rename('nb11'); // shallow lag
      
      // SL sourrounded by DL --> DL
      clean_map = clean_map.where({
        test: clean_map.eq(11)
                .and(nb12.gt(75)),
        value: ee.Image(12)
      })
      
      // DL sourrounded by SL --> SL
      clean_map = clean_map.where({
        test: clean_map.eq(12)
                .and(nb11.gt(75)),
        value: ee.Image(11)
      })
      
      // DL/SL surrounded by IRF --> IRF
      clean_map = clean_map.where({
        test: clean_map.eq(11).or(clean_map.eq(12))
                .and(objsize.lte(max_size))
                .and(nb13.gt(80)),
        value: ee.Image(13)
      })
      
      // SL surrounded by IRF --> IRF
      clean_map = clean_map.where({
        test: clean_map.eq(11)
                .and(objsize.lte(max_size))
                .and(nb13.gt(80)),
        value: ee.Image(13)
      });
      
    
    } else if (vars.geomorphic && vars.fast_clean) {
      print("Executing the fast version OBIA");
      
      /* fast version of the geo clean up
        - blanket version assigns the underlying most common in neighbourhood
        - mode OBIA version iterates through objects+buffers but take the mode instead of doing the class percs, to see if that speeds things up
      */
      
      
      // ## Blanket version
      
      // make a very smooth map to capture the broader neighbourhood  - *** Change to ee.kernal*** see reef mask in clean 3
      var smooth_map = clean_map
                          .focal_mode({
                            radius: vars.smooth_radius.multiply(3), // relates to smoothness required
                            kernelType: 'circle', units: 'pixels', iterations: 2
                          });
      
      // first make a make size threshold, so we're not vectorising huge objects when we don't have t
      // - the unmask(99) captures small no data values/ data gaps
      var segment_id = clean_map.unmask(0).connectedComponents(ee.Kernel.plus(1),vars.small_object_geo.sqrt().multiply(2)).select('labels').pow(2).log().int();
      Map.addLayer(clean_map.unmask(0).updateMask(segment_id.gt(0)).reproject(ee.Projection('EPSG:4326').atScale(ee.Number(vars.image_data_scale))), display_pal, 'Map objects to be iterated through (OBIA)', false);
      
      // replace small objects with smooth underneath
      var clean_map = clean_map.unmask(0).where({
        test: segment_id.gt(0), 
        value: smooth_map
      }).selfMask();
      
      
      // ## mode OBIA version
      
      /* A possible faster plan
            - vectorise one/few class/es at a time, thus only spending resources on what is actually needed to clean up
            - BUT, just assign the mode of the neighbours, so save resouces even further??
      
      // FUNCTION that maps over feature colleciton and assigns neighbour percentages
      var set_neighbour_mode = function(f) {
        // make the 1px buffer
        var diff = f.buffer(vars.image_data_scale).difference(f, ee.ErrorMargin(0.5))
        // reduce the classes in the buffer zone
        var diff_mode = ee.Number(ee.Dictionary(
          clean_map.unmask(ee.Image(0)).reduceRegion({
            reducer: ee.Reducer.mode(),
            geometry: diff.geometry(),
            scale: vars.image_data_scale,
            maxPixels: 1e11
          })).get('classification'))
        
        return(f.set('mode',diff_mode))
      }
      
      // FUNCTION to reduce the map to vectors and map the neighbour properties function
      var reduce_neighbours_mode = function() {
        // reduce map to vectors
        var map_fc = clean_map.unmask(0)
              .updateMask(classn.gt(0)) // only vectorise class/es of interest
              .reduceToVectors({
                scale: vars.image_data_scale, 
                eightConnected: false,
                bestEffort: true, 
                maxPixels: 1e13,
                tileScale: 1,
                geometry: region_extent
              })
        // map the function, calculate neighbour properties
        return(map_fc.map(set_neighbour_mode))
      }
      
      // first make a make size threshold, so we're not vecortising huge objects when we don't have to
      var segment_id = clean_map.unmask(0).connectedComponents(ee.Kernel.plus(1),vars.small_object_geo.sqrt()).select('labels')
      Map.addLayer(clean_map.unmask(0).updateMask(segment_id.gt(0)).reproject(ee.Projection('EPSG:4326').atScale(ee.Number(vars.image_data_scale))), display_pal, 'Map objects to be iterated through (OBIA)', false)
      
      // This is where we select the single or group of classes to vectorise for cleaning up
      var classn = segment_id.where({
        test: clean_map.neq(16) //TRF
                .and(clean_map.neq(15)) //RR
                .and(clean_map.neq(14)) //ORF
                .and(clean_map.neq(13)) //IRF
                //.and(clean_map.neq(12)) // deep L
                .and(clean_map.neq(11)) // shallow L 
                .and(clean_map.unmask(0).neq(0)), // no data values (want to reclaim the small gaps 
        value: ee.Image(0) // 99 ensures it's ignored in logic
      })
      
      // calculate neighbours
      var map_fc_neighbours = reduce_neighbours_mode()
      
      //print(map_fc_neighbours.limit(10))
      
      var mode_map = ee.Image().byte().paint(map_fc_neighbours, 'mode').unmask(0).rename('mode') // paint out the mode values to an image
      //Map.addLayer(mode_map, display_pal, "mode map", false)
      
      // replace small objects with mode underneath
      var clean_map = clean_map.unmask(0).where({
        test: segment_id.gt(0), 
        value: mode_map
      }).selfMask()
      
      */
      
    } else {
      
      if (vars.cleanup_stage == 1) {
        // BENTHIC CLEAN-UP RULES
        
        // reclaim shallow no data to surrounding class
        var smooth_map = clean_map
                            .focal_mode({
                              radius: vars.smooth_radius.multiply(3), // relates to smoothness required
                              kernelType: 'circle', units: 'pixels', iterations: 2
                            });
        
        var clean_map = clean_map.unmask(0).where({
          test: geo_map.gt(2).and(clean_map.eq(0)), 
          value: smooth_map
        }).selfMask();
        
        // cut benthic off to < 10 - 15 m
        clean_map = clean_map.where({
          test: depth.gt(vars.benthic_depth_cutoff),
          value: ee.Image(0)
        });
        
        // Deep (or land or missing) in geo == masked from benthic
        clean_map = clean_map.where({
          test: geo_map.unmask(0).lte(2),
          value: ee.Image(0)
        });
        
      }
    }
  }
  
  // Final clip to the classified extent and move on
  if (vars.geomorphic) {
    clean_map = clean_map.updateMask(clean_map.gt(1)); // this ignores 0/land; make it .gt(2) if you want to mask deep too
  } else {
    clean_map = clean_map.updateMask(clean_map.gt(1)); // this ignores 0/land; make it .gt(2) if you want to mask deep too
  }

  
  
  // 4. Export data
  
  var output_name = (vars.geomorphic) ? vars.geomorph_output_name : vars.benthic_output_name;
  
  if (vars.do_export) {
    print("For export, the image data scale must be set to:", vars.image_data_scale);
    
    Map.addLayer(region_extent, {}, "Export footprint", false);
    
    Export.image.toAsset({
      image: clean_map.set(vars),
      description: output_name,
      assetId: vars.asset_output + 'in_out/' + output_name,
      region: region_extent,
      scale: vars.image_data_scale,
      crs: 'EPSG:4326',
      maxPixels: 1e13,
      pyramidingPolicy: {'.default': 'mode'}
    });
    
  } else {
    if (vars.reproject_display) {
      Map.addLayer(clean_map.reproject(ee.Projection('EPSG:4326').atScale(vars.image_data_scale)), display_pal, output_name, true);
    } else {
      Map.addLayer(clean_map, display_pal, output_name, false);
    }
  }

}

//Generate title
var title = ui.Label({
  value: 'Classes',
  style: {fontWeight: 'bold', fontSize: '12px'}
});

// generate the legend
var geo_legend = pkg_vis.discrete_legend(map_palettes.geo_atlas_names, map_palettes.geo_atlas_cols, 'Geomorphic Zone', false);
var benthic_legend = pkg_vis.discrete_legend(map_palettes.benthic_atlas_names, map_palettes.benthic_atlas_cols, 'Benthic Habitat', false);
//var mask_legend = pkg_vis.discrete_legend(["Low confidence depth","Water conditions"], ["#f7f7f7","#bababa"], 'Confidence Mask reason', false)
var legend = (vars.geomorphic) ? geo_legend : benthic_legend;
pkg_vis.add_lgds([title, legend]);//, mask_legend])
// generate the legend
