/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var centre_map = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.Point([113.12980459536129, 10.07897594189757]),
    wcmc = ee.FeatureCollection("projects/coral_atlas/global_datasets/wcmc_reefs_2018v4_dissolved"),
    region_wcmcBound = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[140.23089908705762, -8.585320339637319],
          [140.89007877455762, -13.158609752389577],
          [142.47211002455762, -13.628858870481562],
          [144.53753971205762, -15.796437236299633],
          [145.54828189955762, -19.232281959787983],
          [150.77777408705762, -24.650968807059012],
          [153.94183658705762, -24.850510653508582],
          [153.63421939955762, -20.92445805796405],
          [147.70160221205762, -16.68245796426936],
          [144.88910221205762, -12.5159099321673],
          [147.61371158705762, -9.496696412689664],
          [147.52582096205762, -7.671750406266707],
          [142.73578189955762, -6.494303270145306]]]),
    region_extent = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[109.30104209981322, 9.572733439453838],
          [108.90553428731322, 8.139867122952825],
          [108.90553428731322, 6.832774773169177],
          [109.96022178731322, 5.69703919031537],
          [111.48732139668822, 4.778050739031632],
          [112.89357139668822, 4.0989452089864375],
          [114.84903502446073, 5.707677368754771],
          [116.33229209981322, 7.704609207094449],
          [118.66139366231322, 11.258295579058515],
          [119.40846397481322, 13.874493202886292],
          [119.23268272481322, 17.21860632391412],
          [120.02369834981322, 18.723402312806023],
          [120.0718248316957, 20.16901957842534],
          [119.01295616231322, 21.324315501839468],
          [116.37623741231322, 22.05930903717677],
          [113.82740928731322, 21.037479993942952],
          [112.02565147481322, 19.180594705188373],
          [109.31202842793822, 17.082134810827352],
          [109.82838584981322, 14.556083881197564],
          [110.61940147481322, 13.148104334997829],
          [110.54151244669319, 11.95069096489355],
          [110.09205772481322, 11.161305021073288],
          [109.69654991231322, 10.265343751849265]]]),
    notReef_mask = 
    /* color: #98ff00 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[143.2229538713317, -8.886967697283483],
          [143.92856732175235, -8.95493207809679],
          [144.5012345369818, -9.48111085346804],
          [146.1285807904934, -8.952134996026112],
          [146.53173120922528, -8.71297369861281],
          [146.62422523349736, -8.511658987448726],
          [146.657201957465, -7.973500391071557],
          [144.7457486757348, -7.0367968175692495],
          [142.41680859666195, -7.074938169820303],
          [141.47755635910474, -8.065901325183084],
          [140.71762530131753, -8.731764730857527],
          [140.42803805758254, -9.50003802285269],
          [140.74044816560792, -10.003208601905198],
          [141.41769325669938, -10.218984405492748],
          [141.35697464880369, -9.70448012349473],
          [141.4653388045741, -9.467319977772028],
          [142.07352381219226, -9.191356735223884],
          [142.25819766519015, -9.162764771128106],
          [142.53406045235698, -9.247924055465315]]]),
    mid_mask = /* color: #0bd638 */ee.Geometry.MultiPolygon(
        [[[[115.17651664356043, 8.402836297491838],
           [115.28843986133387, 8.37566436932431],
           [115.29187308887293, 8.332864737254019],
           [115.09411918262293, 8.349849280024726],
           [114.83456718066981, 8.316558882350455],
           [114.46134953380096, 8.329163955071566],
           [114.47545158008387, 8.203078596701186],
           [114.68420111048422, 8.205493488476943],
           [114.82152091602137, 8.160260225617671],
           [114.80298148731043, 8.095004367675564],
           [114.69380485156825, 8.025658436006724],
           [114.636126628912, 8.078008916162267],
           [114.57432853320887, 8.111319326588468],
           [114.54136954883387, 8.10452150742911],
           [114.47407828906825, 8.05829329607659],
           [114.471331707037, 7.971941193370375],
           [114.51321708301356, 7.841358582979868],
           [114.41022025684168, 7.786937023290031],
           [114.37279391381377, 7.583951392667107],
           [115.09343253711512, 7.7971416057024205],
           [115.51640616992762, 7.884210553827377],
           [115.5754576835995, 8.418459294707244],
           [115.504046550787, 8.545457554548172],
           [115.25067435840418, 8.571938514006217],
           [115.08175956348231, 8.532555907691814],
           [115.02957450488856, 8.43679853040362],
           [115.06322013477137, 8.362077693349365],
           [115.13463126758387, 8.372267744771223],
           [115.16209708789637, 8.3946849186222],
           [115.16827689746668, 8.400798468827716]]],
         [[[113.67843439972535, 8.930080354083357],
           [113.63448908722535, 8.930080354083357],
           [113.63483145917667, 8.958568409618373],
           [113.66538813507691, 8.97484687561668],
           [113.83292963898316, 9.119282838066061],
           [113.8020305911316, 9.430332400701051],
           [113.47038081085816, 9.404591537893866],
           [113.47999384796753, 8.894127500116833],
           [113.62281611359253, 8.848672614590857],
           [113.68186762726441, 8.908373393666169]]],
         [[[113.27410241149427, 8.139783257876381],
           [113.28783532165052, 8.176147050476937],
           [113.30371399901868, 8.195007338832315],
           [113.34697266601087, 8.270439531869505],
           [113.36139222167493, 8.292862541562778],
           [113.40275900582274, 8.349163779866995],
           [113.40259095214368, 8.429411312022575],
           [113.28311463378431, 8.430090539249722],
           [112.88760682128431, 7.933943194860572],
           [113.00914307616712, 7.756406143921258],
           [113.52824708007337, 8.172578787408272],
           [113.4911682226515, 8.320040232206747],
           [113.4142639257765, 8.325475544310624],
           [113.36486657282296, 8.286322426153264],
           [113.36388131164075, 8.26959015034561],
           [113.35814044283394, 8.236600504204747],
           [113.3523143266522, 8.21804988129634],
           [113.34923514959112, 8.207738979060032],
           [113.34461121186305, 8.198277554993858],
           [113.33796044372083, 8.189655185609382],
           [113.33366879536587, 8.181414436654618],
           [113.32645913146497, 8.167906013702304],
           [113.30731843489274, 8.146028334608827],
           [113.28912278197767, 8.127462999321267],
           [113.27749190467904, 8.117224168228704],
           [113.26706318347011, 8.103670978251792],
           [113.24740906737806, 8.084806495724271],
           [113.24178694073555, 8.078773117641887],
           [113.23513500863429, 8.074099309132288],
           [113.22629471801282, 8.070275061768154],
           [113.22187447938903, 8.069892594769934],
           [113.2212307660259, 8.07426902050046],
           [113.21856995604993, 8.080812527995954],
           [113.22547895133006, 8.082002282909496],
           [113.23530645455106, 8.093559142213943],
           [113.24213017450523, 8.099294961619169],
           [113.24706574462415, 8.102141556624177],
           [113.25341676182003, 8.110086392219019],
           [113.2547900334572, 8.11558829442508],
           [113.26157072075084, 8.121568143249188],
           [113.26955338500501, 8.130012049392551]]],
         [[[112.63131967113921, 5.02887278083967],
           [112.62930267218152, 5.033660761974454],
           [112.62928097909203, 5.057039808727056],
           [112.63733824984726, 5.065652407144114],
           [112.61081153280783, 5.095094065720441],
           [112.63303626220215, 5.179933041127606],
           [112.61157906040938, 5.218229190594461],
           [112.5269502422724, 5.182668386153267],
           [112.39339856381531, 5.102996776753763],
           [112.40577798923746, 4.7616160474577445],
           [112.58359829353805, 4.7226272532788585],
           [112.92176892164456, 4.790713104976129],
           [112.85400540381443, 5.237018740414778],
           [112.6827478079567, 5.278913489820539],
           [112.63921603037053, 5.179933041338007],
           [112.61556408700697, 5.096622087489339],
           [112.64100713444556, 5.063579055372727],
           [112.63146934024293, 5.055629063338861],
           [112.63059009202601, 5.033233188061659],
           [112.63236036010885, 5.028787224062322],
           [112.63910877343469, 5.027932240367694],
           [112.64346461301555, 5.024255711284312],
           [112.64696222759328, 5.021220449168805],
           [112.6463828190947, 5.017672179899538],
           [112.64455891901353, 5.014380380123773],
           [112.64320710360096, 5.011259544742974],
           [112.64127596004917, 5.010319008345944],
           [112.6399670686581, 5.012520679269978],
           [112.63908732118323, 5.016004884345462],
           [112.63543951745811, 5.021476965570668]]],
         [[[114.39652048291016, 7.8815086561759],
           [114.36218820751954, 7.887630044562915],
           [114.28734384716797, 7.8223305776713214],
           [114.32922922314454, 7.7930785372769495],
           [114.37454782666016, 7.815527960380719],
           [114.41368662060547, 7.8529409810555935],
           [114.41094003857422, 7.87062596443023]]],
         [[[114.2502649897461, 7.905993665821998],
           [114.30382333935547, 7.9481588851285805],
           [114.25850473583985, 7.985559889937885],
           [114.22348581494141, 7.954959321840371],
           [113.97007847166739, 7.698153586859784],
           [114.01749216259766, 7.669925532685853]]],
         [[[115.30347382673922, 9.363613093973754],
           [115.34870591446857, 9.357519582201085],
           [115.39917470698661, 9.360564336056893],
           [115.41087918866421, 9.360267834167244],
           [115.42515864670601, 9.363612642307912],
           [115.42433241358533, 9.378855469094653],
           [115.42917112675417, 9.386984864970026],
           [115.43721837834616, 9.408577947791379],
           [115.44723976152417, 9.420009876751497],
           [115.45590861419585, 9.419163145277318],
           [115.45711039146107, 9.405614928402409],
           [115.458998491142, 9.391050501474346],
           [115.45899906531953, 9.374621730906737],
           [115.46260399961007, 9.366238068928903],
           [115.46886949616625, 9.360521861852682],
           [115.45998586570278, 9.354614922537355],
           [115.44929963884599, 9.346505926789883],
           [115.4401158275513, 9.347945696538766],
           [115.43316259328081, 9.35248363856971],
           [115.43148802587875, 9.356699716335536],
           [115.42970622007691, 9.362449095246593],
           [115.41072099448967, 9.35795880362628],
           [115.40251597328415, 9.359100736545473],
           [115.3871011831458, 9.358209765701389],
           [115.29798067782771, 9.337867365205037],
           [115.32407307181987, 8.977229669854436],
           [115.77313776600778, 9.004357921188696],
           [115.94067870831495, 9.131833444755118],
           [115.92969239982206, 9.309409331964803],
           [115.8830006634503, 9.310764524436175],
           [115.89673352435416, 9.343287660733647],
           [115.97089098660605, 9.345997792009738],
           [115.96608447596596, 9.322961075125416],
           [115.94548518568101, 9.312119731689203],
           [115.95715815143339, 9.077594082822324],
           [116.29910639315811, 9.471995225151717],
           [116.3320652270719, 9.6223186507901],
           [116.27164062336617, 9.67105787163172],
           [116.20022975410261, 9.610132713994643],
           [116.17817136859654, 9.612756209897915],
           [116.17312355841686, 9.608937363185689],
           [116.17176644322495, 9.598433045424887],
           [116.16716386275372, 9.593757349058864],
           [116.16156348347384, 9.59422294473614],
           [116.15834472907655, 9.597544520580389],
           [116.1614560216016, 9.604071423598565],
           [116.16644487336674, 9.608350351130378],
           [116.16984589490897, 9.611909900962637],
           [116.24692146352821, 9.711668499559952],
           [116.17139070514851, 9.818586200733142],
           [116.02307579193636, 9.92817482417916],
           [115.92007933791417, 9.934938346294782],
           [115.89638863732607, 9.873041640798244],
           [115.90359991550453, 9.817232991666863],
           [115.88643136468313, 9.751928582976106],
           [115.87990913719881, 9.742626725429028],
           [115.87407425546543, 9.714037363151538],
           [115.8693098295895, 9.707183849097461],
           [115.86660558632303, 9.691531672665773],
           [115.86109079967974, 9.68082888111814],
           [115.85351645917137, 9.67215655994006],
           [115.85177895925376, 9.657899824902115],
           [115.84523526597339, 9.646689137164568],
           [115.83548910020922, 9.664962811580061],
           [115.84222192611938, 9.715729237990294],
           [115.83604313315412, 9.746859535616638],
           [115.82986238536847, 9.767161667848983],
           [115.87518078526787, 9.829411354817035],
           [115.89440678013753, 9.956580710097823],
           [115.73098573800789, 10.163462916999125],
           [115.64309543856643, 10.141834396701904],
           [115.56172823800722, 9.928174804297257],
           [115.57940991404307, 9.91633846857668],
           [115.5805254191771, 9.908686598610393],
           [115.58129755787421, 9.901034726011353],
           [115.57365841396793, 9.891099670257006],
           [115.56481812174303, 9.88184085285033],
           [115.55559120959778, 9.874273013631091],
           [115.54533463707912, 9.871440194321222],
           [115.53443428405788, 9.875414845841346],
           [115.52962774500399, 9.876176005969],
           [115.52439202097355, 9.877275336300679],
           [115.51091665127413, 9.877443858874996],
           [115.50482291133316, 9.881756273546351],
           [115.50078894438512, 9.887928868703742],
           [115.4958963392318, 9.900611967822572],
           [115.49692617295571, 9.912871549516261],
           [115.50113199277449, 9.925976626065927],
           [115.5126332630176, 9.947112347192997],
           [115.53374811910315, 9.932402644064485],
           [115.54636493739525, 9.92978166028182],
           [115.5569217369217, 9.929865700904832],
           [115.61579194441747, 10.085199962482836],
           [115.62395111394427, 10.134808014060905],
           [115.60739000495504, 10.17157323490468],
           [115.41924983609363, 10.195902962358238],
           [115.30389381401943, 10.154000643468747],
           [115.13497960671852, 9.964696270875434],
           [115.06082208061085, 9.610132731451422],
           [115.23660267924528, 9.388002035104128],
           [115.27093483605493, 9.379872576620699]]],
         [[[113.87031913279796, 10.122203217104843],
           [113.86967533254114, 10.113626635465227],
           [113.86680007457042, 10.096600288569359],
           [113.86474013804698, 10.08307976804525],
           [113.86268020152355, 10.072347450933473],
           [113.86165023326183, 10.056713121779447],
           [113.85795951365733, 10.046402501449796],
           [113.85821700572276, 10.041923195094455],
           [113.86268020152355, 10.029668172200939],
           [113.8610494005403, 10.024005280400903],
           [113.86096358775401, 10.01614485030858],
           [113.85572791575694, 9.998648216223],
           [113.84911895274425, 9.99281579544118],
           [113.84491327310991, 9.994168266080873],
           [113.84216666697765, 9.997633889691237],
           [113.83972049126147, 10.005156630487877],
           [113.84148002146983, 10.013440118255252],
           [113.84448409556651, 10.03068239859584],
           [113.84242415904308, 10.055698976988447],
           [113.84688735484386, 10.088488044380542],
           [113.85341048716808, 10.102346337805871],
           [113.85032058238292, 10.116880003935464],
           [113.85684371470714, 10.130568087967845],
           [113.85856032847667, 10.15912529476702],
           [113.80603194712901, 10.17129090442561],
           [113.73982977449148, 10.422539291152152],
           [113.51284279573419, 10.407590619847566],
           [113.50942116891643, 10.259901371820773],
           [113.60898236148941, 10.232607444519045],
           [113.62545427793029, 10.231655930463083],
           [113.64741450516283, 10.248667974982647],
           [113.6505139075738, 10.239373866230938],
           [113.64450959015748, 10.231010866259012],
           [113.63567086268763, 10.222438067923223],
           [113.62507172081762, 10.22322100513072],
           [113.61359318668195, 10.22868129910491],
           [113.5900025121396, 10.211477447395104],
           [113.73599410533214, 10.128709246626766],
           [113.73668075083995, 9.902864967857774],
           [113.93065810679698, 9.885277707187424],
           [113.93958449839855, 10.150338733214918],
           [113.9368379163673, 10.237517746617963],
           [113.85126447696342, 10.243472263203039],
           [113.8604481697037, 10.159209312961002],
           [113.85787365769237, 10.130060747029729],
           [113.86345266507675, 10.127019287227432],
           [113.8689887257737, 10.124400064340142]]],
         [[[112.520441839579, 8.846956286548465],
           [112.48409125175942, 8.836736572851612],
           [112.46769859072636, 8.787456534668058],
           [112.55696288592613, 8.673436247159945],
           [112.75609089127951, 8.65578715573049],
           [112.87556769667168, 8.73045076105712],
           [112.87144781088625, 8.826812587724282],
           [112.80295463896155, 8.862432965729573],
           [112.79059558196651, 8.885339529050055],
           [112.81857902343873, 8.885855651938702],
           [112.98268484410377, 8.843096608289589],
           [112.93599276649967, 8.981481656202135],
           [112.84535518695664, 9.263514158727945],
           [112.84672849339536, 9.57105085971033],
           [112.8963326777759, 9.58171628378398],
           [112.91311235758074, 9.592929233674239],
           [112.9185632259656, 9.608204089770387],
           [112.93740506526456, 9.601983630568244],
           [112.96696664603698, 9.563549055760049],
           [113.05970393949433, 9.62429244040759],
           [113.02281786506961, 9.64493442438443],
           [113.00137789814764, 9.663881604270324],
           [112.99331834845992, 9.659223064272089],
           [112.9918636509006, 9.647755290969583],
           [112.98731920603807, 9.641364480709628],
           [112.95472299882965, 9.636107721537167],
           [112.95006911223486, 9.651953517751252],
           [112.96277083553012, 9.658556339939652],
           [113.00191108515371, 9.676660503966428],
           [113.06920265230548, 9.692905199210859],
           [113.05684298572383, 9.759229562272578],
           [112.65172027365107, 9.908072790070413],
           [112.585802042114, 9.445088772122444],
           [112.58408547174783, 8.904664071484875],
           [112.57116736711487, 8.862772009403454],
           [112.66914347469601, 8.836311407692365],
           [112.66459499774966, 8.820027362520056],
           [112.6569563667373, 8.815406342544595],
           [112.64777288950016, 8.815365227913489],
           [112.63077827083387, 8.81477330145975],
           [112.62414761788028, 8.81532518173543],
           [112.61751697100865, 8.81443505802539],
           [112.60989929403209, 8.813799250871838],
           [112.60228166251272, 8.812230300627078],
           [112.5942988130292, 8.809642747604176],
           [112.58738923621742, 8.804998501394435],
           [112.58007214644984, 8.804584729806441],
           [112.57288386108685, 8.80374672503423],
           [112.55179156047053, 8.808410288192372],
           [112.52520538508954, 8.814768716173411]]],
         [[[115.81357222072442, 11.015727853427812],
           [115.93030194031101, 10.864714687444492],
           [116.01681926209658, 10.83571677746123],
           [116.11226297426477, 10.819530675546183],
           [116.10333658398753, 10.789853886148611],
           [116.07518412211667, 10.791202894679332],
           [115.99484660895128, 10.827623835721118],
           [115.90471912111657, 10.866067351226649],
           [115.81021638080044, 10.990450467483592],
           [115.7190289066397, 10.904313468873067],
           [115.69403769977191, 10.824160894899476],
           [115.78666004989708, 10.785242798042578],
           [115.82298177574845, 10.830283865083295],
           [115.85991296432128, 10.815477471513974],
           [115.92824200406962, 10.685962102004696],
           [115.79502892784625, 10.654240486372759],
           [115.80258589334036, 10.532083093397247],
           [115.78783577037466, 10.46938042016225],
           [115.78693462888569, 10.461871901404825],
           [115.78478901819071, 10.456431316146281],
           [115.7808912117634, 10.455480026244398],
           [115.77941438535025, 10.455890612531519],
           [115.77407517728074, 10.455541513017836],
           [115.76830682555342, 10.455825390874896],
           [115.76382592060374, 10.45636240331945],
           [115.7594523385214, 10.457447787235608],
           [115.75216037229532, 10.463850559817502],
           [115.68330101455739, 10.487389176166653],
           [115.76718932971004, 10.697921254576878],
           [115.72676284459742, 10.771027104691292],
           [115.58366868729966, 10.696252005781172],
           [115.26253917179162, 10.29809430135922],
           [115.40268490337542, 10.269164696453572],
           [115.43429383626129, 10.228287496304135],
           [115.87790564548024, 10.289940412139861],
           [116.12462259270131, 10.415272669455053],
           [116.12874246471897, 10.59553381381092],
           [116.14110208196504, 10.66436972600031],
           [116.16376138037381, 10.731166163951675],
           [116.18436074273939, 10.729142245876375],
           [116.20427346002417, 10.63602740721296],
           [116.1720262130808, 10.578041063846994],
           [116.16573257923307, 10.5280590188145],
           [116.36119185412296, 10.178238508176877],
           [116.67611136394112, 10.160580964538259],
           [116.59016818273288, 10.55638491987743],
           [116.62724702884121, 11.227958867209288],
           [115.86919049906206, 11.229979366628518]]],
         [[[112.7355459070641, 16.712819519292744],
           [112.77262476448597, 16.649675613528483],
           [112.76026514534534, 16.603620054108994],
           [112.69846704964222, 16.657569741662705],
           [112.70155702290951, 16.676644924152736],
           [112.70790831785628, 16.685196016881104],
           [112.72756359440123, 16.692431240903748],
           [112.72181299690784, 16.701803725563803],
           [112.68473413948597, 16.802237613467337],
           [112.48423365120472, 16.93365824152214],
           [112.40870264534534, 16.94022687062567],
           [112.38535669807972, 16.885043265112145],
           [112.42655542854847, 16.766738400820934],
           [112.38123682503284, 16.569400203663328],
           [111.7302968836266, 16.61381902355223],
           [111.7259733562938, 16.596006923294116],
           [111.73057619038715, 16.57227240328866],
           [111.76380885030942, 16.54915143865624],
           [111.90022462556222, 16.402165542956315],
           [111.97902908185087, 16.362649814976113],
           [112.04073759564886, 16.36923026000338],
           [112.09454949006422, 16.356690078846885],
           [112.10246587450156, 16.339893258385857],
           [112.08529261116566, 16.323596234067946],
           [112.05046386607624, 16.330017801960583],
           [111.9930519550646, 16.31971627805255],
           [111.98096031862084, 16.320611561632333],
           [111.9761633372582, 16.320065326644077],
           [111.96141026456111, 16.315235258534724],
           [111.94014440889289, 16.312822460506336],
           [111.86886669304023, 16.33246730210449],
           [111.63667270922481, 16.43467745786923],
           [111.3824454176494, 16.38115007379203],
           [111.41257311272607, 16.131370613258802],
           [111.67607862964323, 16.283355040752628],
           [111.79141877633872, 16.287505020694635],
           [111.8171192618528, 16.254919771353673],
           [111.82046214886056, 16.22995876049025],
           [111.78101032466049, 16.199428437690557],
           [111.73881032381696, 16.189429241468325],
           [111.67445802933852, 16.194313174616997],
           [111.61344819372891, 16.15915670269965],
           [111.58678797249378, 16.116076975982523],
           [111.61212447191015, 16.041349923094927],
           [111.67970302599579, 15.985487628093397],
           [111.7649092893157, 16.02530304873536],
           [111.76223703366873, 16.038817165353386],
           [111.75235438807853, 16.04474197417998],
           [111.75112820427596, 16.05230233805192],
           [111.75210885664156, 16.060824565523482],
           [111.76187060841475, 16.06487949865854],
           [111.78004458217328, 16.070912170601783],
           [111.7978541112791, 16.075387615631136],
           [111.81240257358364, 16.07689212342845],
           [111.82557779359598, 16.076086462162216],
           [111.82995362687075, 16.069310108114596],
           [111.82785007852995, 16.05668485400079],
           [111.8168429097141, 16.04443368329643],
           [111.79331617242605, 16.0318735919091],
           [111.78464456808229, 16.023283134668947],
           [111.79382572373787, 16.013702722310676],
           [112.28235987190784, 15.908835580605006],
           [112.49451306769245, 15.827630396367187],
           [112.59032038216175, 15.947297071715145],
           [112.53419151895396, 16.01562302028633],
           [112.52998281016328, 16.022803592105518],
           [112.48341733682146, 16.011378591426165],
           [112.4450948572594, 16.01380317365598],
           [112.43565348152698, 16.03558199860532],
           [112.43917143761482, 16.046305273040634],
           [112.45453623299183, 16.05686355167565],
           [112.4766357131087, 16.0643725554493],
           [112.50079626144586, 16.066600377900016],
           [112.54294184212269, 16.081276794753236],
           [112.5695476097276, 16.087300048110954],
           [112.59117868904652, 16.089688771917803],
           [112.60021308078414, 16.08194203312536],
           [112.60095101280044, 16.074439198973973],
           [112.57950090060463, 16.05953300188957],
           [112.54079734547558, 16.026012253979278],
           [112.53174743019221, 16.02558427380866],
           [112.53437058205103, 16.020206504269623],
           [112.74515894417347, 15.974859354417225],
           [112.94840601448597, 16.58914316803941],
           [112.87974146370472, 16.790405279777808],
           [112.75614527229847, 16.790405279777808]]],
         [[[113.98036170439778, 11.098011960914924],
           [113.8334195657259, 10.935580077698912],
           [114.03392005400715, 10.728536011669132],
           [114.14241004424153, 10.790596794209522],
           [114.03597999053059, 10.911308721161719],
           [114.19116187529622, 11.07847096888207],
           [114.11563086943684, 11.17885731815604]]],
         [[[116.60532944864808, 20.578400150885415],
           [116.68772690958558, 20.632388487791218],
           [116.69253342814027, 20.733886066454147],
           [116.72343247599183, 20.758928810287706],
           [116.79278367228089, 20.783325442504818],
           [116.83054917521058, 20.782683476354183],
           [116.85518265834683, 20.781802958487603],
           [116.86642649771312, 20.78445142927351],
           [116.89028733439027, 20.78396740592556],
           [116.91088669962464, 20.76599139846674],
           [116.92187302774964, 20.735170410572366],
           [116.92873948282777, 20.703058539383477],
           [116.9307994193512, 20.660660453811698],
           [116.90230363077698, 20.625962308071237],
           [116.86419480509339, 20.58675673943305],
           [116.75639146036683, 20.575828800797968],
           [116.70763962931214, 20.599612135575835],
           [116.62180894083558, 20.534681310825995],
           [116.77218430704652, 20.40924186956813],
           [117.01230846358801, 20.524798374443023],
           [117.22262376017152, 20.683145762143564],
           [116.99465745157777, 21.216666350072547],
           [116.82024949259339, 21.264026417763127],
           [116.42199509806214, 20.868040984867736],
           [116.51537888712464, 20.639456972054177]]]]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
// Coral atlas mapping project - South China Sea
// Contact: mitchell.lyons@gmail.com
// Region coordinator: Chris Roelfsema
// Description:
// Viewing script for looking at reefs and classifications for each region. 
// From this region Timor Sea onwards the map_viewer script is going to be used from the very beginning
// in the workflow 


// Load and libraries needed
var map_palettes = require('users/mitchest/global_reefs:Modules/colour_pals');
var param_module = require('users/mitchest/global_reefs:Modules/reef_params');
var pkg_vis = require('users/mitchest/global_reefs:Modules/pkg_vis');

// ###########################################
// SENSOR GENERICS
var sensor_params = param_module.dove ;      //<------------ THIS IS WHERE YOU CHOOSE THE SENSOR
// REGION AND SENSOR SPECIFIC LOAD PATHS
var region_params = param_module.south_china_sea;       //<------------ THIS IS WHERE YOU CHOOSE THE REGION
//  ^^ all the data paths are in this module ^^
// ###########################################



// Choose which layers will be shown in the map viewer
var vars = {
  raw: true, // set to true if you want to view the raw classifications for benthic and geo
  geo_cleanup_stage: 2, // set to 0, 1, 2 or 3 - this controls the display of the geo clean stages (0 = cleanup not ready)
  benthic_cleanup_stage: 0, // set to 0, 1 or 2 - this controls the display of the benthic clean stages (0 = cleanup not ready)
};

// choose where to centre the map (link this dynamically to map app?)
Map.centerObject(centre_map, 6);

// Add low-tide base map to viewer
// var low_tide_image = ee.Image(region_params.pixels);
// Map.addLayer(low_tide_image, {bands: ['b3','b2','b1'], min: 0, max: 3000}, sensor_params.sname + " from stack", false); // image data

//print (region_params.image[0])
var low_tide_image_dove = ee.Image(region_params.image);
Map.addLayer(low_tide_image_dove, {bands: ['b3','b2','b1'], min: 0, max: 3000}, sensor_params.sname + ' low tide', false); // image data


var wcmc=wcmc.filterBounds(region_wcmcBound)
Map.addLayer(wcmc, {color:'#ffff00'}, "WCMC layer", false)



// Load the raw classifications
if (vars.raw) {
// geo raw (test if more than one map exists for the region)
  if (ee.List(region_params.geo_map).length().getInfo() > 1) {
    var geo_map_raw = ee.Image(region_params.geo_map[0]).unmask(0, false)
                 .add(ee.Image(region_params.geo_map[1]).unmask(0, false))
                 .selfMask();
  } else {
    var geo_map_raw = ee.Image(region_params.geo_map);
  }

  // benthic raw (test if more than one map exists for the region)
  if (ee.List(region_params.benthic_map).length().getInfo() > 1) {
    var benthic_map_raw = ee.Image(region_params.benthic_map[0]).unmask(0, false)
                     .add(ee.Image(region_params.benthic_map[1]).unmask(0, false))
                     .selfMask();
  } else {
      var benthic_map_raw = ee.Image(region_params.benthic_map);
  }

  // Add the raw region classification to the viewer
  Map.addLayer(geo_map_raw, map_palettes.geo, 'Geomorphic RAW', false);
  Map.addLayer(benthic_map_raw.updateMask(geo_map_raw.gt(2)), map_palettes.benthic, 'Benthic RAW', false);
}

// Add geo clean stage 1 to the viewer
if (vars.geo_cleanup_stage == 1||vars.geo_cleanup_stage == 2) {
  Map.addLayer(ee.Image(region_params.geo_map_clean1), map_palettes.geo, 'Geomorphic - stage 1 clean', false);
 // Map.addLayer(ee.Image(region_params.geo_map_clean1), map_palettes.geo, 'timor_geo_clean1_10m_5m', false);
  }

// Add geo clean stage 2 to the viewer
if (vars.geo_cleanup_stage == 2||vars.geo_cleanup_stage == 3) {
  Map.addLayer(ee.Image(region_params.geo_map_clean2), map_palettes.geo, 'Geomorphic - stage 2 clean', false);
 
}

// Add geo clean stage 3 to the viewer
if (vars.geo_cleanup_stage == 3) {
  var geo_map_clean3 = ee.Image(region_params.geo_map_clean3)
  Map.addLayer(geo_map_clean3.updateMask(geo_map_clean3.gt(2)), map_palettes.geo, 'Geomorphic - stage 3 clean', true);
}

// Add benthic clean stage 1 to the viewer
if (vars.benthic_cleanup_stage == 1||vars.benthic_cleanup_stage == 2) {
  Map.addLayer(ee.Image(region_params.benthic_map_clean1), map_palettes.benthic, 'Benthic - stage 1 clean', false);
  }

// Add geo clean stage 2 to the viewer
if (vars.benthic_cleanup_stage == 2) {
  Map.addLayer(ee.Image(region_params.benthic_map_clean2), map_palettes.benthic, 'Benthic - stage 2 clean', false);
}

// Geo Training Data - Needs more work + add flag to show
var geo_train = ee.FeatureCollection(region_params.geo_train_library);

var geo_buff = function(feature) {
  return feature.buffer(20);   // substitute in your value of Z here
};

var geo_train_buff = geo_train.map(geo_buff)

// Create an empty image into which to paint the features, cast to byte.
var empty = ee.Image().byte();

// Paint the interior of the polygons with different colors.
var geo_fill = empty.paint({
  featureCollection: geo_train_buff,
  color: 'class_num',
});

Map.addLayer(geo_fill, map_palettes.geo, 'Geo Training Data', false);



////////// UI(user interface) SET UP //////////

//Generate title
var title = ui.Label({
  value: 'Coral Atlas map classes',
  style: {fontWeight: 'bold', fontSize: '14px'}
});

// generate the legend
var geo_legend = pkg_vis.discrete_legend(map_palettes.geo_atlas_names, map_palettes.geo_atlas_cols, 'Geomorphic Zone', false);
var benthic_legend = pkg_vis.discrete_legend(map_palettes.benthic_atlas_names, map_palettes.benthic_atlas_cols, 'Benthic Habitat', false);
//var mask_legend = pkg_vis.discrete_legend(["Low confidence depth","Water conditions"], ["#f7f7f7","#bababa"], 'Confidence Mask reason', false)
pkg_vis.add_lgds([title, geo_legend, benthic_legend]);//, mask_legend])
// generate the legend



////////// MASK EXPORTS //////////


Export.table.toAsset({
  collection: ee.FeatureCollection(region_extent),
  description: "region_extent_export",
  assetId: region_params.asset + 'in_out/' + region_params.sname + '_extent'
})

/*Export.table.toAsset({
  collection: ee.FeatureCollection(notReef_mask),
  description: "not_reef_mask_export",
  assetId: region_params.asset + 'in_out/' +  region_params.sname + '_notreef'
})*/

Export.table.toAsset({
  collection: ee.FeatureCollection(mid_mask),
  description: "mid_mask_export",
  assetId: region_params.asset + 'in_out/' +  region_params.sname + '_midmask'
})