/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var reef_mask = ee.Image("projects/coral_atlas/reefMask/global_reef_mask_combined"),
    imageVisParam = {"opacity":1,"bands":["b3","b2","b1"],"min":17.26,"max":845.74,"gamma":1},
    region_extent = 
    /* color: #ffc82d */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[98.63116381425976, 23.679635845961577],
          [98.63116381425976, 0.741438795358247],
          [117.35186693925982, 0.741438795358247],
          [117.35186693925982, 23.679635845961577]]], null, false),
    refined_mask = /* color: #00ffff */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[108.28814623613476, 1.4004996952484683],
                  [111.33135912675976, 0.796365487551061],
                  [111.89166186113476, 1.0709869606401463],
                  [112.21026537675976, 2.20209878680987],
                  [113.31988451738476, 2.717978585304556],
                  [115.27545092363476, 4.329861675008352],
                  [115.90167162675976, 4.669387636318546],
                  [117.28958487027012, 6.782200181522901],
                  [116.11404776089512, 7.697683876609293],
                  [113.16971182339512, 4.825825736794255],
                  [112.81400736419971, 4.362384488664652],
                  [110.89139994232471, 3.4197489408779957],
                  [110.68265970794971, 2.7505580562736176],
                  [110.19926127044971, 2.739584334866535],
                  [109.81473978607471, 3.485547258999552],
                  [109.49613627044971, 4.340475170282285],
                  [108.96879252044971, 5.161611473832134],
                  [108.15580423919971, 5.522584985394504],
                  [106.89237650482471, 4.58144199706806],
                  [104.89286478607471, 3.81446808918157],
                  [104.62919291107471, 4.866115981224118],
                  [104.40946634857471, 5.8724101797044606],
                  [103.35477884857471, 7.007759234928634],
                  [101.51350362594974, 8.866229963281603],
                  [100.92024190719974, 9.798537854775704],
                  [100.74446065719974, 11.547460329025114],
                  [101.49153096969974, 11.63355872731638],
                  [102.32649190719974, 9.71191808398571],
                  [103.16145284469974, 8.496975290436769],
                  [104.26008565719974, 7.6920936210177135],
                  [106.78694112594974, 7.735641259946256],
                  [107.55598409469974, 8.67078744120483],
                  [108.85237081344974, 9.235113789889915],
                  [110.01692159469974, 10.16641732125939],
                  [110.06086690719974, 13.007385885840554],
                  [110.03398537351154, 15.726582469672215],
                  [108.62773537351154, 17.28549566976387],
                  [109.77031349851154, 17.578984203038218],
                  [111.44023537351154, 18.331469007891695],
                  [111.83574318601154, 20.321849816288676],
                  [113.24199318601154, 20.651177024367986],
                  [114.57605262429001, 21.115285485613825],
                  [115.55041121341594, 21.76678747903553],
                  [116.53918074466594, 22.62125442326719],
                  [115.74816511966594, 23.47044435776667],
                  [114.45177840091594, 23.24855617642232],
                  [114.16613386966594, 23.51074772370503],
                  [113.41906355716594, 23.51074772370503],
                  [112.82580183841594, 23.36963210680215],
                  [112.65002058841594, 22.45890089044364],
                  [111.13390730716594, 22.19467080839909],
                  [110.01330183841594, 22.133623730723226],
                  [108.23351668216594, 22.316685329991447],
                  [107.09093855716594, 21.848388346228646],
                  [106.03625105716594, 21.39901100508086],
                  [105.92638777591594, 20.660688703466228],
                  [105.00353621341594, 19.608586309058605],
                  [104.91564558841594, 18.716123884529043],
                  [106.67345808841594, 16.32767017426305],
                  [107.90392683841594, 15.20695846789041],
                  [108.23351668216594, 14.824956591270965],
                  [108.54113386966594, 14.016309915840903],
                  [108.65099715091594, 12.990794049200577],
                  [108.56310652591594, 11.853526871562616],
                  [107.37658308841594, 10.992038332819803],
                  [106.60754011966594, 11.315402330352683],
                  [105.53087996341594, 10.517132020335719],
                  [103.68517683841594, 11.70295676854971],
                  [102.63048933841594, 12.926554878977237],
                  [102.19103621341594, 13.055016607861443],
                  [101.50988386966594, 13.162017083660071],
                  [101.40002058841594, 13.931020262903505],
                  [99.51037215091594, 13.867032338837667],
                  [99.45602668257555, 12.276903702638274],
                  [99.03854621382555, 11.115037583211903],
                  [98.62106574507555, 10.467518681476607],
                  [98.62106574507555, 8.71267881476788],
                  [99.39010871382555, 8.625792352179957],
                  [99.63180793257555, 7.472734915470519],
                  [100.31296027632555, 6.491310119918048],
                  [101.03805793257555, 6.22926139401963],
                  [102.88376105757555, 4.63251032575753],
                  [102.97165168257555, 2.746864531635133],
                  [103.49899543257555, 1.4513754157365777],
                  [103.89450324507555, 1.0339940604039786],
                  [105.14694465132555, 1.0339940604039786],
                  [105.56442512007555, 1.649056845587427],
                  [106.66305793257555, 1.495306198691729],
                  [107.76169074507555, 1.407443779340008]]]),
            {
              "system:index": "0"
            })]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
///////////////////////////////
// Coral atlas mapping project - reef outline export script for GBR-torres straigh
// Contact: mitchell.lyons@gmail.com
// Description:
// - Primarily for use in generating exports for wave modelling
///////////////////////////////

var param_module = require('users/mitchest/global_reefs:Modules/reef_params')

// #############################
// load analysis params module
var region_params = param_module.nw_china_sea        //<------------ THIS IS WHERE YOU CHOOSE THE REGION
// choose an appropriate scale
var export_scale = ee.Number(100)
// #############################

//var region_extent = ee.FeatureCollection(region_params.extent_mask).geometry().bounds()

// display it

var Dove_sr = ee.Image(region_params.image)
Map.addLayer(Dove_sr, imageVisParam, "Dove Philippines")
Map.addLayer(reef_mask, {min:1, max:3}, "Global reef mask", true)
//Map.addLayer

// exports
//Map.addLayer(region_extent, {}, "export_geom", true)


// drive export
Export.image.toDrive({
  image: reef_mask, 
  description: 'reef_mask_export_' + region_params.sname,
  folder: 'wcmc_rf/',
  fileNamePrefix: 'reef_mask_' + region_params.sname,
  region: region_extent,
  scale: export_scale,
  crs: 'EPSG:4326',
  maxPixels: 1e13,
  skipEmptyTiles: true
})

Export.table.toDrive({
  collection: refined_mask,
  fileFormat: 'SHP'
})
